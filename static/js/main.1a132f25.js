(()=>{var c,h,l,n={489:e=>{e.exports=function i(r,a,o){function s(n,e){if(!a[n]){if(!r[n]){if(l)return l(n,!0);throw new Error("Cannot find module '"+n+"'")}var t=a[n]={exports:{}};r[n][0].call(t.exports,function(e){var t=r[n][1][e];return s(t||e)},t,t.exports,i,r,a,o)}return a[n].exports}for(var l=void 0,e=0;e<o.length;e++)s(o[e]);return s}({1:[function(e,t,n){t.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(e,t,n){t.exports={version:e("../package.json").version,AABB:e("./collision/AABB"),ArrayCollisionMatrix:e("./collision/ArrayCollisionMatrix"),Body:e("./objects/Body"),Box:e("./shapes/Box"),Broadphase:e("./collision/Broadphase"),Constraint:e("./constraints/Constraint"),ContactEquation:e("./equations/ContactEquation"),Narrowphase:e("./world/Narrowphase"),ConeTwistConstraint:e("./constraints/ConeTwistConstraint"),ContactMaterial:e("./material/ContactMaterial"),ConvexPolyhedron:e("./shapes/ConvexPolyhedron"),Cylinder:e("./shapes/Cylinder"),DistanceConstraint:e("./constraints/DistanceConstraint"),Equation:e("./equations/Equation"),EventTarget:e("./utils/EventTarget"),FrictionEquation:e("./equations/FrictionEquation"),GSSolver:e("./solver/GSSolver"),GridBroadphase:e("./collision/GridBroadphase"),Heightfield:e("./shapes/Heightfield"),HingeConstraint:e("./constraints/HingeConstraint"),LockConstraint:e("./constraints/LockConstraint"),Mat3:e("./math/Mat3"),Material:e("./material/Material"),NaiveBroadphase:e("./collision/NaiveBroadphase"),ObjectCollisionMatrix:e("./collision/ObjectCollisionMatrix"),Pool:e("./utils/Pool"),Particle:e("./shapes/Particle"),Plane:e("./shapes/Plane"),PointToPointConstraint:e("./constraints/PointToPointConstraint"),Quaternion:e("./math/Quaternion"),Ray:e("./collision/Ray"),RaycastVehicle:e("./objects/RaycastVehicle"),RaycastResult:e("./collision/RaycastResult"),RigidVehicle:e("./objects/RigidVehicle"),RotationalEquation:e("./equations/RotationalEquation"),RotationalMotorEquation:e("./equations/RotationalMotorEquation"),SAPBroadphase:e("./collision/SAPBroadphase"),SPHSystem:e("./objects/SPHSystem"),Shape:e("./shapes/Shape"),Solver:e("./solver/Solver"),Sphere:e("./shapes/Sphere"),SplitSolver:e("./solver/SplitSolver"),Spring:e("./objects/Spring"),Trimesh:e("./shapes/Trimesh"),Vec3:e("./math/Vec3"),Vec3Pool:e("./utils/Vec3Pool"),World:e("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(e,t,n){var i=e("../math/Vec3");e("../utils/Utils");function r(e){e=e||{},this.lowerBound=new i,e.lowerBound&&this.lowerBound.copy(e.lowerBound),this.upperBound=new i,e.upperBound&&this.upperBound.copy(e.upperBound)}t.exports=r;var u=new i,a=(r.prototype.setFromPoints=function(e,t,n,i){var r=this.lowerBound,a=this.upperBound,o=n;r.copy(e[0]),o&&o.vmult(r,r),a.copy(r);for(var s=1;s<e.length;s++){var l=e[s];o&&(o.vmult(l,u),l=u),l.x>a.x&&(a.x=l.x),l.x<r.x&&(r.x=l.x),l.y>a.y&&(a.y=l.y),l.y<r.y&&(r.y=l.y),l.z>a.z&&(a.z=l.z),l.z<r.z&&(r.z=l.z)}return t&&(t.vadd(r,r),t.vadd(a,a)),i&&(r.x-=i,r.y-=i,r.z-=i,a.x+=i,a.y+=i,a.z+=i),this},r.prototype.copy=function(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this},r.prototype.clone=function(){return(new r).copy(this)},r.prototype.extend=function(e){var t=e.lowerBound.x,n=(this.lowerBound.x>t&&(this.lowerBound.x=t),e.upperBound.x),t=(this.upperBound.x<n&&(this.upperBound.x=n),e.lowerBound.y),n=(this.lowerBound.y>t&&(this.lowerBound.y=t),e.upperBound.y),t=(this.upperBound.y<n&&(this.upperBound.y=n),e.lowerBound.z),n=(this.lowerBound.z>t&&(this.lowerBound.z=t),e.upperBound.z);this.upperBound.z<n&&(this.upperBound.z=n)},r.prototype.overlaps=function(e){var t=this.lowerBound,n=this.upperBound,i=e.lowerBound,e=e.upperBound;return(i.x<=n.x&&n.x<=e.x||t.x<=e.x&&e.x<=n.x)&&(i.y<=n.y&&n.y<=e.y||t.y<=e.y&&e.y<=n.y)&&(i.z<=n.z&&n.z<=e.z||t.z<=e.z&&e.z<=n.z)},r.prototype.contains=function(e){var t=this.lowerBound,n=this.upperBound,i=e.lowerBound,e=e.upperBound;return t.x<=i.x&&n.x>=e.x&&t.y<=i.y&&n.y>=e.y&&t.z<=i.z&&n.z>=e.z},r.prototype.getCorners=function(e,t,n,i,r,a,o,s){var l=this.lowerBound,u=this.upperBound;e.copy(l),t.set(u.x,l.y,l.z),n.set(u.x,u.y,l.z),i.set(l.x,u.y,u.z),r.set(u.x,l.y,l.z),a.set(l.x,u.y,l.z),o.set(l.x,l.y,u.z),s.copy(u)},[new i,new i,new i,new i,new i,new i,new i,new i]);r.prototype.toLocalFrame=function(e,t){var n=a;this.getCorners(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]);for(var i=0;8!==i;i++){var r=n[i];e.pointToLocal(r,r)}return t.setFromPoints(n)},r.prototype.toWorldFrame=function(e,t){var n=a;this.getCorners(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]);for(var i=0;8!==i;i++){var r=n[i];e.pointToWorld(r,r)}return t.setFromPoints(n)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(e,t,n){function i(){this.matrix=[]}(t.exports=i).prototype.get=function(e,t){var n;return(e=e.index)<(t=t.index)&&(n=t,t=e,e=n),this.matrix[(e*(e+1)>>1)+t-1]},i.prototype.set=function(e,t,n){var i;(e=e.index)<(t=t.index)&&(i=t,t=e,e=i),this.matrix[(e*(e+1)>>1)+t-1]=n?1:0},i.prototype.reset=function(){for(var e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0},i.prototype.setNumObjects=function(e){this.matrix.length=e*(e-1)>>1}},{}],5:[function(e,t,n){var i=e("../objects/Body"),r=e("../math/Vec3"),a=e("../math/Quaternion");e("../shapes/Shape"),e("../shapes/Plane");function o(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}(t.exports=o).prototype.collisionPairs=function(e,t,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var s=i.STATIC|i.KINEMATIC,l=(o.prototype.needBroadphaseCollision=function(e,t){return 0!=(e.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&e.collisionFilterMask)&&(0==(e.type&s)&&e.sleepState!==i.SLEEPING||0==(t.type&s)&&t.sleepState!==i.SLEEPING)},o.prototype.intersectionTest=function(e,t,n,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,n,i):this.doBoundingSphereBroadphase(e,t,n,i)},new r),h=(new r,new a,new r,o.prototype.doBoundingSphereBroadphase=function(e,t,n,i){var r=l,a=(t.position.vsub(e.position,r),Math.pow(e.boundingRadius+t.boundingRadius,2));r.norm2()<a&&(n.push(e),i.push(t))},o.prototype.doBoundingBoxBroadphase=function(e,t,n,i){e.aabbNeedsUpdate&&e.computeAABB(),t.aabbNeedsUpdate&&t.computeAABB(),e.aabb.overlaps(t.aabb)&&(n.push(e),i.push(t))},{keys:[]}),d=[],p=[],u=(o.prototype.makePairsUnique=function(e,t){for(var n=h,i=d,r=p,a=e.length,o=0;o!==a;o++)i[o]=e[o],r[o]=t[o];for(o=t.length=e.length=0;o!==a;o++){var s=i[o].id,l=r[o].id;n[u=s<l?s+","+l:l+","+s]=o,n.keys.push(u)}for(o=0;o!==n.keys.length;o++){var u=n.keys.pop(),c=n[u];e.push(i[c]),t.push(r[c]),delete n[u]}},o.prototype.setWorld=function(e){},new r);o.boundingSphereCheck=function(e,t){var n=u;return e.position.vsub(t.position,n),Math.pow(e.shape.boundingSphereRadius+t.shape.boundingSphereRadius,2)>n.norm2()},o.prototype.aabbQuery=function(e,t,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(e,t,n){t.exports=i;var s=e("./Broadphase"),l=e("../math/Vec3"),Q=e("../shapes/Shape");function i(e,t,n,i,r){s.apply(this),this.nx=n||10,this.ny=i||10,this.nz=r||10,this.aabbMin=e||new l(100,100,100),this.aabbMax=t||new l(-100,-100,-100);var a=this.nx*this.ny*this.nz;if(a<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=a,this.binLengths.length=a;for(var o=0;o<a;o++)this.bins[o]=[],this.binLengths[o]=0}(i.prototype=new s).constructor=i;var $=new l;new l;i.prototype.collisionPairs=function(e,t,n){for(var U=e.numObjects(),B=e.bodies,e=this.aabbMax,i=this.aabbMin,g=this.nx,v=this.ny,_=this.nz,y=v*_,E=_,A=1,r=e.x,a=e.y,e=e.z,x=i.x,T=i.y,S=i.z,w=g/(r-x),b=v/(a-T),M=_/(e-S),o=(r-x)/g,s=(a-T)/v,l=(e-S)/_,F=.5*Math.sqrt(o*o+s*s+l*l),i=Q.types,z=i.SPHERE,k=i.PLANE,R=this.bins,N=this.binLengths,u=this.bins.length,c=0;c!==u;c++)N[c]=0;var I=Math.ceil;function h(e,t,n,i,r,a,o){var e=(e-x)*w|0,s=(t-T)*b|0,l=(n-S)*M|0,u=I((i-x)*w),c=I((r-T)*b),h=I((a-S)*M);e<0?e=0:g<=e&&(e=g-1),s<0?s=0:v<=s&&(s=v-1),l<0?l=0:_<=l&&(l=_-1),u<0?u=0:g<=u&&(u=g-1),c<0?c=0:v<=c&&(c=v-1),h<0?h=0:_<=h&&(h=_-1),s*=E,l*=A,u*=y,c*=E,h*=A;for(var d=e*=y;d<=u;d+=y)for(var p=s;p<=c;p+=E)for(var f=l;f<=h;f+=A){var m=d+p+f;R[m][N[m]++]=o}}for(c=0;c!==U;c++){var d=(P=B[c]).shape;switch(d.type){case z:var p=P.position.x,f=P.position.y,m=P.position.z,C=d.radius;h(p-C,f-C,m-C,p+C,f+C,m+C,P);break;case k:d.worldNormalNeedsUpdate&&d.computeWorldNormal(P.quaternion);var G=d.worldNormal,p=x+.5*o-P.position.x,H=T+.5*s-P.position.y,V=S+.5*l-P.position.z,L=$;L.set(p,H,V);for(var D=0,W=0;D!==g;D++,W+=y,L.y=H,L.x+=o)for(var O=0,j=0;O!==v;O++,j+=E,L.z=V,L.y+=s)for(var Y,q=0,X=0;q!==_;q++,X+=A,L.z+=l)L.dot(G)<F&&(R[Y=W+j+X][N[Y]++]=P);break;default:P.aabbNeedsUpdate&&P.computeAABB(),h(P.aabb.lowerBound.x,P.aabb.lowerBound.y,P.aabb.lowerBound.z,P.aabb.upperBound.x,P.aabb.upperBound.y,P.aabb.upperBound.z,P)}}for(c=0;c!==u;c++){var Z=N[c];if(1<Z)for(var K=R[c],D=0;D!==Z;D++)for(var P=K[D],O=0;O!==D;O++){var J=K[O];this.needBroadphaseCollision(P,J)&&this.intersectionTest(P,J,t,n)}}this.makePairsUnique(t,n)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(e,t,n){t.exports=r;var i=e("./Broadphase"),t=e("./AABB");function r(){i.apply(this)}((r.prototype=new i).constructor=r).prototype.collisionPairs=function(e,t,n){for(var i,r,a,o=e.bodies,s=o.length,l=0;l!==s;l++)for(i=0;i!==l;i++)r=o[l],a=o[i],this.needBroadphaseCollision(r,a)&&this.intersectionTest(r,a,t,n)};new t;r.prototype.aabbQuery=function(e,t,n){n=n||[];for(var i=0;i<e.bodies.length;i++){var r=e.bodies[i];r.aabbNeedsUpdate&&r.computeAABB(),r.aabb.overlaps(t)&&n.push(r)}return n}},{"./AABB":3,"./Broadphase":5}],8:[function(e,t,n){function i(){this.matrix={}}(t.exports=i).prototype.get=function(e,t){var n;return(e=e.id)<(t=t.id)&&(n=t,t=e,e=n),e+"-"+t in this.matrix},i.prototype.set=function(e,t,n){var i;(e=e.id)<(t=t.id)&&(i=t,t=e,e=i),n?this.matrix[e+"-"+t]=!0:delete this.matrix[e+"-"+t]},i.prototype.reset=function(){this.matrix={}},i.prototype.setNumObjects=function(e){}},{}],9:[function(e,t,n){t.exports=m;var f=e("../math/Vec3"),t=e("../math/Quaternion"),x=e("../math/Transform"),i=(e("../shapes/ConvexPolyhedron"),e("../shapes/Box"),e("../collision/RaycastResult")),r=e("../shapes/Shape"),e=e("../collision/AABB");function m(e,t){this.from=e?e.clone():new f,this.to=t?t.clone():new f,this._direction=new f,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=m.ANY,this.result=new i,this.hasHit=!1,this.callback=function(e){}}(m.prototype.constructor=m).CLOSEST=1,m.ANY=2,m.ALL=4;var a=new e,o=[],s=(m.prototype.intersectWorld=function(e,t){return this.mode=t.mode||m.ANY,this.result=t.result||new i,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:-1,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(a),o.length=0,e.broadphase.aabbQuery(e,a,o),this.intersectBodies(o),this.hasHit},new f),l=new f;function S(e,t,n,i){i.vsub(t,h),n.vsub(t,s),e.vsub(t,l);var r,i=h.dot(h),n=h.dot(s),e=h.dot(l),t=s.dot(s),a=s.dot(l);return 0<=(r=t*e-n*a)&&0<=(a=i*a-n*e)&&r+a<i*t-n*n}m.pointInTriangle=S;var u=new f,c=new t,w=(m.prototype.intersectBody=function(e,t){t&&(this.result=t,this._updateDirection());var n=this.checkCollisionResponse;if((!n||e.collisionResponse)&&0!=(this.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&this.collisionFilterMask))for(var i=u,r=c,a=0,o=e.shapes.length;a<o;a++){var s=e.shapes[a];if((!n||s.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[a],r),e.quaternion.vmult(e.shapeOffsets[a],i),i.vadd(e.position,i),this.intersectShape(s,r,i,e),this.result._shouldStop))break}},m.prototype.intersectBodies=function(e,t){t&&(this.result=t,this._updateDirection());for(var n=0,i=e.length;!this.result._shouldStop&&n<i;n++)this.intersectBody(e[n])},m.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},m.prototype.intersectShape=function(e,t,n,i){var r,a,o,s=this.from;s=s,o=this._direction,(r=n).vsub(s,h),a=h.dot(o),o.mult(a,v),v.vadd(s,v),r.distanceTo(v)>e.boundingSphereRadius||(o=this[e.type])&&o.call(this,e,t,n,i)},new f,new f,new f),b=new f,M=new f,R=new f,g=(new f,new i,m.prototype[r.types.BOX]=m.prototype.intersectBox=function(e,t,n,i){return this.intersectConvex(e.convexPolyhedronRepresentation,t,n,i)},m.prototype[r.types.PLANE]=m.prototype.intersectPlane=function(e,t,n,i){var r,a=this.from,o=this.to,s=this._direction,l=new f(0,0,1),t=(t.vmult(l,l),new f),u=(a.vsub(n,t),t.dot(l));o.vsub(n,t),0<u*t.dot(l)||a.distanceTo(o)<u||(t=l.dot(s),Math.abs(t)<this.precision)||(o=new f,u=new f,r=new f,a.vsub(n,o),n=-l.dot(o)/t,s.scale(n,u),a.vadd(u,r),this.reportIntersection(l,r,e,i,-1))},m.prototype.getAABB=function(e){var t=this.to,n=this.from;e.lowerBound.x=Math.min(t.x,n.x),e.lowerBound.y=Math.min(t.y,n.y),e.lowerBound.z=Math.min(t.z,n.z),e.upperBound.x=Math.max(t.x,n.x),e.upperBound.y=Math.max(t.y,n.y),e.upperBound.z=Math.max(t.z,n.z)},{faceList:[0]}),d=(m.prototype[r.types.HEIGHTFIELD]=m.prototype.intersectHeightfield=function(e,t,n,i){e.data;var r=new f,a=new m(this.from,this.to),o=(x.pointToLocalFrame(n,t,a.from,a.from),x.pointToLocalFrame(n,t,a.to,a.to),[]),s=null,l=null,u=null,c=null,h=e.getIndexOfPosition(a.from.x,a.from.y,o,!1);if(h&&(u=s=o[0],c=l=o[1]),e.getIndexOfPosition(a.to.x,a.to.y,o,!1)&&((null===s||o[0]<s)&&(s=o[0]),(null===u||u<o[0])&&(u=o[0]),(null===l||o[1]<l)&&(l=o[1]),null===c||c<o[1])&&(c=o[1]),null!==s)for(var h=[],d=(e.getRectMinMax(s,l,u,c,h),s);d<=u;d++)for(var p=l;p<=c;p++){if(this.result._shouldStop)return;if(e.getConvexTrianglePillar(d,p,!1),x.pointToWorldFrame(n,t,e.pillarOffset,r),this.intersectConvex(e.pillarConvex,t,r,i,g),this.result._shouldStop)return;e.getConvexTrianglePillar(d,p,!0),x.pointToWorldFrame(n,t,e.pillarOffset,r),this.intersectConvex(e.pillarConvex,t,r,i,g)}},new f),p=new f,N=(m.prototype[r.types.SPHERE]=m.prototype.intersectSphere=function(e,t,n,i){var r,a=this.from,o=this.to,s=e.radius,l=Math.pow(o.x-a.x,2)+Math.pow(o.y-a.y,2)+Math.pow(o.z-a.z,2),u=2*((o.x-a.x)*(a.x-n.x)+(o.y-a.y)*(a.y-n.y)+(o.z-a.z)*(a.z-n.z)),s=Math.pow(a.x-n.x,2)+Math.pow(a.y-n.y,2)+Math.pow(a.z-n.z,2)-Math.pow(s,2),s=Math.pow(u,2)-4*l*s,c=d,h=p;s<0||(0==s?(a.lerp(o,s,c),c.vsub(n,h),h.normalize(),this.reportIntersection(h,c,e,i,-1)):(r=(-u-Math.sqrt(s))/(2*l),u=(-u+Math.sqrt(s))/(2*l),0<=r&&r<=1&&(a.lerp(o,r,c),c.vsub(n,h),h.normalize(),this.reportIntersection(h,c,e,i,-1)),this.result._shouldStop||0<=u&&u<=1&&(a.lerp(o,u,c),c.vsub(n,h),h.normalize(),this.reportIntersection(h,c,e,i,-1))))},new f),I=(new f,new f,new f),T=(m.prototype[r.types.CONVEXPOLYHEDRON]=m.prototype.intersectConvex=function(e,t,n,i,r){for(var a=N,o=I,s=r&&r.faceList||null,l=e.faces,u=e.vertices,c=e.faceNormals,h=this._direction,d=this.from,r=this.to,p=d.distanceTo(r),f=(s||l).length,m=this.result,g=0;!m._shouldStop&&g<f;g++){var v=s?s[g]:g,_=l[v],y=c[v],E=t,A=n,y=(o.copy(u[_[0]]),E.vmult(o,o),o.vadd(A,o),o.vsub(d,o),E.vmult(y,a),h.dot(a));if(!(Math.abs(y)<this.precision)){y=a.dot(o)/y;if(!(y<0)){h.mult(y,w),w.vadd(d,w),b.copy(u[_[0]]),E.vmult(b,b),A.vadd(b,b);for(var x=1;!m._shouldStop&&x<_.length-1;x++){M.copy(u[_[x]]),R.copy(u[_[x+1]]),E.vmult(M,M),E.vmult(R,R),A.vadd(M,M),A.vadd(R,R);var T=w.distanceTo(d);!S(w,b,M,R)&&!S(w,M,b,R)||p<T||this.reportIntersection(a,w,e,i,v)}}}}},new f),C=new f,L=new f,D=new f,O=new f,P=new f,U=(new e,[]),B=new x,h=(m.prototype[r.types.TRIMESH]=m.prototype.intersectTrimesh=function(e,t,n,i,r){var a=T,o=U,s=B,l=I,u=C,c=L,h=D,d=P,p=O,f=(r&&r.faceList,e.indices),r=this.from,m=this.to,g=this._direction,v=(s.position.copy(n),s.quaternion.copy(t),x.vectorToLocalFrame(n,t,g,u),x.pointToLocalFrame(n,t,r,c),x.pointToLocalFrame(n,t,m,h),c.distanceSquared(h));e.tree.rayQuery(this,s,o);for(var _=0,y=o.length;!this.result._shouldStop&&_!==y;_++){var E=o[_],A=(e.getNormal(E,a),e.getVertex(f[3*E],b),b.vsub(c,l),u.dot(a)),A=a.dot(l)/A;A<0||(u.scale(A,w),w.vadd(c,w),e.getVertex(f[3*E+1],M),e.getVertex(f[3*E+2],R),A=w.distanceSquared(c),!S(w,M,b,R)&&!S(w,b,M,R))||v<A||(x.vectorToWorldFrame(t,a,p),x.pointToWorldFrame(n,t,w,d),this.reportIntersection(p,d,e,i,E))}o.length=0},m.prototype.reportIntersection=function(e,t,n,i,r){var a=this.from,o=this.to,s=a.distanceTo(t),l=this.result;if(!(this.skipBackfaces&&0<e.dot(this._direction)))switch(l.hitFaceIndex=void 0!==r?r:-1,this.mode){case m.ALL:this.hasHit=!0,l.set(a,o,e,t,n,i,s),l.hasHit=!0,this.callback(l);break;case m.CLOSEST:(s<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(a,o,e,t,n,i,s));break;case m.ANY:this.hasHit=!0,l.hasHit=!0,l.set(a,o,e,t,n,i,s),l._shouldStop=!0}},new f),v=new f},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(e,t,n){var i=e("../math/Vec3");function r(){this.rayFromWorld=new i,this.rayToWorld=new i,this.hitNormalWorld=new i,this.hitPointWorld=new i,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}(t.exports=r).prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},r.prototype.abort=function(){this._shouldStop=!0},r.prototype.set=function(e,t,n,i,r,a,o){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=r,this.body=a,this.distance=o}},{"../math/Vec3":30}],11:[function(e,t,n){e("../shapes/Shape");var i=e("../collision/Broadphase");function c(e){i.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var t=this.axisList;this._addBodyHandler=function(e){t.push(e.body)},this._removeBodyHandler=function(e){e=t.indexOf(e.body);-1!==e&&t.splice(e,1)},e&&this.setWorld(e)}((t.exports=c).prototype=new i).setWorld=function(e){for(var t=this.axisList.length=0;t<e.bodies.length;t++)this.axisList.push(e.bodies[t]);e.removeEventListener("addBody",this._addBodyHandler),e.removeEventListener("removeBody",this._removeBodyHandler),e.addEventListener("addBody",this._addBodyHandler),e.addEventListener("removeBody",this._removeBodyHandler),this.world=e,this.dirty=!0},c.insertionSortX=function(e){for(var t=1,n=e.length;t<n;t++){for(var i=e[t],r=t-1;0<=r&&!(e[r].aabb.lowerBound.x<=i.aabb.lowerBound.x);r--)e[r+1]=e[r];e[r+1]=i}return e},c.insertionSortY=function(e){for(var t=1,n=e.length;t<n;t++){for(var i=e[t],r=t-1;0<=r&&!(e[r].aabb.lowerBound.y<=i.aabb.lowerBound.y);r--)e[r+1]=e[r];e[r+1]=i}return e},c.insertionSortZ=function(e){for(var t=1,n=e.length;t<n;t++){for(var i=e[t],r=t-1;0<=r&&!(e[r].aabb.lowerBound.z<=i.aabb.lowerBound.z);r--)e[r+1]=e[r];e[r+1]=i}return e},c.prototype.collisionPairs=function(e,t,n){var i,r=this.axisList,a=r.length,o=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),i=0;i!==a;i++)for(var s=r[i],l=i+1;l<a;l++){var u=r[l];if(this.needBroadphaseCollision(s,u)){if(!c.checkBounds(s,u,o))break;this.intersectionTest(s,u,t,n)}}},c.prototype.sortList=function(){for(var e=this.axisList,t=this.axisIndex,n=e.length,i=0;i!==n;i++){var r=e[i];r.aabbNeedsUpdate&&r.computeAABB()}0===t?c.insertionSortX(e):1===t?c.insertionSortY(e):2===t&&c.insertionSortZ(e)},c.checkBounds=function(e,t,n){0===n?(i=e.position.x,r=t.position.x):1===n?(i=e.position.y,r=t.position.y):2===n&&(i=e.position.z,r=t.position.z);var i,r,n=e.boundingRadius,e=t.boundingRadius;return r-e<i+n},c.prototype.autoDetectAxis=function(){for(var e=0,t=0,n=0,i=0,r=0,a=0,o=this.axisList,s=o.length,l=1/s,u=0;u!==s;u++){var c=o[u],h=c.position.x,h=(e+=h,t+=h*h,c.position.y),h=(n+=h,i+=h*h,c.position.z);r+=h,a+=h*h}var d=t-e*e*l,p=i-n*n*l,l=a-r*r*l;this.axisIndex=p<d?l<d?0:2:l<p?1:2},c.prototype.aabbQuery=function(e,t,n){n=n||[],this.dirty&&(this.sortList(),this.dirty=!1);for(var i=this.axisIndex,i=2===i?"z":1===i?"y":"x",r=this.axisList,a=(t.lowerBound[i],t.upperBound[i],0);a<r.length;a++){var o=r[a];o.aabbNeedsUpdate&&o.computeAABB(),o.aabb.overlaps(t)&&n.push(o)}return n}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(e,t,n){t.exports=i;e("./Constraint");var o=e("./PointToPointConstraint"),s=e("../equations/ConeEquation"),l=e("../equations/RotationalEquation"),u=(e("../equations/ContactEquation"),e("../math/Vec3"));function i(e,t,n){var i=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,r=n.pivotA?n.pivotA.clone():new u,a=n.pivotB?n.pivotB.clone():new u,r=(this.axisA=n.axisA?n.axisA.clone():new u,this.axisB=n.axisB?n.axisB.clone():new u,o.call(this,e,r,t,a,i),this.collideConnected=!!n.collideConnected,this.angle=void 0!==n.angle?n.angle:0,this.coneEquation=new s(e,t,n)),a=this.twistEquation=new l(e,t,n);this.twistAngle=void 0!==n.twistAngle?n.twistAngle:0,r.maxForce=0,r.minForce=-i,a.maxForce=0,a.minForce=-i,this.equations.push(r,a)}i.prototype=new o,i.constructor=i;new u,new u;i.prototype.update=function(){var e=this.bodyA,t=this.bodyB,n=this.coneEquation,i=this.twistEquation;o.prototype.update.call(this),e.vectorToWorldFrame(this.axisA,n.axisA),t.vectorToWorldFrame(this.axisB,n.axisB),this.axisA.tangents(i.axisA,i.axisA),e.vectorToWorldFrame(i.axisA,i.axisA),this.axisB.tangents(i.axisB,i.axisB),t.vectorToWorldFrame(i.axisB,i.axisB),n.angle=this.angle,i.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(e,t,n){t.exports=r;var i=e("../utils/Utils");function r(e,t,n){n=i.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.id=r.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(e&&e.wakeUp(),t)&&t.wakeUp()}r.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},r.prototype.enable=function(){for(var e=this.equations,t=0;t<e.length;t++)e[t].enabled=!0},r.prototype.disable=function(){for(var e=this.equations,t=0;t<e.length;t++)e[t].enabled=!1},r.idCounter=0},{"../utils/Utils":53}],14:[function(e,t,n){t.exports=i;var r=e("./Constraint"),a=e("../equations/ContactEquation");function i(e,t,n,i){r.call(this,e,t),void 0===n&&(n=e.position.distanceTo(t.position)),void 0===i&&(i=1e6),this.distance=n;n=this.distanceEquation=new a(e,t);this.equations.push(n),n.minForce=-i,n.maxForce=i}(i.prototype=new r).update=function(){var e=this.bodyA,t=this.bodyB,n=this.distanceEquation,i=.5*this.distance,r=n.ni;t.position.vsub(e.position,r),r.normalize(),r.mult(i,n.ri),r.mult(-i,n.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(e,t,n){t.exports=i;e("./Constraint");var u=e("./PointToPointConstraint"),o=e("../equations/RotationalEquation"),s=e("../equations/RotationalMotorEquation"),l=(e("../equations/ContactEquation"),e("../math/Vec3"));function i(e,t,n){var i=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,r=n.pivotA?n.pivotA.clone():new l,a=n.pivotB?n.pivotB.clone():new l;u.call(this,e,r,t,a,i),(this.axisA=n.axisA?n.axisA.clone():new l(1,0,0)).normalize();(this.axisB=n.axisB?n.axisB.clone():new l(1,0,0)).normalize();r=this.rotationalEquation1=new o(e,t,n),a=this.rotationalEquation2=new o(e,t,n),n=this.motorEquation=new s(e,t,i);n.enabled=!1,this.equations.push(r,a,n)}i.prototype=new u,(i.constructor=i).prototype.enableMotor=function(){this.motorEquation.enabled=!0},i.prototype.disableMotor=function(){this.motorEquation.enabled=!1},i.prototype.setMotorSpeed=function(e){this.motorEquation.targetVelocity=e},i.prototype.setMotorMaxForce=function(e){this.motorEquation.maxForce=e,this.motorEquation.minForce=-e};var c=new l,h=new l;i.prototype.update=function(){var e=this.bodyA,t=this.bodyB,n=this.motorEquation,i=this.rotationalEquation1,r=this.rotationalEquation2,a=c,o=h,s=this.axisA,l=this.axisB;u.prototype.update.call(this),e.quaternion.vmult(s,a),t.quaternion.vmult(l,o),a.tangents(i.axisA,r.axisA),i.axisB.copy(o),r.axisB.copy(o),this.motorEquation.enabled&&(e.quaternion.vmult(this.axisA,n.axisA),t.quaternion.vmult(this.axisB,n.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(e,t,n){t.exports=i;e("./Constraint");var s=e("./PointToPointConstraint"),l=e("../equations/RotationalEquation"),u=(e("../equations/RotationalMotorEquation"),e("../equations/ContactEquation"),e("../math/Vec3"));function i(e,t,n){var i=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,r=new u,a=new u,o=new u,o=(e.position.vadd(t.position,o),o.scale(.5,o),t.pointToLocalFrame(o,a),e.pointToLocalFrame(o,r),s.call(this,e,r,t,a,i),this.rotationalEquation1=new l(e,t,n)),r=this.rotationalEquation2=new l(e,t,n),a=this.rotationalEquation3=new l(e,t,n);this.equations.push(o,r,a)}i.prototype=new s,i.constructor=i;new u,new u;i.prototype.update=function(){var e=this.bodyA,t=this.bodyB,n=(this.motorEquation,this.rotationalEquation1),i=this.rotationalEquation2,r=this.rotationalEquation3;s.prototype.update.call(this),e.vectorToWorldFrame(u.UNIT_X,n.axisA),t.vectorToWorldFrame(u.UNIT_Y,n.axisB),e.vectorToWorldFrame(u.UNIT_Y,i.axisA),t.vectorToWorldFrame(u.UNIT_Z,i.axisB),e.vectorToWorldFrame(u.UNIT_Z,r.axisA),t.vectorToWorldFrame(u.UNIT_X,r.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(e,t,n){t.exports=i;var a=e("./Constraint"),o=e("../equations/ContactEquation"),s=e("../math/Vec3");function i(e,t,n,i,r){a.call(this,e,n),r=void 0!==r?r:1e6,this.pivotA=t?t.clone():new s,this.pivotB=i?i.clone():new s;t=this.equationX=new o(e,n),i=this.equationY=new o(e,n),e=this.equationZ=new o(e,n);this.equations.push(t,i,e),t.minForce=i.minForce=e.minForce=-r,t.maxForce=i.maxForce=e.maxForce=r,t.ni.set(1,0,0),i.ni.set(0,1,0),e.ni.set(0,0,1)}(i.prototype=new a).update=function(){var e=this.bodyA,t=this.bodyB,n=this.equationX,i=this.equationY,r=this.equationZ;e.quaternion.vmult(this.pivotA,n.ri),t.quaternion.vmult(this.pivotB,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),r.ri.copy(n.ri),r.rj.copy(n.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(e,t,n){t.exports=i;var r=e("../math/Vec3"),a=(e("../math/Mat3"),e("./Equation"));function i(e,t,n){var i=void 0!==(n=n||{}).maxForce?n.maxForce:1e6;a.call(this,e,t,-i,i),this.axisA=n.axisA?n.axisA.clone():new r(1,0,0),this.axisB=n.axisB?n.axisB.clone():new r(0,1,0),this.angle=void 0!==n.angle?n.angle:0}(i.prototype=new a).constructor=i;var u=new r,c=new r;i.prototype.computeB=function(e){var t=this.a,n=this.b,i=this.axisA,r=this.axisB,a=u,o=c,s=this.jacobianElementA,l=this.jacobianElementB;return i.cross(r,a),r.cross(i,o),s.rotational.copy(o),l.rotational.copy(a),-(Math.cos(this.angle)-i.dot(r))*t-this.computeGW()*n-e*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(e,t,n){t.exports=a;var i=e("./Equation"),r=e("../math/Vec3");e("../math/Mat3");function a(e,t,n){i.call(this,e,t,0,n=void 0!==n?n:1e6),this.restitution=0,this.ri=new r,this.rj=new r,this.ni=new r}(a.prototype=new i).constructor=a;var v=new r,_=new r,y=new r,o=(a.prototype.computeB=function(e){var t=this.a,n=this.b,i=this.bi,r=this.bj,a=this.ri,o=this.rj,s=v,l=_,u=i.velocity,c=i.angularVelocity,h=r.velocity,d=r.angularVelocity,p=y,f=this.jacobianElementA,m=this.jacobianElementB,g=this.ni,f=(a.cross(g,s),o.cross(g,l),g.negate(f.spatial),s.negate(f.rotational),m.spatial.copy(g),m.rotational.copy(l),p.copy(r.position),p.vadd(o,p),p.vsub(i.position,p),p.vsub(a,p),g.dot(p)),m=this.restitution+1;return-f*t-(m*h.dot(g)-m*u.dot(g)+d.dot(l)-c.dot(s))*n-e*this.computeGiMf()},new r),s=new r,l=new r,u=new r,c=new r;a.prototype.getImpactVelocityAlongNormal=function(){var e=o,t=s,n=l,i=u,r=c;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(n,e),this.bj.getVelocityAtWorldPoint(i,t),e.vsub(t,r),this.ni.dot(r)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(e,t,n){t.exports=a;var r=e("../math/JacobianElement"),t=e("../math/Vec3");function a(e,t,n,i){this.id=a.id++,this.minForce=void 0===n?-1e6:n,this.maxForce=void 0===i?1e6:i,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new r,this.jacobianElementB=new r,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}(a.prototype.constructor=a).id=0,a.prototype.setSpookParams=function(e,t,n){this.a=4/(n*(1+4*t)),this.b=4*t/(1+4*t),this.eps=4/(n*n*e*(1+4*t))},a.prototype.computeB=function(e,t,n){var i=this.computeGW();return-this.computeGq()*e-i*t-this.computeGiMf()*n},a.prototype.computeGq=function(){var e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,n=n.position,i=i.position;return e.spatial.dot(n)+t.spatial.dot(i)};var o=new t,u=(a.prototype.computeGW=function(){var e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.velocity,a=i.velocity,i=i.angularVelocity||o;return e.multiplyVectors(r,n.angularVelocity||o)+t.multiplyVectors(a,i)},a.prototype.computeGWlambda=function(){var e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.vlambda,a=i.vlambda,i=i.wlambda||o;return e.multiplyVectors(r,n.wlambda||o)+t.multiplyVectors(a,i)},new t),c=new t,h=new t,d=new t,s=(a.prototype.computeGiMf=function(){var e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.force,a=i.force,o=i.torque,s=n.invMassSolve,l=i.invMassSolve;return n.invInertiaWorldSolve?n.invInertiaWorldSolve.vmult(n.torque,h):h.set(0,0,0),i.invInertiaWorldSolve?i.invInertiaWorldSolve.vmult(o,d):d.set(0,0,0),r.mult(s,u),a.mult(l,c),e.multiplyVectors(u,h)+t.multiplyVectors(c,d)},new t),l=(a.prototype.computeGiMGt=function(){var e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.invMassSolve,a=i.invMassSolve,n=n.invInertiaWorldSolve,i=i.invInertiaWorldSolve,r=r+a;return n&&(n.vmult(e.rotational,s),r+=s.dot(e.rotational)),i&&(i.vmult(t.rotational,s),r+=s.dot(t.rotational)),r},new t);new t,new t,new t,new t,new t;a.prototype.addToWlambda=function(e){var t=this.jacobianElementA,n=this.jacobianElementB,i=this.bi,r=this.bj,a=l;t.spatial.mult(i.invMassSolve*e,a),i.vlambda.vadd(a,i.vlambda),n.spatial.mult(r.invMassSolve*e,a),r.vlambda.vadd(a,r.vlambda),i.invInertiaWorldSolve&&(i.invInertiaWorldSolve.vmult(t.rotational,a),a.mult(e,a),i.wlambda.vadd(a,i.wlambda)),r.invInertiaWorldSolve&&(r.invInertiaWorldSolve.vmult(n.rotational,a),a.mult(e,a),r.wlambda.vadd(a,r.wlambda))},a.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(e,t,n){t.exports=a;var i=e("./Equation"),r=e("../math/Vec3");e("../math/Mat3");function a(e,t,n){i.call(this,e,t,-n,n),this.ri=new r,this.rj=new r,this.t=new r}(a.prototype=new i).constructor=a;var s=new r,l=new r;a.prototype.computeB=function(e){this.a;var t=this.b,n=(this.bi,this.bj,this.ri),i=this.rj,r=s,a=l,o=this.t,n=(n.cross(o,r),i.cross(o,a),this.jacobianElementA),i=this.jacobianElementB;return o.negate(n.spatial),r.negate(n.rotational),i.spatial.copy(o),i.rotational.copy(a),-this.computeGW()*t-e*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(e,t,n){t.exports=i;var r=e("../math/Vec3"),a=(e("../math/Mat3"),e("./Equation"));function i(e,t,n){var i=void 0!==(n=n||{}).maxForce?n.maxForce:1e6;a.call(this,e,t,-i,i),this.axisA=n.axisA?n.axisA.clone():new r(1,0,0),this.axisB=n.axisB?n.axisB.clone():new r(0,1,0),this.maxAngle=Math.PI/2}(i.prototype=new a).constructor=i;var u=new r,c=new r;i.prototype.computeB=function(e){var t=this.a,n=this.b,i=this.axisA,r=this.axisB,a=u,o=c,s=this.jacobianElementA,l=this.jacobianElementB;return i.cross(r,a),r.cross(i,o),s.rotational.copy(o),l.rotational.copy(a),-(Math.cos(this.maxAngle)-i.dot(r))*t-this.computeGW()*n-e*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(e,t,n){t.exports=a;var i=e("../math/Vec3"),r=(e("../math/Mat3"),e("./Equation"));function a(e,t,n){r.call(this,e,t,-(n=void 0!==n?n:1e6),n),this.axisA=new i,this.axisB=new i,this.targetVelocity=0}((a.prototype=new r).constructor=a).prototype.computeB=function(e){this.a;var t=this.b,n=(this.bi,this.bj,this.axisA),i=this.axisB,r=this.jacobianElementA,a=this.jacobianElementB;return r.rotational.copy(n),i.negate(a.rotational),-(this.computeGW()-this.targetVelocity)*t-e*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(e,t,n){var i=e("../utils/Utils");function r(e,t,n){n=i.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=r.idCounter++,this.materials=[e,t],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}(t.exports=r).idCounter=0},{"../utils/Utils":53}],25:[function(e,t,n){function i(e){var t="";"string"==typeof(e=e||{})?(t=e,e={}):"object"==typeof e&&(t=""),this.name=t,this.id=i.idCounter++,this.friction=void 0!==e.friction?e.friction:-1,this.restitution=void 0!==e.restitution?e.restitution:-1}(t.exports=i).idCounter=0},{}],26:[function(e,t,n){t.exports=r;var i=e("./Vec3");function r(){this.spatial=new i,this.rotational=new i}r.prototype.multiplyElement=function(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)},r.prototype.multiplyVectors=function(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}},{"./Vec3":30}],27:[function(e,t,n){t.exports=u;var c=e("./Vec3");function u(e){this.elements=e||[0,0,0,0,0,0,0,0,0]}u.prototype.identity=function(){var e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1},u.prototype.setZero=function(){var e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0},u.prototype.setTrace=function(e){var t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z},u.prototype.getTrace=function(e){var e=e||new c,t=this.elements;e.x=t[0],e.y=t[4],e.z=t[8]},u.prototype.vmult=function(e,t){t=t||new c;var n=this.elements,i=e.x,r=e.y,e=e.z;return t.x=n[0]*i+n[1]*r+n[2]*e,t.y=n[3]*i+n[4]*r+n[5]*e,t.z=n[6]*i+n[7]*r+n[8]*e,t},u.prototype.smult=function(e){for(var t=0;t<this.elements.length;t++)this.elements[t]*=e},u.prototype.mmult=function(e,t){for(var n=t||new u,i=0;i<3;i++)for(var r=0;r<3;r++){for(var a=0,o=0;o<3;o++)a+=e.elements[i+3*o]*this.elements[o+3*r];n.elements[i+3*r]=a}return n},u.prototype.scale=function(e,t){t=t||new u;for(var n=this.elements,i=t.elements,r=0;3!==r;r++)i[3*r+0]=e.x*n[3*r+0],i[3*r+1]=e.y*n[3*r+1],i[3*r+2]=e.z*n[3*r+2];return t},u.prototype.solve=function(e,t){t=t||new c;for(var n,i=[],r=0;r<12;r++)i.push(0);for(r=0;r<3;r++)for(n=0;n<3;n++)i[r+4*n]=this.elements[r+3*n];i[3]=e.x,i[7]=e.y,i[11]=e.z;var a,o=3,s=o;do{if(0===i[(r=s-o)+4*r])for(n=r+1;n<s;n++)if(0!==i[r+4*n]){for(u=4;i[(a=4-u)+4*r]+=i[a+4*n],--u;);break}if(0!==i[r+4*r])for(n=r+1;n<s;n++)for(var l=i[r+4*n]/i[r+4*r],u=4;i[(a=4-u)+4*n]=a<=r?0:i[a+4*n]-i[a+4*r]*l,--u;);}while(--o);if(t.z=i[11]/i[10],t.y=(i[7]-i[6]*t.z)/i[5],t.x=(i[3]-i[2]*t.z-i[1]*t.y)/i[0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw"Could not solve equation! Got x=["+t.toString()+"], b=["+e.toString()+"], A=["+this.toString()+"]";return t},u.prototype.e=function(e,t,n){if(void 0===n)return this.elements[t+3*e];this.elements[t+3*e]=n},u.prototype.copy=function(e){for(var t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this},u.prototype.toString=function(){for(var e="",t=0;t<9;t++)e+=this.elements[t]+",";return e},u.prototype.reverse=function(e){e=e||new u;for(var t,n=[],i=0;i<18;i++)n.push(0);for(i=0;i<3;i++)for(t=0;t<3;t++)n[i+6*t]=this.elements[i+3*t];n[3]=1,n[9]=0,n[15]=0,n[4]=0,n[10]=1,n[16]=0,n[5]=0,n[11]=0,n[17]=1;var r,a=3,o=a;do{if(0===n[(i=o-a)+6*i])for(t=i+1;t<o;t++)if(0!==n[i+6*t]){for(l=6;n[(r=6-l)+6*i]+=n[r+6*t],--l;);break}if(0!==n[i+6*i])for(t=i+1;t<o;t++)for(var s=n[i+6*t]/n[i+6*i],l=6;n[(r=6-l)+6*t]=r<=i?0:n[r+6*t]-n[r+6*i]*s,--l;);}while(--a);i=2;do{t=i-1;do{s=n[i+6*t]/n[i+6*i];for(l=6;n[(r=6-l)+6*t]=n[r+6*t]-n[r+6*i]*s,--l;);}while(t--)}while(--i);i=2;do{s=1/n[i+6*i];for(l=6;n[(r=6-l)+6*i]=n[r+6*i]*s,--l;);}while(i--);i=2;do{t=2;do{if(r=n[3+t+6*i],isNaN(r)||r===1/0)throw"Could not reverse! A=["+this.toString()+"]"}while(e.e(i,t,r),t--)}while(i--);return e},u.prototype.setRotationFromQuaternion=function(e){var t=e.x,n=e.y,i=e.z,e=e.w,r=t+t,a=n+n,o=i+i,s=t*r,l=t*a,t=t*o,u=n*a,n=n*o,i=i*o,r=e*r,a=e*a,e=e*o,o=this.elements;return o[0]=1-(u+i),o[1]=l-e,o[2]=t+a,o[3]=l+e,o[4]=1-(s+i),o[5]=n-r,o[6]=t-a,o[7]=n+r,o[8]=1-(s+u),this},u.prototype.transpose=function(e){for(var t=(e=e||new u).elements,n=this.elements,i=0;3!==i;i++)for(var r=0;3!==r;r++)t[3*i+r]=n[3*r+i];return e}},{"./Vec3":30}],28:[function(e,t,n){t.exports=o;var h=e("./Vec3");function o(e,t,n,i){this.x=void 0!==e?e:0,this.y=void 0!==t?t:0,this.z=void 0!==n?n:0,this.w=void 0!==i?i:1}o.prototype.set=function(e,t,n,i){this.x=e,this.y=t,this.z=n,this.w=i},o.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},o.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},o.prototype.setFromAxisAngle=function(e,t){var n=Math.sin(.5*t);this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(.5*t)},o.prototype.toAxisAngle=function(e){e=e||new h,this.normalize();var t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]};var i=new h,r=new h,s=(o.prototype.setFromVectors=function(e,t){var n;e.isAntiparallelTo(t)?(e.tangents(n=i,r),this.setFromAxisAngle(n,Math.PI)):(n=e.cross(t),this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(Math.pow(e.norm(),2)*Math.pow(t.norm(),2))+e.dot(t),this.normalize())},new h),l=new h,u=new h;o.prototype.mult=function(e,t){t=t||new o;var n=this.w,i=s,r=l,a=u;return i.set(this.x,this.y,this.z),r.set(e.x,e.y,e.z),t.w=n*e.w-i.dot(r),i.cross(r,a),t.x=n*r.x+e.w*i.x+a.x,t.y=n*r.y+e.w*i.y+a.y,t.z=n*r.z+e.w*i.z+a.z,t},o.prototype.inverse=function(e){var t=this.x,n=this.y,i=this.z,r=this.w,t=(e=e||new o,this.conjugate(e),1/(t*t+n*n+i*i+r*r));return e.x*=t,e.y*=t,e.z*=t,e.w*=t,e},o.prototype.conjugate=function(e){return(e=e||new o).x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e},o.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e=1/e,this.y*=e,this.z*=e,this.w*=e)},o.prototype.normalizeFast=function(){var e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0==e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e)},o.prototype.vmult=function(e,t){t=t||new h;var n=e.x,i=e.y,e=e.z,r=this.x,a=this.y,o=this.z,s=this.w,l=s*n+a*e-o*i,u=s*i+o*n-r*e,c=s*e+r*i-a*n,n=-r*n-a*i-o*e;return t.x=l*s+n*-r+u*-o-c*-a,t.y=u*s+n*-a+c*-r-l*-o,t.z=c*s+n*-o+l*-a-u*-r,t},o.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},o.prototype.toEuler=function(e,t){t=t||"YZX";var n=this.x,i=this.y,r=this.z,a=this.w;if("YZX"!==t)throw new Error("Euler order "+t+" not supported yet.");var o,s,l,u,c,t=n*i+r*a;.499<t&&(l=2*Math.atan2(n,a),u=Math.PI/2,c=0),t<-.499&&(l=-2*Math.atan2(n,a),u=-Math.PI/2,c=0),isNaN(l)&&(o=n*n,s=r*r,l=Math.atan2(2*i*a-2*n*r,1-2*(i*i)-2*s),u=Math.asin(2*t),c=Math.atan2(2*n*a-2*i*r,1-2*o-2*s)),e.y=l,e.z=u,e.x=c},o.prototype.setFromEuler=function(e,t,n,i){i=i||"XYZ";var r=Math.cos(e/2),a=Math.cos(t/2),o=Math.cos(n/2),e=Math.sin(e/2),t=Math.sin(t/2),n=Math.sin(n/2);return"XYZ"===i?(this.x=e*a*o+r*t*n,this.y=r*t*o-e*a*n,this.z=r*a*n+e*t*o,this.w=r*a*o-e*t*n):"YXZ"===i?(this.x=e*a*o+r*t*n,this.y=r*t*o-e*a*n,this.z=r*a*n-e*t*o,this.w=r*a*o+e*t*n):"ZXY"===i?(this.x=e*a*o-r*t*n,this.y=r*t*o+e*a*n,this.z=r*a*n+e*t*o,this.w=r*a*o-e*t*n):"ZYX"===i?(this.x=e*a*o-r*t*n,this.y=r*t*o+e*a*n,this.z=r*a*n-e*t*o,this.w=r*a*o+e*t*n):"YZX"===i?(this.x=e*a*o+r*t*n,this.y=r*t*o+e*a*n,this.z=r*a*n-e*t*o,this.w=r*a*o-e*t*n):"XZY"===i&&(this.x=e*a*o-r*t*n,this.y=r*t*o-e*a*n,this.z=r*a*n+e*t*o,this.w=r*a*o+e*t*n),this},o.prototype.clone=function(){return new o(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(e,t,n){var r=e("./Vec3"),i=e("./Quaternion");function a(e){e=e||{},this.position=new r,e.position&&this.position.copy(e.position),this.quaternion=new i,e.quaternion&&this.quaternion.copy(e.quaternion)}t.exports=a;var o=new i;a.pointToLocalFrame=function(e,t,n,i){i=i||new r;return n.vsub(e,i),t.conjugate(o),o.vmult(i,i),i},a.prototype.pointToLocal=function(e,t){return a.pointToLocalFrame(this.position,this.quaternion,e,t)},a.pointToWorldFrame=function(e,t,n,i){i=i||new r;return t.vmult(n,i),i.vadd(e,i),i},a.prototype.pointToWorld=function(e,t){return a.pointToWorldFrame(this.position,this.quaternion,e,t)},a.prototype.vectorToWorldFrame=function(e,t){t=t||new r;return this.quaternion.vmult(e,t),t},a.vectorToWorldFrame=function(e,t,n){return e.vmult(t,n),n},a.vectorToLocalFrame=function(e,t,n,i){i=i||new r;return t.w*=-1,t.vmult(n,i),t.w*=-1,i}},{"./Quaternion":28,"./Vec3":30}],30:[function(e,t,n){t.exports=s;var i=e("./Mat3");function s(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}s.ZERO=new s(0,0,0),s.UNIT_X=new s(1,0,0),s.UNIT_Y=new s(0,1,0),s.UNIT_Z=new s(0,0,1),s.prototype.cross=function(e,t){var n=e.x,i=e.y,e=e.z,r=this.x,a=this.y,o=this.z;return(t=t||new s).x=a*e-o*i,t.y=o*n-r*e,t.z=r*i-a*n,t},s.prototype.set=function(e,t,n){return this.x=e,this.y=t,this.z=n,this},s.prototype.setZero=function(){this.x=this.y=this.z=0},s.prototype.vadd=function(e,t){if(!t)return new s(this.x+e.x,this.y+e.y,this.z+e.z);t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z},s.prototype.vsub=function(e,t){if(!t)return new s(this.x-e.x,this.y-e.y,this.z-e.z);t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z},s.prototype.crossmat=function(){return new i([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},s.prototype.normalize=function(){var e=this.x,t=this.y,n=this.z,e=Math.sqrt(e*e+t*t+n*n);return 0<e?(this.x*=t=1/e,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),e},s.prototype.unit=function(e){e=e||new s;var t=this.x,n=this.y,i=this.z,r=Math.sqrt(t*t+n*n+i*i);return 0<r?(e.x=t*(r=1/r),e.y=n*r,e.z=i*r):(e.x=1,e.y=0,e.z=0),e},s.prototype.length=s.prototype.norm=function(){var e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)},s.prototype.lengthSquared=s.prototype.norm2=function(){return this.dot(this)},s.prototype.distanceTo=function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,e=e.z;return Math.sqrt((r-t)*(r-t)+(a-n)*(a-n)+(e-i)*(e-i))},s.prototype.distanceSquared=function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,e=e.z;return(r-t)*(r-t)+(a-n)*(a-n)+(e-i)*(e-i)},s.prototype.scale=s.prototype.mult=function(e,t){t=t||new s;var n=this.x,i=this.y,r=this.z;return t.x=e*n,t.y=e*i,t.z=e*r,t},s.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},s.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},s.prototype.negate=function(e){return(e=e||new s).x=-this.x,e.y=-this.y,e.z=-this.z,e};var r=new s,a=new s,o=(s.prototype.tangents=function(e,t){var n,i=this.norm();0<i?((n=r).set(this.x*(i=1/i),this.y*i,this.z*i),i=a,Math.abs(n.x)<.9?i.set(1,0,0):i.set(0,1,0),n.cross(i,e),n.cross(e,t)):(e.set(1,0,0),t.set(0,1,0))},s.prototype.toString=function(){return this.x+","+this.y+","+this.z},s.prototype.toArray=function(){return[this.x,this.y,this.z]},s.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},s.prototype.lerp=function(e,t,n){var i=this.x,r=this.y,a=this.z;n.x=i+(e.x-i)*t,n.y=r+(e.y-r)*t,n.z=a+(e.z-a)*t},s.prototype.almostEquals=function(e,t){return void 0===t&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)},s.prototype.almostZero=function(e){return void 0===e&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)},new s);s.prototype.isAntiparallelTo=function(e,t){return this.negate(o),o.almostEquals(e,t)},s.prototype.clone=function(){return new s(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(e,t,n){t.exports=u;var i=e("../utils/EventTarget"),a=(e("../shapes/Shape"),e("../math/Vec3")),r=e("../math/Mat3"),o=e("../math/Quaternion"),s=(e("../material/Material"),e("../collision/AABB")),l=e("../shapes/Box");function u(e){e=e||{},i.apply(this),this.id=u.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new a,this.collisionFilterGroup="number"==typeof e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof e.collisionFilterMask?e.collisionFilterMask:1,this.collisionResponse=!0,this.position=new a,e.position&&this.position.copy(e.position),this.previousPosition=new a,this.initPosition=new a,this.velocity=new a,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new a,this.force=new a;var t="number"==typeof e.mass?e.mass:0;this.mass=t,this.invMass=0<t?1/t:0,this.material=e.material||null,this.linearDamping="number"==typeof e.linearDamping?e.linearDamping:.01,this.type=t<=0?u.STATIC:u.DYNAMIC,typeof e.type==typeof u.STATIC&&(this.type=e.type),this.allowSleep=void 0===e.allowSleep||e.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==e.sleepSpeedLimit?e.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==e.sleepTimeLimit?e.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new a,this.quaternion=new o,e.quaternion&&this.quaternion.copy(e.quaternion),this.initQuaternion=new o,this.angularVelocity=new a,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new a,this.interpolatedPosition=new a,this.interpolatedQuaternion=new o,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new a,this.invInertia=new a,this.invInertiaWorld=new r,this.invMassSolve=0,this.invInertiaSolve=new a,this.invInertiaWorldSolve=new r,this.fixedRotation=void 0!==e.fixedRotation&&e.fixedRotation,this.angularDamping=void 0!==e.angularDamping?e.angularDamping:.01,this.aabb=new s,this.aabbNeedsUpdate=!0,this.wlambda=new a,e.shape&&this.addShape(e.shape),this.updateMassProperties()}((u.prototype=new i).constructor=u).DYNAMIC=1,u.STATIC=2,u.KINEMATIC=4,u.AWAKE=0,u.SLEEPY=1,u.SLEEPING=2,u.idCounter=0,u.prototype.wakeUp=function(){var e=this.sleepState;this.sleepState=0,e===u.SLEEPING&&this.dispatchEvent({type:"wakeup"})},u.prototype.sleep=function(){this.sleepState=u.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},u.sleepyEvent={type:"sleepy"},u.sleepEvent={type:"sleep"},u.prototype.sleepTick=function(e){var t,n,i;this.allowSleep&&(t=this.sleepState,n=this.velocity.norm2()+this.angularVelocity.norm2(),i=Math.pow(this.sleepSpeedLimit,2),t===u.AWAKE&&n<i?(this.sleepState=u.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(u.sleepyEvent)):t===u.SLEEPY&&i<n?this.wakeUp():t===u.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(u.sleepEvent)))},u.prototype.updateSolveMassProperties=function(){this.sleepState===u.SLEEPING||this.type===u.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},u.prototype.pointToLocalFrame=function(e,t){t=t||new a;return e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t},u.prototype.vectorToLocalFrame=function(e,t){t=t||new a;return this.quaternion.conjugate().vmult(e,t),t},u.prototype.pointToWorldFrame=function(e,t){t=t||new a;return this.quaternion.vmult(e,t),t.vadd(this.position,t),t},u.prototype.vectorToWorldFrame=function(e,t){t=t||new a;return this.quaternion.vmult(e,t),t};var h=new a,d=new o,p=(u.prototype.addShape=function(e,t,n){var i=new a,r=new o;return t&&i.copy(t),n&&r.copy(n),this.shapes.push(e),this.shapeOffsets.push(i),this.shapeOrientations.push(r),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},u.prototype.updateBoundingRadius=function(){for(var e=this.shapes,t=this.shapeOffsets,n=e.length,i=0,r=0;r!==n;r++){var a=e[r],o=(a.updateBoundingSphereRadius(),t[r].norm()),a=a.boundingSphereRadius;i<o+a&&(i=o+a)}this.boundingRadius=i},new s),c=(u.prototype.computeAABB=function(){for(var e=this.shapes,t=this.shapeOffsets,n=this.shapeOrientations,i=e.length,r=h,a=d,o=this.quaternion,s=this.aabb,l=p,u=0;u!==i;u++){var c=e[u];n[u].mult(o,a),a.vmult(t[u],r),r.vadd(this.position,r),c.calculateWorldAABB(r,a,l.lowerBound,l.upperBound),0===u?s.copy(l):s.extend(l)}this.aabbNeedsUpdate=!1},new r),f=new r,m=(new r,u.prototype.updateInertiaWorld=function(e){var t,n=this.invInertia;n.x===n.y&&n.y===n.z&&!e||(e=f,(t=c).setRotationFromQuaternion(this.quaternion),t.transpose(e),t.scale(n,t),t.mmult(e,this.invInertiaWorld))},new a),g=new a,v=(u.prototype.applyForce=function(e,t){this.type===u.DYNAMIC&&(t.vsub(this.position,t=m),t.cross(e,t=g),this.force.vadd(e,this.force),this.torque.vadd(t,this.torque))},new a),_=new a,y=(u.prototype.applyLocalForce=function(e,t){var n;this.type===u.DYNAMIC&&(n=_,this.vectorToWorldFrame(e,e=v),this.pointToWorldFrame(t,n),this.applyForce(e,n))},new a),E=new a,A=new a,x=(u.prototype.applyImpulse=function(e,t){var n;this.type===u.DYNAMIC&&(t.vsub(this.position,t=y),(n=E).copy(e),n.mult(this.invMass,n),this.velocity.vadd(n,this.velocity),t.cross(e,n=A),this.invInertiaWorld.vmult(n,n),this.angularVelocity.vadd(n,this.angularVelocity))},new a),T=new a,S=(u.prototype.applyLocalImpulse=function(e,t){var n;this.type===u.DYNAMIC&&(n=T,this.vectorToWorldFrame(e,e=x),this.pointToWorldFrame(t,n),this.applyImpulse(e,n))},new a);u.prototype.updateMassProperties=function(){var e=S,t=(this.invMass=0<this.mass?1/this.mass:0,this.inertia),n=this.fixedRotation;this.computeAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),l.calculateInertia(e,this.mass,t),this.invInertia.set(0<t.x&&!n?1/t.x:0,0<t.y&&!n?1/t.y:0,0<t.z&&!n?1/t.z:0),this.updateInertiaWorld(!0)},u.prototype.getVelocityAtWorldPoint=function(e,t){var n=new a;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(e,t,n){e("./Body");var E=e("../math/Vec3"),a=e("../math/Quaternion"),i=(e("../collision/RaycastResult"),e("../collision/Ray")),r=e("../objects/WheelInfo");function o(e){this.chassisBody=e.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==e.indexRightAxis?e.indexRightAxis:1,this.indexForwardAxis=void 0!==e.indexForwardAxis?e.indexForwardAxis:0,this.indexUpAxis=void 0!==e.indexUpAxis?e.indexUpAxis:2}t.exports=o;new E,new E,new E;var s=new E,l=new E,u=new E,c=(new i,o.prototype.addWheel=function(e){var e=new r(e=e||{}),t=this.wheelInfos.length;return this.wheelInfos.push(e),t},o.prototype.setSteeringValue=function(e,t){this.wheelInfos[t].steering=e},new E,o.prototype.applyEngineForce=function(e,t){this.wheelInfos[t].engineForce=e},o.prototype.setBrake=function(e,t){this.wheelInfos[t].brake=e},o.prototype.addToWorld=function(e){this.constraints;e.add(this.chassisBody);var t=this;this.preStepCallback=function(){t.updateVehicle(e.dt)},e.addEventListener("preStep",this.preStepCallback),this.world=e},o.prototype.getVehicleAxisWorld=function(e,t){t.set(0===e?1:0,1===e?1:0,2===e?1:0),this.chassisBody.vectorToWorldFrame(t,t)},o.prototype.updateVehicle=function(e){for(var t=this.wheelInfos,n=t.length,i=this.chassisBody,r=0;r<n;r++)this.updateWheelTransform(r);this.currentVehicleSpeedKmHour=3.6*i.velocity.norm();var a=new E;this.getVehicleAxisWorld(this.indexForwardAxis,a),a.dot(i.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(r=0;r<n;r++)this.castRay(t[r]);this.updateSuspension(e);for(var o=new E,s=new E,r=0;r<n;r++){var l=(p=t[r]).suspensionForce;p.maxSuspensionForce<l&&(l=p.maxSuspensionForce),p.raycastResult.hitNormalWorld.scale(l*e,o),p.raycastResult.hitPointWorld.vsub(i.position,s),i.applyImpulse(o,p.raycastResult.hitPointWorld)}this.updateFriction(e);var u=new E,c=new E,h=new E;for(r=0;r<n;r++){var d,p=t[r],f=(i.getVelocityAtWorldPoint(p.chassisConnectionPointWorld,h),1);1===this.indexUpAxis&&(f=-1),p.isInContact&&(this.getVehicleAxisWorld(this.indexForwardAxis,c),d=c.dot(p.raycastResult.hitNormalWorld),p.raycastResult.hitNormalWorld.scale(d,u),c.vsub(u,c),d=c.dot(h),p.deltaRotation=f*d*e/p.radius),!p.sliding&&p.isInContact||0===p.engineForce||!p.useCustomSlidingRotationalSpeed||(p.deltaRotation=(0<p.engineForce?1:-1)*p.customSlidingRotationalSpeed*e),Math.abs(p.brake)>Math.abs(p.engineForce)&&(p.deltaRotation=0),p.rotation+=p.deltaRotation,p.deltaRotation*=.99}},o.prototype.updateSuspension=function(e){for(var t=this.chassisBody.mass,n=this.wheelInfos,i=n.length,r=0;r<i;r++){var a,o,s=n[r];(!s.isInContact||(a=s.suspensionRestLength,o=s.suspensionLength,a=s.suspensionStiffness*(a-o)*s.clippedInvContactDotSuspension,a-=((o=s.suspensionRelativeVelocity)<0?s.dampingCompression:s.dampingRelaxation)*o,s.suspensionForce=a*t,s.suspensionForce<0))&&(s.suspensionForce=0)}},o.prototype.removeFromWorld=function(e){this.constraints;e.remove(this.chassisBody),e.removeEventListener("preStep",this.preStepCallback),this.world=null},new E),h=new E,A=(o.prototype.castRay=function(e){var t=c,n=h,i=(this.updateWheelTransformWorld(e),this.chassisBody),r=-1,a=e.suspensionRestLength+e.radius,a=(e.directionWorld.scale(a,t),e.chassisConnectionPointWorld),t=(a.vadd(t,n),e.raycastResult),o=(t.reset(),i.collisionResponse),a=(i.collisionResponse=!1,this.world.rayTest(a,n,t),i.collisionResponse=o,t.body);return e.raycastResult.groundObject=0,a?(r=t.distance,e.raycastResult.hitNormalWorld=t.hitNormalWorld,e.isInContact=!0,n=t.distance,e.suspensionLength=n-e.radius,o=e.suspensionRestLength+e.maxSuspensionTravel,e.suspensionLength<(a=e.suspensionRestLength-e.maxSuspensionTravel)&&(e.suspensionLength=a),o<e.suspensionLength&&(e.suspensionLength=o,e.raycastResult.reset()),t=e.raycastResult.hitNormalWorld.dot(e.directionWorld),n=new E,i.getVelocityAtWorldPoint(e.raycastResult.hitPointWorld,n),a=e.raycastResult.hitNormalWorld.dot(n),-.1<=t?(e.suspensionRelativeVelocity=0,e.clippedInvContactDotSuspension=10):(e.suspensionRelativeVelocity=a*(o=-1/t),e.clippedInvContactDotSuspension=o)):(e.suspensionLength=e.suspensionRestLength+0*e.maxSuspensionTravel,e.suspensionRelativeVelocity=0,e.directionWorld.scale(-1,e.raycastResult.hitNormalWorld),e.clippedInvContactDotSuspension=1),r},o.prototype.updateWheelTransformWorld=function(e){e.isInContact=!1;var t=this.chassisBody;t.pointToWorldFrame(e.chassisConnectionPointLocal,e.chassisConnectionPointWorld),t.vectorToWorldFrame(e.directionLocal,e.directionWorld),t.vectorToWorldFrame(e.axleLocal,e.axleWorld)},o.prototype.updateWheelTransform=function(e){var t=s,n=l,i=u,e=this.wheelInfos[e],i=(this.updateWheelTransformWorld(e),e.directionLocal.scale(-1,t),n.copy(e.axleLocal),t.cross(n,i),i.normalize(),n.normalize(),e.steering),r=new a,t=(r.setFromAxisAngle(t,i),new a),i=(t.setFromAxisAngle(n,e.rotation),e.worldTransform.quaternion),n=(this.chassisBody.quaternion.mult(r,i),i.mult(t,i),i.normalize(),e.worldTransform.position);n.copy(e.directionWorld),n.scale(e.suspensionLength,n),n.vadd(e.chassisConnectionPointWorld,n)},[new E(1,0,0),new E(0,1,0),new E(0,0,1)]),x=(o.prototype.getWheelTransformWorld=function(e){return this.wheelInfos[e].worldTransform},new E),T=[],S=[],w=(o.prototype.updateFriction=function(e){for(var t=x,n=this.wheelInfos,i=n.length,r=this.chassisBody,a=S,o=T,s=0;s<i;s++)f=(_=n[s]).raycastResult.body,_.sideImpulse=0,_.forwardImpulse=0,a[s]||(a[s]=new E),o[s]||(o[s]=new E);for(var l,u,c,s=0;s<i;s++)(f=(_=n[s]).raycastResult.body)&&(l=o[s],this.getWheelTransformWorld(s).vectorToWorldFrame(A[this.indexRightAxis],l),u=_.raycastResult.hitNormalWorld,c=l.dot(u),u.scale(c,t),l.vsub(t,l),l.normalize(),u.cross(l,a[s]),a[s].normalize(),_.sideImpulse=((e,t,n,i,r)=>{var a,o,s;return 1.1<r.norm2()?0:(a=N,o=I,s=C,e.getVelocityAtWorldPoint(t,a),n.getVelocityAtWorldPoint(i,o),a.vsub(o,s),t=r.dot(s),i=1/(e.invMass+n.invMass),-.2*t*i)})(r,_.raycastResult.hitPointWorld,f,_.raycastResult.hitPointWorld,l),_.sideImpulse*=1);this.sliding=!1;for(s=0;s<i;s++){var h,d,p,f=(_=n[s]).raycastResult.body,m=0;_.slipInfo=1,f&&(p=_.brake||0,m=((e,t,n,i,r)=>{var a=0,o=n,s=w,l=b,u=M,o=(e.getVelocityAtWorldPoint(o,s),t.getVelocityAtWorldPoint(o,l),s.vsub(l,u),i.dot(u)),s=R(e,n,i),l=R(t,n,i);return a=(a=r<(a=1/(s+l)*-o)?r:a)<-r?-r:a})(r,f,_.raycastResult.hitPointWorld,a[s],p),p=p/(m+=_.engineForce*e),_.slipInfo*=p),_.forwardImpulse=0,_.skidInfo=1,f&&(_.skidInfo=1,d=(h=_.suspensionForce*e*_.frictionSlip)*h,_.forwardImpulse=m,m=(m=.5*_.forwardImpulse)*m+(m=+_.sideImpulse)*m,_.sliding=!1,d<m)&&(this.sliding=!0,_.sliding=!0,p=h/Math.sqrt(m),_.skidInfo*=p)}if(this.sliding)for(s=0;s<i;s++)0!==(_=n[s]).sideImpulse&&_.skidInfo<1&&(_.forwardImpulse*=_.skidInfo,_.sideImpulse*=_.skidInfo);for(s=0;s<i;s++){var g,v,_=n[s],y=new E;y.copy(_.raycastResult.hitPointWorld),0!==_.forwardImpulse&&(g=new E,a[s].scale(_.forwardImpulse,g),r.applyImpulse(g,y)),0!==_.sideImpulse&&(f=_.raycastResult.body,(g=new E).copy(_.raycastResult.hitPointWorld),v=new E,o[s].scale(_.sideImpulse,v),r.pointToLocalFrame(y,y),y["xyz"[this.indexUpAxis]]*=_.rollInfluence,r.pointToWorldFrame(y,y),r.applyImpulse(v,y),v.scale(-1,v),f.applyImpulse(v,g))}},new E),b=new E,M=new E;var d=new E,p=new E,f=new E,m=new E;function R(e,t,n){var i=d,r=p,a=f,o=m;return t.vsub(e.position,i),i.cross(n,r),e.invInertiaWorld.vmult(r,o),o.cross(i,a),e.invMass+n.dot(a)}var N=new E,I=new E,C=new E},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(e,t,n){var r=e("./Body"),a=e("../shapes/Sphere"),i=e("../shapes/Box"),o=e("../math/Vec3"),s=e("../constraints/HingeConstraint");function l(e){this.wheelBodies=[],this.coordinateSystem=void 0===e.coordinateSystem?new o(1,2,3):e.coordinateSystem.clone(),this.chassisBody=e.chassisBody,this.chassisBody||(e=new i(new o(5,2,.5)),this.chassisBody=new r(1,e)),this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}(t.exports=l).prototype.addWheel=function(e){var t=(t=(e=e||{}).body)||new r(1,new a(1.2)),n=(this.wheelBodies.push(t),this.wheelForces.push(0),new o,void 0!==e.position?e.position.clone():new o),i=new o,i=(this.chassisBody.pointToWorldFrame(n,i),t.position.set(i.x,i.y,i.z),void 0!==e.axis?e.axis.clone():new o(0,1,0)),e=(this.wheelAxes.push(i),new s(this.chassisBody,t,{pivotA:n,axisA:i,pivotB:o.ZERO,axisB:i,collideConnected:!1}));return this.constraints.push(e),this.wheelBodies.length-1},l.prototype.setSteeringValue=function(e,t){var n=this.wheelAxes[t],i=Math.cos(e),e=Math.sin(e),r=n.x,n=n.y;this.constraints[t].axisA.set(i*r-e*n,e*r+i*n,0)},l.prototype.setMotorSpeed=function(e,t){t=this.constraints[t];t.enableMotor(),t.motorTargetVelocity=e},l.prototype.disableMotor=function(e){this.constraints[e].disableMotor()};var u=new o,c=(l.prototype.setWheelForce=function(e,t){this.wheelForces[t]=e},l.prototype.applyWheelForce=function(e,t){var n=this.wheelAxes[t],t=this.wheelBodies[t],i=t.torque;n.scale(e,u),t.vectorToWorldFrame(u,u),i.vadd(u,i)},l.prototype.addToWorld=function(e){for(var t=this.constraints,n=this.wheelBodies.concat([this.chassisBody]),i=0;i<n.length;i++)e.add(n[i]);for(i=0;i<t.length;i++)e.addConstraint(t[i]);e.addEventListener("preStep",this._update.bind(this))},l.prototype._update=function(){for(var e=this.wheelForces,t=0;t<e.length;t++)this.applyWheelForce(e[t],t)},l.prototype.removeFromWorld=function(e){for(var t=this.constraints,n=this.wheelBodies.concat([this.chassisBody]),i=0;i<n.length;i++)e.remove(n[i]);for(i=0;i<t.length;i++)e.removeConstraint(t[i])},new o);l.prototype.getWheelSpeed=function(e){var t=this.wheelAxes[e],e=this.wheelBodies[e].angularVelocity;return this.chassisBody.vectorToWorldFrame(t,c),e.dot(c)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(e,t,n){t.exports=i;e("../shapes/Shape");t=e("../math/Vec3");e("../math/Quaternion"),e("../shapes/Particle"),e("../objects/Body"),e("../material/Material");function i(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}i.prototype.add=function(e){this.particles.push(e),this.neighbors.length<this.particles.length&&this.neighbors.push([])},i.prototype.remove=function(e){e=this.particles.indexOf(e);-1!==e&&(this.particles.splice(e,1),this.neighbors.length>this.particles.length)&&this.neighbors.pop()};var l=new t,E=(i.prototype.getNeighbors=function(e,t){for(var n=this.particles.length,i=e.id,r=this.smoothingRadius*this.smoothingRadius,a=l,o=0;o!==n;o++){var s=this.particles[o];s.position.vsub(e.position,a),i!==s.id&&a.norm2()<r&&t.push(s)}},new t),A=new t,x=new t,T=new t,S=new t,w=new t;i.prototype.update=function(){for(var e=this.particles.length,t=E,n=this.speedOfSound,i=this.eps,r=0;r!==e;r++){for(var a=this.particles[r],o=((g=this.neighbors[r]).length=0,this.getNeighbors(a,g),g.push(this.particles[r]),g.length),s=0,l=0;l!==o;l++){a.position.vsub(g[l].position,t);var u=t.norm(),u=this.w(u);s+=g[l].mass*u}this.densities[r]=s,this.pressures[r]=n*n*(this.densities[r]-this.density)}for(var c=A,h=x,d=T,p=S,f=w,r=0;r!==e;r++){var m=this.particles[r];c.set(0,0,0),h.set(0,0,0);for(var g,o=(g=this.neighbors[r]).length,l=0;l!==o;l++){var v=g[l],_=(m.position.vsub(v.position,p),p.norm()),y=-v.mass*(this.pressures[r]/(this.densities[r]*this.densities[r]+i)+this.pressures[l]/(this.densities[l]*this.densities[l]+i));this.gradw(p,d),d.mult(y,d),c.vadd(d,c),v.velocity.vsub(m.velocity,f),f.mult(1/(1e-4+this.densities[r]*this.densities[l])*this.viscosity*v.mass,f),y=this.nablaw(_),f.mult(y,f),h.vadd(f,h)}h.mult(m.mass,h),c.mult(m.mass,c),m.force.vadd(h,m.force),m.force.vadd(c,m.force)}},i.prototype.w=function(e){var t=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(t,9))*Math.pow(t*t-e*e,3)},i.prototype.gradw=function(e,t){var n=e.norm(),i=this.smoothingRadius;e.mult(945/(32*Math.PI*Math.pow(i,9))*Math.pow(i*i-n*n,2),t)},i.prototype.nablaw=function(e){var t=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(t,9))*(t*t-e*e)*(7*e*e-3*t*t)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(e,t,n){var i=e("../math/Vec3");function r(e,t,n){this.restLength="number"==typeof(n=n||{}).restLength?n.restLength:1,this.stiffness=n.stiffness||100,this.damping=n.damping||1,this.bodyA=e,this.bodyB=t,this.localAnchorA=new i,this.localAnchorB=new i,n.localAnchorA&&this.localAnchorA.copy(n.localAnchorA),n.localAnchorB&&this.localAnchorB.copy(n.localAnchorB),n.worldAnchorA&&this.setWorldAnchorA(n.worldAnchorA),n.worldAnchorB&&this.setWorldAnchorB(n.worldAnchorB)}(t.exports=r).prototype.setWorldAnchorA=function(e){this.bodyA.pointToLocalFrame(e,this.localAnchorA)},r.prototype.setWorldAnchorB=function(e){this.bodyB.pointToLocalFrame(e,this.localAnchorB)},r.prototype.getWorldAnchorA=function(e){this.bodyA.pointToWorldFrame(this.localAnchorA,e)},r.prototype.getWorldAnchorB=function(e){this.bodyB.pointToWorldFrame(this.localAnchorB,e)};var g=new i,v=new i,_=new i,y=new i,E=new i,A=new i,x=new i,T=new i,S=new i,w=new i,b=new i;r.prototype.applyForce=function(){var e=this.stiffness,t=this.damping,n=this.restLength,i=this.bodyA,r=this.bodyB,a=g,o=v,s=_,l=y,u=b,c=E,h=A,d=x,p=T,f=S,m=w,h=(this.getWorldAnchorA(c),this.getWorldAnchorB(h),c.vsub(i.position,d),h.vsub(r.position,p),h.vsub(c,a),a.norm());o.copy(a),o.normalize(),r.velocity.vsub(i.velocity,s),r.angularVelocity.cross(p,u),s.vadd(u,s),i.angularVelocity.cross(d,u),s.vsub(u,s),o.mult(-e*(h-n)-t*s.dot(o),l),i.force.vsub(l,i.force),r.force.vadd(l,r.force),d.cross(l,f),p.cross(l,m),i.torque.vsub(f,i.torque),r.torque.vadd(m,r.torque)}},{"../math/Vec3":30}],36:[function(e,t,n){var i=e("../math/Vec3"),r=e("../math/Transform"),a=e("../collision/RaycastResult"),o=e("../utils/Utils");function s(e){e=o.defaults(e,{chassisConnectionPointLocal:new i,chassisConnectionPointWorld:new i,directionLocal:new i,directionWorld:new i,axleLocal:new i,axleWorld:new i,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=e.maxSuspensionTravel,this.customSlidingRotationalSpeed=e.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=e.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=e.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=e.chassisConnectionPointWorld.clone(),this.directionLocal=e.directionLocal.clone(),this.directionWorld=e.directionWorld.clone(),this.axleLocal=e.axleLocal.clone(),this.axleWorld=e.axleWorld.clone(),this.suspensionRestLength=e.suspensionRestLength,this.suspensionMaxLength=e.suspensionMaxLength,this.radius=e.radius,this.suspensionStiffness=e.suspensionStiffness,this.dampingCompression=e.dampingCompression,this.dampingRelaxation=e.dampingRelaxation,this.frictionSlip=e.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=e.rollInfluence,this.maxSuspensionForce=e.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=e.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new a,this.worldTransform=new r,this.isInContact=!1}t.exports=s;new i;var l=new i,u=new i;s.prototype.updateWheel=function(e){var t,n=this.raycastResult;this.isInContact?(t=n.hitNormalWorld.dot(n.directionWorld),n.hitPointWorld.vsub(e.position,l),e.getVelocityAtWorldPoint(l,u),e=n.hitNormalWorld.dot(u),-.1<=t?(this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10):(this.suspensionRelativeVelocity=e*(e=-1/t),this.clippedInvContactDotSuspension=e)):(n.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,n.directionWorld.scale(-1,n.hitNormalWorld),this.clippedInvContactDotSuspension=1)}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(e,t,n){t.exports=o;var i=e("./Shape"),r=e("../math/Vec3"),a=e("./ConvexPolyhedron");function o(e){i.call(this),this.type=i.types.BOX,this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}((o.prototype=new i).constructor=o).prototype.updateConvexPolyhedronRepresentation=function(){var e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,i=r,e=[new i(-e,-t,-n),new i(e,-t,-n),new i(e,t,-n),new i(-e,t,-n),new i(-e,-t,n),new i(e,-t,n),new i(e,t,n),new i(-e,t,n)],t=(new i(0,0,1),new i(0,1,0),new i(1,0,0),new a(e,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));(this.convexPolyhedronRepresentation=t).material=this.material},o.prototype.calculateLocalInertia=function(e,t){return t=t||new r,o.calculateInertia(this.halfExtents,e,t),t},o.calculateInertia=function(e,t,n){n.x=1/12*t*(2*e.y*2*e.y+2*e.z*2*e.z),n.y=1/12*t*(2*e.x*2*e.x+2*e.z*2*e.z),n.z=1/12*t*(2*e.y*2*e.y+2*e.x*2*e.x)},o.prototype.getSideNormals=function(e,t){var n=e,e=this.halfExtents;if(n[0].set(e.x,0,0),n[1].set(0,e.y,0),n[2].set(0,0,e.z),n[3].set(-e.x,0,0),n[4].set(0,-e.y,0),n[5].set(0,0,-e.z),void 0!==t)for(var i=0;i!==n.length;i++)t.vmult(n[i],n[i]);return n},o.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},o.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var s=new r,c=(new r,o.prototype.forEachWorldCorner=function(e,t,n){for(var i=this.halfExtents,r=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]],a=0;a<r.length;a++)s.set(r[a][0],r[a][1],r[a][2]),t.vmult(s,s),e.vadd(s,s),n(s.x,s.y,s.z)},[new r,new r,new r,new r,new r,new r,new r,new r]);o.prototype.calculateWorldAABB=function(e,t,n,i){var r=this.halfExtents;c[0].set(r.x,r.y,r.z),c[1].set(-r.x,r.y,r.z),c[2].set(-r.x,-r.y,r.z),c[3].set(-r.x,-r.y,-r.z),c[4].set(r.x,-r.y,-r.z),c[5].set(r.x,r.y,-r.z),c[6].set(-r.x,r.y,-r.z),c[7].set(r.x,-r.y,r.z),t.vmult(o=c[0],o),e.vadd(o,o),i.copy(o),n.copy(o);for(var a=1;a<8;a++){t.vmult(o=c[a],o),e.vadd(o,o);var o,s=o.x,l=o.y,u=o.z;s>i.x&&(i.x=s),i.y<l&&(i.y=l),i.z<u&&(i.z=u),s<n.x&&(n.x=s),l<n.y&&(n.y=l),u<n.z&&(n.z=u)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(e,t,n){t.exports=o;var i=e("./Shape"),E=e("../math/Vec3"),p=(e("../math/Quaternion"),e("../math/Transform"));function o(e,t,n){i.call(this),this.type=i.types.CONVEXPOLYHEDRON,this.vertices=e||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=t||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=n?n.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}(o.prototype=new i).constructor=o;var c=new E,r=(o.prototype.computeEdges=function(){for(var e=this.faces,t=this.vertices,n=(t.length,this.uniqueEdges),i=(n.length=0,c),r=0;r!==e.length;r++)for(var a=e[r],o=a.length,s=0;s!==o;s++){t[a[s]].vsub(t[a[(s+1)%o]],i),i.normalize();for(var l=!1,u=0;u!==n.length;u++)if(n[u].almostEquals(i)||n[u].almostEquals(i)){l=!0;break}l||n.push(i.clone())}},o.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var e=0;e<this.faces.length;e++){for(var t=0;t<this.faces[e].length;t++)if(!this.vertices[this.faces[e][t]])throw new Error("Vertex "+this.faces[e][t]+" not found!");var n=this.faceNormals[e]||new E,i=(this.getFaceNormal(e,n),n.negate(n),this.faceNormals[e]=n,this.vertices[this.faces[e][0]]);if(n.dot(i)<0){console.error(".faceNormals["+e+"] = Vec3("+n.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(t=0;t<this.faces[e].length;t++)console.warn(".vertices["+this.faces[e][t]+"] = Vec3("+this.vertices[this.faces[e][t]].toString()+")")}}},new E),a=new E,A=(o.computeNormal=function(e,t,n,i){t.vsub(e,a),n.vsub(t,r),r.cross(a,i),i.isZero()||i.normalize()},o.prototype.getFaceNormal=function(e,t){var e=this.faces[e],n=this.vertices[e[0]],i=this.vertices[e[1]],e=this.vertices[e[2]];return o.computeNormal(n,i,e,t)},new E),S=(o.prototype.clipAgainstHull=function(e,t,n,i,r,a,o,s,l){for(var u=A,c=-1,h=-Number.MAX_VALUE,d=0;d<n.faces.length;d++){u.copy(n.faceNormals[d]),r.vmult(u,u);var p=u.dot(a);h<p&&(h=p,c=d)}for(var f=[],m=n.faces[c],g=m.length,v=0;v<g;v++){var _=n.vertices[m[v]],y=new E;y.copy(_),r.vmult(y,y),i.vadd(y,y),f.push(y)}0<=c&&this.clipFaceAgainstHull(a,e,t,f,o,s,l)},new E),w=new E,b=new E,M=new E,R=new E,N=new E,s=(o.prototype.findSeparatingAxis=function(e,t,n,i,r,a,o,s){var l=S,u=w,c=b,h=M,d=R,p=N,f=Number.MAX_VALUE,m=this;if(m.uniqueAxes)for(v=0;v!==m.uniqueAxes.length;v++){if(n.vmult(m.uniqueAxes[v],l),!1===(E=m.testSepAxis(l,e,t,n,i,r)))return!1;E<f&&(f=E,a.copy(l))}else for(var g=(o||m.faces).length,v=0;v<g;v++){var _=o?o[v]:v;if(l.copy(m.faceNormals[_]),n.vmult(l,l),!1===(E=m.testSepAxis(l,e,t,n,i,r)))return!1;E<f&&(f=E,a.copy(l))}if(e.uniqueAxes)for(v=0;v!==e.uniqueAxes.length;v++){if(r.vmult(e.uniqueAxes[v],u),!1===(E=m.testSepAxis(u,e,t,n,i,r)))return!1;E<f&&(f=E,a.copy(u))}else for(var y=(s||e.faces).length,v=0;v<y;v++){var E,_=s?s[v]:v;if(u.copy(e.faceNormals[_]),r.vmult(u,u),!1===(E=m.testSepAxis(u,e,t,n,i,r)))return!1;E<f&&(f=E,a.copy(u))}for(var A=0;A!==m.uniqueEdges.length;A++){n.vmult(m.uniqueEdges[A],h);for(var x=0;x!==e.uniqueEdges.length;x++)if(r.vmult(e.uniqueEdges[x],d),h.cross(d,p),!p.almostZero()){p.normalize();var T=m.testSepAxis(p,e,t,n,i,r);if(!1===T)return!1;T<f&&(f=T,a.copy(p))}}return i.vsub(t,c),0<c.dot(a)&&a.negate(a),!0},[]),l=[],u=(o.prototype.testSepAxis=function(e,t,n,i,r,a){o.project(this,e,n,i,s),o.project(t,e,r,a,l);n=s[0],i=s[1],t=l[0],e=l[1];return!(n<e||t<i)&&((r=n-e)<(a=t-i)?r:a)},new E),h=new E,D=(o.prototype.calculateLocalInertia=function(e,t){this.computeLocalAABB(u,h);var n=h.x-u.x,i=h.y-u.y,r=h.z-u.z;t.x=1/12*e*(2*i*2*i+2*r*2*r),t.y=1/12*e*(2*n*2*n+2*r*2*r),t.z=1/12*e*(2*i*2*i+2*n*2*n)},o.prototype.getPlaneConstantOfFace=function(e){var t=this.faces[e],e=this.faceNormals[e],t=this.vertices[t[0]];return-e.dot(t)},new E),O=new E,P=new E,U=new E,B=new E,F=new E,z=new E,k=new E,f=(o.prototype.clipFaceAgainstHull=function(e,t,n,i,r,a,o){for(var s=D,l=O,u=P,c=U,h=B,d=F,p=z,f=k,m=this,g=i,v=[],_=-1,y=Number.MAX_VALUE,E=0;E<m.faces.length;E++){s.copy(m.faceNormals[E]),n.vmult(s,s);var A=s.dot(e);A<y&&(y=A,_=E)}if(!(_<0)){var x=m.faces[_];x.connectedFaces=[];for(var T=0;T<m.faces.length;T++)for(var S=0;S<m.faces[T].length;S++)-1!==x.indexOf(m.faces[T][S])&&T!==_&&-1===x.connectedFaces.indexOf(T)&&x.connectedFaces.push(T);g.length;for(var w=x.length,b=0;b<w;b++){var M=m.vertices[x[b]],R=m.vertices[x[(b+1)%w]],R=(M.vsub(R,l),u.copy(l),n.vmult(u,u),t.vadd(u,u),c.copy(this.faceNormals[_]),n.vmult(c,c),t.vadd(c,c),u.cross(c,h),h.negate(h),d.copy(M),n.vmult(d,d),t.vadd(d,d),d.dot(h),x.connectedFaces[b]),N=(p.copy(this.faceNormals[R]),this.getPlaneConstantOfFace(R)),I=(f.copy(p),n.vmult(f,f),N-f.dot(t));for(this.clipFaceAgainstPlane(g,v,f,I);g.length;)g.shift();for(;v.length;)g.push(v.shift())}p.copy(this.faceNormals[_]);for(N=this.getPlaneConstantOfFace(_),I=(f.copy(p),n.vmult(f,f),N-f.dot(t)),T=0;T<g.length;T++){var C,L=f.dot(g[T])+I;L<=r&&(console.log("clamped: depth="+L+" to minDist="+r+""),L=r),L<=a&&(C=g[T],L<=0)&&o.push({point:C,normal:f,depth:L})}}},o.prototype.clipFaceAgainstPlane=function(e,t,n,i){var r=e.length;if(!(r<2))for(var a=e[e.length-1],o=n.dot(a)+i,s=0;s<r;s++){var l,u=e[s],c=n.dot(u)+i;o<0?(c<0?(l=new E).copy(u):(l=new E,a.lerp(u,o/(o-c),l)),t.push(l)):c<0&&(l=new E,a.lerp(u,o/(o-c),l),t.push(l),t.push(u)),a=u,o=c}return t},o.prototype.computeWorldVertices=function(e,t){for(var n=this.vertices.length;this.worldVertices.length<n;)this.worldVertices.push(new E);for(var i=this.vertices,r=this.worldVertices,a=0;a!==n;a++)t.vmult(i[a],r[a]),e.vadd(r[a],r[a]);this.worldVerticesNeedsUpdate=!1},new E,o.prototype.computeLocalAABB=function(e,t){var n=this.vertices.length,i=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var r=0;r<n;r++){var a=i[r];a.x<e.x?e.x=a.x:a.x>t.x&&(t.x=a.x),a.y<e.y?e.y=a.y:a.y>t.y&&(t.y=a.y),a.z<e.z?e.z=a.z:a.z>t.z&&(t.z=a.z)}},o.prototype.computeWorldFaceNormals=function(e){for(var t=this.faceNormals.length;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new E);for(var n=this.faceNormals,i=this.worldFaceNormals,r=0;r!==t;r++)e.vmult(n[r],i[r]);this.worldFaceNormalsNeedsUpdate=!1},o.prototype.updateBoundingSphereRadius=function(){for(var e=0,t=this.vertices,n=0,i=t.length;n!==i;n++){var r=t[n].norm2();e<r&&(e=r)}this.boundingSphereRadius=Math.sqrt(e)},new E),d=(o.prototype.calculateWorldAABB=function(e,t,n,i){for(var r,a,o,s,l,u,c=this.vertices.length,h=this.vertices,d=0;d<c;d++)f.copy(h[d]),t.vmult(f,f),e.vadd(f,f),f.x<r||void 0===r?r=f.x:(f.x>s||void 0===s)&&(s=f.x),f.y<a||void 0===a?a=f.y:(f.y>l||void 0===l)&&(l=f.y),f.z<o||void 0===o?o=f.z:(f.z>u||void 0===u)&&(u=f.z);n.set(r,a,o),i.set(s,l,u)},o.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},o.prototype.getAveragePointLocal=function(e){e=e||new E;for(var t=this.vertices.length,n=this.vertices,i=0;i<t;i++)e.vadd(n[i],e);return e.mult(1/t,e),e},o.prototype.transformAllPoints=function(e,t){var n=this.vertices.length,i=this.vertices;if(t){for(var r=0;r<n;r++){var a=i[r];t.vmult(a,a)}for(r=0;r<this.faceNormals.length;r++){a=this.faceNormals[r];t.vmult(a,a)}}if(e)for(r=0;r<n;r++)(a=i[r]).vadd(e,a)},new E),m=new E,g=new E,v=(o.prototype.pointIsInside=function(e){var t=this.vertices.length,n=this.vertices,i=this.faces,r=this.faceNormals,a=this.faces.length,o=d;this.getAveragePointLocal(o);for(var s=0;s<a;s++){this.faces[s].length;var t=r[s],l=n[i[s][0]],u=m,u=(e.vsub(l,u),t.dot(u)),c=g,l=(o.vsub(l,c),t.dot(c));if(u<0&&0<l||0<u&&l<0)return!1}return-1},new E,new E),_=new E;o.project=function(e,t,n,i,r){var a=e.vertices.length,o=v,s=0,l=0,u=_,c=e.vertices,e=(u.setZero(),p.vectorToLocalFrame(n,i,t,o),p.pointToLocalFrame(n,i,u,u),u.dot(o));l=s=c[0].dot(o);for(var h=1;h<a;h++){var d=c[h].dot(o);s<d&&(s=d),d<l&&(l=d)}(s-=e)<(l-=e)&&(t=l,l=s,s=t),r[0]=s,r[1]=l}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(e,t,n){t.exports=i;var g=e("./Shape"),v=e("../math/Vec3"),_=(e("../math/Quaternion"),e("./ConvexPolyhedron"));function i(e,t,n,i){var r=i,a=[],o=[],s=[],l=[],u=[],c=Math.cos,h=Math.sin;a.push(new v(t*c(0),t*h(0),.5*-n)),l.push(0),a.push(new v(e*c(0),e*h(0),.5*n)),u.push(1);for(var d=0;d<r;d++){var p=2*Math.PI/r*(d+1),f=2*Math.PI/r*(d+.5);d<r-1?(a.push(new v(t*c(p),t*h(p),.5*-n)),l.push(2*d+2),a.push(new v(e*c(p),e*h(p),.5*n)),u.push(2*d+3),s.push([2*d+2,2*d+3,2*d+1,2*d])):s.push([0,1,2*d+1,2*d]),(r%2==1||d<r/2)&&o.push(new v(c(f),h(f),0))}s.push(u),o.push(new v(0,0,1));for(var m=[],d=0;d<l.length;d++)m.push(l[l.length-d-1]);s.push(m),this.type=g.types.CONVEXPOLYHEDRON,_.call(this,a,s,o)}i.prototype=new _},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(e,t,n){var i=e("./Shape"),h=e("./ConvexPolyhedron"),d=e("../math/Vec3"),r=e("../utils/Utils");function a(e,t){t=r.defaults(t,{maxValue:null,minValue:null,elementSize:1}),this.data=e,this.maxValue=t.maxValue,this.minValue=t.minValue,this.elementSize=t.elementSize,null===t.minValue&&this.updateMinValue(),null===t.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,i.call(this),this.pillarConvex=new h,this.pillarOffset=new d,this.type=i.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}((t.exports=a).prototype=new i).update=function(){this._cachedPillars={}},a.prototype.updateMinValue=function(){for(var e=this.data,t=e[0][0],n=0;n!==e.length;n++)for(var i=0;i!==e[n].length;i++){var r=e[n][i];r<t&&(t=r)}this.minValue=t},a.prototype.updateMaxValue=function(){for(var e=this.data,t=e[0][0],n=0;n!==e.length;n++)for(var i=0;i!==e[n].length;i++){var r=e[n][i];t<r&&(t=r)}this.maxValue=t},a.prototype.setHeightValueAtIndex=function(e,t,n){this.data[e][t]=n,this.clearCachedConvexTrianglePillar(e,t,!1),0<e&&(this.clearCachedConvexTrianglePillar(e-1,t,!0),this.clearCachedConvexTrianglePillar(e-1,t,!1)),0<t&&(this.clearCachedConvexTrianglePillar(e,t-1,!0),this.clearCachedConvexTrianglePillar(e,t-1,!1)),0<t&&0<e&&this.clearCachedConvexTrianglePillar(e-1,t-1,!0)},a.prototype.getRectMinMax=function(e,t,n,i,r){r=r||[];for(var a=this.data,o=this.minValue,s=e;s<=n;s++)for(var l=t;l<=i;l++){var u=a[s][l];o<u&&(o=u)}r[0]=this.minValue,r[1]=o},a.prototype.getIndexOfPosition=function(e,t,n,i){var r=this.elementSize,a=this.data,e=Math.floor(e/r),t=Math.floor(t/r);return n[0]=e,n[1]=t,i&&((e=e<0?0:e)>=a.length-1&&(e=a.length-1),(t=t<0?0:t)>=a[0].length-1)&&(t=a[0].length-1),!(e<0||t<0||e>=a.length-1||t>=a[0].length-1)},a.prototype.getHeightAt=function(e,t,n){var i=[],e=(this.getIndexOfPosition(e,t,i,n),[]);return this.getRectMinMax(i[0],i[1]+1,i[0],i[1]+1,e),(e[0]+e[1])/2},a.prototype.getCacheConvexTrianglePillarKey=function(e,t,n){return e+"_"+t+"_"+(n?1:0)},a.prototype.getCachedConvexTrianglePillar=function(e,t,n){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,n)]},a.prototype.setCachedConvexTrianglePillar=function(e,t,n,i,r){this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,n)]={convex:i,offset:r}},a.prototype.clearCachedConvexTrianglePillar=function(e,t,n){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,n)]},a.prototype.getConvexTrianglePillar=function(e,t,n){var i=this.pillarConvex,r=this.pillarOffset;if(this.cacheEnabled){if(a=this.getCachedConvexTrianglePillar(e,t,n))return this.pillarConvex=a.convex,void(this.pillarOffset=a.offset);i=new h,r=new d,this.pillarConvex=i,this.pillarOffset=r}var a=this.data,o=this.elementSize,s=i.faces;i.vertices.length=6;for(var l=0;l<6;l++)i.vertices[l]||(i.vertices[l]=new d);s.length=5;for(l=0;l<5;l++)s[l]||(s[l]=[]);var u=i.vertices,c=(Math.min(a[e][t],a[e+1][t],a[e][t+1],a[e+1][t+1])-this.minValue)/2+this.minValue;n?(r.set((e+.75)*o,(t+.75)*o,c),u[0].set(.25*o,.25*o,a[e+1][t+1]-c),u[1].set(-.75*o,.25*o,a[e][t+1]-c),u[2].set(.25*o,-.75*o,a[e+1][t]-c),u[3].set(.25*o,.25*o,-c-1),u[4].set(-.75*o,.25*o,-c-1),u[5].set(.25*o,-.75*o,-c-1),s[0][0]=0,s[0][1]=1,s[0][2]=2,s[1][0]=5,s[1][1]=4,s[1][2]=3,s[2][0]=2,s[2][1]=5,s[2][2]=3,s[2][3]=0,s[3][0]=3,s[3][1]=4,s[3][2]=1,s[3][3]=0,s[4][0]=1,s[4][1]=4,s[4][2]=5,s[4][3]=2):(r.set((e+.25)*o,(t+.25)*o,c),u[0].set(-.25*o,-.25*o,a[e][t]-c),u[1].set(.75*o,-.25*o,a[e+1][t]-c),u[2].set(-.25*o,.75*o,a[e][t+1]-c),u[3].set(-.25*o,-.25*o,-c-1),u[4].set(.75*o,-.25*o,-c-1),u[5].set(-.25*o,.75*o,-c-1),s[0][0]=0,s[0][1]=1,s[0][2]=2,s[1][0]=5,s[1][1]=4,s[1][2]=3,s[2][0]=0,s[2][1]=2,s[2][2]=5,s[2][3]=3,s[3][0]=1,s[3][1]=0,s[3][2]=3,s[3][3]=4,s[4][0]=4,s[4][1]=5,s[4][2]=2,s[4][3]=1),i.computeNormals(),i.computeEdges(),i.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(e,t,n,i,r)},a.prototype.calculateLocalInertia=function(e,t){return(t=t||new d).set(0,0,0),t},a.prototype.volume=function(){return Number.MAX_VALUE},a.prototype.calculateWorldAABB=function(e,t,n,i){n.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),i.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},a.prototype.updateBoundingSphereRadius=function(){var e=this.data,t=this.elementSize;this.boundingSphereRadius=new d(e.length*t,e[0].length*t,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(e,t,n){t.exports=a;var i=e("./Shape"),r=e("../math/Vec3");function a(){i.call(this),this.type=i.types.PARTICLE}((a.prototype=new i).constructor=a).prototype.calculateLocalInertia=function(e,t){return(t=t||new r).set(0,0,0),t},a.prototype.volume=function(){return 0},a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},a.prototype.calculateWorldAABB=function(e,t,n,i){n.copy(e),i.copy(e)}},{"../math/Vec3":30,"./Shape":43}],42:[function(e,t,n){t.exports=a;var i=e("./Shape"),r=e("../math/Vec3");function a(){i.call(this),this.type=i.types.PLANE,this.worldNormal=new r,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}((a.prototype=new i).constructor=a).prototype.computeWorldNormal=function(e){var t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1},a.prototype.calculateLocalInertia=function(e,t){return t=t||new r},a.prototype.volume=function(){return Number.MAX_VALUE};var o=new r;a.prototype.calculateWorldAABB=function(e,t,n,i){o.set(0,0,1),t.vmult(o,o);t=Number.MAX_VALUE;n.set(-t,-t,-t),i.set(t,t,t),1===o.x&&(i.x=e.x),1===o.y&&(i.y=e.y),1===o.z&&(i.z=e.z),-1===o.x&&(n.x=e.x),-1===o.y&&(n.y=e.y),-1===o.z&&(n.z=e.z)},a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(e,t,n){t.exports=i;var i=e("./Shape");e("../math/Vec3"),e("../math/Quaternion"),e("../material/Material");function i(){this.id=i.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}(i.prototype.constructor=i).prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},i.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},i.prototype.calculateLocalInertia=function(e,t){throw"calculateLocalInertia() not implemented for shape type "+this.type},i.idCounter=0,i.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(e,t,n){t.exports=a;var i=e("./Shape"),r=e("../math/Vec3");function a(e){if(i.call(this),this.radius=void 0!==e?Number(e):1,this.type=i.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}((a.prototype=new i).constructor=a).prototype.calculateLocalInertia=function(e,t){t=t||new r;e=2*e*this.radius*this.radius/5;return t.x=e,t.y=e,t.z=e,t},a.prototype.volume=function(){return 4*Math.PI*this.radius/3},a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},a.prototype.calculateWorldAABB=function(e,t,n,i){for(var r=this.radius,a=["x","y","z"],o=0;o<a.length;o++){var s=a[o];n[s]=e[s]-r,i[s]=e[s]+r}}},{"../math/Vec3":30,"./Shape":43}],45:[function(e,t,n){t.exports=m;var i=e("./Shape"),u=e("../math/Vec3"),r=(e("../math/Quaternion"),e("../math/Transform")),c=e("../collision/AABB"),a=e("../utils/Octree");function m(e,t){i.call(this),this.type=i.types.TRIMESH,this.vertices=new Float32Array(e),this.indices=new Int16Array(t),this.normals=new Float32Array(t.length),this.aabb=new c,this.edges=null,this.scale=new u(1,1,1),this.tree=new a,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}(m.prototype=new i).constructor=m;var s=new u,o=(m.prototype.updateTree=function(){for(var e=this.tree,t=(e.reset(),e.aabb.copy(this.aabb),this.scale),n=(e.aabb.lowerBound.x*=1/t.x,e.aabb.lowerBound.y*=1/t.y,e.aabb.lowerBound.z*=1/t.z,e.aabb.upperBound.x*=1/t.x,e.aabb.upperBound.y*=1/t.y,e.aabb.upperBound.z*=1/t.z,new c),i=new u,r=new u,a=new u,o=[i,r,a],s=0;s<this.indices.length/3;s++){var l=3*s;this._getUnscaledVertex(this.indices[l],i),this._getUnscaledVertex(this.indices[1+l],r),this._getUnscaledVertex(this.indices[2+l],a),n.setFromPoints(o),e.insert(n,s)}e.removeEmptyNodes()},new c),l=(m.prototype.getTrianglesInAABB=function(e,t){o.copy(e);var e=this.scale,n=e.x,i=e.y,e=e.z,r=o.lowerBound,a=o.upperBound;return r.x/=n,r.y/=i,r.z/=e,a.x/=n,a.y/=i,a.z/=e,this.tree.aabbQuery(o,t)},m.prototype.setScale=function(e){var t=this.scale.x===this.scale.y===this.scale.z,n=e.x===e.y===e.z;t&&n||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()},m.prototype.updateNormals=function(){for(var e=s,t=this.normals,n=0;n<this.indices.length/3;n++){var i=3*n,r=this.indices[i],a=this.indices[1+i],o=this.indices[2+i];this.getVertex(r,f),this.getVertex(a,g),this.getVertex(o,v),m.computeNormal(g,f,v,e),t[i]=e.x,t[1+i]=e.y,t[2+i]=e.z}},m.prototype.updateEdges=function(){for(var n={},e=function(e,t){n[r<a?r+"_"+a:a+"_"+r]=!0},t=0;t<this.indices.length/3;t++){var i=3*t,r=this.indices[i],a=this.indices[1+i];this.indices[2+i];e(),e(),e()}var o=Object.keys(n);this.edges=new Int16Array(2*o.length);for(t=0;t<o.length;t++){var s=o[t].split("_");this.edges[2*t]=parseInt(s[0],10),this.edges[2*t+1]=parseInt(s[1],10)}},m.prototype.getEdgeVertex=function(e,t,n){e=this.edges[2*e+(t?1:0)];this.getVertex(e,n)},new u),h=new u,d=(m.prototype.getEdgeVector=function(e,t){var n=l,i=h;this.getEdgeVertex(e,0,n),this.getEdgeVertex(e,1,i),i.vsub(n,t)},new u),p=new u,f=(m.computeNormal=function(e,t,n,i){t.vsub(e,p),n.vsub(t,d),d.cross(p,i),i.isZero()||i.normalize()},new u),g=new u,v=new u,_=(m.prototype.getVertex=function(e,t){var n=this.scale;return this._getUnscaledVertex(e,t),t.x*=n.x,t.y*=n.y,t.z*=n.z,t},m.prototype._getUnscaledVertex=function(e,t){var e=3*e,n=this.vertices;return t.set(n[e],n[1+e],n[2+e])},m.prototype.getWorldVertex=function(e,t,n,i){return this.getVertex(e,i),r.pointToWorldFrame(t,n,i,i),i},m.prototype.getTriangleVertices=function(e,t,n,i){e*=3;this.getVertex(this.indices[e],t),this.getVertex(this.indices[1+e],n),this.getVertex(this.indices[2+e],i)},m.prototype.getNormal=function(e,t){e*=3;return t.set(this.normals[e],this.normals[1+e],this.normals[2+e])},new c),y=(m.prototype.calculateLocalInertia=function(e,t){this.computeLocalAABB(_);var n=_.upperBound.x-_.lowerBound.x,i=_.upperBound.y-_.lowerBound.y,r=_.upperBound.z-_.lowerBound.z;return t.set(1/12*e*(2*i*2*i+2*r*2*r),1/12*e*(2*n*2*n+2*r*2*r),1/12*e*(2*i*2*i+2*n*2*n))},new u),E=(m.prototype.computeLocalAABB=function(e){var t=e.lowerBound,n=e.upperBound,i=this.vertices.length,r=(this.vertices,y);this.getVertex(0,r),t.copy(r),n.copy(r);for(var a=0;a!==i;a++)this.getVertex(a,r),r.x<t.x?t.x=r.x:r.x>n.x&&(n.x=r.x),r.y<t.y?t.y=r.y:r.y>n.y&&(n.y=r.y),r.z<t.z?t.z=r.z:r.z>n.z&&(n.z=r.z)},m.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},m.prototype.updateBoundingSphereRadius=function(){for(var e=0,t=this.vertices,n=new u,i=0,r=t.length/3;i!==r;i++){this.getVertex(i,n);var a=n.norm2();e<a&&(e=a)}this.boundingSphereRadius=Math.sqrt(e)},new u,new r),A=new c;m.prototype.calculateWorldAABB=function(e,t,n,i){var r=E,a=A;r.position=e,r.quaternion=t,this.aabb.toWorldFrame(r,a),n.copy(a.lowerBound),i.copy(a.upperBound)},m.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},m.createTorus=function(e,t,n,i,r){e=e||1,t=t||.5,n=n||8,i=i||6,r=r||2*Math.PI;for(var a=[],o=[],s=0;s<=n;s++)for(var l=0;l<=i;l++){var u=l/i*r,c=s/n*Math.PI*2,h=(e+t*Math.cos(c))*Math.cos(u),u=(e+t*Math.cos(c))*Math.sin(u),c=t*Math.sin(c);a.push(h,u,c)}for(s=1;s<=n;s++)for(l=1;l<=i;l++){var d=(i+1)*(s-1)+l-1,p=(i+1)*(s-1)+l,f=(i+1)*s+l;o.push((i+1)*s+l-1,d,f),o.push(d,p,f)}return new m(a,o)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(e,t,n){t.exports=r;e("../math/Vec3"),e("../math/Quaternion");var i=e("./Solver");function r(){i.call(this),this.iterations=10,this.tolerance=1e-7}r.prototype=new i;var w=[],b=[],M=[];r.prototype.solve=function(e,t){var n=0,i=this.iterations,r=this.tolerance*this.tolerance,a=this.equations,o=a.length,s=t.bodies,l=s.length,u=e;if(0!==o)for(var c=0;c!==l;c++)s[c].updateSolveMassProperties();var h=b,d=M,p=w;h.length=o,d.length=o,p.length=o;for(c=0;c!==o;c++){var f=a[c];p[c]=0,d[c]=f.computeB(u),h[c]=1/f.computeC()}if(0!==o){for(c=0;c!==l;c++){var m=(x=s[c]).vlambda,g=x.wlambda;m.set(0,0,0),g&&g.set(0,0,0)}for(n=0;n!==i;n++){for(var v=0,_=0;_!==o;_++){var y,f=a[_],E=d[_],A=h[_];(y=p[_])+(A=A*(E-f.computeGWlambda()-f.eps*y))<f.minForce?A=f.minForce-y:y+A>f.maxForce&&(A=f.maxForce-y),p[_]+=A,v+=0<A?A:-A,f.addToWlambda(A)}if(v*v<r)break}for(c=0;c!==l;c++){var x,T=(x=s[c]).velocity,S=x.angularVelocity;T.vadd(x.vlambda,T),S&&S.vadd(x.wlambda,S)}}return n}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(e,t,n){function i(){this.equations=[]}(t.exports=i).prototype.solve=function(e,t){return 0},i.prototype.addEquation=function(e){e.enabled&&this.equations.push(e)},i.prototype.removeEquation=function(e){var t=this.equations,e=t.indexOf(e);-1!==e&&t.splice(e,1)},i.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(e,t,n){t.exports=r;e("../math/Vec3"),e("../math/Quaternion");var i=e("./Solver"),t=e("../objects/Body");function r(e){for(i.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=e,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}r.prototype=new i;var b=[],M=[],R={bodies:[]},a=t.STATIC;function N(e){for(var t=e.length,n=0;n!==t;n++){var i=e[n];if(!(i.visited||i.body.type&a))return i}return!1}var I=[];function C(e,t,n){t.push(e.body);for(var i=e.eqs.length,r=0;r!==i;r++){var a=e.eqs[r];-1===n.indexOf(a)&&n.push(a)}}function L(e,t){return t.id-e.id}r.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},r.prototype.solve=function(e,t){for(var n=b,i=this.nodePool,r=t.bodies,a=this.equations,o=a.length,s=r.length,l=this.subsolver;i.length<s;)i.push(this.createNode());n.length=s;for(var u=0;u<s;u++)n[u]=i[u];for(u=0;u!==s;u++){var c=n[u];c.body=r[u],c.children.length=0,c.eqs.length=0,c.visited=!1}for(var h=0;h!==o;h++){var d=a[h],u=r.indexOf(d.bi),p=r.indexOf(d.bj),f=n[u],p=n[p];f.children.push(p),f.eqs.push(d),p.children.push(f),p.eqs.push(d)}for(var m,g=0,v=M,_=(l.tolerance=this.tolerance,l.iterations=this.iterations,R);m=N(n);){v.length=0,_.bodies.length=0,T=S=x=A=E=y=void 0;var y=m,E=C,A=_.bodies,x=v;for(I.push(y),y.visited=!0,E(y,A,x);I.length;)for(var T,S=I.pop();T=N(S.children);)T.visited=!0,E(T,A,x),I.push(T);for(var w=v.length,v=v.sort(L),u=0;u!==w;u++)l.addEquation(v[u]);l.solve(e,_);l.removeAllEquations(),g++}return g}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(e,t,n){function i(){}(t.exports=i).prototype={constructor:i,addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;return void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t),this},hasEventListener:function(e,t){var n;return void 0!==this._listeners&&void 0!==(n=this._listeners)[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){var n,i;return void 0!==this._listeners&&(void 0!==(n=this._listeners)[e]&&-1!==(i=n[e].indexOf(t)))&&n[e].splice(i,1),this},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=0,i=t.length;n<i;n++)t[n].call(this,e)}}return this}}},{}],50:[function(e,t,n){var s=e("../collision/AABB"),l=e("../math/Vec3");function u(e){this.root=(e=e||{}).root||null,this.aabb=e.aabb?e.aabb.clone():new s,this.data=[],this.children=[]}function i(e,t){(t=t||{}).root=null,t.aabb=e,u.call(this,t),this.maxDepth=void 0!==t.maxDepth?t.maxDepth:8}(t.exports=i).prototype=new u,u.prototype.reset=function(e,t){this.children.length=this.data.length=0},u.prototype.insert=function(e,t,n){var i=this.data;if(n=n||0,!this.aabb.contains(e))return!1;var r=this.children;if(n<(this.maxDepth||this.root.maxDepth)){var a=!1;r.length||(this.subdivide(),a=!0);for(var o=0;8!==o;o++)if(r[o].insert(e,t,n+1))return!0;a&&(r.length=0)}return i.push(t),!0};var c=new l,r=(u.prototype.subdivide=function(){for(var e=this.aabb,t=e.lowerBound,e=e.upperBound,n=this.children,i=(n.push(new u({aabb:new s({lowerBound:new l(0,0,0)})}),new u({aabb:new s({lowerBound:new l(1,0,0)})}),new u({aabb:new s({lowerBound:new l(1,1,0)})}),new u({aabb:new s({lowerBound:new l(1,1,1)})}),new u({aabb:new s({lowerBound:new l(0,1,1)})}),new u({aabb:new s({lowerBound:new l(0,0,1)})}),new u({aabb:new s({lowerBound:new l(1,0,1)})}),new u({aabb:new s({lowerBound:new l(0,1,0)})})),e.vsub(t,c),c.scale(.5,c),this.root||this),r=0;8!==r;r++){var a=n[r],o=(a.root=i,a.aabb.lowerBound);o.x*=c.x,o.y*=c.y,o.z*=c.z,o.vadd(t,o),o.vadd(c,a.aabb.upperBound)}},u.prototype.aabbQuery=function(e,t){this.data,this.children;for(var n=[this];n.length;){var i=n.pop();i.aabb.overlaps(e)&&Array.prototype.push.apply(t,i.data),Array.prototype.push.apply(n,i.children)}return t},new s);u.prototype.rayQuery=function(e,t,n){return e.getAABB(r),r.toLocalFrame(t,r),this.aabbQuery(r,n),n},u.prototype.removeEmptyNodes=function(){for(var e=[this];e.length;){for(var t=e.pop(),n=t.children.length-1;0<=n;n--)t.children[n].data.length||t.children.splice(n,1);Array.prototype.push.apply(e,t.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(e,t,n){function i(){this.objects=[],this.type=Object}(t.exports=i).prototype.release=function(){for(var e=arguments.length,t=0;t!==e;t++)this.objects.push(arguments[t])},i.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},i.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(e,t,n){function i(){this.data={keys:[]}}(t.exports=i).prototype.get=function(e,t){var n;return t<e&&(n=t,t=e,e=n),this.data[e+"-"+t]},i.prototype.set=function(e,t,n){t<e&&(i=t,t=e,e=i);var i=e+"-"+t;this.get(e,t)||this.data.keys.push(i),this.data[i]=n},i.prototype.reset=function(){for(var e=this.data,t=e.keys;0<t.length;)delete e[t.pop()]}},{}],53:[function(e,t,n){function i(){}(t.exports=i).defaults=function(e,t){for(var n in e=e||{},t)n in e||(e[n]=t[n]);return e}},{}],54:[function(e,t,n){t.exports=a;var i=e("../math/Vec3"),r=e("./Pool");function a(){r.call(this),this.type=i}(a.prototype=new r).constructObject=function(){return new i}},{"../math/Vec3":30,"./Pool":51}],55:[function(e,t,o){t.exports=a;var t=e("../collision/AABB"),n=e("../shapes/Shape"),C=e("../collision/Ray"),f=e("../math/Vec3"),L=e("../math/Transform"),i=(e("../shapes/ConvexPolyhedron"),e("../math/Quaternion")),r=(e("../solver/Solver"),e("../utils/Vec3Pool")),l=e("../equations/ContactEquation"),c=e("../equations/FrictionEquation");function a(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new r,this.world=e,this.currentContactMaterial=null,this.enableFrictionReduction=!1}a.prototype.createContactEquation=function(e,t,n,i,r,a){this.contactPointPool.length?((o=this.contactPointPool.pop()).bi=e,o.bj=t):o=new l(e,t),o.enabled=e.collisionResponse&&t.collisionResponse&&n.collisionResponse&&i.collisionResponse;var o,s=this.currentContactMaterial,s=(o.restitution=s.restitution,o.setSpookParams(s.contactEquationStiffness,s.contactEquationRelaxation,this.world.dt),n.material||e.material),e=i.material||t.material;return s&&e&&0<=s.restitution&&0<=e.restitution&&(o.restitution=s.restitution*e.restitution),o.si=r||n,o.sj=a||i,o},a.prototype.createFrictionEquationsFromContact=function(e,t){var n,i=e.bi,r=e.bj,a=this.world,o=this.currentContactMaterial,s=o.friction,l=e.si.material||i.material,u=e.sj.material||r.material;return 0<(s=l&&u&&0<=l.friction&&0<=u.friction?l.friction*u.friction:s)&&(l=s*a.gravity.length(),0<(u=i.invMass+r.invMass)&&(u=1/u),n=(s=this.frictionEquationPool).length?s.pop():new c(i,r,l*u),s=s.length?s.pop():new c(i,r,l*u),n.bi=s.bi=i,n.bj=s.bj=r,n.minForce=s.minForce=-l*u,n.maxForce=s.maxForce=l*u,n.ri.copy(e.ri),n.rj.copy(e.rj),s.ri.copy(e.ri),s.rj.copy(e.rj),e.ni.tangents(n.t,s.t),n.setSpookParams(o.frictionEquationStiffness,o.frictionEquationRelaxation,a.dt),s.setSpookParams(o.frictionEquationStiffness,o.frictionEquationRelaxation,a.dt),n.enabled=s.enabled=e.enabled,t.push(n,s),!0)};var s=new f,u=new f,h=new f,A=(a.prototype.createFrictionFromAverage=function(e){var t=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(t,this.frictionResult)&&1!==e){for(var n=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1],r=(s.setZero(),u.setZero(),h.setZero(),t.bi),a=(t.bj,0);a!==e;a++)(t=this.result[this.result.length-1-a]).bodyA!==r?(s.vadd(t.ni,s),u.vadd(t.ri,u),h.vadd(t.rj,h)):(s.vsub(t.ni,s),u.vadd(t.rj,u),h.vadd(t.ri,h));var o=1/e;u.scale(o,n.ri),h.scale(o,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),s.normalize(),s.tangents(n.t,i.t)}},new f),x=new f,T=new i,S=new i;a.prototype.getContacts=function(e,t,n,i,r,a,o){this.contactPointPool=r,this.frictionEquationPool=o,this.result=i,this.frictionResult=a;for(var s=T,l=S,u=A,c=x,h=0,d=e.length;h!==d;h++){var p=e[h],f=t[h],m=null;p.material&&f.material&&(m=n.getContactMaterial(p.material,f.material)||null);for(var g=0;g<p.shapes.length;g++){p.quaternion.mult(p.shapeOrientations[g],s),p.quaternion.vmult(p.shapeOffsets[g],u),u.vadd(p.position,u);for(var v=p.shapes[g],_=0;_<f.shapes.length;_++){f.quaternion.mult(f.shapeOrientations[_],l),f.quaternion.vmult(f.shapeOffsets[_],c),c.vadd(f.position,c);var y,E=f.shapes[_];u.distanceTo(c)>v.boundingSphereRadius+E.boundingSphereRadius||(y=null,v.material&&E.material&&(y=n.getContactMaterial(v.material,E.material)||null),this.currentContactMaterial=y||m||n.defaultContactMaterial,(y=this[v.type|E.type])&&(v.type<E.type?y.call(this,v,E,u,c,s,l,p,f,v,E):y.call(this,E,v,c,u,l,s,f,p,v,E)))}}}};a.prototype[n.types.BOX|n.types.BOX]=a.prototype.boxBox=function(e,t,n,i,r,a,o,s){e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,n,i,r,a,o,s,e,t)},a.prototype[n.types.BOX|n.types.CONVEXPOLYHEDRON]=a.prototype.boxConvex=function(e,t,n,i,r,a,o,s){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,n,i,r,a,o,s,e,t)},a.prototype[n.types.BOX|n.types.PARTICLE]=a.prototype.boxParticle=function(e,t,n,i,r,a,o,s){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,n,i,r,a,o,s,e,t)},a.prototype[n.types.SPHERE]=a.prototype.sphereSphere=function(e,t,n,i,r,a,o,s){var l=this.createContactEquation(o,s,e,t);i.vsub(n,l.ni),l.ni.normalize(),l.ri.copy(l.ni),l.rj.copy(l.ni),l.ri.mult(e.radius,l.ri),l.rj.mult(-t.radius,l.rj),l.ri.vadd(n,l.ri),l.ri.vsub(o.position,l.ri),l.rj.vadd(i,l.rj),l.rj.vsub(s.position,l.rj),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)};var m=new f,g=new f,v=new f,D=(a.prototype[n.types.PLANE|n.types.TRIMESH]=a.prototype.planeTrimesh=function(e,t,n,i,r,a,o,s){var l=new f,u=m;u.set(0,0,1),r.vmult(u,u);for(var c=0;c<t.vertices.length/3;c++){t.getVertex(c,l);var h,d,p=new f,p=(p.copy(l),L.pointToWorldFrame(i,a,p,l),g);l.vsub(n,p),u.dot(p)<=0&&((h=this.createContactEquation(o,s,e,t)).ni.copy(u),d=v,u.scale(p.dot(u),d),l.vsub(d,d),h.ri.copy(d),h.ri.vsub(o.position,h.ri),h.rj.copy(l),h.rj.vsub(s.position,h.rj),this.result.push(h),this.createFrictionEquationsFromContact(h,this.frictionResult))}},new f),O=new f,P=(new f,new f),U=new f,B=new f,F=new f,z=new f,k=new f,G=new f,H=new f,V=new f,j=new f,Y=new f,q=new t,X=[],d=(a.prototype[n.types.SPHERE|n.types.TRIMESH]=a.prototype.sphereTrimesh=function(e,t,n,i,r,a,o,s){for(var l=B,u=F,c=z,h=k,d=G,p=H,f=q,m=U,g=O,v=X,_=(L.pointToLocalFrame(i,a,n,d),e.radius),y=(f.lowerBound.set(d.x-_,d.y-_,d.z-_),f.upperBound.set(d.x+_,d.y+_,d.z+_),t.getTrianglesInAABB(f,v),P),E=e.radius*e.radius,A=0;A<v.length;A++)for(var x=0;x<3;x++)t.getVertex(t.indices[3*v[A]+x],y),y.vsub(d,g),g.norm2()<=E&&(m.copy(y),L.pointToWorldFrame(i,a,m,y),y.vsub(n,g),(N=this.createContactEquation(o,s,e,t)).ni.copy(g),N.ni.normalize(),N.ri.copy(N.ni),N.ri.scale(e.radius,N.ri),N.ri.vadd(n,N.ri),N.ri.vsub(o.position,N.ri),N.rj.copy(y),N.rj.vsub(s.position,N.rj),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult));for(A=0;A<v.length;A++)for(x=0;x<3;x++){t.getVertex(t.indices[3*v[A]+x],l),t.getVertex(t.indices[3*v[A]+(x+1)%3],u),u.vsub(l,c),d.vsub(u,p);var T=p.dot(c);d.vsub(l,p),0<p.dot(c)&&T<0&&(d.vsub(l,p),h.copy(c),h.normalize(),T=p.dot(h),h.scale(T,p),p.vadd(l,p),(I=p.distanceTo(d))<e.radius)&&(N=this.createContactEquation(o,s,e,t),p.vsub(d,N.ni),N.ni.normalize(),N.ni.scale(e.radius,N.ri),L.pointToWorldFrame(i,a,p,p),p.vsub(s.position,N.rj),L.vectorToWorldFrame(a,N.ni,N.ni),L.vectorToWorldFrame(a,N.ri,N.ri),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult))}for(var S=V,w=j,b=Y,M=D,A=0,R=v.length;A!==R;A++){t.getTriangleVertices(v[A],S,w,b),t.getNormal(v[A],M),d.vsub(S,p);var N,I=p.dot(M);M.scale(I,p),d.vsub(p,p),I=p.distanceTo(d),C.pointInTriangle(p,S,w,b)&&I<e.radius&&(N=this.createContactEquation(o,s,e,t),p.vsub(d,N.ni),N.ni.normalize(),N.ni.scale(e.radius,N.ri),L.pointToWorldFrame(i,a,p,p),p.vsub(s.position,N.rj),L.vectorToWorldFrame(a,N.ni,N.ni),L.vectorToWorldFrame(a,N.ri,N.ri),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult))}v.length=0},new f),p=new f,Z=(a.prototype[n.types.SPHERE|n.types.PLANE]=a.prototype.spherePlane=function(e,t,n,i,r,a,o,s){t=this.createContactEquation(o,s,e,t);t.ni.set(0,0,1),a.vmult(t.ni,t.ni),t.ni.negate(t.ni),t.ni.normalize(),t.ni.mult(e.radius,t.ri),n.vsub(i,d),t.ni.mult(t.ni.dot(d),p),d.vsub(p,t.rj),-d.dot(t.ni)<=e.radius&&(a=t.ri,e=t.rj,a.vadd(n,a),a.vsub(o.position,a),e.vadd(i,e),e.vsub(s.position,e),this.result.push(t),this.createFrictionEquationsFromContact(t,this.frictionResult))},new f),K=new f,J=new f;var W=new f,Q=new f,$=new f,ee=new f,te=[new f,new f,new f,new f,new f,new f],ne=new f,ie=new f,re=new f,ae=new f,oe=(a.prototype[n.types.SPHERE|n.types.BOX]=a.prototype.sphereBox=function(e,t,n,i,U,B,r,a){for(var o=this.v3pool,s=te,l=(n.vsub(i,W),t.getSideNormals(s,B),e.radius),u=!1,c=ie,h=re,d=ae,p=null,F=0,z=0,k=0,f=null,m=0,G=s.length;m!==G&&!1===u;m++){var g,v,_,y,E,A,x=Q,T=(x.copy(s[m]),x.norm()),S=(x.normalize(),W.dot(x));S<T+l&&0<S&&(v=ee,(g=$).copy(s[(m+1)%3]),v.copy(s[(m+2)%3]),_=g.norm(),y=v.norm(),g.normalize(),v.normalize(),E=W.dot(g),A=W.dot(v),E<_)&&-_<E&&A<y&&-y<A&&(O=Math.abs(S-T-l),null===f||O<f)&&(f=O,z=E,k=A,p=T,c.copy(x),h.copy(g),d.copy(v),F++)}F&&(u=!0,L=this.createContactEquation(r,a,e,t),c.mult(-l,L.ri),L.ni.copy(c),L.ni.negate(L.ni),c.mult(p,c),h.mult(z,h),c.vadd(h,c),d.mult(k,d),c.vadd(d,L.rj),L.ri.vadd(n,L.ri),L.ri.vsub(r.position,L.ri),L.rj.vadd(i,L.rj),L.rj.vsub(a.position,L.rj),this.result.push(L),this.createFrictionEquationsFromContact(L,this.frictionResult));for(var w=o.get(),b=ne,M=0;2!==M&&!u;M++)for(var R=0;2!==R&&!u;R++)for(var N=0;2!==N&&!u;N++)w.set(0,0,0),M?w.vadd(s[0],w):w.vsub(s[0],w),R?w.vadd(s[1],w):w.vsub(s[1],w),N?w.vadd(s[2],w):w.vsub(s[2],w),i.vadd(w,b),b.vsub(n,b),b.norm2()<l*l&&(u=!0,(L=this.createContactEquation(r,a,e,t)).ri.copy(b),L.ri.normalize(),L.ni.copy(L.ri),L.ri.mult(l,L.ri),L.rj.copy(w),L.ri.vadd(n,L.ri),L.ri.vsub(r.position,L.ri),L.rj.vadd(i,L.rj),L.rj.vsub(a.position,L.rj),this.result.push(L),this.createFrictionEquationsFromContact(L,this.frictionResult));o.release(w);for(var w=null,I=o.get(),C=o.get(),L=o.get(),D=o.get(),O=o.get(),H=s.length,M=0;M!==H&&!u;M++)for(R=0;R!==H&&!u;R++)if(M%3!=R%3){s[R].cross(s[M],I),I.normalize(),s[M].vadd(s[R],C),L.copy(n),L.vsub(C,L),L.vsub(i,L);for(var P=L.dot(I),N=(I.mult(P,D),0);N===M%3||N===R%3;)N++;O.copy(n),O.vsub(D,O),O.vsub(C,O),O.vsub(i,O);var P=Math.abs(P),V=O.norm();P<s[N].norm()&&V<l&&(u=!0,P=this.createContactEquation(r,a,e,t),C.vadd(D,P.rj),P.rj.copy(P.rj),O.negate(P.ni),P.ni.normalize(),P.ri.copy(P.rj),P.ri.vadd(i,P.ri),P.ri.vsub(n,P.ri),P.ri.normalize(),P.ri.mult(l,P.ri),P.ri.vadd(n,P.ri),P.ri.vsub(r.position,P.ri),P.rj.vadd(i,P.rj),P.rj.vsub(a.position,P.rj),this.result.push(P),this.createFrictionEquationsFromContact(P,this.frictionResult))}o.release(I,C,L,D,O)},new f),se=new f,le=new f,ue=new f,ce=new f,he=new f,de=new f,pe=new f,fe=new f,me=new f,E=(a.prototype[n.types.SPHERE|n.types.CONVEXPOLYHEDRON]=a.prototype.sphereConvex=function(e,t,n,i,P,r,a,o){for(var s=this.v3pool,l=(n.vsub(i,oe),t.faceNormals),u=t.faces,c=t.vertices,h=e.radius,d=0;d!==c.length;d++){var p=c[d],f=ce,p=(r.vmult(p,f),i.vadd(f,f),ue);if(f.vsub(n,p),p.norm2()<h*h)return m=!0,(b=this.createContactEquation(a,o,e,t)).ri.copy(p),b.ri.normalize(),b.ni.copy(b.ri),b.ri.mult(h,b.ri),f.vsub(i,b.rj),b.ri.vadd(n,b.ri),b.ri.vsub(a.position,b.ri),b.rj.vadd(i,b.rj),b.rj.vsub(o.position,b.rj),this.result.push(b),void this.createFrictionEquationsFromContact(b,this.frictionResult)}for(var m=!1,d=0,g=u.length;d!==g&&!1===m;d++){var v=l[d],_=u[d],y=he,v=(r.vmult(v,y),de),E=(r.vmult(c[_[0]],v),v.vadd(i,v),pe),A=(y.mult(-h,E),n.vadd(E,E),fe),E=(E.vsub(v,A),A.dot(y)),A=me;if(n.vsub(v,A),E<0&&0<A.dot(y)){for(var x=[],T=0,S=_.length;T!==S;T++){var w=s.get();r.vmult(c[_[T]],w),i.vadd(w,w),x.push(w)}if(((e,t,n)=>{for(var i=null,r=e.length,a=0;a!==r;a++){var o=e[a],s=Z,l=(e[(a+1)%r].vsub(o,s),K),s=(s.cross(t,l),J),o=(n.vsub(o,s),l.dot(s));if(!(null===i||0<o&&!0===i||o<=0&&!1===i))return;null===i&&(i=0<o)}return 1})(x,y,n)){m=!0;var b=this.createContactEquation(a,o,e,t),v=(y.mult(-h,b.ri),y.negate(b.ni),s.get()),A=(y.mult(-E,v),s.get());y.mult(-h,A),n.vsub(i,b.rj),b.rj.vadd(A,b.rj),b.rj.vadd(v,b.rj),b.rj.vadd(i,b.rj),b.rj.vsub(o.position,b.rj),b.ri.vadd(n,b.ri),b.ri.vsub(a.position,b.ri),s.release(v),s.release(A),this.result.push(b),this.createFrictionEquationsFromContact(b,this.frictionResult);for(var T=0,M=x.length;T!==M;T++)s.release(x[T]);return}for(T=0;T!==_.length;T++){var R=s.get(),N=s.get(),I=(r.vmult(c[_[(T+1)%_.length]],R),r.vmult(c[_[(T+2)%_.length]],N),i.vadd(R,R),i.vadd(N,N),se),C=(N.vsub(R,I),le),L=(I.unit(C),s.get()),D=s.get(),O=(n.vsub(R,D),D.dot(C)),C=(C.mult(O,L),L.vadd(R,L),s.get());if(L.vsub(n,C),0<O&&O*O<I.norm2()&&C.norm2()<h*h){b=this.createContactEquation(a,o,e,t);L.vsub(i,b.rj),L.vsub(n,b.ni),b.ni.normalize(),b.ni.mult(h,b.ri),b.rj.vadd(i,b.rj),b.rj.vsub(o.position,b.rj),b.ri.vadd(n,b.ri),b.ri.vsub(a.position,b.ri),this.result.push(b),this.createFrictionEquationsFromContact(b,this.frictionResult);for(T=0,M=x.length;T!==M;T++)s.release(x[T]);return s.release(R),s.release(N),s.release(L),s.release(C),void s.release(D)}s.release(R),s.release(N),s.release(L),s.release(C),s.release(D)}for(T=0,M=x.length;T!==M;T++)s.release(x[T])}}},new f,new f,a.prototype[n.types.PLANE|n.types.BOX]=a.prototype.planeBox=function(e,t,n,i,r,a,o,s){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.planeConvex(e,t.convexPolyhedronRepresentation,n,i,r,a,o,s)},new f),w=new f,b=new f,M=new f,R=(a.prototype[n.types.PLANE|n.types.CONVEXPOLYHEDRON]=a.prototype.planeConvex=function(e,t,n,i,r,a,o,s){for(var l,u,c=E,h=w,d=(h.set(0,0,1),r.vmult(h,h),0),p=b,f=0;f!==t.vertices.length;f++)c.copy(t.vertices[f]),a.vmult(c,c),i.vadd(c,c),c.vsub(n,p),h.dot(p)<=0&&(l=this.createContactEquation(o,s,e,t),u=M,h.mult(h.dot(p),u),c.vsub(u,u),u.vsub(n,l.ri),l.ni.copy(h),c.vsub(i,l.rj),l.ri.vadd(n,l.ri),l.ri.vsub(o.position,l.ri),l.rj.vadd(i,l.rj),l.rj.vsub(s.position,l.rj),this.result.push(l),d++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(l,this.frictionResult));this.enableFrictionReduction&&d&&this.createFrictionFromAverage(d)},new f),N=new f,I=(a.prototype[n.types.CONVEXPOLYHEDRON]=a.prototype.convexConvex=function(e,t,n,i,r,a,o,s,l,u,c,h){var d=R;if(!(n.distanceTo(i)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,n,r,i,a,d,c,h)){for(var p=[],f=N,m=(e.clipAgainstHull(n,r,t,i,a,d,-100,100,p),0),g=0;g!==p.length;g++){var v=this.createContactEquation(o,s,e,t,l,u),_=v.ri,y=v.rj;d.negate(v.ni),p[g].normal.negate(f),f.mult(p[g].depth,f),p[g].point.vadd(f,_),y.copy(p[g].point),_.vsub(n,_),y.vsub(i,y),_.vadd(n,_),_.vsub(o.position,_),y.vadd(i,y),y.vsub(s.position,y),this.result.push(v),m++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(v,this.frictionResult)}this.enableFrictionReduction&&m&&this.createFrictionFromAverage(m)}},new f),ge=new f,ve=new f,_e=(a.prototype[n.types.PLANE|n.types.PARTICLE]=a.prototype.planeParticle=function(e,t,n,i,r,a,o,s){var l=I,u=(l.set(0,0,1),o.quaternion.vmult(l,l),ge);i.vsub(o.position,u),l.dot(u)<=0&&((u=this.createContactEquation(s,o,t,e)).ni.copy(l),u.ni.negate(u.ni),u.ri.set(0,0,0),s=ve,l.mult(l.dot(i),s),i.vsub(s,s),u.rj.copy(s),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult))},new f),_=(a.prototype[n.types.PARTICLE|n.types.SPHERE]=a.prototype.sphereParticle=function(e,t,n,i,r,a,o,s){var l=_e;l.set(0,0,1),i.vsub(n,l),l.norm2()<=e.radius*e.radius&&(i=this.createContactEquation(s,o,t,e),l.normalize(),i.rj.copy(l),i.rj.mult(e.radius,i.rj),i.ni.copy(l),i.ni.negate(i.ni),i.ri.set(0,0,0),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult))},new i),ye=new f,Ee=(new f,new f),y=new f,Ae=new f,xe=(a.prototype[n.types.PARTICLE|n.types.CONVEXPOLYHEDRON]=a.prototype.convexParticle=function(e,t,n,i,r,a,o,s){var l=-1,u=Ee,c=Ae,h=null,d=ye;if(d.copy(i),d.vsub(n,d),r.conjugate(_),_.vmult(d,d),e.pointIsInside(d)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(n,r),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(r);for(var p=0,f=e.faces.length;p!==f;p++){var m=[e.worldVertices[e.faces[p][0]]],g=e.worldFaceNormals[p],m=(i.vsub(m[0],y),-g.dot(y));(null===h||Math.abs(m)<Math.abs(h))&&(h=m,l=p,u.copy(g),0)}-1!==l?(d=this.createContactEquation(s,o,t,e),u.mult(h,c),c.vadd(i,c),c.vsub(n,c),d.rj.copy(c),u.negate(d.ni),d.ri.set(0,0,0),r=d.ri,t=d.rj,r.vadd(i,r),r.vsub(s.position,r),t.vadd(n,t),t.vsub(o.position,t),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)):console.warn("Point found inside convex, but did not find penetrating face!")}},a.prototype[n.types.BOX|n.types.HEIGHTFIELD]=a.prototype.boxHeightfield=function(e,t,n,i,r,a,o,s){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,n,i,r,a,o,s)},new f),Te=new f,Se=[0],we=(a.prototype[n.types.CONVEXPOLYHEDRON|n.types.HEIGHTFIELD]=a.prototype.convexHeightfield=function(e,t,n,i,r,a,o,s){var l=t.data,u=t.elementSize,c=e.boundingSphereRadius,h=Te,d=Se,p=xe,f=(L.pointToLocalFrame(i,a,n,p),Math.floor((p.x-c)/u)-1),m=Math.ceil((p.x+c)/u)+1,g=Math.floor((p.y-c)/u)-1,v=Math.ceil((p.y+c)/u)+1;if(!(m<0||v<0||f>l.length||g>l[0].length)){(f=f<0?0:f)>=l.length&&(f=l.length-1),(m=m<0?0:m)>=l.length&&(m=l.length-1),(v=v<0?0:v)>=l[0].length&&(v=l[0].length-1),(g=g<0?0:g)>=l[0].length&&(g=l[0].length-1);u=[],l=(t.getRectMinMax(f,g,m,v,u),u[0]),u=u[1];if(!(p.z-c>u||p.z+c<l))for(var _=f;_<m;_++)for(var y=g;y<v;y++)t.getConvexTrianglePillar(_,y,!1),L.pointToWorldFrame(i,a,t.pillarOffset,h),n.distanceTo(h)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.convexConvex(e,t.pillarConvex,n,h,r,a,o,s,null,null,d,null),t.getConvexTrianglePillar(_,y,!0),L.pointToWorldFrame(i,a,t.pillarOffset,h),n.distanceTo(h)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.convexConvex(e,t.pillarConvex,n,h,r,a,o,s,null,null,d,null)}},new f),be=new f;a.prototype[n.types.SPHERE|n.types.HEIGHTFIELD]=a.prototype.sphereHeightfield=function(e,t,n,i,r,a,o,s){var l=t.data,u=e.radius,c=t.elementSize,h=be,d=we,p=(L.pointToLocalFrame(i,a,n,d),Math.floor((d.x-u)/c)-1),f=Math.ceil((d.x+u)/c)+1,m=Math.floor((d.y-u)/c)-1,g=Math.ceil((d.y+u)/c)+1;if(!(f<0||g<0||p>l.length||g>l[0].length)){(p=p<0?0:p)>=l.length&&(p=l.length-1),(f=f<0?0:f)>=l.length&&(f=l.length-1),(g=g<0?0:g)>=l[0].length&&(g=l[0].length-1),(m=m<0?0:m)>=l[0].length&&(m=l[0].length-1);c=[],l=(t.getRectMinMax(p,m,f,g,c),c[0]),c=c[1];if(!(d.z-u>c||d.z+u<l))for(var v=this.result,_=p;_<f;_++)for(var y=m;y<g;y++){var E=v.length;if(t.getConvexTrianglePillar(_,y,!1),L.pointToWorldFrame(i,a,t.pillarOffset,h),n.distanceTo(h)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.sphereConvex(e,t.pillarConvex,n,h,r,a,o,s),t.getConvexTrianglePillar(_,y,!0),L.pointToWorldFrame(i,a,t.pillarOffset,h),n.distanceTo(h)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.sphereConvex(e,t.pillarConvex,n,h,r,a,o,s),2<v.length-E)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(e,t,n){t.exports=m;var $=e("../shapes/Shape"),i=e("../math/Vec3"),t=e("../math/Quaternion"),r=e("../solver/GSSolver"),a=(e("../utils/Vec3Pool"),e("../equations/ContactEquation"),e("../equations/FrictionEquation"),e("./Narrowphase")),o=e("../utils/EventTarget"),s=e("../collision/ArrayCollisionMatrix"),l=e("../material/Material"),u=e("../material/ContactMaterial"),ee=e("../objects/Body"),c=e("../utils/TupleDictionary"),h=e("../collision/RaycastResult"),d=e("../collision/AABB"),p=e("../collision/Ray"),f=e("../collision/NaiveBroadphase");function m(){o.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new i,this.broadphase=new f,this.bodies=[],this.solver=new r,this.constraints=[],this.narrowphase=new a(this),this.collisionMatrix=new s,this.collisionMatrixPrevious=new s,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new c,this.defaultMaterial=new l("default"),this.defaultContactMaterial=new u(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}m.prototype=new o;new d;var g,v=new p,_=(m.prototype.getContactMaterial=function(e,t){return this.contactMaterialTable.get(e.id,t.id)},m.prototype.numObjects=function(){return this.bodies.length},m.prototype.collisionMatrixTick=function(){var e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset()},m.prototype.add=m.prototype.addBody=function(e){-1===this.bodies.indexOf(e)&&(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof ee&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.dispatchEvent(this.addBodyEvent))},m.prototype.addConstraint=function(e){this.constraints.push(e)},m.prototype.removeConstraint=function(e){e=this.constraints.indexOf(e);-1!==e&&this.constraints.splice(e,1)},m.prototype.rayTest=function(e,t,n){n instanceof h?this.raycastClosest(e,t,{skipBackfaces:!0},n):this.raycastAll(e,t,{skipBackfaces:!0},n)},m.prototype.raycastAll=function(e,t,n,i){return n.mode=p.ALL,n.from=e,n.to=t,n.callback=i,v.intersectWorld(this,n)},m.prototype.raycastAny=function(e,t,n,i){return n.mode=p.ANY,n.from=e,n.to=t,n.result=i,v.intersectWorld(this,n)},m.prototype.raycastClosest=function(e,t,n,i){return n.mode=p.CLOSEST,n.from=e,n.to=t,n.result=i,v.intersectWorld(this,n)},m.prototype.removeBody=m.prototype.remove=function(e){e.world=null;var t=this.bodies.length-1,n=this.bodies,i=n.indexOf(e);if(-1!==i){n.splice(i,1);for(var r=0;r!==n.length;r++)n[r].index=r;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,this.dispatchEvent(this.removeBodyEvent)}},m.prototype.addMaterial=function(e){this.materials.push(e)},m.prototype.addContactMaterial=function(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)},(performance="undefined"==typeof performance?{}:performance).now||(g=Date.now(),performance.timing&&performance.timing.navigationStart&&(g=performance.timing.navigationStart),performance.now=function(){return Date.now()-g}),new i),te=(m.prototype.step=function(e,t,n){if(n=n||10,0===(t=t||0))this.internalStep(e),this.time+=e;else{for(var i=Math.floor((this.time+t)/e)-Math.floor(this.time/e),i=Math.min(i,n),r=performance.now(),a=0;a!==i&&(this.internalStep(e),!(performance.now()-r>1e3*e));a++);this.time+=t;for(var o=this.time%e/e,s=_,l=this.bodies,u=0;u!==l.length;u++){var c=l[u];c.type!==ee.STATIC&&c.sleepState!==ee.SLEEPING?(c.position.vsub(c.previousPosition,s),s.scale(o,s),c.position.vadd(s,c.interpolatedPosition)):(c.interpolatedPosition.copy(c.position),c.interpolatedQuaternion.copy(c.quaternion))}}},{type:"postStep"}),ne={type:"preStep"},ie={type:"collide",body:null,contact:null},re=[],ae=[],oe=[],se=[],le=(new i,new i,new i,new i,new i,new i,new i,new i,new i,new t,new t),ue=new t,ce=new i;m.prototype.internalStep=function(e){this.dt=e;var t,n,i,r=this.contacts,a=oe,o=se,s=this.numObjects(),l=this.bodies,u=this.solver,c=this.gravity,h=this.doProfiling,d=this.profile,p=ee.DYNAMIC,f=this.constraints,m=ae,U=(c.norm(),c.x),B=c.y,F=c.z,g=0;for(h&&(t=performance.now()),g=0;g!==s;g++)(A=l[g]).type&p&&(n=A.force,i=A.mass,n.x+=i*U,n.y+=i*B,n.z+=i*F);for(var g=0,z=this.subsystems.length;g!==z;g++)this.subsystems[g].update();h&&(t=performance.now()),a.length=0,o.length=0,this.broadphase.collisionPairs(this,a,o),h&&(d.broadphase=performance.now()-t);var v=f.length;for(g=0;g!==v;g++)if(!(S=f[g]).collideConnected)for(var _=a.length-1;0<=_;--_)(S.bodyA===a[_]&&S.bodyB===o[_]||S.bodyB===a[_]&&S.bodyA===o[_])&&(a.splice(_,1),o.splice(_,1));this.collisionMatrixTick(),h&&(t=performance.now());var y=re,k=r.length;for(g=0;g!==k;g++)y.push(r[g]);r.length=0;var G=this.frictionEquations.length;for(g=0;g!==G;g++)m.push(this.frictionEquations[g]);this.frictionEquations.length=0,this.narrowphase.getContacts(a,o,this,r,y,this.frictionEquations,m),h&&(d.narrowphase=performance.now()-t),h&&(t=performance.now());for(g=0;g<this.frictionEquations.length;g++)u.addEquation(this.frictionEquations[g]);for(var H=r.length,E=0;E!==H;E++){var A=(S=r[E]).bi,x=S.bj,T=A.material&&x.material&&this.getContactMaterial(A.material,x.material)||this.defaultContactMaterial;T.friction;A.material&&x.material&&(0<=A.material.friction&&0<=x.material.friction&&(A.material.friction,x.material.friction),0<=A.material.restitution)&&0<=x.material.restitution&&(S.restitution=A.material.restitution*x.material.restitution),u.addEquation(S),A.allowSleep&&A.type===ee.DYNAMIC&&A.sleepState===ee.SLEEPING&&x.sleepState===ee.AWAKE&&x.type!==ee.STATIC&&(T=x.velocity.norm2()+x.angularVelocity.norm2(),2*Math.pow(x.sleepSpeedLimit,2)<=T)&&(A._wakeUpAfterNarrowphase=!0),x.allowSleep&&x.type===ee.DYNAMIC&&x.sleepState===ee.SLEEPING&&A.sleepState===ee.AWAKE&&A.type!==ee.STATIC&&(T=A.velocity.norm2()+A.angularVelocity.norm2(),2*Math.pow(A.sleepSpeedLimit,2)<=T)&&(x._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(A,x,!0),this.collisionMatrixPrevious.get(A,x)||(ie.body=x,ie.contact=S,A.dispatchEvent(ie),ie.body=A,x.dispatchEvent(ie))}for(h&&(d.makeContactConstraints=performance.now()-t,t=performance.now()),g=0;g!==s;g++)(A=l[g])._wakeUpAfterNarrowphase&&(A.wakeUp(),A._wakeUpAfterNarrowphase=!1);var S,v=f.length;for(g=0;g!==v;g++){(S=f[g]).update();for(var _=0,V=S.equations.length;_!==V;_++){var W=S.equations[_];u.addEquation(W)}}u.solve(e,this),h&&(d.solve=performance.now()-t),u.removeAllEquations();var w,b,j=Math.pow;for(g=0;g!==s;g++)(A=l[g]).type&p&&(w=j(1-A.linearDamping,e),(b=A.velocity).mult(w,b),w=A.angularVelocity)&&(b=j(1-A.angularDamping,e),w.mult(b,w));for(this.dispatchEvent(ne),g=0;g!==s;g++)(A=l[g]).preStep&&A.preStep.call(A);h&&(t=performance.now());var Y=le,M=ue,c=this.stepnumber,q=ee.DYNAMIC|ee.KINEMATIC,X=c%(this.quatNormalizeSkip+1)==0,Z=this.quatNormalizeFast,R=.5*e;$.types.PLANE,$.types.CONVEXPOLYHEDRON;for(g=0;g!==s;g++){var N,I,C,L,D,K,O=l[g],P=O.force,J=O.torque;O.type&q&&O.sleepState!==ee.SLEEPING&&(N=O.velocity,I=O.angularVelocity,C=O.position,L=O.quaternion,D=O.invMass,K=O.invInertiaWorld,N.x+=P.x*D*e,N.y+=P.y*D*e,N.z+=P.z*D*e,O.angularVelocity&&(K.vmult(J,ce),ce.mult(e,ce),ce.vadd(I,I)),C.x+=N.x*e,C.y+=N.y*e,C.z+=N.z*e,O.angularVelocity&&(Y.set(I.x,I.y,I.z,0),Y.mult(L,M),L.x+=R*M.x,L.y+=R*M.y,L.z+=R*M.z,L.w+=R*M.w,X)&&(Z?L.normalizeFast():L.normalize()),O.aabb&&(O.aabbNeedsUpdate=!0),O.updateInertiaWorld)&&O.updateInertiaWorld()}for(this.clearForces(),this.broadphase.dirty=!0,h&&(d.integrate=performance.now()-t),this.time+=e,this.stepnumber+=1,this.dispatchEvent(te),g=0;g!==s;g++){var Q=(A=l[g]).postStep;Q&&Q.call(A)}if(this.allowSleep)for(g=0;g!==s;g++)l[g].sleepTick(this.time)},m.prototype.clearForces=function(){for(var e=this.bodies,t=e.length,n=0;n!==t;n++){var i=e[n];i.force;i.force.set(0,0,0),i.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)},613:function(li,ui){var ci,e,t;e="undefined"!=typeof window?window:this,t=function(A,U){function _(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item}function B(e){return null!=e&&e===e.window}var t=[],F=Object.getPrototypeOf,s=t.slice,z=t.flat?function(e){return t.flat.call(e)}:function(e){return t.concat.apply([],e)},k=t.push,y=t.indexOf,G={},H=G.toString,V=G.hasOwnProperty,W=V.toString,j=W.call(Object),m={},x=A.document,Y={type:!0,src:!0,nonce:!0,noModule:!0};function q(e,t,n){var i,r,a=(n=n||x).createElement("script");if(a.text=e,t)for(i in Y)(r=t[i]||t.getAttribute&&t.getAttribute(i))&&a.setAttribute(i,r);n.head.appendChild(a).parentNode.removeChild(a)}function X(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?G[H.call(e)]||"object":typeof e}var Z=/HTML$/i,T=function(e,t){return new T.fn.init(e,t)};function K(e){var t=!!e&&"length"in e&&e.length,n=X(e);return!_(e)&&!B(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}function E(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}T.fn=T.prototype={jquery:"3.7.1",constructor:T,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){e=T.merge(this.constructor(),e);return e.prevObject=this,e},each:function(e){return T.each(this,e)},map:function(n){return this.pushStack(T.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(T.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(T.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,e=+e+(e<0?t:0);return this.pushStack(0<=e&&e<t?[this[e]]:[])},end:function(){return this.prevObject||this.constructor()},push:k,sort:t.sort,splice:t.splice},T.extend=T.fn.extend=function(){var e,t,n,i,r,a=arguments[0]||{},o=1,s=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[o]||{},o++),"object"==typeof a||_(a)||(a={}),o===s&&(a=this,o--);o<s;o++)if(null!=(e=arguments[o]))for(t in e)n=e[t],"__proto__"!==t&&a!==n&&(l&&n&&(T.isPlainObject(n)||(i=Array.isArray(n)))?(r=a[t],r=i&&!Array.isArray(r)?[]:i||T.isPlainObject(r)?r:{},i=!1,a[t]=T.extend(l,r,n)):void 0!==n&&(a[t]=n));return a},T.extend({expando:"jQuery"+("3.7.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){return!(!e||"[object Object]"!==H.call(e)||(e=F(e))&&("function"!=typeof(e=V.call(e,"constructor")&&e.constructor)||W.call(e)!==j))},isEmptyObject:function(e){for(var t in e)return!1;return!0},globalEval:function(e,t,n){q(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,i=0;if(K(e))for(n=e.length;i<n&&!1!==t.call(e[i],i,e[i]);i++);else for(i in e)if(!1===t.call(e[i],i,e[i]))break;return e},text:function(e){var t,n="",i=0,r=e.nodeType;if(!r)for(;t=e[i++];)n+=T.text(t);return 1===r||11===r?e.textContent:9===r?e.documentElement.textContent:3===r||4===r?e.nodeValue:n},makeArray:function(e,t){t=t||[];return null!=e&&(K(Object(e))?T.merge(t,"string"==typeof e?[e]:e):k.call(t,e)),t},inArray:function(e,t,n){return null==t?-1:y.call(t,e,n)},isXMLDoc:function(e){var t=e&&e.namespaceURI,e=e&&(e.ownerDocument||e).documentElement;return!Z.test(t||e&&e.nodeName||"HTML")},merge:function(e,t){for(var n=+t.length,i=0,r=e.length;i<n;i++)e[r++]=t[i];return e.length=r,e},grep:function(e,t,n){for(var i=[],r=0,a=e.length,o=!n;r<a;r++)!t(e[r],r)!=o&&i.push(e[r]);return i},map:function(e,t,n){var i,r,a=0,o=[];if(K(e))for(i=e.length;a<i;a++)null!=(r=t(e[a],a,n))&&o.push(r);else for(a in e)null!=(r=t(e[a],a,n))&&o.push(r);return z(o)},guid:1,support:m}),"function"==typeof Symbol&&(T.fn[Symbol.iterator]=t[Symbol.iterator]),T.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){G["[object "+t+"]"]=t.toLowerCase()});var J=t.pop,Q=t.sort,$=t.splice,n="[\\x20\\t\\r\\n\\f]",ee=new RegExp("^"+n+"+|((?:^|[^\\\\])(?:\\\\.)*)"+n+"+$","g"),te=(T.contains=function(e,t){t=t&&t.parentNode;return e===t||!(!t||1!==t.nodeType||!(e.contains?e.contains(t):e.compareDocumentPosition&&16&e.compareDocumentPosition(t)))},/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g);function ne(e,t){return t?"\0"===e?"":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}T.escapeSelector=function(e){return(e+"").replace(te,ne)};var ie,S,re,ae,oe,w,i,b,d,se,r=x,le=k,M=le,R=T.expando,N=0,ue=0,ce=Ne(),he=Ne(),de=Ne(),pe=Ne(),fe=function(e,t){return e===t&&(oe=!0),0},me="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",e="(?:\\\\[\\da-fA-F]{1,6}"+n+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",a="\\["+n+"*("+e+")(?:"+n+"*([*^$|!~]?=)"+n+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+e+"))|)"+n+"*\\]",o=":("+e+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+a+")*)|.*)\\)|)",ge=new RegExp(n+"+","g"),ve=new RegExp("^"+n+"*,"+n+"*"),_e=new RegExp("^"+n+"*([>+~]|"+n+")"+n+"*"),ye=new RegExp(n+"|>"),Ee=new RegExp(o),Ae=new RegExp("^"+e+"$"),xe={ID:new RegExp("^#("+e+")"),CLASS:new RegExp("^\\.("+e+")"),TAG:new RegExp("^("+e+"|[*])"),ATTR:new RegExp("^"+a),PSEUDO:new RegExp("^"+o),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+n+"*(even|odd|(([+-]|)(\\d*)n|)"+n+"*(?:([+-]|)"+n+"*(\\d+)|))"+n+"*\\)|)","i"),bool:new RegExp("^(?:"+me+")$","i"),needsContext:new RegExp("^"+n+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+n+"*((?:-\\d)?\\d*)"+n+"*\\)|)(?=[^-]|$)","i")},Te=/^(?:input|select|textarea|button)$/i,Se=/^h\d$/i,we=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,be=/[+~]/,h=new RegExp("\\\\[\\da-fA-F]{1,6}"+n+"?|\\\\([^\\r\\n\\f])","g"),p=function(e,t){e="0x"+e.slice(1)-65536;return t||(e<0?String.fromCharCode(65536+e):String.fromCharCode(e>>10|55296,1023&e|56320))},Me=function(){Oe()},Re=Fe(function(e){return!0===e.disabled&&E(e,"fieldset")},{dir:"parentNode",next:"legend"});try{M.apply(t=s.call(r.childNodes),r.childNodes),t[r.childNodes.length].nodeType}catch(e){M={apply:function(e,t){le.apply(e,s.call(t))},call:function(e){le.apply(e,s.call(arguments,1))}}}function I(t,e,n,i){var r,a,o,s,l,u,c=e&&e.ownerDocument,h=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==h&&9!==h&&11!==h)return n;if(!i&&(Oe(e),e=e||w,b)){if(11!==h&&(s=we.exec(t)))if(r=s[1]){if(9===h){if(!(u=e.getElementById(r)))return n;if(u.id===r)return M.call(n,u),n}else if(c&&(u=c.getElementById(r))&&I.contains(e,u)&&u.id===r)return M.call(n,u),n}else{if(s[2])return M.apply(n,e.getElementsByTagName(t)),n;if((r=s[3])&&e.getElementsByClassName)return M.apply(n,e.getElementsByClassName(r)),n}if(!(pe[t+" "]||d&&d.test(t))){if(u=t,c=e,1===h&&(ye.test(t)||_e.test(t))){for((c=be.test(t)&&De(e.parentNode)||e)==e&&m.scope||((o=e.getAttribute("id"))?o=T.escapeSelector(o):e.setAttribute("id",o=R)),a=(l=Ue(t)).length;a--;)l[a]=(o?"#"+o:":scope")+" "+Be(l[a]);u=l.join(",")}try{return M.apply(n,c.querySelectorAll(u)),n}catch(e){pe(t,!0)}finally{o===R&&e.removeAttribute("id")}}}return We(t.replace(ee,"$1"),e,n,i)}function Ne(){var n=[];function i(e,t){return n.push(e+" ")>S.cacheLength&&delete i[n.shift()],i[e+" "]=t}return i}function l(e){return e[R]=!0,e}function Ie(e){var t=w.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t)}}function Ce(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&Re(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function Le(o){return l(function(a){return a=+a,l(function(e,t){for(var n,i=o([],e.length,a),r=i.length;r--;)e[n=i[r]]&&(e[n]=!(t[n]=e[n]))})})}function De(e){return e&&void 0!==e.getElementsByTagName&&e}function Oe(e){var e=e?e.ownerDocument||e:r;return e!=w&&9===e.nodeType&&e.documentElement&&(i=(w=e).documentElement,b=!T.isXMLDoc(w),se=i.matches||i.webkitMatchesSelector||i.msMatchesSelector,i.msMatchesSelector&&r!=w&&(e=w.defaultView)&&e.top!==e&&e.addEventListener("unload",Me),m.getById=Ie(function(e){return i.appendChild(e).id=T.expando,!w.getElementsByName||!w.getElementsByName(T.expando).length}),m.disconnectedMatch=Ie(function(e){return se.call(e,"*")}),m.scope=Ie(function(){return w.querySelectorAll(":scope")}),m.cssHas=Ie(function(){try{w.querySelector(":has(*,:jqfake)")}catch(e){return 1}}),m.getById?(S.filter.ID=function(e){var t=e.replace(h,p);return function(e){return e.getAttribute("id")===t}},S.find.ID=function(e,t){if(void 0!==t.getElementById&&b)return(t=t.getElementById(e))?[t]:[]}):(S.filter.ID=function(e){var t=e.replace(h,p);return function(e){e=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return e&&e.value===t}},S.find.ID=function(e,t){if(void 0!==t.getElementById&&b){var n,i,r,a=t.getElementById(e);if(a){if((n=a.getAttributeNode("id"))&&n.value===e)return[a];for(r=t.getElementsByName(e),i=0;a=r[i++];)if((n=a.getAttributeNode("id"))&&n.value===e)return[a]}return[]}}),S.find.TAG=function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):t.querySelectorAll(e)},S.find.CLASS=function(e,t){if(void 0!==t.getElementsByClassName&&b)return t.getElementsByClassName(e)},d=[],Ie(function(e){var t;i.appendChild(e).innerHTML="<a id='"+R+"' href='' disabled='disabled'></a><select id='"+R+"-\r\\' disabled='disabled'><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+n+"*(?:value|"+me+")"),e.querySelectorAll("[id~="+R+"-]").length||d.push("~="),e.querySelectorAll("a#"+R+"+*").length||d.push(".#.+[+~]"),e.querySelectorAll(":checked").length||d.push(":checked"),(t=w.createElement("input")).setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),i.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&d.push(":enabled",":disabled"),(t=w.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||d.push("\\["+n+"*name"+n+"*="+n+"*(?:''|\"\")")}),m.cssHas||d.push(":has"),d=d.length&&new RegExp(d.join("|")),fe=function(e,t){var n;return e===t?(oe=!0,0):(n=!e.compareDocumentPosition-!t.compareDocumentPosition)||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!m.sortDetached&&t.compareDocumentPosition(e)===n?e===w||e.ownerDocument==r&&I.contains(r,e)?-1:t===w||t.ownerDocument==r&&I.contains(r,t)?1:ae?y.call(ae,e)-y.call(ae,t):0:4&n?-1:1)}),w}for(ie in I.matches=function(e,t){return I(e,null,null,t)},I.matchesSelector=function(e,t){if(Oe(e),b&&!pe[t+" "]&&(!d||!d.test(t)))try{var n=se.call(e,t);if(n||m.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){pe(t,!0)}return 0<I(t,w,null,[e]).length},I.contains=function(e,t){return(e.ownerDocument||e)!=w&&Oe(e),T.contains(e,t)},I.attr=function(e,t){(e.ownerDocument||e)!=w&&Oe(e);var n=S.attrHandle[t.toLowerCase()],n=n&&V.call(S.attrHandle,t.toLowerCase())?n(e,t,!b):void 0;return void 0!==n?n:e.getAttribute(t)},I.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},T.uniqueSort=function(e){var t,n=[],i=0,r=0;if(oe=!m.sortStable,ae=!m.sortStable&&s.call(e,0),Q.call(e,fe),oe){for(;t=e[r++];)t===e[r]&&(i=n.push(r));for(;i--;)$.call(e,n[i],1)}return ae=null,e},T.fn.uniqueSort=function(){return this.pushStack(T.uniqueSort(s.apply(this)))},(S=T.expr={cacheLength:50,createPseudo:l,match:xe,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(h,p),e[3]=(e[3]||e[4]||e[5]||"").replace(h,p),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||I.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&I.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return xe.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&Ee.test(n)&&(t=(t=Ue(n,!0))&&n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(h,p).toLowerCase();return"*"===e?function(){return!0}:function(e){return E(e,t)}},CLASS:function(e){var t=ce[e+" "];return t||(t=new RegExp("(^|"+n+")"+e+"("+n+"|$)"))&&ce(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(t,n,i){return function(e){e=I.attr(e,t);return null==e?"!="===n:!n||(e+="","="===n?e===i:"!="===n?e!==i:"^="===n?i&&0===e.indexOf(i):"*="===n?i&&-1<e.indexOf(i):"$="===n?i&&e.slice(-i.length)===i:"~="===n?-1<(" "+e.replace(ge," ")+" ").indexOf(i):"|="===n&&(e===i||e.slice(0,i.length+1)===i+"-"))}},CHILD:function(p,e,t,f,m){var g="nth"!==p.slice(0,3),v="last"!==p.slice(-4),_="of-type"===e;return 1===f&&0===m?function(e){return!!e.parentNode}:function(e,t,n){var i,r,a,o,s,l=g!=v?"nextSibling":"previousSibling",u=e.parentNode,c=_&&e.nodeName.toLowerCase(),h=!n&&!_,d=!1;if(u){if(g){for(;l;){for(a=e;a=a[l];)if(_?E(a,c):1===a.nodeType)return!1;s=l="only"===p&&!s&&"nextSibling"}return!0}if(s=[v?u.firstChild:u.lastChild],v&&h){for(d=(o=(i=(r=u[R]||(u[R]={}))[p]||[])[0]===N&&i[1])&&i[2],a=o&&u.childNodes[o];a=++o&&a&&a[l]||(d=o=0,s.pop());)if(1===a.nodeType&&++d&&a===e){r[p]=[N,o,d];break}}else if(!1===(d=h?o=(i=(r=e[R]||(e[R]={}))[p]||[])[0]===N&&i[1]:d))for(;(a=++o&&a&&a[l]||(d=o=0,s.pop()))&&((_?!E(a,c):1!==a.nodeType)||!++d||(h&&((r=a[R]||(a[R]={}))[p]=[N,d]),a!==e)););return(d-=m)===f||d%f==0&&0<=d/f}}},PSEUDO:function(e,a){var t,o=S.pseudos[e]||S.setFilters[e.toLowerCase()]||I.error("unsupported pseudo: "+e);return o[R]?o(a):1<o.length?(t=[e,e,"",a],S.setFilters.hasOwnProperty(e.toLowerCase())?l(function(e,t){for(var n,i=o(e,a),r=i.length;r--;)e[n=y.call(e,i[r])]=!(t[n]=i[r])}):function(e){return o(e,0,t)}):o}},pseudos:{not:l(function(e){var i=[],r=[],s=Ve(e.replace(ee,"$1"));return s[R]?l(function(e,t,n,i){for(var r,a=s(e,null,i,[]),o=e.length;o--;)(r=a[o])&&(e[o]=!(t[o]=r))}):function(e,t,n){return i[0]=e,s(i,null,n,r),i[0]=null,!r.pop()}}),has:l(function(t){return function(e){return 0<I(t,e).length}}),contains:l(function(t){return t=t.replace(h,p),function(e){return-1<(e.textContent||T.text(e)).indexOf(t)}}),lang:l(function(n){return Ae.test(n||"")||I.error("unsupported lang: "+n),n=n.replace(h,p).toLowerCase(),function(e){var t;do{if(t=b?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=A.location&&A.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===i},focus:function(e){return e===(()=>{try{return w.activeElement}catch(e){}})()&&w.hasFocus()&&!!(e.type||e.href||~e.tabIndex)},enabled:Ce(!1),disabled:Ce(!0),checked:function(e){return E(e,"input")&&!!e.checked||E(e,"option")&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!S.pseudos.empty(e)},header:function(e){return Se.test(e.nodeName)},input:function(e){return Te.test(e.nodeName)},button:function(e){return E(e,"input")&&"button"===e.type||E(e,"button")},text:function(e){return E(e,"input")&&"text"===e.type&&(null==(e=e.getAttribute("type"))||"text"===e.toLowerCase())},first:Le(function(){return[0]}),last:Le(function(e,t){return[t-1]}),eq:Le(function(e,t,n){return[n<0?n+t:n]}),even:Le(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:Le(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:Le(function(e,t,n){for(var i=n<0?n+t:t<n?t:n;0<=--i;)e.push(i);return e}),gt:Le(function(e,t,n){for(var i=n<0?n+t:n;++i<t;)e.push(i);return e})}}).pseudos.nth=S.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})S.pseudos[ie]=(t=>function(e){return E(e,"input")&&e.type===t})(ie);for(ie in{submit:!0,reset:!0})S.pseudos[ie]=(t=>function(e){return(E(e,"input")||E(e,"button"))&&e.type===t})(ie);function Pe(){}function Ue(e,t){var n,i,r,a,o,s,l,u=he[e+" "];if(u)return t?0:u.slice(0);for(o=e,s=[],l=S.preFilter;o;){for(a in n&&!(i=ve.exec(o))||(i&&(o=o.slice(i[0].length)||o),s.push(r=[])),n=!1,(i=_e.exec(o))&&(n=i.shift(),r.push({value:n,type:i[0].replace(ee," ")}),o=o.slice(n.length)),S.filter)!(i=xe[a].exec(o))||l[a]&&!(i=l[a](i))||(n=i.shift(),r.push({value:n,type:a,matches:i}),o=o.slice(n.length));if(!n)break}return t?o.length:o?I.error(e):he(e,s).slice(0)}function Be(e){for(var t=0,n=e.length,i="";t<n;t++)i+=e[t].value;return i}function Fe(o,e,t){var s=e.dir,l=e.next,u=l||s,c=t&&"parentNode"===u,h=ue++;return e.first?function(e,t,n){for(;e=e[s];)if(1===e.nodeType||c)return o(e,t,n);return!1}:function(e,t,n){var i,r,a=[N,h];if(n){for(;e=e[s];)if((1===e.nodeType||c)&&o(e,t,n))return!0}else for(;e=e[s];)if(1===e.nodeType||c)if(r=e[R]||(e[R]={}),l&&E(e,l))e=e[s]||e;else{if((i=r[u])&&i[0]===N&&i[1]===h)return a[2]=i[2];if((r[u]=a)[2]=o(e,t,n))return!0}return!1}}function ze(r){return 1<r.length?function(e,t,n){for(var i=r.length;i--;)if(!r[i](e,t,n))return!1;return!0}:r[0]}function ke(e,t,n,i,r){for(var a,o=[],s=0,l=e.length,u=null!=t;s<l;s++)!(a=e[s])||n&&!n(a,i,r)||(o.push(a),u&&t.push(s));return o}function Ge(p,f,m,g,v,e){return g&&!g[R]&&(g=Ge(g)),v&&!v[R]&&(v=Ge(v,e)),l(function(e,t,n,i){var r,a,o,s,l=[],u=[],c=t.length,h=e||((e,t,n)=>{for(var i=0,r=t.length;i<r;i++)I(e,t[i],n);return n})(f||"*",n.nodeType?[n]:n,[]),d=!p||!e&&f?h:ke(h,l,p,n,i);if(m?m(d,s=v||(e?p:c||g)?[]:t,n,i):s=d,g)for(r=ke(s,u),g(r,[],n,i),a=r.length;a--;)(o=r[a])&&(s[u[a]]=!(d[u[a]]=o));if(e){if(v||p){if(v){for(r=[],a=s.length;a--;)(o=s[a])&&r.push(d[a]=o);v(null,s=[],r,i)}for(a=s.length;a--;)(o=s[a])&&-1<(r=v?y.call(e,o):l[a])&&(e[r]=!(t[r]=o))}}else s=ke(s===t?s.splice(c,s.length):s),v?v(null,t,s,i):M.apply(t,s)})}function He(g,v){function e(e,t,n,i,r){var a,o,s,l=0,u="0",c=e&&[],h=[],d=re,p=e||y&&S.find.TAG("*",r),f=N+=null==d?1:Math.random()||.1,m=p.length;for(r&&(re=t==w||t||r);u!==m&&null!=(a=p[u]);u++){if(y&&a){for(o=0,t||a.ownerDocument==w||(Oe(a),n=!b);s=g[o++];)if(s(a,t||w,n)){M.call(i,a);break}r&&(N=f)}_&&((a=!s&&a)&&l--,e)&&c.push(a)}if(l+=u,_&&u!==l){for(o=0;s=v[o++];)s(c,h,t,n);if(e){if(0<l)for(;u--;)c[u]||h[u]||(h[u]=J.call(i));h=ke(h)}M.apply(i,h),r&&!e&&0<h.length&&1<l+v.length&&T.uniqueSort(i)}return r&&(N=f,re=d),c}var _=0<v.length,y=0<g.length;return _?l(e):e}function Ve(e,t){var n,i=[],r=[],a=de[e+" "];if(!a){for(n=(t=t||Ue(e)).length;n--;)((a=function e(t){for(var i,n,r,a=t.length,o=S.relative[t[0].type],s=o||S.relative[" "],l=o?1:0,u=Fe(function(e){return e===i},s,!0),c=Fe(function(e){return-1<y.call(i,e)},s,!0),h=[function(e,t,n){return e=!o&&(n||t!=re)||((i=t).nodeType?u:c)(e,t,n),i=null,e}];l<a;l++)if(n=S.relative[t[l].type])h=[Fe(ze(h),n)];else{if((n=S.filter[t[l].type].apply(null,t[l].matches))[R]){for(r=++l;r<a&&!S.relative[t[r].type];r++);return Ge(1<l&&ze(h),1<l&&Be(t.slice(0,l-1).concat({value:" "===t[l-2].type?"*":""})).replace(ee,"$1"),n,l<r&&e(t.slice(l,r)),r<a&&e(t=t.slice(r)),r<a&&Be(t))}h.push(n)}return ze(h)}(t[n]))[R]?i:r).push(a);(a=de(e,He(r,i))).selector=e}return a}function We(e,t,n,i){var r,a,o,s,l,u="function"==typeof e&&e,c=!i&&Ue(e=u.selector||e);if(n=n||[],1===c.length){if(2<(a=c[0]=c[0].slice(0)).length&&"ID"===(o=a[0]).type&&9===t.nodeType&&b&&S.relative[a[1].type]){if(!(t=(S.find.ID(o.matches[0].replace(h,p),t)||[])[0]))return n;u&&(t=t.parentNode),e=e.slice(a.shift().value.length)}for(r=xe.needsContext.test(e)?0:a.length;r--&&(o=a[r],!S.relative[s=o.type]);)if((l=S.find[s])&&(i=l(o.matches[0].replace(h,p),be.test(a[0].type)&&De(t.parentNode)||t))){if(a.splice(r,1),e=i.length&&Be(a))break;return M.apply(n,i),n}}return(u||Ve(e,c))(i,t,!b,n,!t||be.test(e)&&De(t.parentNode)||t),n}Pe.prototype=S.filters=S.pseudos,S.setFilters=new Pe,m.sortStable=R.split("").sort(fe).join("")===R,Oe(),m.sortDetached=Ie(function(e){return 1&e.compareDocumentPosition(w.createElement("fieldset"))}),T.find=I,T.expr[":"]=T.expr.pseudos,T.unique=T.uniqueSort,I.compile=Ve,I.select=We,I.setDocument=Oe,I.tokenize=Ue,I.escape=T.escapeSelector,I.getText=T.text,I.isXML=T.isXMLDoc,I.selectors=T.expr,I.support=T.support,I.uniqueSort=T.uniqueSort;function je(e,t,n){for(var i=[],r=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(r&&T(e).is(n))break;i.push(e)}return i}function Ye(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}var qe=T.expr.match.needsContext,Xe=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function Ze(e,n,i){return _(n)?T.grep(e,function(e,t){return!!n.call(e,t,e)!==i}):n.nodeType?T.grep(e,function(e){return e===n!==i}):"string"!=typeof n?T.grep(e,function(e){return-1<y.call(n,e)!==i}):T.filter(n,e,i)}T.filter=function(e,t,n){var i=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?T.find.matchesSelector(i,e)?[i]:[]:T.find.matches(e,T.grep(t,function(e){return 1===e.nodeType}))},T.fn.extend({find:function(e){var t,n,i=this.length,r=this;if("string"!=typeof e)return this.pushStack(T(e).filter(function(){for(t=0;t<i;t++)if(T.contains(r[t],this))return!0}));for(n=this.pushStack([]),t=0;t<i;t++)T.find(e,r[t],n);return 1<i?T.uniqueSort(n):n},filter:function(e){return this.pushStack(Ze(this,e||[],!1))},not:function(e){return this.pushStack(Ze(this,e||[],!0))},is:function(e){return!!Ze(this,"string"==typeof e&&qe.test(e)?T(e):e||[],!1).length}});var Ke,Je=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,Qe=((T.fn.init=function(e,t,n){if(e){if(n=n||Ke,"string"!=typeof e)return e.nodeType?(this[0]=e,this.length=1,this):_(e)?void 0!==n.ready?n.ready(e):e(T):T.makeArray(e,this);if(!(i="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:Je.exec(e))||!i[1]&&t)return(!t||t.jquery?t||n:this.constructor(t)).find(e);if(i[1]){if(t=t instanceof T?t[0]:t,T.merge(this,T.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:x,!0)),Xe.test(i[1])&&T.isPlainObject(t))for(var i in t)_(this[i])?this[i](t[i]):this.attr(i,t[i])}else(n=x.getElementById(i[2]))&&(this[0]=n,this.length=1)}return this}).prototype=T.fn,Ke=T(x),/^(?:parents|prev(?:Until|All))/),$e={children:!0,contents:!0,next:!0,prev:!0};function et(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}T.fn.extend({has:function(e){var t=T(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(T.contains(this,t[e]))return!0})},closest:function(e,t){var n,i=0,r=this.length,a=[],o="string"!=typeof e&&T(e);if(!qe.test(e))for(;i<r;i++)for(n=this[i];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?-1<o.index(n):1===n.nodeType&&T.find.matchesSelector(n,e))){a.push(n);break}return this.pushStack(1<a.length?T.uniqueSort(a):a)},index:function(e){return e?"string"==typeof e?y.call(T(e),this[0]):y.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(T.uniqueSort(T.merge(this.get(),T(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),T.each({parent:function(e){e=e.parentNode;return e&&11!==e.nodeType?e:null},parents:function(e){return je(e,"parentNode")},parentsUntil:function(e,t,n){return je(e,"parentNode",n)},next:function(e){return et(e,"nextSibling")},prev:function(e){return et(e,"previousSibling")},nextAll:function(e){return je(e,"nextSibling")},prevAll:function(e){return je(e,"previousSibling")},nextUntil:function(e,t,n){return je(e,"nextSibling",n)},prevUntil:function(e,t,n){return je(e,"previousSibling",n)},siblings:function(e){return Ye((e.parentNode||{}).firstChild,e)},children:function(e){return Ye(e.firstChild)},contents:function(e){return null!=e.contentDocument&&F(e.contentDocument)?e.contentDocument:(E(e,"template")&&(e=e.content||e),T.merge([],e.childNodes))}},function(i,r){T.fn[i]=function(e,t){var n=T.map(this,r,e);return(t="Until"!==i.slice(-5)?e:t)&&"string"==typeof t&&(n=T.filter(t,n)),1<this.length&&($e[i]||T.uniqueSort(n),Qe.test(i))&&n.reverse(),this.pushStack(n)}});var C=/[^\x20\t\r\n\f]+/g;function tt(e){return e}function nt(e){throw e}function it(e,t,n,i){var r;try{e&&_(r=e.promise)?r.call(e).done(t).fail(n):e&&_(r=e.then)?r.call(e,t,n):t.apply(void 0,[e].slice(i))}catch(e){n.apply(void 0,[e])}}T.Callbacks=function(i){var e,n;i="string"==typeof i?(e=i,n={},T.each(e.match(C)||[],function(e,t){n[t]=!0}),n):T.extend({},i);function r(){for(s=s||i.once,o=a=!0;u.length;c=-1)for(t=u.shift();++c<l.length;)!1===l[c].apply(t[0],t[1])&&i.stopOnFalse&&(c=l.length,t=!1);i.memory||(t=!1),a=!1,s&&(l=t?[]:"")}var a,t,o,s,l=[],u=[],c=-1,h={add:function(){return l&&(t&&!a&&(c=l.length-1,u.push(t)),function n(e){T.each(e,function(e,t){_(t)?i.unique&&h.has(t)||l.push(t):t&&t.length&&"string"!==X(t)&&n(t)})}(arguments),t)&&!a&&r(),this},remove:function(){return T.each(arguments,function(e,t){for(var n;-1<(n=T.inArray(t,l,n));)l.splice(n,1),n<=c&&c--}),this},has:function(e){return e?-1<T.inArray(e,l):0<l.length},empty:function(){return l=l&&[],this},disable:function(){return s=u=[],l=t="",this},disabled:function(){return!l},lock:function(){return s=u=[],t||a||(l=t=""),this},locked:function(){return!!s},fireWith:function(e,t){return s||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),a)||r(),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!o}};return h},T.extend({Deferred:function(e){var a=[["notify","progress",T.Callbacks("memory"),T.Callbacks("memory"),2],["resolve","done",T.Callbacks("once memory"),T.Callbacks("once memory"),0,"resolved"],["reject","fail",T.Callbacks("once memory"),T.Callbacks("once memory"),1,"rejected"]],r="pending",o={state:function(){return r},always:function(){return s.done(arguments).fail(arguments),this},catch:function(e){return o.then(null,e)},pipe:function(){var r=arguments;return T.Deferred(function(i){T.each(a,function(e,t){var n=_(r[t[4]])&&r[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&_(e.promise)?e.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[t[0]+"With"](this,n?[e]:arguments)})}),r=null}).promise()},then:function(t,n,i){var l=0;function u(r,a,o,s){return function(){function e(){var e,t;if(!(r<l)){if((e=o.apply(n,i))===a.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,_(t)?s?t.call(e,u(l,a,tt,s),u(l,a,nt,s)):(l++,t.call(e,u(l,a,tt,s),u(l,a,nt,s),u(l,a,tt,a.notifyWith))):(o!==tt&&(n=void 0,i=[e]),(s||a.resolveWith)(n,i))}}var n=this,i=arguments,t=s?e:function(){try{e()}catch(e){T.Deferred.exceptionHook&&T.Deferred.exceptionHook(e,t.error),l<=r+1&&(o!==nt&&(n=void 0,i=[e]),a.rejectWith(n,i))}};r?t():(T.Deferred.getErrorHook?t.error=T.Deferred.getErrorHook():T.Deferred.getStackHook&&(t.error=T.Deferred.getStackHook()),A.setTimeout(t))}}return T.Deferred(function(e){a[0][3].add(u(0,e,_(i)?i:tt,e.notifyWith)),a[1][3].add(u(0,e,_(t)?t:tt)),a[2][3].add(u(0,e,_(n)?n:nt))}).promise()},promise:function(e){return null!=e?T.extend(e,o):o}},s={};return T.each(a,function(e,t){var n=t[2],i=t[5];o[t[1]]=n.add,i&&n.add(function(){r=i},a[3-e][2].disable,a[3-e][3].disable,a[0][2].lock,a[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),o.promise(s),e&&e.call(s,s),s},when:function(e){function t(t){return function(e){r[t]=this,a[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,a)}}var n=arguments.length,i=n,r=Array(i),a=s.call(arguments),o=T.Deferred();if(n<=1&&(it(e,o.done(t(i)).resolve,o.reject,!n),"pending"===o.state()||_(a[i]&&a[i].then)))return o.then();for(;i--;)it(a[i],t(i),o.reject);return o.promise()}});var rt=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/,at=(T.Deferred.exceptionHook=function(e,t){A.console&&A.console.warn&&e&&rt.test(e.name)&&A.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},T.readyException=function(e){A.setTimeout(function(){throw e})},T.Deferred());function ot(){x.removeEventListener("DOMContentLoaded",ot),A.removeEventListener("load",ot),T.ready()}T.fn.ready=function(e){return at.then(e).catch(function(e){T.readyException(e)}),this},T.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--T.readyWait:T.isReady)||(T.isReady=!0)!==e&&0<--T.readyWait||at.resolveWith(x,[T])}}),T.ready.then=at.then,"complete"===x.readyState||"loading"!==x.readyState&&!x.documentElement.doScroll?A.setTimeout(T.ready):(x.addEventListener("DOMContentLoaded",ot),A.addEventListener("load",ot));function c(e,t,n,i,r,a,o){var s=0,l=e.length,u=null==n;if("object"===X(n))for(s in r=!0,n)c(e,t,s,n[s],!0,a,o);else if(void 0!==i&&(r=!0,_(i)||(o=!0),t=u?o?(t.call(e,i),null):(u=t,function(e,t,n){return u.call(T(e),n)}):t))for(;s<l;s++)t(e[s],n,o?i:i.call(e[s],s,t(e[s],n)));return r?e:u?t.call(e):l?t(e[0],n):a}var st=/^-ms-/,lt=/-([a-z])/g;function ut(e,t){return t.toUpperCase()}function L(e){return e.replace(st,"ms-").replace(lt,ut)}function ct(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType}function ht(){this.expando=T.expando+ht.uid++}ht.uid=1,ht.prototype={cache:function(e){var t=e[this.expando];return t||(t={},ct(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var i,r=this.cache(e);if("string"==typeof t)r[L(t)]=n;else for(i in t)r[L(i)]=t[i];return r},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][L(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,i=e[this.expando];if(void 0!==i){if(void 0!==t){n=(t=Array.isArray(t)?t.map(L):(t=L(t))in i?[t]:t.match(C)||[]).length;for(;n--;)delete i[t[n]]}void 0!==t&&!T.isEmptyObject(i)||(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){e=e[this.expando];return void 0!==e&&!T.isEmptyObject(e)}};var v=new ht,u=new ht,dt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,pt=/[A-Z]/g;function ft(e,t,n){var i,r;if(void 0===n&&1===e.nodeType)if(i="data-"+t.replace(pt,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(i))){try{n="true"===(r=n)||"false"!==r&&("null"===r?null:r===+r+""?+r:dt.test(r)?JSON.parse(r):r)}catch(e){}u.set(e,t,n)}else n=void 0;return n}T.extend({hasData:function(e){return u.hasData(e)||v.hasData(e)},data:function(e,t,n){return u.access(e,t,n)},removeData:function(e,t){u.remove(e,t)},_data:function(e,t,n){return v.access(e,t,n)},_removeData:function(e,t){v.remove(e,t)}}),T.fn.extend({data:function(n,e){var t,i,r,a=this[0],o=a&&a.attributes;if(void 0!==n)return"object"==typeof n?this.each(function(){u.set(this,n)}):c(this,function(e){var t;if(a&&void 0===e)return void 0!==(t=u.get(a,n))||void 0!==(t=ft(a,n))?t:void 0;this.each(function(){u.set(this,n,e)})},null,e,1<arguments.length,null,!0);if(this.length&&(r=u.get(a),1===a.nodeType)&&!v.get(a,"hasDataAttrs")){for(t=o.length;t--;)o[t]&&0===(i=o[t].name).indexOf("data-")&&(i=L(i.slice(5)),ft(a,i,r[i]));v.set(a,"hasDataAttrs",!0)}return r},removeData:function(e){return this.each(function(){u.remove(this,e)})}}),T.extend({queue:function(e,t,n){var i;if(e)return i=v.get(e,t=(t||"fx")+"queue"),n&&(!i||Array.isArray(n)?i=v.access(e,t,T.makeArray(n)):i.push(n)),i||[]},dequeue:function(e,t){t=t||"fx";var n=T.queue(e,t),i=n.length,r=n.shift(),a=T._queueHooks(e,t);"inprogress"===r&&(r=n.shift(),i--),r&&("fx"===t&&n.unshift("inprogress"),delete a.stop,r.call(e,function(){T.dequeue(e,t)},a)),!i&&a&&a.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return v.get(e,n)||v.access(e,n,{empty:T.Callbacks("once memory").add(function(){v.remove(e,[t+"queue",n])})})}}),T.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?T.queue(this[0],t):void 0===n?this:this.each(function(){var e=T.queue(this,t,n);T._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&T.dequeue(this,t)})},dequeue:function(e){return this.each(function(){T.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){function n(){--r||a.resolveWith(o,[o])}var i,r=1,a=T.Deferred(),o=this,s=this.length;for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)(i=v.get(o[s],e+"queueHooks"))&&i.empty&&(r++,i.empty.add(n));return n(),a.promise(t)}});function mt(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&yt(e)&&"none"===T.css(e,"display")}var e=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,gt=new RegExp("^(?:([+-])=|)("+e+")([a-z%]*)$","i"),vt=["Top","Right","Bottom","Left"],_t=x.documentElement,yt=function(e){return T.contains(e.ownerDocument,e)},Et={composed:!0};_t.getRootNode&&(yt=function(e){return T.contains(e.ownerDocument,e)||e.getRootNode(Et)===e.ownerDocument});function At(e,t,n,i){var r,a,o=20,s=i?function(){return i.cur()}:function(){return T.css(e,t,"")},l=s(),u=n&&n[3]||(T.cssNumber[t]?"":"px"),c=e.nodeType&&(T.cssNumber[t]||"px"!==u&&+l)&&gt.exec(T.css(e,t));if(c&&c[3]!==u){for(u=u||c[3],c=+(l/=2)||1;o--;)T.style(e,t,c+u),(1-a)*(1-(a=s()/l||.5))<=0&&(o=0),c/=a;T.style(e,t,(c*=2)+u),n=n||[]}return n&&(c=+c||+l||0,r=n[1]?c+(n[1]+1)*n[2]:+n[2],i)&&(i.unit=u,i.start=c,i.end=r),r}var xt={};function Tt(e,t){for(var n,i,r,a,o,s=[],l=0,u=e.length;l<u;l++)(i=e[l]).style&&(n=i.style.display,t?("none"===n&&(s[l]=v.get(i,"display")||null,s[l]||(i.style.display="")),""===i.style.display&&mt(i)&&(s[l]=(o=a=void 0,a=(r=i).ownerDocument,(o=xt[r=r.nodeName])||(a=a.body.appendChild(a.createElement(r)),o=T.css(a,"display"),a.parentNode.removeChild(a),xt[r]=o="none"===o?"block":o),o))):"none"!==n&&(s[l]="none",v.set(i,"display",n)));for(l=0;l<u;l++)null!=s[l]&&(e[l].style.display=s[l]);return e}T.fn.extend({show:function(){return Tt(this,!0)},hide:function(){return Tt(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){mt(this)?T(this).show():T(this).hide()})}});var St=/^(?:checkbox|radio)$/i,wt=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,bt=/^$|^module$|\/(?:java|ecma)script/i,f=(a=x.createDocumentFragment().appendChild(x.createElement("div")),(o=x.createElement("input")).setAttribute("type","radio"),o.setAttribute("checked","checked"),o.setAttribute("name","t"),a.appendChild(o),m.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,a.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!a.cloneNode(!0).lastChild.defaultValue,a.innerHTML="<option></option>",m.option=!!a.lastChild,{thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]});function g(e,t){var n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&E(e,t)?T.merge([e],n):n}function Mt(e,t){for(var n=0,i=e.length;n<i;n++)v.set(e[n],"globalEval",!t||v.get(t[n],"globalEval"))}f.tbody=f.tfoot=f.colgroup=f.caption=f.thead,f.th=f.td,m.option||(f.optgroup=f.option=[1,"<select multiple='multiple'>","</select>"]);var Rt=/<|&#?\w+;/;function Nt(e,t,n,i,r){for(var a,o,s,l,u,c=t.createDocumentFragment(),h=[],d=0,p=e.length;d<p;d++)if((a=e[d])||0===a)if("object"===X(a))T.merge(h,a.nodeType?[a]:a);else if(Rt.test(a)){for(o=o||c.appendChild(t.createElement("div")),s=(wt.exec(a)||["",""])[1].toLowerCase(),s=f[s]||f._default,o.innerHTML=s[1]+T.htmlPrefilter(a)+s[2],u=s[0];u--;)o=o.lastChild;T.merge(h,o.childNodes),(o=c.firstChild).textContent=""}else h.push(t.createTextNode(a));for(c.textContent="",d=0;a=h[d++];)if(i&&-1<T.inArray(a,i))r&&r.push(a);else if(l=yt(a),o=g(c.appendChild(a),"script"),l&&Mt(o),n)for(u=0;a=o[u++];)bt.test(a.type||"")&&n.push(a);return c}var It=/^([^.]*)(?:\.(.+)|)/;function Ct(){return!0}function Lt(){return!1}function Dt(e,t,n,i,r,a){var o,s;if("object"==typeof t){for(s in"string"!=typeof n&&(i=i||n,n=void 0),t)Dt(e,s,n,i,t[s],a);return e}if(null==i&&null==r?(r=n,i=n=void 0):null==r&&("string"==typeof n?(r=i,i=void 0):(r=i,i=n,n=void 0)),!1===r)r=Lt;else if(!r)return e;return 1===a&&(o=r,(r=function(e){return T().off(e),o.apply(this,arguments)}).guid=o.guid||(o.guid=T.guid++)),e.each(function(){T.event.add(this,t,r,i,n)})}function Ot(e,i,t){t?(v.set(e,i,!1),T.event.add(e,i,{namespace:!1,handler:function(e){var t,n=v.get(this,i);if(1&e.isTrigger&&this[i]){if(n)(T.event.special[i]||{}).delegateType&&e.stopPropagation();else if(n=s.call(arguments),v.set(this,i,n),this[i](),t=v.get(this,i),v.set(this,i,!1),n!==t)return e.stopImmediatePropagation(),e.preventDefault(),t}else n&&(v.set(this,i,T.event.trigger(n[0],n.slice(1),this)),e.stopPropagation(),e.isImmediatePropagationStopped=Ct)}})):void 0===v.get(e,i)&&T.event.add(e,i,Ct)}T.event={global:{},add:function(t,e,n,i,r){var a,o,s,l,u,c,h,d,p,f=v.get(t);if(ct(t))for(n.handler&&(n=(a=n).handler,r=a.selector),r&&T.find.matchesSelector(_t,r),n.guid||(n.guid=T.guid++),s=(s=f.events)||(f.events=Object.create(null)),o=(o=f.handle)||(f.handle=function(e){return void 0!==T&&T.event.triggered!==e.type?T.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(C)||[""]).length;l--;)h=p=(d=It.exec(e[l])||[])[1],d=(d[2]||"").split(".").sort(),h&&(u=T.event.special[h]||{},h=(r?u.delegateType:u.bindType)||h,u=T.event.special[h]||{},p=T.extend({type:h,origType:p,data:i,handler:n,guid:n.guid,selector:r,needsContext:r&&T.expr.match.needsContext.test(r),namespace:d.join(".")},a),(c=s[h])||((c=s[h]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(t,i,d,o))||t.addEventListener&&t.addEventListener(h,o),u.add&&(u.add.call(t,p),p.handler.guid||(p.handler.guid=n.guid)),r?c.splice(c.delegateCount++,0,p):c.push(p),T.event.global[h]=!0)},remove:function(e,t,n,i,r){var a,o,s,l,u,c,h,d,p,f,m,g=v.hasData(e)&&v.get(e);if(g&&(l=g.events)){for(u=(t=(t||"").match(C)||[""]).length;u--;)if(p=m=(s=It.exec(t[u])||[])[1],f=(s[2]||"").split(".").sort(),p){for(h=T.event.special[p]||{},d=l[p=(i?h.delegateType:h.bindType)||p]||[],s=s[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=a=d.length;a--;)c=d[a],!r&&m!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||i&&i!==c.selector&&("**"!==i||!c.selector)||(d.splice(a,1),c.selector&&d.delegateCount--,h.remove&&h.remove.call(e,c));o&&!d.length&&(h.teardown&&!1!==h.teardown.call(e,f,g.handle)||T.removeEvent(e,p,g.handle),delete l[p])}else for(p in l)T.event.remove(e,p+t[u],n,i,!0);T.isEmptyObject(l)&&v.remove(e,"handle events")}},dispatch:function(e){var t,n,i,r,a,o=new Array(arguments.length),s=T.event.fix(e),e=(v.get(this,"events")||Object.create(null))[s.type]||[],l=T.event.special[s.type]||{};for(o[0]=s,t=1;t<arguments.length;t++)o[t]=arguments[t];if(s.delegateTarget=this,!l.preDispatch||!1!==l.preDispatch.call(this,s)){for(a=T.event.handlers.call(this,s,e),t=0;(i=a[t++])&&!s.isPropagationStopped();)for(s.currentTarget=i.elem,n=0;(r=i.handlers[n++])&&!s.isImmediatePropagationStopped();)s.rnamespace&&!1!==r.namespace&&!s.rnamespace.test(r.namespace)||(s.handleObj=r,s.data=r.data,void 0!==(r=((T.event.special[r.origType]||{}).handle||r.handler).apply(i.elem,o))&&!1===(s.result=r)&&(s.preventDefault(),s.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,s),s.result}},handlers:function(e,t){var n,i,r,a,o,s=[],l=t.delegateCount,u=e.target;if(l&&u.nodeType&&!("click"===e.type&&1<=e.button))for(;u!==this;u=u.parentNode||this)if(1===u.nodeType&&("click"!==e.type||!0!==u.disabled)){for(a=[],o={},n=0;n<l;n++)void 0===o[r=(i=t[n]).selector+" "]&&(o[r]=i.needsContext?-1<T(r,this).index(u):T.find(r,this,null,[u]).length),o[r]&&a.push(i);a.length&&s.push({elem:u,handlers:a})}return u=this,l<t.length&&s.push({elem:u,handlers:t.slice(l)}),s},addProp:function(t,e){Object.defineProperty(T.Event.prototype,t,{enumerable:!0,configurable:!0,get:_(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[T.expando]?e:new T.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){e=this||e;return St.test(e.type)&&e.click&&E(e,"input")&&Ot(e,"click",!0),!1},trigger:function(e){e=this||e;return St.test(e.type)&&e.click&&E(e,"input")&&Ot(e,"click"),!0},_default:function(e){e=e.target;return St.test(e.type)&&e.click&&E(e,"input")&&v.get(e,"click")||E(e,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},T.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},T.Event=function(e,t){if(!(this instanceof T.Event))return new T.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ct:Lt,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&T.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[T.expando]=!0},T.Event.prototype={constructor:T.Event,isDefaultPrevented:Lt,isPropagationStopped:Lt,isImmediatePropagationStopped:Lt,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ct,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ct,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ct,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},T.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},T.event.addProp),T.each({focus:"focusin",blur:"focusout"},function(i,r){function a(e){var t,n;x.documentMode?(t=v.get(this,"handle"),(n=T.event.fix(e)).type="focusin"===e.type?"focus":"blur",n.isSimulated=!0,t(e),n.target===n.currentTarget&&t(n)):T.event.simulate(r,e.target,T.event.fix(e))}T.event.special[i]={setup:function(){var e;if(Ot(this,i,!0),!x.documentMode)return!1;(e=v.get(this,r))||this.addEventListener(r,a),v.set(this,r,(e||0)+1)},trigger:function(){return Ot(this,i),!0},teardown:function(){var e;if(!x.documentMode)return!1;(e=v.get(this,r)-1)?v.set(this,r,e):(this.removeEventListener(r,a),v.remove(this,r))},_default:function(e){return v.get(e.target,i)},delegateType:r},T.event.special[r]={setup:function(){var e=this.ownerDocument||this.document||this,t=x.documentMode?this:e,n=v.get(t,r);n||(x.documentMode?this.addEventListener(r,a):e.addEventListener(i,a,!0)),v.set(t,r,(n||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=x.documentMode?this:e,n=v.get(t,r)-1;n?v.set(t,r,n):(x.documentMode?this.removeEventListener(r,a):e.removeEventListener(i,a,!0),v.remove(t,r))}}}),T.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,r){T.event.special[e]={delegateType:r,bindType:r,handle:function(e){var t,n=e.relatedTarget,i=e.handleObj;return n&&(n===this||T.contains(this,n))||(e.type=i.origType,t=i.handler.apply(this,arguments),e.type=r),t}}}),T.fn.extend({on:function(e,t,n,i){return Dt(this,e,t,n,i)},one:function(e,t,n,i){return Dt(this,e,t,n,i,1)},off:function(e,t,n){var i,r;if(e&&e.preventDefault&&e.handleObj)i=e.handleObj,T(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler);else{if("object"!=typeof e)return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Lt),this.each(function(){T.event.remove(this,e,n,t)});for(r in e)this.off(r,t,e[r])}return this}});var Pt=/<script|<style|<link/i,Ut=/checked\s*(?:[^=]|=\s*.checked.)/i,Bt=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Ft(e,t){return E(e,"table")&&E(11!==t.nodeType?t:t.firstChild,"tr")&&T(e).children("tbody")[0]||e}function zt(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function kt(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Gt(e,t){var n,i,r,a;if(1===t.nodeType){if(v.hasData(e)&&(a=v.get(e).events))for(r in v.remove(t,"handle events"),a)for(n=0,i=a[r].length;n<i;n++)T.event.add(t,r,a[r][n]);u.hasData(e)&&(e=u.access(e),e=T.extend({},e),u.set(t,e))}}function Ht(n,i,r,a){i=z(i);var e,t,o,s,l,u,c=0,h=n.length,d=h-1,p=i[0],f=_(p);if(f||1<h&&"string"==typeof p&&!m.checkClone&&Ut.test(p))return n.each(function(e){var t=n.eq(e);f&&(i[0]=p.call(this,e,t.html())),Ht(t,i,r,a)});if(h&&(t=(e=Nt(i,n[0].ownerDocument,!1,n,a)).firstChild,1===e.childNodes.length&&(e=t),t||a)){for(s=(o=T.map(g(e,"script"),zt)).length;c<h;c++)l=e,c!==d&&(l=T.clone(l,!0,!0),s)&&T.merge(o,g(l,"script")),r.call(n[c],l,c);if(s)for(u=o[o.length-1].ownerDocument,T.map(o,kt),c=0;c<s;c++)l=o[c],bt.test(l.type||"")&&!v.access(l,"globalEval")&&T.contains(u,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?T._evalUrl&&!l.noModule&&T._evalUrl(l.src,{nonce:l.nonce||l.getAttribute("nonce")},u):q(l.textContent.replace(Bt,""),l,u))}return n}function Vt(e,t,n){for(var i,r=t?T.filter(t,e):e,a=0;null!=(i=r[a]);a++)n||1!==i.nodeType||T.cleanData(g(i)),i.parentNode&&(n&&yt(i)&&Mt(g(i,"script")),i.parentNode.removeChild(i));return e}T.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var i,r,a,o,s,l,u,c=e.cloneNode(!0),h=yt(e);if(!(m.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||T.isXMLDoc(e)))for(o=g(c),i=0,r=(a=g(e)).length;i<r;i++)s=a[i],l=o[i],u=void 0,"input"===(u=l.nodeName.toLowerCase())&&St.test(s.type)?l.checked=s.checked:"input"!==u&&"textarea"!==u||(l.defaultValue=s.defaultValue);if(t)if(n)for(a=a||g(e),o=o||g(c),i=0,r=a.length;i<r;i++)Gt(a[i],o[i]);else Gt(e,c);return 0<(o=g(c,"script")).length&&Mt(o,!h&&g(e,"script")),c},cleanData:function(e){for(var t,n,i,r=T.event.special,a=0;void 0!==(n=e[a]);a++)if(ct(n)){if(t=n[v.expando]){if(t.events)for(i in t.events)r[i]?T.event.remove(n,i):T.removeEvent(n,i,t.handle);n[v.expando]=void 0}n[u.expando]&&(n[u.expando]=void 0)}}}),T.fn.extend({detach:function(e){return Vt(this,e,!0)},remove:function(e){return Vt(this,e)},text:function(e){return c(this,function(e){return void 0===e?T.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return Ht(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ft(this,e).appendChild(e)})},prepend:function(){return Ht(this,arguments,function(e){var t;1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(t=Ft(this,e)).insertBefore(e,t.firstChild)})},before:function(){return Ht(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return Ht(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(T.cleanData(g(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return T.clone(this,e,t)})},html:function(e){return c(this,function(e){var t=this[0]||{},n=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Pt.test(e)&&!f[(wt.exec(e)||["",""])[1].toLowerCase()]){e=T.htmlPrefilter(e);try{for(;n<i;n++)1===(t=this[n]||{}).nodeType&&(T.cleanData(g(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return Ht(this,arguments,function(e){var t=this.parentNode;T.inArray(this,n)<0&&(T.cleanData(g(this)),t)&&t.replaceChild(e,this)},n)}}),T.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,o){T.fn[e]=function(e){for(var t,n=[],i=T(e),r=i.length-1,a=0;a<=r;a++)t=a===r?this:this.clone(!0),T(i[a])[o](t),k.apply(n,t.get());return this.pushStack(n)}});function Wt(e){var t=e.ownerDocument.defaultView;return(t=t&&t.opener?t:A).getComputedStyle(e)}function jt(e,t,n){var i,r={};for(i in t)r[i]=e.style[i],e.style[i]=t[i];for(i in n=n.call(e),t)e.style[i]=r[i];return n}var Yt,qt,Xt,Zt,Kt,Jt,Qt,D,$t=new RegExp("^("+e+")(?!px)[a-z%]+$","i"),en=/^--/,tn=new RegExp(vt.join("|"),"i");function nn(){var e;D&&(Qt.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",D.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",_t.appendChild(Qt).appendChild(D),e=A.getComputedStyle(D),Yt="1%"!==e.top,Jt=12===rn(e.marginLeft),D.style.right="60%",Zt=36===rn(e.right),qt=36===rn(e.width),D.style.position="absolute",Xt=12===rn(D.offsetWidth/3),_t.removeChild(Qt),D=null)}function rn(e){return Math.round(parseFloat(e))}function an(e,t,n){var i,r=en.test(t),a=e.style;return(n=n||Wt(e))&&(i=n.getPropertyValue(t)||n[t],""!==(i=r?i&&(i.replace(ee,"$1")||void 0):i)||yt(e)||(i=T.style(e,t)),!m.pixelBoxStyles())&&$t.test(i)&&tn.test(t)&&(r=a.width,e=a.minWidth,t=a.maxWidth,a.minWidth=a.maxWidth=a.width=i,i=n.width,a.width=r,a.minWidth=e,a.maxWidth=t),void 0!==i?i+"":i}function on(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}Qt=x.createElement("div"),(D=x.createElement("div")).style&&(D.style.backgroundClip="content-box",D.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===D.style.backgroundClip,T.extend(m,{boxSizingReliable:function(){return nn(),qt},pixelBoxStyles:function(){return nn(),Zt},pixelPosition:function(){return nn(),Yt},reliableMarginLeft:function(){return nn(),Jt},scrollboxSize:function(){return nn(),Xt},reliableTrDimensions:function(){var e,t,n;return null==Kt&&(e=x.createElement("table"),t=x.createElement("tr"),n=x.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="box-sizing:content-box;border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",_t.appendChild(e).appendChild(t).appendChild(n),n=A.getComputedStyle(t),Kt=parseInt(n.height,10)+parseInt(n.borderTopWidth,10)+parseInt(n.borderBottomWidth,10)===t.offsetHeight,_t.removeChild(e)),Kt}}));var sn=["Webkit","Moz","ms"],ln=x.createElement("div").style,un={};function cn(e){var t=T.cssProps[e]||un[e];return t||(e in ln?e:un[e]=(e=>{for(var t=e[0].toUpperCase()+e.slice(1),n=sn.length;n--;)if((e=sn[n]+t)in ln)return e})(e)||e)}var hn=/^(none|table(?!-c[ea]).+)/,dn={position:"absolute",visibility:"hidden",display:"block"},pn={letterSpacing:"0",fontWeight:"400"};function fn(e,t,n){var i=gt.exec(t);return i?Math.max(0,i[2]-(n||0))+(i[3]||"px"):t}function mn(e,t,n,i,r,a){var o="width"===t?1:0,s=0,l=0,u=0;if(n===(i?"border":"content"))return 0;for(;o<4;o+=2)"margin"===n&&(u+=T.css(e,n+vt[o],!0,r)),i?("content"===n&&(l-=T.css(e,"padding"+vt[o],!0,r)),"margin"!==n&&(l-=T.css(e,"border"+vt[o]+"Width",!0,r))):(l+=T.css(e,"padding"+vt[o],!0,r),"padding"!==n?l+=T.css(e,"border"+vt[o]+"Width",!0,r):s+=T.css(e,"border"+vt[o]+"Width",!0,r));return!i&&0<=a&&(l+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-a-l-s-.5))||0),l+u}function gn(e,t,n){var i=Wt(e),r=(!m.boxSizingReliable()||n)&&"border-box"===T.css(e,"boxSizing",!1,i),a=r,o=an(e,t,i),s="offset"+t[0].toUpperCase()+t.slice(1);if($t.test(o)){if(!n)return o;o="auto"}return(!m.boxSizingReliable()&&r||!m.reliableTrDimensions()&&E(e,"tr")||"auto"===o||!parseFloat(o)&&"inline"===T.css(e,"display",!1,i))&&e.getClientRects().length&&(r="border-box"===T.css(e,"boxSizing",!1,i),a=s in e)&&(o=e[s]),(o=parseFloat(o)||0)+mn(e,t,n||(r?"border":"content"),a,i,o)+"px"}function O(e,t,n,i,r){return new O.prototype.init(e,t,n,i,r)}T.extend({cssHooks:{opacity:{get:function(e,t){if(t)return""===(t=an(e,"opacity"))?"1":t}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(e,t,n,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var r,a,o,s=L(t),l=en.test(t),u=e.style;if(l||(t=cn(s)),o=T.cssHooks[t]||T.cssHooks[s],void 0===n)return o&&"get"in o&&void 0!==(r=o.get(e,!1,i))?r:u[t];"string"===(a=typeof n)&&(r=gt.exec(n))&&r[1]&&(n=At(e,t,r),a="number"),null==n||n!=n||("number"!==a||l||(n+=r&&r[3]||(T.cssNumber[s]?"":"px")),m.clearCloneStyle||""!==n||0!==t.indexOf("background")||(u[t]="inherit"),o&&"set"in o&&void 0===(n=o.set(e,n,i)))||(l?u.setProperty(t,n):u[t]=n)}},css:function(e,t,n,i){var r,a=L(t);return en.test(t)||(t=cn(a)),"normal"===(r=void 0===(r=(a=T.cssHooks[t]||T.cssHooks[a])&&"get"in a?a.get(e,!0,n):r)?an(e,t,i):r)&&t in pn&&(r=pn[t]),(""===n||n)&&(a=parseFloat(r),!0===n||isFinite(a))?a||0:r}}),T.each(["height","width"],function(e,o){T.cssHooks[o]={get:function(e,t,n){if(t)return!hn.test(T.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?gn(e,o,n):jt(e,dn,function(){return gn(e,o,n)})},set:function(e,t,n){var i=Wt(e),r=!m.scrollboxSize()&&"absolute"===i.position,a=(r||n)&&"border-box"===T.css(e,"boxSizing",!1,i),n=n?mn(e,o,n,a,i):0;return a&&r&&(n-=Math.ceil(e["offset"+o[0].toUpperCase()+o.slice(1)]-parseFloat(i[o])-mn(e,o,"border",!1,i)-.5)),n&&(a=gt.exec(t))&&"px"!==(a[3]||"px")&&(e.style[o]=t,t=T.css(e,o)),fn(0,t,n)}}}),T.cssHooks.marginLeft=on(m.reliableMarginLeft,function(e,t){if(t)return(parseFloat(an(e,"marginLeft"))||e.getBoundingClientRect().left-jt(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),T.each({margin:"",padding:"",border:"Width"},function(r,a){T.cssHooks[r+a]={expand:function(e){for(var t=0,n={},i="string"==typeof e?e.split(" "):[e];t<4;t++)n[r+vt[t]+a]=i[t]||i[t-2]||i[0];return n}},"margin"!==r&&(T.cssHooks[r+a].set=fn)}),T.fn.extend({css:function(e,t){return c(this,function(e,t,n){var i,r,a={},o=0;if(Array.isArray(t)){for(i=Wt(e),r=t.length;o<r;o++)a[t[o]]=T.css(e,t[o],!1,i);return a}return void 0!==n?T.style(e,t,n):T.css(e,t)},e,t,1<arguments.length)}}),((T.Tween=O).prototype={constructor:O,init:function(e,t,n,i,r,a){this.elem=e,this.prop=n,this.easing=r||T.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=a||(T.cssNumber[n]?"":"px")},cur:function(){var e=O.propHooks[this.prop];return(e&&e.get?e:O.propHooks._default).get(this)},run:function(e){var t,n=O.propHooks[this.prop];return this.options.duration?this.pos=t=T.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),(n&&n.set?n:O.propHooks._default).set(this),this}}).init.prototype=O.prototype,(O.propHooks={_default:{get:function(e){return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(e=T.css(e.elem,e.prop,""))&&"auto"!==e?e:0},set:function(e){T.fx.step[e.prop]?T.fx.step[e.prop](e):1!==e.elem.nodeType||!T.cssHooks[e.prop]&&null==e.elem.style[cn(e.prop)]?e.elem[e.prop]=e.now:T.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=O.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},T.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},T.fx=O.prototype.init,T.fx.step={};var vn,_n,yn=/^(?:toggle|show|hide)$/,En=/queueHooks$/;function An(){_n&&(!1===x.hidden&&A.requestAnimationFrame?A.requestAnimationFrame(An):A.setTimeout(An,T.fx.interval),T.fx.tick())}function xn(){return A.setTimeout(function(){vn=void 0}),vn=Date.now()}function Tn(e,t){var n,i=0,r={height:e};for(t=t?1:0;i<4;i+=2-t)r["margin"+(n=vt[i])]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function Sn(e,t,n){for(var i,r=(P.tweeners[t]||[]).concat(P.tweeners["*"]),a=0,o=r.length;a<o;a++)if(i=r[a].call(n,t,e))return i}function P(r,e,t){var n,a,i,o,s,l,u,c=0,h=P.prefilters.length,d=T.Deferred().always(function(){delete p.elem}),p=function(){if(!a){for(var e=vn||xn(),e=Math.max(0,f.startTime+f.duration-e),t=1-(e/f.duration||0),n=0,i=f.tweens.length;n<i;n++)f.tweens[n].run(t);if(d.notifyWith(r,[f,t,e]),t<1&&i)return e;i||d.notifyWith(r,[f,1,0]),d.resolveWith(r,[f])}return!1},f=d.promise({elem:r,props:T.extend({},e),opts:T.extend(!0,{specialEasing:{},easing:T.easing._default},t),originalProperties:e,originalOptions:t,startTime:vn||xn(),duration:t.duration,tweens:[],createTween:function(e,t){t=T.Tween(r,f.opts,e,t,f.opts.specialEasing[e]||f.opts.easing);return f.tweens.push(t),t},stop:function(e){var t=0,n=e?f.tweens.length:0;if(!a){for(a=!0;t<n;t++)f.tweens[t].run(1);e?(d.notifyWith(r,[f,1,0]),d.resolveWith(r,[f,e])):d.rejectWith(r,[f,e])}return this}}),m=f.props,g=m,v=f.opts.specialEasing;for(i in g)if(s=v[o=L(i)],l=g[i],Array.isArray(l)&&(s=l[1],l=g[i]=l[0]),i!==o&&(g[o]=l,delete g[i]),(u=T.cssHooks[o])&&"expand"in u)for(i in l=u.expand(l),delete g[o],l)i in g||(g[i]=l[i],v[i]=s);else v[o]=s;for(;c<h;c++)if(n=P.prefilters[c].call(f,r,m,f.opts))return _(n.stop)&&(T._queueHooks(f.elem,f.opts.queue).stop=n.stop.bind(n)),n;return T.map(m,Sn,f),_(f.opts.start)&&f.opts.start.call(r,f),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always),T.fx.timer(T.extend(p,{elem:r,anim:f,queue:f.opts.queue})),f}T.Animation=T.extend(P,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return At(n.elem,e,gt.exec(t),n),n}]},tweener:function(e,t){for(var n,i=0,r=(e=_(e)?(t=e,["*"]):e.match(C)).length;i<r;i++)n=e[i],P.tweeners[n]=P.tweeners[n]||[],P.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var i,r,a,o,s,l,u,c="width"in t||"height"in t,h=this,d={},p=e.style,f=e.nodeType&&mt(e),m=v.get(e,"fxshow");for(i in n.queue||(null==(o=T._queueHooks(e,"fx")).unqueued&&(o.unqueued=0,s=o.empty.fire,o.empty.fire=function(){o.unqueued||s()}),o.unqueued++,h.always(function(){h.always(function(){o.unqueued--,T.queue(e,"fx").length||o.empty.fire()})})),t)if(r=t[i],yn.test(r)){if(delete t[i],a=a||"toggle"===r,r===(f?"hide":"show")){if("show"!==r||!m||void 0===m[i])continue;f=!0}d[i]=m&&m[i]||T.style(e,i)}if((l=!T.isEmptyObject(t))||!T.isEmptyObject(d))for(i in c&&1===e.nodeType&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],null==(u=m&&m.display)&&(u=v.get(e,"display")),"none"===(c=T.css(e,"display"))&&(u?c=u:(Tt([e],!0),u=e.style.display||u,c=T.css(e,"display"),Tt([e]))),"inline"===c||"inline-block"===c&&null!=u)&&"none"===T.css(e,"float")&&(l||(h.done(function(){p.display=u}),null==u&&(c=p.display,u="none"===c?"":c)),p.display="inline-block"),n.overflow&&(p.overflow="hidden",h.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]})),l=!1,d)l||(m?"hidden"in m&&(f=m.hidden):m=v.access(e,"fxshow",{display:u}),a&&(m.hidden=!f),f&&Tt([e],!0),h.done(function(){for(i in f||Tt([e]),v.remove(e,"fxshow"),d)T.style(e,i,d[i])})),l=Sn(f?m[i]:0,i,h),i in m||(m[i]=l.start,f&&(l.end=l.start,l.start=0))}],prefilter:function(e,t){t?P.prefilters.unshift(e):P.prefilters.push(e)}}),T.speed=function(e,t,n){var i=e&&"object"==typeof e?T.extend({},e):{complete:n||!n&&t||_(e)&&e,duration:e,easing:n&&t||t&&!_(t)&&t};return T.fx.off?i.duration=0:"number"!=typeof i.duration&&(i.duration in T.fx.speeds?i.duration=T.fx.speeds[i.duration]:i.duration=T.fx.speeds._default),null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){_(i.old)&&i.old.call(this),i.queue&&T.dequeue(this,i.queue)},i},T.fn.extend({fadeTo:function(e,t,n,i){return this.filter(mt).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(t,e,n,i){function r(){var e=P(this,T.extend({},t),o);(a||v.get(this,"finish"))&&e.stop(!0)}var a=T.isEmptyObject(t),o=T.speed(e,n,i);return r.finish=r,a||!1===o.queue?this.each(r):this.queue(o.queue,r)},stop:function(r,e,a){function o(e){var t=e.stop;delete e.stop,t(a)}return"string"!=typeof r&&(a=e,e=r,r=void 0),e&&this.queue(r||"fx",[]),this.each(function(){var e=!0,t=null!=r&&r+"queueHooks",n=T.timers,i=v.get(this);if(t)i[t]&&i[t].stop&&o(i[t]);else for(t in i)i[t]&&i[t].stop&&En.test(t)&&o(i[t]);for(t=n.length;t--;)n[t].elem!==this||null!=r&&n[t].queue!==r||(n[t].anim.stop(a),e=!1,n.splice(t,1));!e&&a||T.dequeue(this,r)})},finish:function(o){return!1!==o&&(o=o||"fx"),this.each(function(){var e,t=v.get(this),n=t[o+"queue"],i=t[o+"queueHooks"],r=T.timers,a=n?n.length:0;for(t.finish=!0,T.queue(this,o,[]),i&&i.stop&&i.stop.call(this,!0),e=r.length;e--;)r[e].elem===this&&r[e].queue===o&&(r[e].anim.stop(!0),r.splice(e,1));for(e=0;e<a;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),T.each(["toggle","show","hide"],function(e,i){var r=T.fn[i];T.fn[i]=function(e,t,n){return null==e||"boolean"==typeof e?r.apply(this,arguments):this.animate(Tn(i,!0),e,t,n)}}),T.each({slideDown:Tn("show"),slideUp:Tn("hide"),slideToggle:Tn("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,i){T.fn[e]=function(e,t,n){return this.animate(i,e,t,n)}}),T.timers=[],T.fx.tick=function(){var e,t=0,n=T.timers;for(vn=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||T.fx.stop(),vn=void 0},T.fx.timer=function(e){T.timers.push(e),T.fx.start()},T.fx.interval=13,T.fx.start=function(){_n||(_n=!0,An())},T.fx.stop=function(){_n=null},T.fx.speeds={slow:600,fast:200,_default:400},T.fn.delay=function(i,e){return i=T.fx&&T.fx.speeds[i]||i,this.queue(e=e||"fx",function(e,t){var n=A.setTimeout(e,i);t.stop=function(){A.clearTimeout(n)}})},o=x.createElement("input"),a=x.createElement("select").appendChild(x.createElement("option")),o.type="checkbox",m.checkOn=""!==o.value,m.optSelected=a.selected,(o=x.createElement("input")).value="t",o.type="radio",m.radioValue="t"===o.value;var wn,bn=T.expr.attrHandle,Mn=(T.fn.extend({attr:function(e,t){return c(this,T.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){T.removeAttr(this,e)})}}),T.extend({attr:function(e,t,n){var i,r,a=e.nodeType;if(3!==a&&8!==a&&2!==a)return void 0===e.getAttribute?T.prop(e,t,n):(1===a&&T.isXMLDoc(e)||(r=T.attrHooks[t.toLowerCase()]||(T.expr.match.bool.test(t)?wn:void 0)),void 0!==n?null===n?void T.removeAttr(e,t):r&&"set"in r&&void 0!==(i=r.set(e,n,t))?i:(e.setAttribute(t,n+""),n):!(r&&"get"in r&&null!==(i=r.get(e,t)))&&null==(i=T.find.attr(e,t))?void 0:i)},attrHooks:{type:{set:function(e,t){var n;if(!m.radioValue&&"radio"===t&&E(e,"input"))return n=e.value,e.setAttribute("type",t),n&&(e.value=n),t}}},removeAttr:function(e,t){var n,i=0,r=t&&t.match(C);if(r&&1===e.nodeType)for(;n=r[i++];)e.removeAttribute(n)}}),wn={set:function(e,t,n){return!1===t?T.removeAttr(e,n):e.setAttribute(n,n),n}},T.each(T.expr.match.bool.source.match(/\w+/g),function(e,t){var o=bn[t]||T.find.attr;bn[t]=function(e,t,n){var i,r,a=t.toLowerCase();return n||(r=bn[a],bn[a]=i,i=null!=o(e,t,n)?a:null,bn[a]=r),i}}),/^(?:input|select|textarea|button)$/i),Rn=/^(?:a|area)$/i;function Nn(e){return(e.match(C)||[]).join(" ")}function In(e){return e.getAttribute&&e.getAttribute("class")||""}function Cn(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(C)||[]}T.fn.extend({prop:function(e,t){return c(this,T.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[T.propFix[e]||e]})}}),T.extend({prop:function(e,t,n){var i,r,a=e.nodeType;if(3!==a&&8!==a&&2!==a)return 1===a&&T.isXMLDoc(e)||(t=T.propFix[t]||t,r=T.propHooks[t]),void 0!==n?r&&"set"in r&&void 0!==(i=r.set(e,n,t))?i:e[t]=n:r&&"get"in r&&null!==(i=r.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){var t=T.find.attr(e,"tabindex");return t?parseInt(t,10):Mn.test(e.nodeName)||Rn.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(T.propHooks.selected={get:function(e){e=e.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(e){e=e.parentNode;e&&(e.selectedIndex,e.parentNode)&&e.parentNode.selectedIndex}}),T.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){T.propFix[this.toLowerCase()]=this}),T.fn.extend({addClass:function(t){var e,n,i,r,a,o;return _(t)?this.each(function(e){T(this).addClass(t.call(this,e,In(this)))}):(e=Cn(t)).length?this.each(function(){if(i=In(this),n=1===this.nodeType&&" "+Nn(i)+" "){for(a=0;a<e.length;a++)r=e[a],n.indexOf(" "+r+" ")<0&&(n+=r+" ");o=Nn(n),i!==o&&this.setAttribute("class",o)}}):this},removeClass:function(t){var e,n,i,r,a,o;return _(t)?this.each(function(e){T(this).removeClass(t.call(this,e,In(this)))}):arguments.length?(e=Cn(t)).length?this.each(function(){if(i=In(this),n=1===this.nodeType&&" "+Nn(i)+" "){for(a=0;a<e.length;a++)for(r=e[a];-1<n.indexOf(" "+r+" ");)n=n.replace(" "+r+" "," ");o=Nn(n),i!==o&&this.setAttribute("class",o)}}):this:this.attr("class","")},toggleClass:function(t,n){var e,i,r,a,o=typeof t,s="string"==o||Array.isArray(t);return _(t)?this.each(function(e){T(this).toggleClass(t.call(this,e,In(this),n),n)}):"boolean"==typeof n&&s?n?this.addClass(t):this.removeClass(t):(e=Cn(t),this.each(function(){if(s)for(a=T(this),r=0;r<e.length;r++)i=e[r],a.hasClass(i)?a.removeClass(i):a.addClass(i);else void 0!==t&&"boolean"!=o||((i=In(this))&&v.set(this,"__className__",i),this.setAttribute&&this.setAttribute("class",!i&&!1!==t&&v.get(this,"__className__")||""))}))},hasClass:function(e){for(var t,n=0,i=" "+e+" ";t=this[n++];)if(1===t.nodeType&&-1<(" "+Nn(In(t))+" ").indexOf(i))return!0;return!1}});function Ln(e){e.stopPropagation()}var Dn=/\r/g,On=(T.fn.extend({val:function(t){var n,e,i,r=this[0];return arguments.length?(i=_(t),this.each(function(e){1!==this.nodeType||(null==(e=i?t.call(this,e,T(this).val()):t)?e="":"number"==typeof e?e+="":Array.isArray(e)&&(e=T.map(e,function(e){return null==e?"":e+""})),(n=T.valHooks[this.type]||T.valHooks[this.nodeName.toLowerCase()])&&"set"in n&&void 0!==n.set(this,e,"value"))||(this.value=e)})):r?(n=T.valHooks[r.type]||T.valHooks[r.nodeName.toLowerCase()])&&"get"in n&&void 0!==(e=n.get(r,"value"))?e:"string"==typeof(e=r.value)?e.replace(Dn,""):null==e?"":e:void 0}}),T.extend({valHooks:{option:{get:function(e){var t=T.find.attr(e,"value");return null!=t?t:Nn(T.text(e))}},select:{get:function(e){for(var t,n=e.options,i=e.selectedIndex,r="select-one"===e.type,a=r?null:[],o=r?i+1:n.length,s=i<0?o:r?i:0;s<o;s++)if(((t=n[s]).selected||s===i)&&!t.disabled&&(!t.parentNode.disabled||!E(t.parentNode,"optgroup"))){if(t=T(t).val(),r)return t;a.push(t)}return a},set:function(e,t){for(var n,i,r=e.options,a=T.makeArray(t),o=r.length;o--;)((i=r[o]).selected=-1<T.inArray(T.valHooks.option.get(i),a))&&(n=!0);return n||(e.selectedIndex=-1),a}}}}),T.each(["radio","checkbox"],function(){T.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<T.inArray(T(e).val(),t)}},m.checkOn||(T.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),A.location),Pn={guid:Date.now()},Un=/\?/,Bn=(T.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new A.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||T.error("Invalid XML: "+(n?T.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t},/^(?:focusinfocus|focusoutblur)$/),Fn=(T.extend(T.event,{trigger:function(e,t,n,i){var r,a,o,s,l,u,c,h=[n||x],d=V.call(e,"type")?e.type:e,p=V.call(e,"namespace")?e.namespace.split("."):[],f=c=a=n=n||x;if(3!==n.nodeType&&8!==n.nodeType&&!Bn.test(d+T.event.triggered)&&(-1<d.indexOf(".")&&(d=(p=d.split(".")).shift(),p.sort()),s=d.indexOf(":")<0&&"on"+d,(e=e[T.expando]?e:new T.Event(d,"object"==typeof e&&e)).isTrigger=i?2:3,e.namespace=p.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:T.makeArray(t,[e]),u=T.event.special[d]||{},i||!u.trigger||!1!==u.trigger.apply(n,t))){if(!i&&!u.noBubble&&!B(n)){for(o=u.delegateType||d,Bn.test(o+d)||(f=f.parentNode);f;f=f.parentNode)h.push(f),a=f;a===(n.ownerDocument||x)&&h.push(a.defaultView||a.parentWindow||A)}for(r=0;(f=h[r++])&&!e.isPropagationStopped();)c=f,e.type=1<r?o:u.bindType||d,(l=(v.get(f,"events")||Object.create(null))[e.type]&&v.get(f,"handle"))&&l.apply(f,t),(l=s&&f[s])&&l.apply&&ct(f)&&(e.result=l.apply(f,t),!1===e.result)&&e.preventDefault();return e.type=d,i||e.isDefaultPrevented()||u._default&&!1!==u._default.apply(h.pop(),t)||!ct(n)||s&&_(n[d])&&!B(n)&&((a=n[s])&&(n[s]=null),T.event.triggered=d,e.isPropagationStopped()&&c.addEventListener(d,Ln),n[d](),e.isPropagationStopped()&&c.removeEventListener(d,Ln),T.event.triggered=void 0,a)&&(n[s]=a),e.result}},simulate:function(e,t,n){n=T.extend(new T.Event,n,{type:e,isSimulated:!0});T.event.trigger(n,null,t)}}),T.fn.extend({trigger:function(e,t){return this.each(function(){T.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return T.event.trigger(e,t,n,!0)}}),/\[\]$/),zn=/\r?\n/g,kn=/^(?:submit|button|image|reset|file)$/i,Gn=/^(?:input|select|textarea|keygen)/i;T.param=function(e,t){function n(e,t){t=_(t)?t():t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==t?"":t)}var i,r=[];if(null==e)return"";if(Array.isArray(e)||e.jquery&&!T.isPlainObject(e))T.each(e,function(){n(this.name,this.value)});else for(i in e)!function n(i,e,r,a){if(Array.isArray(e))T.each(e,function(e,t){r||Fn.test(i)?a(i,t):n(i+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,a)});else if(r||"object"!==X(e))a(i,e);else for(var t in e)n(i+"["+t+"]",e[t],r,a)}(i,e[i],t,n);return r.join("&")},T.fn.extend({serialize:function(){return T.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=T.prop(this,"elements");return e?T.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!T(this).is(":disabled")&&Gn.test(this.nodeName)&&!kn.test(e)&&(this.checked||!St.test(e))}).map(function(e,t){var n=T(this).val();return null==n?null:Array.isArray(n)?T.map(n,function(e){return{name:t.name,value:e.replace(zn,"\r\n")}}):{name:t.name,value:n.replace(zn,"\r\n")}}).get()}});var Hn=/%20/g,Vn=/#.*$/,Wn=/([?&])_=[^&]*/,jn=/^(.*?):[ \t]*([^\r\n]*)$/gm,Yn=/^(?:GET|HEAD)$/,qn=/^\/\//,Xn={},Zn={},Kn="*/".concat("*"),Jn=x.createElement("a");function Qn(a){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,i=0,r=e.toLowerCase().match(C)||[];if(_(t))for(;n=r[i++];)"+"===n[0]?(n=n.slice(1)||"*",(a[n]=a[n]||[]).unshift(t)):(a[n]=a[n]||[]).push(t)}}function $n(t,i,r,a){var o={},s=t===Zn;function l(e){var n;return o[e]=!0,T.each(t[e]||[],function(e,t){t=t(i,r,a);return"string"!=typeof t||s||o[t]?s?!(n=t):void 0:(i.dataTypes.unshift(t),l(t),!1)}),n}return l(i.dataTypes[0])||!o["*"]&&l("*")}function ei(e,t){var n,i,r=T.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((r[n]?e:i=i||{})[n]=t[n]);return i&&T.extend(!0,e,i),e}Jn.href=On.href,T.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:On.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(On.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Kn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":T.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?ei(ei(e,T.ajaxSettings),t):ei(T.ajaxSettings,e)},ajaxPrefilter:Qn(Xn),ajaxTransport:Qn(Zn),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0);var l,u,c,n,h,d,p,i,f=T.ajaxSetup({},t=t||{}),m=f.context||f,g=f.context&&(m.nodeType||m.jquery)?T(m):T.event,v=T.Deferred(),_=T.Callbacks("once memory"),y=f.statusCode||{},r={},a={},o="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(d){if(!n)for(n={};t=jn.exec(c);)n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return d?c:null},setRequestHeader:function(e,t){return null==d&&(e=a[e.toLowerCase()]=a[e.toLowerCase()]||e,r[e]=t),this},overrideMimeType:function(e){return null==d&&(f.mimeType=e),this},statusCode:function(e){if(e)if(d)E.always(e[E.status]);else for(var t in e)y[t]=[y[t],e[t]];return this},abort:function(e){e=e||o;return l&&l.abort(e),s(0,e),this}};if(v.promise(E),f.url=((e||f.url||On.href)+"").replace(qn,On.protocol+"//"),f.type=t.method||t.type||f.method||f.type,f.dataTypes=(f.dataType||"*").toLowerCase().match(C)||[""],null==f.crossDomain){e=x.createElement("a");try{e.href=f.url,e.href=e.href,f.crossDomain=Jn.protocol+"//"+Jn.host!=e.protocol+"//"+e.host}catch(e){f.crossDomain=!0}}if(f.data&&f.processData&&"string"!=typeof f.data&&(f.data=T.param(f.data,f.traditional)),$n(Xn,f,t,E),!d){for(i in(p=T.event&&f.global)&&0==T.active++&&T.event.trigger("ajaxStart"),f.type=f.type.toUpperCase(),f.hasContent=!Yn.test(f.type),u=f.url.replace(Vn,""),f.hasContent?f.data&&f.processData&&0===(f.contentType||"").indexOf("application/x-www-form-urlencoded")&&(f.data=f.data.replace(Hn,"+")):(e=f.url.slice(u.length),f.data&&(f.processData||"string"==typeof f.data)&&(u+=(Un.test(u)?"&":"?")+f.data,delete f.data),!1===f.cache&&(u=u.replace(Wn,"$1"),e=(Un.test(u)?"&":"?")+"_="+Pn.guid+++e),f.url=u+e),f.ifModified&&(T.lastModified[u]&&E.setRequestHeader("If-Modified-Since",T.lastModified[u]),T.etag[u])&&E.setRequestHeader("If-None-Match",T.etag[u]),(f.data&&f.hasContent&&!1!==f.contentType||t.contentType)&&E.setRequestHeader("Content-Type",f.contentType),E.setRequestHeader("Accept",f.dataTypes[0]&&f.accepts[f.dataTypes[0]]?f.accepts[f.dataTypes[0]]+("*"!==f.dataTypes[0]?", "+Kn+"; q=0.01":""):f.accepts["*"]),f.headers)E.setRequestHeader(i,f.headers[i]);if(f.beforeSend&&(!1===f.beforeSend.call(m,E,f)||d))return E.abort();if(o="abort",_.add(f.complete),E.done(f.success),E.fail(f.error),l=$n(Zn,f,t,E)){if(E.readyState=1,p&&g.trigger("ajaxSend",[E,f]),d)return E;f.async&&0<f.timeout&&(h=A.setTimeout(function(){E.abort("timeout")},f.timeout));try{d=!1,l.send(r,s)}catch(e){if(d)throw e;s(-1,e)}}else s(-1,"No Transport")}return E;function s(e,t,n,i){var r,a,o,s=t;d||(d=!0,h&&A.clearTimeout(h),l=void 0,c=i||"",E.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(o=((e,t,n)=>{for(var i,r,a,o,s=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(r in s)if(s[r]&&s[r].test(i)){l.unshift(r);break}if(l[0]in n)a=l[0];else{for(r in n){if(!l[0]||e.converters[r+" "+l[0]]){a=r;break}o=o||r}a=a||o}if(a)return a!==l[0]&&l.unshift(a),n[a]})(f,E,n)),!i&&-1<T.inArray("script",f.dataTypes)&&T.inArray("json",f.dataTypes)<0&&(f.converters["text script"]=function(){}),o=((e,t,n,i)=>{var r,a,o,s,l,u={},c=e.dataTypes.slice();if(c[1])for(o in e.converters)u[o.toLowerCase()]=e.converters[o];for(a=c.shift();a;)if(e.responseFields[a]&&(n[e.responseFields[a]]=t),!l&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=a,a=c.shift())if("*"===a)a=l;else if("*"!==l&&l!==a){if(!(o=u[l+" "+a]||u["* "+a]))for(r in u)if((s=r.split(" "))[1]===a&&(o=u[l+" "+s[0]]||u["* "+s[0]])){!0===o?o=u[r]:!0!==u[r]&&(a=s[0],c.unshift(s[1]));break}if(!0!==o)if(o&&e.throws)t=o(t);else try{t=o(t)}catch(e){return{state:"parsererror",error:o?e:"No conversion from "+l+" to "+a}}}return{state:"success",data:t}})(f,o,E,i),i?(f.ifModified&&((n=E.getResponseHeader("Last-Modified"))&&(T.lastModified[u]=n),n=E.getResponseHeader("etag"))&&(T.etag[u]=n),204===e||"HEAD"===f.type?s="nocontent":304===e?s="notmodified":(s=o.state,r=o.data,i=!(a=o.error))):(a=s,!e&&s||(s="error",e<0&&(e=0))),E.status=e,E.statusText=(t||s)+"",i?v.resolveWith(m,[r,s,E]):v.rejectWith(m,[E,s,a]),E.statusCode(y),y=void 0,p&&g.trigger(i?"ajaxSuccess":"ajaxError",[E,f,i?r:a]),_.fireWith(m,[E,s]),p&&(g.trigger("ajaxComplete",[E,f]),--T.active||T.event.trigger("ajaxStop")))}},getJSON:function(e,t,n){return T.get(e,t,n,"json")},getScript:function(e,t){return T.get(e,void 0,t,"script")}}),T.each(["get","post"],function(e,r){T[r]=function(e,t,n,i){return _(t)&&(i=i||n,n=t,t=void 0),T.ajax(T.extend({url:e,type:r,dataType:i,data:t,success:n},T.isPlainObject(e)&&e))}}),T.ajaxPrefilter(function(e){for(var t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),T._evalUrl=function(e,t,n){return T.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){T.globalEval(e,t,n)}})},T.fn.extend({wrapAll:function(e){return this[0]&&(_(e)&&(e=e.call(this[0])),e=T(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return _(n)?this.each(function(e){T(this).wrapInner(n.call(this,e))}):this.each(function(){var e=T(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=_(t);return this.each(function(e){T(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){T(this).replaceWith(this.childNodes)}),this}}),T.expr.pseudos.hidden=function(e){return!T.expr.pseudos.visible(e)},T.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},T.ajaxSettings.xhr=function(){try{return new A.XMLHttpRequest}catch(e){}};var ti={0:200,1223:204},ni=T.ajaxSettings.xhr(),ii=(m.cors=!!ni&&"withCredentials"in ni,m.ajax=ni=!!ni,T.ajaxTransport(function(r){var a,o;if(m.cors||ni&&!r.crossDomain)return{send:function(e,t){var n,i=r.xhr();if(i.open(r.type,r.url,r.async,r.username,r.password),r.xhrFields)for(n in r.xhrFields)i[n]=r.xhrFields[n];for(n in r.mimeType&&i.overrideMimeType&&i.overrideMimeType(r.mimeType),r.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)i.setRequestHeader(n,e[n]);a=function(e){return function(){a&&(a=o=i.onload=i.onerror=i.onabort=i.ontimeout=i.onreadystatechange=null,"abort"===e?i.abort():"error"===e?"number"!=typeof i.status?t(0,"error"):t(i.status,i.statusText):t(ti[i.status]||i.status,i.statusText,"text"!==(i.responseType||"text")||"string"!=typeof i.responseText?{binary:i.response}:{text:i.responseText},i.getAllResponseHeaders()))}},i.onload=a(),o=i.onerror=i.ontimeout=a("error"),void 0!==i.onabort?i.onabort=o:i.onreadystatechange=function(){4===i.readyState&&A.setTimeout(function(){a&&o()})},a=a("abort");try{i.send(r.hasContent&&r.data||null)}catch(e){if(a)throw e}},abort:function(){a&&a()}}}),T.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),T.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return T.globalEval(e),e}}}),T.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),T.ajaxTransport("script",function(n){var i,r;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){i=T("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",r=function(e){i.remove(),r=null,e&&t("error"===e.type?404:200,e.type)}),x.head.appendChild(i[0])},abort:function(){r&&r()}}}),[]),ri=/(=)\?(?=&|$)|\?\?/,ai=(T.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=ii.pop()||T.expando+"_"+Pn.guid++;return this[e]=!0,e}}),T.ajaxPrefilter("json jsonp",function(e,t,n){var i,r,a,o=!1!==e.jsonp&&(ri.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&ri.test(e.data)&&"data");if(o||"jsonp"===e.dataTypes[0])return i=e.jsonpCallback=_(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,o?e[o]=e[o].replace(ri,"$1"+i):!1!==e.jsonp&&(e.url+=(Un.test(e.url)?"&":"?")+e.jsonp+"="+i),e.converters["script json"]=function(){return a||T.error(i+" was not called"),a[0]},e.dataTypes[0]="json",r=A[i],A[i]=function(){a=arguments},n.always(function(){void 0===r?T(A).removeProp(i):A[i]=r,e[i]&&(e.jsonpCallback=t.jsonpCallback,ii.push(i)),a&&_(r)&&r(a[0]),a=r=void 0}),"script"}),m.createHTMLDocument=((e=x.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===e.childNodes.length),T.parseHTML=function(e,t,n){var i;return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(m.createHTMLDocument?((i=(t=x.implementation.createHTMLDocument("")).createElement("base")).href=x.location.href,t.head.appendChild(i)):t=x),i=!n&&[],(n=Xe.exec(e))?[t.createElement(n[1])]:(n=Nt([e],t,i),i&&i.length&&T(i).remove(),T.merge([],n.childNodes)))},T.fn.load=function(e,t,n){var i,r,a,o=this,s=e.indexOf(" ");return-1<s&&(i=Nn(e.slice(s)),e=e.slice(0,s)),_(t)?(n=t,t=void 0):t&&"object"==typeof t&&(r="POST"),0<o.length&&T.ajax({url:e,type:r||"GET",dataType:"html",data:t}).done(function(e){a=arguments,o.html(i?T("<div>").append(T.parseHTML(e)).find(i):e)}).always(n&&function(e,t){o.each(function(){n.apply(this,a||[e.responseText,t,e])})}),this},T.expr.pseudos.animated=function(t){return T.grep(T.timers,function(e){return t===e.elem}).length},T.offset={setOffset:function(e,t,n){var i,r,a,o,s=T.css(e,"position"),l=T(e),u={};"static"===s&&(e.style.position="relative"),a=l.offset(),i=T.css(e,"top"),o=T.css(e,"left"),s=("absolute"===s||"fixed"===s)&&-1<(i+o).indexOf("auto")?(r=(s=l.position()).top,s.left):(r=parseFloat(i)||0,parseFloat(o)||0),null!=(t=_(t)?t.call(e,n,T.extend({},a)):t).top&&(u.top=t.top-a.top+r),null!=t.left&&(u.left=t.left-a.left+s),"using"in t?t.using.call(e,u):l.css(u)}},T.fn.extend({offset:function(t){var e,n;return arguments.length?void 0===t?this:this.each(function(e){T.offset.setOffset(this,t,e)}):(n=this[0])?n.getClientRects().length?(e=n.getBoundingClientRect(),n=n.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,i=this[0],r={top:0,left:0};if("fixed"===T.css(i,"position"))t=i.getBoundingClientRect();else{for(t=this.offset(),n=i.ownerDocument,e=i.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===T.css(e,"position");)e=e.parentNode;e&&e!==i&&1===e.nodeType&&((r=T(e).offset()).top+=T.css(e,"borderTopWidth",!0),r.left+=T.css(e,"borderLeftWidth",!0))}return{top:t.top-r.top-T.css(i,"marginTop",!0),left:t.left-r.left-T.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===T.css(e,"position");)e=e.offsetParent;return e||_t})}}),T.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,r){var a="pageYOffset"===r;T.fn[t]=function(e){return c(this,function(e,t,n){var i;if(B(e)?i=e:9===e.nodeType&&(i=e.defaultView),void 0===n)return i?i[r]:e[t];i?i.scrollTo(a?i.pageXOffset:n,a?n:i.pageYOffset):e[t]=n},t,e,arguments.length)}}),T.each(["top","left"],function(e,n){T.cssHooks[n]=on(m.pixelPosition,function(e,t){if(t)return t=an(e,n),$t.test(t)?T(e).position()[n]+"px":t})}),T.each({Height:"height",Width:"width"},function(o,s){T.each({padding:"inner"+o,content:s,"":"outer"+o},function(i,a){T.fn[a]=function(e,t){var n=arguments.length&&(i||"boolean"!=typeof e),r=i||(!0===e||!0===t?"margin":"border");return c(this,function(e,t,n){var i;return B(e)?0===a.indexOf("outer")?e["inner"+o]:e.document.documentElement["client"+o]:9===e.nodeType?(i=e.documentElement,Math.max(e.body["scroll"+o],i["scroll"+o],e.body["offset"+o],i["offset"+o],i["client"+o])):void 0===n?T.css(e,t,r):T.style(e,t,n,r)},s,n?e:void 0,n)}})}),T.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){T.fn[t]=function(e){return this.on(t,e)}}),T.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.on("mouseenter",e).on("mouseleave",t||e)}}),T.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){T.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}}),/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g),oi=(T.proxy=function(e,t){var n,i;if("string"==typeof t&&(i=e[t],t=e,e=i),_(e))return n=s.call(arguments,2),(i=function(){return e.apply(t||this,n.concat(s.call(arguments)))}).guid=e.guid=e.guid||T.guid++,i},T.holdReady=function(e){e?T.readyWait++:T.ready(!0)},T.isArray=Array.isArray,T.parseJSON=JSON.parse,T.nodeName=E,T.isFunction=_,T.isWindow=B,T.camelCase=L,T.type=X,T.now=Date.now,T.isNumeric=function(e){var t=T.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},T.trim=function(e){return null==e?"":(e+"").replace(ai,"$1")},void 0!==(ci=function(){return T}.apply(ui,[]))&&(li.exports=ci),A.jQuery),si=A.$;return T.noConflict=function(e){return A.$===T&&(A.$=si),e&&A.jQuery===T&&(A.jQuery=oi),T},void 0===U&&(A.jQuery=A.$=T),T},"object"==typeof li.exports?li.exports=e.document?t(e,!0):function(e){if(e.document)return t(e);throw new Error("jQuery requires a window with a document")}:t(e)},601:e=>{window,e.exports=(n=>{var i={};function r(e){var t;return(i[e]||(t=i[e]={i:e,l:!1,exports:{}},n[e].call(t.exports,t,t.exports,r),t.l=!0,t)).exports}return r.m=n,r.c=i,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)})([function(e,t,n){n.r(t);function y(e,t){var n=t.x-e.x,t=t.y-e.y;return Math.sqrt(n*n+t*t)}function E(e){return e*(Math.PI/180)}function r(e){f.has(e)&&clearTimeout(f.get(e)),f.set(e,setTimeout(e,100))}function a(e,t,n){for(var i,r=t.split(/[ ,]+/g),a=0;a<r.length;a+=1)i=r[a],e.addEventListener?e.addEventListener(i,n,!1):e.attachEvent&&e.attachEvent(i,n)}function i(e,t,n){for(var i,r=t.split(/[ ,]+/g),a=0;a<r.length;a+=1)i=r[a],e.removeEventListener?e.removeEventListener(i,n):e.detachEvent&&e.detachEvent(i,n)}function o(e){return e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e}function s(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}}function l(e,t){t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")}function u(e,t,n){var i,r=c(e);for(i in r)if(r.hasOwnProperty(i))if("string"==typeof t)r[i]=t+" "+n;else{for(var a="",o=0,s=t.length;o<s;o+=1)a+=t[o]+" "+n+", ";r[i]=a.slice(0,-2)}return r}function c(t){var n={};return n[t]="",["webkit","Moz","o"].forEach(function(e){n[e+t.charAt(0).toUpperCase()+t.slice(1)]=""}),n}function h(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function d(e,t){if(e.length)for(var n=0,i=e.length;n<i;n+=1)t(e[n]);else t(e)}var p,f=new Map,n=!!("ontouchstart"in window),m=!!window.PointerEvent,g={start:"mousedown",move:"mousemove",end:"mouseup"},v={};function _(){}m?p={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:!!window.MSPointerEvent?p={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:n?(p={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},v=g):p=g,_.prototype.on=function(e,t){var n,i=e.split(/[ ,]+/g);this._handlers_=this._handlers_||{};for(var r=0;r<i.length;r+=1)n=i[r],this._handlers_[n]=this._handlers_[n]||[],this._handlers_[n].push(t);return this},_.prototype.off=function(e,t){return this._handlers_=this._handlers_||{},void 0===e?this._handlers_={}:void 0===t?this._handlers_[e]=null:this._handlers_[e]&&0<=this._handlers_[e].indexOf(t)&&this._handlers_[e].splice(this._handlers_[e].indexOf(t),1),this},_.prototype.trigger=function(e,t){var n,i=this,r=e.split(/[ ,]+/g);i._handlers_=i._handlers_||{};for(var a=0;a<r.length;a+=1)n=r[a],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach(function(e){e.call(i,{type:n,target:i},t)})},_.prototype.config=function(e){this.options=this.defaults||{},e&&(this.options=((e,t)=>{var n,i={};for(n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)?i[n]=t[n]:e.hasOwnProperty(n)&&(i[n]=e[n]);return i})(this.options,e))},_.prototype.bindEvt=function(e,t){var n=this;return n._domHandlers_=n._domHandlers_||{},n._domHandlers_[t]=function(){"function"==typeof n["on"+t]?n["on"+t].apply(n,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},a(e,p[t],n._domHandlers_[t]),v[t]&&a(e,v[t],n._domHandlers_[t]),n},_.prototype.unbindEvt=function(e,t){return this._domHandlers_=this._domHandlers_||{},i(e,p[t],this._domHandlers_[t]),v[t]&&i(e,v[t],this._domHandlers_[t]),delete this._domHandlers_[t],this};m=_;function A(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=A.id,A.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}A.prototype=new m,(A.constructor=A).id=0,A.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},A.prototype.stylize=function(){var e,t,n;return this.options.dataOnly||(t=this.options.fadeTime+"ms",e=(()=>{var e,t=c("borderRadius");for(e in t)t.hasOwnProperty(e)&&(t[e]="50%");return t})(),t=u("transition","opacity",t),(n={}).el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},h(n.el,t),"circle"===this.options.shape&&h(n.back,e),h(n.front,e),this.applyStyles(n)),this},A.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var n in e[t])this.ui[t].style[n]=e[t][n];return this},A.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},A.prototype.removeFromDom=function(){return!this.options.dataOnly&&document.body.contains(this.ui.el)&&this.options.zone.removeChild(this.ui.el),this},A.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},A.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),"function"==typeof e&&e.call(this)},t.options.fadeTime)),t},A.prototype.hide=function(t){var e,n,i=this;return i.options.dataOnly||(i.ui.el.style.opacity=i.options.restOpacity,clearTimeout(i.removeTimeout),clearTimeout(i.showTimeout),clearTimeout(i.restTimeout),i.removeTimeout=setTimeout(function(){var e="dynamic"===i.options.mode?"none":"block";i.ui.el.style.display=e,"function"==typeof t&&t.call(i),i.trigger("hidden",i.instance)},i.options.fadeTime),i.options.restJoystick&&(e=i.options.restJoystick,(n={}).x=!0===e||!1!==e.x?0:i.instance.frontPosition.x,n.y=!0===e||!1!==e.y?0:i.instance.frontPosition.y,i.setPosition(t,n))),i},A.prototype.setPosition=function(e,t){var n=this,t=(n.frontPosition={x:t.x,y:t.y},n.options.fadeTime+"ms"),i={},t=(i.front=u("transition",["transform"],t),{front:{}});t.front={transform:"translate("+n.frontPosition.x+"px,"+n.frontPosition.y+"px)"},n.applyStyles(i),n.applyStyles(t),n.restTimeout=setTimeout(function(){"function"==typeof e&&e.call(n),n.restCallback()},n.options.fadeTime)},A.prototype.restCallback=function(){var e={};e.front=u("transition","none",""),this.applyStyles(e),this.trigger("rested",this.instance)},A.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},A.prototype.computeDirection=function(e){var t,n,i,r=e.angle.radian,a=Math.PI/4,o=Math.PI/2;if(a<r&&r<3*a&&!e.lockX?t="up":-a<r&&r<=a&&!e.lockY?t="left":3*-a<r&&r<=-a&&!e.lockX?t="down":e.lockY||(t="right"),e.lockY||(n=-o<r&&r<o?"left":"right"),e.lockX||(i=0<r?"up":"down"),e.force>this.options.threshold){var s,l={};for(s in this.direction)this.direction.hasOwnProperty(s)&&(l[s]=this.direction[s]);var u={};for(s in this.direction={x:n,y:i,angle:t},e.direction=this.direction,l)l[s]===this.direction[s]&&(u[s]=!0);if(u.x&&u.y&&u.angle)return e;u.x&&u.y||this.trigger("plain",e),u.x||this.trigger("plain:"+n,e),u.y||this.trigger("plain:"+i,e),u.angle||this.trigger("dir dir:"+t,e)}else this.resetDirection();return e};var x=A;function T(e,t){this.nipples=[],this.idles=[],this.actives=[],this.ids=[],this.pressureIntervals={},this.manager=e,this.id=T.id,T.id+=1,this.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},this.config(t),"static"!==this.options.mode&&"semi"!==this.options.mode||(this.options.multitouch=!1),this.options.multitouch||(this.options.maxNumberOfNipples=1);e=getComputedStyle(this.options.zone.parentElement);return e&&"flex"===e.display&&(this.parentIsFlex=!0),this.updateBox(),this.prepareNipples(),this.bindings(),this.begin(),this.nipples}T.prototype=new m,(T.constructor=T).id=0,T.prototype.prepareNipples=function(){var i=this.nipples;i.on=this.on.bind(this),i.off=this.off.bind(this),i.options=this.options,i.destroy=this.destroy.bind(this),i.ids=this.ids,i.id=this.id,i.processOnMove=this.processOnMove.bind(this),i.processOnEnd=this.processOnEnd.bind(this),i.get=function(e){if(void 0===e)return i[0];for(var t=0,n=i.length;t<n;t+=1)if(i[t].identifier===e)return i[t];return!1}},T.prototype.bindings=function(){this.bindEvt(this.options.zone,"start"),this.options.zone.style.touchAction="none",this.options.zone.style.msTouchAction="none"},T.prototype.begin=function(){var e=this.options;"static"===e.mode&&((e=this.createNipple(e.position,this.manager.getIdentifier())).add(),this.idles.push(e))},T.prototype.createNipple=function(e,t){var n=this.manager.scroll,i={},r=this.options,a=this.parentIsFlex?n.x:n.x+this.box.left,o=this.parentIsFlex?n.y:n.y+this.box.top,a=(e.x&&e.y?i={x:e.x-a,y:e.y-o}:(e.top||e.right||e.bottom||e.left)&&((a=document.createElement("DIV")).style.display="hidden",a.style.top=e.top,a.style.right=e.right,a.style.bottom=e.bottom,a.style.left=e.left,a.style.position="absolute",r.zone.appendChild(a),o=a.getBoundingClientRect(),r.zone.removeChild(a),i=e,e={x:o.left+n.x,y:o.top+n.y}),new x(this,{color:r.color,size:r.size,threshold:r.threshold,fadeTime:r.fadeTime,dataOnly:r.dataOnly,restJoystick:r.restJoystick,restOpacity:r.restOpacity,mode:r.mode,identifier:t,position:e,zone:r.zone,frontPosition:{x:0,y:0},shape:r.shape}));return r.dataOnly||(l(a.ui.el,i),l(a.ui.front,a.frontPosition)),this.nipples.push(a),this.trigger("added "+a.identifier+":added",a),this.manager.trigger("added "+a.identifier+":added",a),this.bindNipple(a),a},T.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},T.prototype.bindNipple=function(e){function t(e,t){n=e.type+" "+t.id+":"+e.type,i.trigger(n,t)}var n,i=this;e.on("destroyed",i.onDestroyed.bind(i)),e.on("shown hidden rested dir plain",t),e.on("dir:up dir:right dir:down dir:left",t),e.on("plain:up plain:right plain:down plain:left",t)},T.prototype.pressureFn=function(t,n,e){var i=this,r=0;clearInterval(i.pressureIntervals[e]),i.pressureIntervals[e]=setInterval(function(){var e=t.force||t.pressure||t.webkitForce||0;e!==r&&(n.trigger("pressure",e),i.trigger("pressure "+n.identifier+":pressure",e),r=e)}.bind(i),100)},T.prototype.onstart=function(n){var i=this,t=i.options,r=n;return n=o(n),i.updateBox(),d(n,function(e){(i.actives.length<t.maxNumberOfNipples||r.type.match(/^touch/)&&(Object.keys(i.manager.ids).forEach(function(t){var e;Object.values(r.touches).findIndex(function(e){return e.identifier===t})<0&&((e=[n[0]]).identifier=t,i.processOnEnd(e))}),i.actives.length<t.maxNumberOfNipples))&&i.processOnStart(e)}),i.manager.bindDocument(),!1},T.prototype.processOnStart=function(t){function e(e){e.trigger("start",e),n.trigger("start "+e.id+":start",e),e.show(),0<a&&n.pressureFn(t,e,e.identifier),n.processOnMove(t)}var n=this,i=n.options,r=n.manager.getIdentifier(t),a=t.force||t.pressure||t.webkitForce||0,o={x:t.pageX,y:t.pageY},s=n.getOrCreate(r,o);s.identifier!==r&&n.manager.removeIdentifier(s.identifier),s.identifier=r;if(0<=(r=n.idles.indexOf(s))&&n.idles.splice(r,1),n.actives.push(s),n.ids.push(s.identifier),"semi"!==i.mode||y(o,s.position)<=i.catchDistance)return e(s),s;s.destroy(),n.processOnStart(t)},T.prototype.getOrCreate=function(e,t){var n,i=this.options;return/(semi|static)/.test(i.mode)?(n=this.idles[0])?(this.idles.splice(0,1),n):"semi"===i.mode?this.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1):this.createNipple(t,e)},T.prototype.processOnMove=function(e){var t,n,i,r,a,o,s,l,u,c,h,d,p,f,m=this.options,g=this.manager.getIdentifier(e),v=this.nipples.get(g),_=this.manager.scroll;f=e,(isNaN(f.buttons)?0!==f.pressure:0!==f.buttons)?v?(m.dynamicPage&&(f=v.el.getBoundingClientRect(),v.position={x:_.x+f.left,y:_.y+f.top}),v.identifier=g,f=v.options.size/2,t={x:e.pageX,y:e.pageY},m.lockX&&(t.y=v.position.y),m.lockY&&(t.x=v.position.x),r=y(t,v.position),o=t,a=v.position,s=a.x-o.x,a=Math.atan2(a.y-o.y,s)*(180/Math.PI),o=E(a),s=r/f,l={distance:r,position:t},"circle"===v.options.shape?(n=Math.min(r,f),i=v.position,h=n,p={x:0,y:0},d=E(a),p.x=i.x-h*Math.cos(d),p.y=i.y-h*Math.sin(d),i=p):(h=t,d=v.position,p=f,i={x:Math.min(Math.max(h.x,d.x-p),d.x+p),y:Math.min(Math.max(h.y,d.y-p),d.y+p)},n=y(i,v.position)),m.follow?f<r&&(u=t.x-i.x,c=t.y-i.y,v.position.x+=u,v.position.y+=c,v.el.style.top=v.position.y-(this.box.top+_.y)+"px",v.el.style.left=v.position.x-(this.box.left+_.x)+"px",r=y(t,v.position)):(t=i,r=n),u=t.x-v.position.x,c=t.y-v.position.y,v.frontPosition={x:u,y:c},m.dataOnly||(v.ui.front.style.transform="translate("+u+"px,"+c+"px)"),_={identifier:v.identifier,position:t,force:s,pressure:e.force||e.pressure||e.webkitForce||0,distance:r,angle:{radian:o,degree:a},vector:{x:u/f,y:-c/f},raw:l,instance:v,lockX:m.lockX,lockY:m.lockY},(_=v.computeDirection(_)).angle={radian:E(180-a),degree:180-a},v.trigger("move",_),this.trigger("move "+v.id+":move",_)):(console.error("Found zombie joystick with ID "+g),this.manager.removeIdentifier(g)):this.processOnEnd(e)},T.prototype.processOnEnd=function(e){var t=this,n=t.options,e=t.manager.getIdentifier(e),i=t.nipples.get(e),e=t.manager.removeIdentifier(i.identifier);i&&(n.dataOnly||i.hide(function(){"dynamic"===n.mode&&(i.trigger("removed",i),t.trigger("removed "+i.id+":removed",i),t.manager.trigger("removed "+i.id+":removed",i),i.destroy())}),clearInterval(t.pressureIntervals[i.identifier]),i.resetDirection(),i.trigger("end",i),t.trigger("end "+i.id+":end",i),0<=t.ids.indexOf(i.identifier)&&t.ids.splice(t.ids.indexOf(i.identifier),1),0<=t.actives.indexOf(i)&&t.actives.splice(t.actives.indexOf(i),1),/(semi|static)/.test(n.mode)?t.idles.push(i):0<=t.nipples.indexOf(i)&&t.nipples.splice(t.nipples.indexOf(i),1),t.manager.unbindDocument(),/(semi|static)/.test(n.mode))&&(t.manager.ids[e.id]=e.identifier)},T.prototype.onDestroyed=function(e,t){0<=this.nipples.indexOf(t)&&this.nipples.splice(this.nipples.indexOf(t),1),0<=this.actives.indexOf(t)&&this.actives.splice(this.actives.indexOf(t),1),0<=this.idles.indexOf(t)&&this.idles.splice(this.idles.indexOf(t),1),0<=this.ids.indexOf(t.identifier)&&this.ids.splice(this.ids.indexOf(t.identifier),1),this.manager.removeIdentifier(t.identifier),this.manager.unbindDocument()},T.prototype.destroy=function(){for(var e in this.unbindEvt(this.options.zone,"start"),this.nipples.forEach(function(e){e.destroy()}),this.pressureIntervals)this.pressureIntervals.hasOwnProperty(e)&&clearInterval(this.pressureIntervals[e]);this.trigger("destroyed",this.nipples),this.manager.unbindDocument(),this.off()};var S=T;function w(e){function t(){var t;i.collections.forEach(function(e){e.forEach(function(e){t=e.el.getBoundingClientRect(),e.position={x:i.scroll.x+t.left,y:i.scroll.y+t.top}})})}function n(){i.scroll=s()}var i=this;i.ids={},i.index=0,i.collections=[],i.scroll=s(),i.config(e),i.prepareCollections(),a(window,"resize",function(){r(t)});return a(window,"scroll",function(){r(n)}),i.collections}w.prototype=new m,(w.constructor=w).prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var n;return e.collections.every(function(e){return!(n=e.get(t))}),n}},w.prototype.create=function(e){return this.createCollection(e)},w.prototype.createCollection=function(e){e=new S(this,e);return this.bindCollection(e),this.collections.push(e),e},w.prototype.bindCollection=function(e){function t(e,t){n=e.type+" "+t.id+":"+e.type,i.trigger(n,t)}var n,i=this;e.on("destroyed",i.onDestroyed.bind(i)),e.on("shown hidden rested dir plain",t),e.on("dir:up dir:right dir:down dir:left",t),e.on("plain:up plain:right plain:down plain:left",t)},w.prototype.bindDocument=function(){this.binded||(this.bindEvt(document,"move").bindEvt(document,"end"),this.binded=!0)},w.prototype.unbindDocument=function(e){Object.keys(this.ids).length&&!0!==e||(this.unbindEvt(document,"move").unbindEvt(document,"end"),this.binded=!1)},w.prototype.getIdentifier=function(e){var t;return e?void 0===(t=void 0===e.identifier?e.pointerId:e.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},w.prototype.removeIdentifier=function(e){var t,n={};for(t in this.ids)if(this.ids[t]===e){n.id=t,n.identifier=this.ids[t],delete this.ids[t];break}return n},w.prototype.onmove=function(e){return this.onAny("move",e),!1},w.prototype.onend=function(e){return this.onAny("end",e),!1},w.prototype.oncancel=function(e){return this.onAny("end",e),!1},w.prototype.onAny=function(e,t){var n,i=this,r="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=o(t);return d(t,function(e){n=i.getIdentifier(e),d(i.collections,function(e,t,n){0<=n.ids.indexOf(t)&&(n[r](e),e._found_=!0)}.bind(null,e,n)),e._found_||i.removeIdentifier(n)}),!1},w.prototype.destroy=function(){this.unbindDocument(!0),this.ids={},this.index=0,this.collections.forEach(function(e){e.destroy()}),this.off()},w.prototype.onDestroyed=function(e,t){if(this.collections.indexOf(t)<0)return!1;this.collections.splice(this.collections.indexOf(t),1)};var b=new w;t.default={create:function(e){return b.create(e)},factory:b}}]).default},730:(a,l,U)=>{var B=U(43),k=U(853);function F(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var G=new Set,H={};function V(e,t){W(e,t),W(e+"Capture",t)}function W(e,t){for(H[e]=t,e=0;e<t.length;e++)G.add(t[e])}var U=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),j=Object.prototype.hasOwnProperty,Y=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,q={},X={};function Z(e,t,n,i){if(null==t||((e,t,n,i)=>{if(null===n||0!==n.type)switch(typeof t){case"function":case"symbol":return 1;case"boolean":return i?void 0:null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e;default:return}})(e,t,n,i))return 1;if(!i&&null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||t<1}}function n(e,t,n,i,r,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var o={},K=("children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){o[e]=new n(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];o[t]=new n(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){o[e]=new n(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){o[e]=new n(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){o[e]=new n(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){o[e]=new n(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){o[e]=new n(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){o[e]=new n(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){o[e]=new n(e,5,!1,e.toLowerCase(),null,!1,!1)}),/[\-:]([a-z])/g);function J(e){return e[1].toUpperCase()}function Q(e,t,n,i){var r,a=o.hasOwnProperty(t)?o[t]:null;(null!==a?0!==a.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(Z(t,n,a,i)&&(n=null),i||null===a?(r=t,(j.call(X,r)||!j.call(q,r)&&(Y.test(r)?X[r]=!0:void(q[r]=!0)))&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n))):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,i=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(K,J);o[t]=new n(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(K,J);o[t]=new n(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(K,J);o[t]=new n(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){o[e]=new n(e,1,!1,e.toLowerCase(),null,!1,!1)}),o.xlinkHref=new n("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){o[e]=new n(e,1,!1,e.toLowerCase(),null,!0,!0)});var $=B.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ee=Symbol.for("react.element"),te=Symbol.for("react.portal"),ne=Symbol.for("react.fragment"),ie=Symbol.for("react.strict_mode"),re=Symbol.for("react.profiler"),ae=Symbol.for("react.provider"),oe=Symbol.for("react.context"),se=Symbol.for("react.forward_ref"),le=Symbol.for("react.suspense"),ue=Symbol.for("react.suspense_list"),ce=Symbol.for("react.memo"),he=Symbol.for("react.lazy"),de=(Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode"),Symbol.for("react.offscreen")),pe=(Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker"),Symbol.iterator);function fe(e){return null!==e&&"object"==typeof e&&"function"==typeof(e=pe&&e[pe]||e["@@iterator"])?e:null}var me,g=Object.assign;function ge(e){if(void 0===me)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);me=t&&t[1]||""}return"\n"+me+e}var ve=!1;function _e(t,e){if(!t||ve)return"";ve=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(e,[])}catch(e){var i=e}Reflect.construct(t,[],e)}else{try{e.call()}catch(e){i=e}t.call(e.prototype)}else{try{throw Error()}catch(e){i=e}t()}}catch(e){if(e&&i&&"string"==typeof e.stack){for(var r,a=e.stack.split("\n"),o=i.stack.split("\n"),s=a.length-1,l=o.length-1;1<=s&&0<=l&&a[s]!==o[l];)l--;for(;1<=s&&0<=l;s--,l--)if(a[s]!==o[l]){if(1!==s||1!==l)do{if(s--,--l<0||a[s]!==o[l])return r="\n"+a[s].replace(" at new "," at "),r=t.displayName&&r.includes("<anonymous>")?r.replace("<anonymous>",t.displayName):r}while(1<=s&&0<=l);break}}}finally{ve=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ge(t):""}function ye(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return function e(t){if(null!=t){if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t;switch(t){case ne:return"Fragment";case te:return"Portal";case re:return"Profiler";case ie:return"StrictMode";case le:return"Suspense";case ue:return"SuspenseList"}if("object"==typeof t)switch(t.$$typeof){case oe:return(t.displayName||"Context")+".Consumer";case ae:return(t._context.displayName||"Context")+".Provider";case se:var n=t.render;return t=(t=t.displayName)||(""!==(t=n.displayName||n.name||"")?"ForwardRef("+t+")":"ForwardRef");case ce:return null!==(n=t.displayName||null)?n:e(t.type)||"Memo";case he:n=t._payload,t=t._init;try{return e(t(n))}catch(e){}}}return null}(t);case 8:return t===ie?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function Ee(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function Ae(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function xe(e){e._valueTracker||(e._valueTracker=(e=>{var t,n,i=Ae(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,i),a=""+e[i];if(!e.hasOwnProperty(i)&&void 0!==r&&"function"==typeof r.get&&"function"==typeof r.set)return t=r.get,n=r.set,Object.defineProperty(e,i,{configurable:!0,get:function(){return t.call(this)},set:function(e){a=""+e,n.call(this,e)}}),Object.defineProperty(e,i,{enumerable:r.enumerable}),{getValue:function(){return a},setValue:function(e){a=""+e},stopTracking:function(){e._valueTracker=null,delete e[i]}}})(e))}function Te(e){var t,n,i;if(e)return(t=e._valueTracker)?(n=t.getValue(),i="",(e=i=e?Ae(e)?e.checked?"true":"false":e.value:i)!==n&&(t.setValue(e),1)):1}function Se(t){if(void 0===(t=t||("undefined"!=typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}function we(e,t){var n=t.checked;return g({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function be(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked,n=Ee(null!=t.value?t.value:n);e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Me(e,t){null!=(t=t.checked)&&Q(e,"checked",t,!1)}function Re(e,t){Me(e,t);var n=Ee(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?Ie(e,t.type,n):t.hasOwnProperty("defaultValue")&&Ie(e,t.type,Ee(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Ne(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(("submit"===i||"reset"===i)&&null==t.value)return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function Ie(e,t,n){"number"===t&&Se(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Ce=Array.isArray;function Le(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+Ee(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function De(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(F(91));return g({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Oe(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(F(92));if(Ce(n)){if(1<n.length)throw Error(F(93));n=n[0]}t=n}n=t=null==t?"":t}e._wrapperState={initialValue:Ee(n)}}function Pe(e,t){var n=Ee(t.value),i=Ee(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue)&&e.defaultValue!==n&&(e.defaultValue=n),null!=i&&(e.defaultValue=""+i)}function Ue(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function Be(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Fe(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?Be(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}ke=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ze=ze||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ze.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}};var ze,ke,Ge="undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return ke(e,t)})}:ke;function He(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var Ve={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},We=["Webkit","ms","Moz","O"];function je(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||Ve.hasOwnProperty(e)&&Ve[e]?(""+t).trim():t+"px"}function Ye(e,t){for(var n in e=e.style,t){var i,r;t.hasOwnProperty(n)&&(i=0===n.indexOf("--"),r=je(n,t[n],i),"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r)}}Object.keys(Ve).forEach(function(t){We.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ve[e]=Ve[t]})});var qe=g({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Xe(e,t){if(t){if(qe[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(F(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(F(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(F(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(F(62))}}function Ze(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ke=null;function Je(e){return 3===(e=(e=e.target||e.srcElement||window).correspondingUseElement?e.correspondingUseElement:e).nodeType?e.parentNode:e}var Qe=null,$e=null,et=null;function tt(e){if(e=Cr(e)){if("function"!=typeof Qe)throw Error(F(280));var t=e.stateNode;t&&(t=Dr(t),Qe(e.stateNode,e.type,t))}}function nt(e){$e?et?et.push(e):et=[e]:$e=e}function it(){if($e){var e=$e,t=et;if(et=$e=null,tt(e),t)for(e=0;e<t.length;e++)tt(t[e])}}function rt(e,t){return e(t)}function at(){}var ot=!1;function st(e,t,n){if(ot)return e(t,n);ot=!0;try{rt(e,t,n)}finally{ot=!1,null===$e&&null===et||(at(),it())}}function lt(e,t){var n=e.stateNode;if(null===n)return null;var i=Dr(n);if(null===i)return null;switch(n=i[t],t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":e=!(i=(i=!i.disabled)?i:!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e));break;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(F(231,t,typeof n));return n}var ut=!1;if(U)try{var e={};Object.defineProperty(e,"passive",{get:function(){ut=!0}}),window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){ut=!1}var ct=!1,ht=null,dt=!1,pt=null,ft={onError:function(e){ct=!0,ht=e}};function mt(e,t,n,i,r,a,o,s,l){ct=!1,ht=null,function(e,t,n,i,r,a,o,s,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(e){this.onError(e)}}.apply(ft,arguments)}function gt(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else for(e=t;0!=(4098&(t=e).flags)&&(n=t.return),e=t.return;);return 3===t.tag?n:null}function vt(e){if(13===e.tag){var t=e.memoizedState;if(null!==(t=null===t&&null!==(e=e.alternate)?e.memoizedState:t))return t.dehydrated}return null}function _t(e){if(gt(e)!==e)throw Error(F(188))}function yt(e){return null!==(e=(e=>{var t=e.alternate;if(!t){if(null===(t=gt(e)))throw Error(F(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null===(i=r.return))break;n=i}else{if(r.child===a.child){for(a=r.child;a;){if(a===n)return _t(r),e;if(a===i)return _t(r),t;a=a.sibling}throw Error(F(188))}if(n.return!==i.return)n=r,i=a;else{for(var o=!1,s=r.child;s;){if(s===n){o=!0,n=r,i=a;break}if(s===i){o=!0,i=r,n=a;break}s=s.sibling}if(!o){for(s=a.child;s;){if(s===n){o=!0,n=a,i=r;break}if(s===i){o=!0,i=a,n=r;break}s=s.sibling}if(!o)throw Error(F(189))}}if(n.alternate!==i)throw Error(F(190))}}if(3!==n.tag)throw Error(F(188));return n.stateNode.current===n?e:t})(e))?function e(t){if(5===t.tag||6===t.tag)return t;for(t=t.child;null!==t;){var n=e(t);if(null!==n)return n;t=t.sibling}return null}(e):null}var Et=k.unstable_scheduleCallback,At=k.unstable_cancelCallback,xt=k.unstable_shouldYield,Tt=k.unstable_requestPaint,m=k.unstable_now,St=k.unstable_getCurrentPriorityLevel,wt=k.unstable_ImmediatePriority,bt=k.unstable_UserBlockingPriority,Mt=k.unstable_NormalPriority,Rt=k.unstable_LowPriority,Nt=k.unstable_IdlePriority,It=null,Ct=null;var Lt=Math.clz32||function(e){return 0==(e>>>=0)?32:31-(Dt(e)/Ot|0)|0},Dt=Math.log,Ot=Math.LN2;var Pt=64,Ut=4194304;function Bt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Ft(e,t){var n=e.pendingLanes;if(0===n)return 0;var i,r=0,a=e.suspendedLanes,o=e.pingedLanes,s=268435455&n;if(0!=s?0!=(i=s&~a)?r=Bt(i):0!==(o&=s)&&(r=Bt(o)):0!=(s=n&~a)?r=Bt(s):0!==o&&(r=Bt(o)),0===r)return 0;if(0!==t&&t!==r&&0==(t&a)&&((o=t&-t)<=(a=r&-r)||16===a&&0!=(4194240&o)))return t;if(0!=(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)r|=e[n=31-Lt(t)],t&=~(a=1<<n);return r}function zt(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-Lt(a),s=1<<o,l=r[o];-1===l?0!=(s&n)&&0==(s&i)||(r[o]=((e,t)=>{switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;default:return-1}})(s,t)):l<=t&&(e.expiredLanes|=s),a&=~s}}function kt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Gt(){var e=Pt;return 0==(4194240&(Pt<<=1))&&(Pt=64),e}function Ht(e){for(var t=[],n=0;n<31;n++)t.push(e);return t}function Vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-Lt(t)]=n}function Wt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-Lt(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var A=0;function jt(e){return 1<(e&=-e)?4<e?0!=(268435455&e)?16:536870912:4:1}var Yt,qt,Xt,Zt,Kt,Jt=!1,Qt=[],$t=null,en=null,tn=null,nn=new Map,rn=new Map,an=[],on="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function sn(e,t){switch(e){case"focusin":case"focusout":$t=null;break;case"dragenter":case"dragleave":en=null;break;case"mouseover":case"mouseout":tn=null;break;case"pointerover":case"pointerout":nn.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":rn.delete(t.pointerId)}}function ln(e,t,n,i,r,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:a,targetContainers:[r]},null!==t&&null!==(t=Cr(t))&&qt(t)):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r)),e}function un(e){var t=Ir(e.target);if(null!==t){var n=gt(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=vt(n)))return e.blockedOn=t,void Kt(e.priority,function(){Xt(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function cn(e){if(null===e.blockedOn){for(var t=e.targetContainers;0<t.length;){var n=An(e.domEventName,0,t[0],e.nativeEvent);if(null!==n)return null!==(t=Cr(n))&&qt(t),e.blockedOn=n,0;var i=new(n=e.nativeEvent).constructor(n.type,n);Ke=i,n.target.dispatchEvent(i),Ke=null,t.shift()}return 1}}function hn(e,t,n){cn(e)&&n.delete(t)}function dn(){Jt=!1,null!==$t&&cn($t)&&($t=null),null!==en&&cn(en)&&(en=null),null!==tn&&cn(tn)&&(tn=null),nn.forEach(hn),rn.forEach(hn)}function pn(e,t){e.blockedOn===t&&(e.blockedOn=null,Jt||(Jt=!0,k.unstable_scheduleCallback(k.unstable_NormalPriority,dn)))}function fn(t){function e(e){return pn(e,t)}if(0<Qt.length){pn(Qt[0],t);for(var n=1;n<Qt.length;n++){var i=Qt[n];i.blockedOn===t&&(i.blockedOn=null)}}for(null!==$t&&pn($t,t),null!==en&&pn(en,t),null!==tn&&pn(tn,t),nn.forEach(e),rn.forEach(e),n=0;n<an.length;n++)(i=an[n]).blockedOn===t&&(i.blockedOn=null);for(;0<an.length&&null===(n=an[0]).blockedOn;)un(n),null===n.blockedOn&&an.shift()}var mn=$.ReactCurrentBatchConfig,gn=!0;function vn(e,t,n,i){var r=A,a=mn.transition;mn.transition=null;try{A=1,yn(e,t,n,i)}finally{A=r,mn.transition=a}}function _n(e,t,n,i){var r=A,a=mn.transition;mn.transition=null;try{A=4,yn(e,t,n,i)}finally{A=r,mn.transition=a}}function yn(e,t,n,i){if(gn){var r=An(e,0,0,i);if(null===r)ir(e,t,i,En,n),sn(e,i);else if(((e,t,n,i,r)=>{switch(t){case"focusin":return $t=ln($t,e,t,n,i,r),1;case"dragenter":return en=ln(en,e,t,n,i,r),1;case"mouseover":return tn=ln(tn,e,t,n,i,r),1;case"pointerover":var a=r.pointerId;return nn.set(a,ln(nn.get(a)||null,e,t,n,i,r)),1;case"gotpointercapture":return a=r.pointerId,rn.set(a,ln(rn.get(a)||null,e,t,n,i,r)),1}})(r,e,t,n,i))i.stopPropagation();else if(sn(e,i),4&t&&-1<on.indexOf(e)){for(;null!==r;){var a=Cr(r);if(null!==a&&Yt(a),null===(a=An(e,0,0,i))&&ir(e,t,i,En,n),a===r)break;r=a}null!==r&&i.stopPropagation()}else ir(e,t,i,null,n)}}var En=null;function An(e,t,n,i){if((En=null)!==(e=Ir(e=Je(i))))if(null===(t=gt(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=vt(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return En=e,null}function xn(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(St()){case wt:return 1;case bt:return 4;case Mt:case Rt:return 16;case Nt:return 536870912;default:return 16}default:return 16}}var Tn=null,Sn=null,wn=null;function bn(){if(wn)return wn;for(var e=Sn,t=e.length,n=("value"in Tn?Tn.value:Tn.textContent),i=n.length,r=0;r<t&&e[r]===n[r];r++);for(var a=t-r,o=1;o<=a&&e[t-o]===n[i-o];o++);return wn=n.slice(r,1<o?1-o:void 0)}function Mn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,32<=(e=10===e?13:e)||13===e?e:0}function Rn(){return!0}function Nn(){return!1}function In(o){function e(e,t,n,i,r){for(var a in this._reactName=e,this._targetInst=n,this.type=t,this.nativeEvent=i,this.target=r,this.currentTarget=null,o)o.hasOwnProperty(a)&&(e=o[a],this[a]=e?e(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?Rn:Nn,this.isPropagationStopped=Nn,this}return g(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Rn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Rn)},persist:function(){},isPersistent:Rn}),e}var Cn,Ln,Dn,e={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},On=In(e),t=g({},e,{view:0,detail:0}),Pn=In(t),i=g({},t,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Dn&&(Ln=Dn&&"mousemove"===e.type?(Cn=e.screenX-Dn.screenX,e.screenY-Dn.screenY):Cn=0,Dn=e),Cn)},movementY:function(e){return"movementY"in e?e.movementY:Ln}}),Un=In(i),Bn=In(g({},i,{dataTransfer:0})),Fn=In(g({},t,{relatedTarget:0})),zn=In(g({},e,{animationName:0,elapsedTime:0,pseudoElement:0})),kn=In(g({},e,{clipboardData:function(e){return("clipboardData"in e?e:window).clipboardData}})),Gn=In(g({},e,{data:0})),Hn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Vn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Wn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Wn[e])&&!!t[e]}function Yn(){return jn}var qn=In(g({},t,{key:function(e){if(e.key){var t=Hn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Mn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Vn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yn,charCode:function(e){return"keypress"===e.type?Mn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Mn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),Xn=In(g({},i,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Zn=In(g({},t,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yn})),Kn=In(g({},e,{propertyName:0,elapsedTime:0,pseudoElement:0})),Jn=In(g({},i,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Qn=[9,13,27,32],$n=U&&"CompositionEvent"in window,t=null,ei=(U&&"documentMode"in document&&(t=document.documentMode),U&&"TextEvent"in window&&!t),ti=U&&(!$n||t&&8<t&&t<=11),ni=String.fromCharCode(32),ii=!1;function ri(e,t){switch(e){case"keyup":return-1!==Qn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return 1;default:return}}function ai(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var oi=!1;var si={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function li(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?si[e.type]:"textarea"===t}function ui(e,t,n,i){nt(i),0<(t=ar(t,"onChange")).length&&(n=new On("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var ci=null,hi=null;function di(e){Qi(e,0)}function pi(e){if(Te(Lr(e)))return e}function fi(e,t){if("change"===e)return t}var mi=!1;function gi(){ci&&(ci.detachEvent("onpropertychange",vi),hi=ci=null)}function vi(e){var t;"value"===e.propertyName&&pi(hi)&&(ui(t=[],hi,e,Je(e)),st(di,t))}function _i(e,t,n){"focusin"===e?(gi(),hi=n,(ci=t).attachEvent("onpropertychange",vi)):"focusout"===e&&gi()}function yi(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return pi(hi)}function Ei(e,t){if("click"===e)return pi(t)}function Ai(e,t){if("input"===e||"change"===e)return pi(t)}U&&(t=U&&((e="oninput"in document)||((i=document.createElement("div")).setAttribute("oninput","return;"),e="function"==typeof i.oninput),e),mi=t&&(!document.documentMode||9<document.documentMode));var xi="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function Ti(e,t){if(!xi(e,t)){if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!j.call(t,r)||!xi(e[r],t[r]))return!1}}return!0}function Si(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function wi(e,t){var n,i=Si(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&t<=n)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Si(i)}}function bi(){for(var e=window,t=Se();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=Se((e=t.contentWindow).document)}return t}function Mi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function Ri(e){var t,n,i,r=bi(),a=e.focusedElem,o=e.selectionRange;if(r!==a&&a&&a.ownerDocument&&function e(t,n){return!(!t||!n)&&(t===n||(!t||3!==t.nodeType)&&(n&&3===n.nodeType?e(t,n.parentNode):"contains"in t?t.contains(n):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(n))))}(a.ownerDocument.documentElement,a)){null!==o&&Mi(a)&&(r=o.start,void 0===(e=o.end)&&(e=r),"selectionStart"in a?(a.selectionStart=r,a.selectionEnd=Math.min(e,a.value.length)):(e=(r=a.ownerDocument||document)&&r.defaultView||window).getSelection&&(e=e.getSelection(),n=a.textContent.length,t=Math.min(o.start,n),o=void 0===o.end?t:Math.min(o.end,n),!e.extend&&o<t&&(n=o,o=t,t=n),n=wi(a,t),i=wi(a,o),n)&&i&&(1!==e.rangeCount||e.anchorNode!==n.node||e.anchorOffset!==n.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&((r=r.createRange()).setStart(n.node,n.offset),e.removeAllRanges(),o<t?(e.addRange(r),e.extend(i.node,i.offset)):(r.setEnd(i.node,i.offset),e.addRange(r)))),r=[];for(e=a;e=e.parentNode;)1===e.nodeType&&r.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof a.focus&&a.focus(),a=0;a<r.length;a++)(e=r[a]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Ni=U&&"documentMode"in document&&document.documentMode<=11,Ii=null,Ci=null,Li=null,Di=!1;function Oi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;Di||null==Ii||Ii!==Se(i)||(i="selectionStart"in(i=Ii)&&Mi(i)?{start:i.selectionStart,end:i.selectionEnd}:{anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},Li&&Ti(Li,i))||(Li=i,0<(i=ar(Ci,"onSelect")).length&&(t=new On("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=Ii))}function Pi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ui={animationend:Pi("Animation","AnimationEnd"),animationiteration:Pi("Animation","AnimationIteration"),animationstart:Pi("Animation","AnimationStart"),transitionend:Pi("Transition","TransitionEnd")},Bi={},Fi={};function zi(e){if(Bi[e])return Bi[e];if(Ui[e]){var t,n=Ui[e];for(t in n)if(n.hasOwnProperty(t)&&t in Fi)return Bi[e]=n[t]}return e}U&&(Fi=document.createElement("div").style,"AnimationEvent"in window||(delete Ui.animationend.animation,delete Ui.animationiteration.animation,delete Ui.animationstart.animation),"TransitionEvent"in window||delete Ui.transitionend.transition);var ki=zi("animationend"),Gi=zi("animationiteration"),Hi=zi("animationstart"),Vi=zi("transitionend"),Wi=new Map,ji="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Yi(e,t){Wi.set(e,t),V(t,[e])}for(var qi=0;qi<ji.length;qi++){var Xi=ji[qi];Yi(Xi.toLowerCase(),"on"+(Xi[0].toUpperCase()+Xi.slice(1)))}Yi(ki,"onAnimationEnd"),Yi(Gi,"onAnimationIteration"),Yi(Hi,"onAnimationStart"),Yi("dblclick","onDoubleClick"),Yi("focusin","onFocus"),Yi("focusout","onBlur"),Yi(Vi,"onTransitionEnd"),W("onMouseEnter",["mouseout","mouseover"]),W("onMouseLeave",["mouseout","mouseover"]),W("onPointerEnter",["pointerout","pointerover"]),W("onPointerLeave",["pointerout","pointerover"]),V("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),V("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),V("onBeforeInput",["compositionend","keypress","textInput","paste"]),V("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),V("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),V("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ki=new Set("cancel close invalid load scroll toggle".split(" ").concat(Zi));function Ji(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(){var e;mt.apply(this,arguments),ct&&(e=ht,ct=!1,ht=null,dt||(dt=!0,pt=e))}(i,t,void 0,e),e.currentTarget=null}function Qi(e,t){t=0!=(4&t);for(var n=0;n<e.length;n++){var i=(r=e[n]).event,r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=(u=r[o]).instance,l=u.currentTarget,u=u.listener;if(s!==a&&i.isPropagationStopped())break e;Ji(i,u,l),a=s}else for(o=0;o<r.length;o++){if(s=(u=r[o]).instance,l=u.currentTarget,u=u.listener,s!==a&&i.isPropagationStopped())break e;Ji(i,u,l),a=s}}}if(dt)throw e=pt,dt=!1,pt=null,e}function c(e,t){var n=t[Mr],i=e+"__bubble";(n=void 0===n?t[Mr]=new Set:n).has(i)||(nr(t,e,2,!1),n.add(i))}function $i(e,t,n){var i=0;t&&(i|=4),nr(n,e,i,t)}var er="_reactListening"+Math.random().toString(36).slice(2);function tr(t){var e;t[er]||(t[er]=!0,G.forEach(function(e){"selectionchange"!==e&&(Ki.has(e)||$i(e,!1,t),$i(e,!0,t))}),null===(e=9===t.nodeType?t:t.ownerDocument))||e[er]||$i("selectionchange",!(e[er]=!0),e)}function nr(e,t,n,i){switch(xn(t)){case 1:var r=vn;break;case 4:r=_n;break;default:r=yn}n=r.bind(null,t,n,e),r=!ut||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t?void 0:!0,i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function ir(g,v,_,e,t){var y=e;if(0==(1&v)&&0==(2&v)&&null!==e)e:for(;;){if(null===e)return;var n=e.tag;if(3===n||4===n){var i=e.stateNode.containerInfo;if(i===t||8===i.nodeType&&i.parentNode===t)break;if(4===n)for(n=e.return;null!==n;){var r=n.tag;if((3===r||4===r)&&((r=n.stateNode.containerInfo)===t||8===r.nodeType&&r.parentNode===t))return;n=n.return}for(;null!==i;){if(null===(n=Ir(i)))return;if(5===(r=n.tag)||6===r){e=y=n;continue e}i=i.parentNode}}e=e.return}st(function(){var e,t,n,i=y,r=Je(_),a=[];e:{var o=Wi.get(g);if(void 0!==o){var s=On,l=g;switch(g){case"keypress":if(0===Mn(_))break e;case"keydown":case"keyup":s=qn;break;case"focusin":l="focus",s=Fn;break;case"focusout":l="blur",s=Fn;break;case"beforeblur":case"afterblur":s=Fn;break;case"click":if(2===_.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":s=Un;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":s=Bn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":s=Zn;break;case ki:case Gi:case Hi:s=zn;break;case Vi:s=Kn;break;case"scroll":s=Pn;break;case"wheel":s=Jn;break;case"copy":case"cut":case"paste":s=kn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":s=Xn}for(var u=!(h=0!=(4&v))&&"scroll"===g,c=h?null!==o?o+"Capture":null:o,h=[],d=i;null!==d;){var p,f=(p=d).stateNode;if(5===p.tag&&null!==f&&(p=f,null!==c)&&null!=(f=lt(d,c))&&h.push(rr(d,f,p)),u)break;d=d.return}0<h.length&&(o=new s(o,l,null,_,r),a.push({event:o,listeners:h}))}}if(0==(7&v)){if(s="mouseout"===g||"pointerout"===g,(!(o="mouseover"===g||"pointerover"===g)||_===Ke||!(l=_.relatedTarget||_.fromElement)||!Ir(l)&&!l[br])&&(s||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,s?(s=i,null!==(l=(l=_.relatedTarget||_.toElement)?Ir(l):null)&&(l!==(u=gt(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(s=null,l=i),s!==l)){if(h=Un,f="onMouseLeave",c="onMouseEnter",d="mouse","pointerout"!==g&&"pointerover"!==g||(h=Xn,f="onPointerLeave",c="onPointerEnter",d="pointer"),u=null==s?o:Lr(s),p=null==l?o:Lr(l),(o=new h(f,d+"leave",s,_,r)).target=u,o.relatedTarget=p,f=null,Ir(r)===i&&((h=new h(c,d+"enter",l,_,r)).target=p,h.relatedTarget=u,f=h),u=f,s&&l)e:{for(c=l,d=0,p=h=s;p;p=or(p))d++;for(p=0,f=c;f;f=or(f))p++;for(;0<d-p;)h=or(h),d--;for(;0<p-d;)c=or(c),p--;for(;d--;){if(h===c||null!==c&&h===c.alternate)break e;h=or(h),c=or(c)}h=null}else h=null;null!==s&&sr(a,o,s,h,!1),null!==l&&null!==u&&sr(a,u,l,h,!0)}switch("select"===(s=(o=i?Lr(i):window).nodeName&&o.nodeName.toLowerCase())||"input"===s&&"file"===o.type?e=fi:li(o)?mi?e=Ai:(e=yi,t=_i):!(s=o.nodeName)||"input"!==s.toLowerCase()||"checkbox"!==o.type&&"radio"!==o.type||(e=Ei),(e=e&&e(g,i))?ui(a,e,_,r):(t&&t(g,o,i),"focusout"===g&&(t=o._wrapperState)&&t.controlled&&"number"===o.type&&Ie(o,"number",o.value)),t=i?Lr(i):window,g){case"focusin":!li(t)&&"true"!==t.contentEditable||(Ii=t,Ci=i,Li=null);break;case"focusout":Li=Ci=Ii=null;break;case"mousedown":Di=!0;break;case"contextmenu":case"mouseup":case"dragend":Di=!1,Oi(a,_,r);break;case"selectionchange":if(Ni)break;case"keydown":case"keyup":Oi(a,_,r)}if($n)e:{switch(g){case"compositionstart":var m="onCompositionStart";break e;case"compositionend":m="onCompositionEnd";break e;case"compositionupdate":m="onCompositionUpdate";break e}m=void 0}else oi?ri(g,_)&&(m="onCompositionEnd"):"keydown"===g&&229===_.keyCode&&(m="onCompositionStart");m&&(ti&&"ko"!==_.locale&&(oi||"onCompositionStart"!==m?"onCompositionEnd"===m&&oi&&(n=bn()):(Sn="value"in(Tn=r)?Tn.value:Tn.textContent,oi=!0)),0<(t=ar(i,m)).length)&&(m=new Gn(m,g,null,_,r),a.push({event:m,listeners:t}),n||null!==(n=ai(_)))&&(m.data=n),(n=(ei?(e,t)=>{switch(e){case"compositionend":return ai(t);case"keypress":return 32!==t.which?null:(ii=!0,ni);case"textInput":return(e=t.data)===ni&&ii?null:e;default:return null}}:(e,t)=>{if(oi)return"compositionend"===e||!$n&&ri(e,t)?(e=bn(),wn=Sn=Tn=null,oi=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return ti&&"ko"!==t.locale?null:t.data;default:return null}})(g,_))&&0<(i=ar(i,"onBeforeInput")).length&&(r=new Gn("onBeforeInput","beforeinput",null,_,r),a.push({event:r,listeners:i}),r.data=n)}Qi(a,v)})}function rr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function ar(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,a=r.stateNode;5===r.tag&&null!==a&&(r=a,null!=(a=lt(e,n))&&i.unshift(rr(e,a,r)),null!=(a=lt(e,t)))&&i.push(rr(e,a,r)),e=e.return}return i}function or(e){if(null===e)return null;for(;(e=e.return)&&5!==e.tag;);return e||null}function sr(e,t,n,i,r){for(var a=t._reactName,o=[];null!==n&&n!==i;){var s=n,l=s.alternate,u=s.stateNode;if(null!==l&&l===i)break;5===s.tag&&null!==u&&(s=u,r?null!=(l=lt(n,a))&&o.unshift(rr(n,l,s)):null!=(l=lt(n,a))&&o.push(rr(n,l,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var lr=/\r\n?/g,ur=/\u0000|\uFFFD/g;function cr(e){return("string"==typeof e?e:""+e).replace(lr,"\n").replace(ur,"")}function hr(e,t,n){if(t=cr(t),cr(e)!==t&&n)throw Error(F(425))}function dr(){}var pr=null,fr=null;function mr(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var gr="function"==typeof setTimeout?setTimeout:void 0,vr="function"==typeof clearTimeout?clearTimeout:void 0,_r="function"==typeof Promise?Promise:void 0,yr="function"==typeof queueMicrotask?queueMicrotask:void 0!==_r?function(e){return _r.resolve(null).then(e).catch(Er)}:gr;function Er(e){setTimeout(function(){throw e})}function Ar(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void fn(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++}while(n=r);fn(t)}function xr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function Tr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var i=Math.random().toString(36).slice(2),Sr="__reactFiber$"+i,wr="__reactProps$"+i,br="__reactContainer$"+i,Mr="__reactEvents$"+i,Rr="__reactListeners$"+i,Nr="__reactHandles$"+i;function Ir(e){var t=e[Sr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[br]||n[Sr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Tr(e);null!==e;){if(n=e[Sr])return n;e=Tr(e)}return t}n=(e=n).parentNode}return null}function Cr(e){return!(e=e[Sr]||e[br])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Lr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(F(33))}function Dr(e){return e[wr]||null}var Or=[],Pr=-1;function Ur(e){return{current:e}}function u(e){Pr<0||(e.current=Or[Pr],Or[Pr]=null,Pr--)}function v(e,t){Or[++Pr]=e.current,e.current=t}var Br={},_=Ur(Br),y=Ur(!1),Fr=Br;function zr(e,t){var n=e.type.contextTypes;if(!n)return Br;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in n)a[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function E(e){return null!=(e=e.childContextTypes)}function kr(){u(y),u(_)}function Gr(e,t,n){if(_.current!==Br)throw Error(F(168));v(_,t),v(y,n)}function Hr(e,t,n){var i,r=e.stateNode;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(i in r=r.getChildContext())if(!(i in t))throw Error(F(108,ye(e)||"Unknown",i));return g({},n,r)}function Vr(e){e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Br,Fr=_.current,v(_,e),v(y,y.current)}function Wr(e,t,n){var i=e.stateNode;if(!i)throw Error(F(169));n?(e=Hr(e,t,Fr),i.__reactInternalMemoizedMergedChildContext=e,u(y),u(_),v(_,e)):u(y),v(y,n)}var jr=null,Yr=!1,qr=!1;function Xr(e){null===jr?jr=[e]:jr.push(e)}function Zr(){if(!qr&&null!==jr){qr=!0;var t=0,e=A;try{var n=jr;for(A=1;t<n.length;t++)for(var i=n[t];null!==(i=i(!0)););jr=null,Yr=!1}catch(e){throw null!==jr&&(jr=jr.slice(t+1)),Et(wt,Zr),e}finally{A=e,qr=!1}}return null}var Kr=[],Jr=0,Qr=null,$r=0,ea=[],ta=0,na=null,ia=1,ra="";function aa(e,t){Kr[Jr++]=$r,Kr[Jr++]=Qr,Qr=e,$r=t}function oa(e,t,n){ea[ta++]=ia,ea[ta++]=ra,ea[ta++]=na,na=e;var i,r=ia,a=(e=ra,32-Lt(r)-1),o=(r&=~(1<<a),n+=1,32-Lt(t)+a);ra=30<o?(o=(r&(1<<(i=a-a%5))-1).toString(32),r>>=i,a-=i,ia=1<<32-Lt(t)+a|n<<a|r,o+e):(ia=1<<o|n<<a|r,e)}function sa(e){null!==e.return&&(aa(e,1),oa(e,1,0))}function la(e){for(;e===Qr;)Qr=Kr[--Jr],Kr[Jr]=null,$r=Kr[--Jr],Kr[Jr]=null;for(;e===na;)na=ea[--ta],ea[ta]=null,ra=ea[--ta],ea[ta]=null,ia=ea[--ta],ea[ta]=null}var ua=null,x=null,z=!1,ca=null;function ha(e,t){var n=iu(5,null,null,0);n.elementType="DELETED",n.stateNode=t,null===(t=(n.return=e).deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function da(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ua=e,x=xr(t.firstChild),1);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ua=e,x=null,1);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==na?{id:ia,overflow:ra}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=iu(18,null,null,0)).stateNode=t,(n.return=e).child=n,ua=e,x=null,1);default:return}}function pa(e){return 0!=(1&e.mode)&&0==(128&e.flags)}function fa(e){if(z)if(x){var t=x;if(!da(e,x)){if(pa(e))throw Error(F(418));var n=xr(t.nextSibling),i=ua;n&&da(e,n)?ha(i,t):(e.flags=-4097&e.flags|2,z=!1,ua=e)}}else{if(pa(e))throw Error(F(418));e.flags=-4097&e.flags|2,z=!1,ua=e}}function ma(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ua=e}function ga(e){if(e!==ua)return!1;if(!z)return ma(e),!(z=!0);var t;if(t=(t=(t=3!==e.tag)&&!(t=5!==e.tag)?"head"!==(t=e.type)&&"body"!==t&&!mr(e.type,e.memoizedProps):t)&&x){if(pa(e))throw va(),Error(F(418));for(;t;)ha(e,t),t=xr(t.nextSibling)}if(ma(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(F(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){x=xr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}x=null}}else x=ua?xr(e.stateNode.nextSibling):null;return!0}function va(){for(var e=x;e;)e=xr(e.nextSibling)}function _a(){x=ua=null,z=!1}function ya(e){null===ca?ca=[e]:ca.push(e)}var Ea=$.ReactCurrentBatchConfig;function Aa(e,t){if(e&&e.defaultProps)for(var n in t=g({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}var xa=Ur(null),Ta=null,Sa=null,wa=null;function ba(){wa=Sa=Ta=null}function Ma(e){var t=xa.current;u(xa),e._currentValue=t}function Ra(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Na(e,t){(wa=Sa=null)!==(e=(Ta=e).dependencies)&&null!==e.firstContext&&(0!=(e.lanes&t)&&(M=!0),e.firstContext=null)}function Ia(e){var t=e._currentValue;if(wa!==e)if(e={context:e,memoizedValue:t,next:null},null===Sa){if(null===Ta)throw Error(F(308));Sa=e,Ta.dependencies={lanes:0,firstContext:e}}else Sa=Sa.next=e;return t}var Ca=null;function La(e){null===Ca?Ca=[e]:Ca.push(e)}function Da(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,La(t)):(n.next=r.next,r.next=n),t.interleaved=n,Oa(e,i)}function Oa(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),e=(n=e).return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),e=(n=e).return;return 3===n.tag?n.stateNode:null}var Pa=!1;function Ua(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ba(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Fa(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function za(e,t,n){var i,r=e.updateQueue;return null===r?null:(r=r.shared,0!=(2&C)?(null===(i=r.pending)?t.next=t:(t.next=i.next,i.next=t),r.pending=t):(null===(i=r.interleaved)?(t.next=t,La(r)):(t.next=i.next,i.next=t),r.interleaved=t),Oa(e,n))}function ka(e,t,n){var i;null!==(t=t.updateQueue)&&(t=t.shared,0!=(4194240&n))&&(i=t.lanes,i&=e.pendingLanes,Wt(e,t.lanes=n|=i))}function Ga(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null}}while(null===a?r=a=o:a=a.next=o,null!==(n=n.next));null===a?r=a=t:a=a.next=t}else r=a=t;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},e.updateQueue=n}else null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ha(e,t,n,i){var r,a,o=e.updateQueue,s=(Pa=!1,o.firstBaseUpdate),l=o.lastBaseUpdate;if(null!==(h=o.shared.pending)&&(o.shared.pending=null,a=(r=h).next,(r.next=null)===l?s=a:l.next=a,l=r,null!==(c=e.alternate))&&(h=(c=c.updateQueue).lastBaseUpdate)!==l&&(null===h?c.firstBaseUpdate=a:h.next=a,c.lastBaseUpdate=r),null!==s){for(var u=o.baseState,l=0,c=a=r=null,h=s;;){var d=h.lane,p=h.eventTime;if((i&d)===d){null!==c&&(c=c.next={eventTime:p,lane:0,tag:h.tag,payload:h.payload,callback:h.callback,next:null});e:{var f=e,m=h,d=t,p=n;switch(m.tag){case 1:if("function"==typeof(f=m.payload)){u=f.call(p,u,d);break e}u=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(d="function"==typeof(f=m.payload)?f.call(p,u,d):f))break e;u=g({},u,d);break e;case 2:Pa=!0}}null!==h.callback&&0!==h.lane&&(e.flags|=64,null===(d=o.effects)?o.effects=[h]:d.push(h))}else p={eventTime:p,lane:d,tag:h.tag,payload:h.payload,callback:h.callback,next:null},null===c?(a=c=p,r=u):c=c.next=p,l|=d;if(null===(h=h.next)){if(null===(h=o.shared.pending))break;h=(d=h).next,d.next=null,o.lastBaseUpdate=d,o.shared.pending=null}}if(null===c&&(r=u),o.baseState=r,o.firstBaseUpdate=a,o.lastBaseUpdate=c,null!==(t=o.shared.interleaved))for(o=t;l|=o.lane,(o=o.next)!==t;);else null===s&&(o.shared.lanes=0);gl|=l,e.lanes=l,e.memoizedState=u}}function Va(e,t,n){if(e=t.effects,(t.effects=null)!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!=typeof r)throw Error(F(191,r));r.call(i)}}}var Wa=(new B.Component).refs;function ja(e,t,n,i){n=null==(n=n(i,t=e.memoizedState))?t:g({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Ya={isMounted:function(e){return!!(e=e._reactInternals)&&gt(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=f(),r=Dl(e),a=Fa(i,r);a.payload=t,null!=n&&(a.callback=n),null!==(t=za(e,a,r))&&(Ol(t,e,r,i),ka(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=f(),r=Dl(e),a=Fa(i,r);a.tag=1,a.payload=t,null!=n&&(a.callback=n),null!==(t=za(e,a,r))&&(Ol(t,e,r,i),ka(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=f(),i=Dl(e),r=Fa(n,i);r.tag=2,null!=t&&(r.callback=t),null!==(t=za(e,r,i))&&(Ol(t,e,i,n),ka(t,e,i))}};function qa(e,t,n,i,r,a,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,a,o):!(t.prototype&&t.prototype.isPureReactComponent&&Ti(n,i)&&Ti(r,a))}function Xa(e,t,n){var i=!1,r=Br,a=t.contextType;t=new t(n,a="object"==typeof a&&null!==a?Ia(a):(r=E(t)?Fr:_.current,(i=null!=(i=t.contextTypes))?zr(e,r):Br)),e.memoizedState=null!=t.state?t.state:null,t.updater=Ya,(e.stateNode=t)._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=a)}function Za(e,t,n,i){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Ya.enqueueReplaceState(t,t.state,null)}function Ka(e,t,n,i){var r=e.stateNode,a=(r.props=n,r.state=e.memoizedState,r.refs=Wa,Ua(e),t.contextType);"object"==typeof a&&null!==a?r.context=Ia(a):(a=E(t)?Fr:_.current,r.context=zr(e,a)),r.state=e.memoizedState,"function"==typeof(a=t.getDerivedStateFromProps)&&(ja(e,0,a,n),r.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(t=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Ya.enqueueReplaceState(r,r.state,null),Ha(e,n,r,i),r.state=e.memoizedState),"function"==typeof r.componentDidMount&&(e.flags|=4194308)}function Ja(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(F(309));var i=n.stateNode}var r,a;if(i)return r=i,a=""+e,null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===a?t.ref:((t=function(e){var t=r.refs;t===Wa&&(t=r.refs={}),null===e?delete t[a]:t[a]=e})._stringRef=a,t);throw Error(F(147,e))}if("string"!=typeof e)throw Error(F(284));if(!n._owner)throw Error(F(290,e))}return e}function Qa(e,t){throw e=Object.prototype.toString.call(t),Error(F(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function $a(e){return(0,e._init)(e._payload)}function eo(R){function N(e,t){var n;R&&(null===(n=e.deletions)?(e.deletions=[t],e.flags|=16):n.push(t))}function I(e,t){if(R)for(;null!==t;)N(e,t),t=t.sibling;return null}function C(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function L(e,t){return(e=au(e,t)).index=0,e.sibling=null,e}function D(e,t,n){if(e.index=n,R){if(null!==(n=e.alternate))return(n=n.index)<t?(e.flags|=2,t):n;e.flags|=2}else e.flags|=1048576;return t}function O(e){return R&&null===e.alternate&&(e.flags|=2),e}function a(e,t,n,i){return null===t||6!==t.tag?(t=uu(n,e.mode,i)).return=e:(t=L(t,n)).return=e,t}function o(e,t,n,i){var r=n.type;return r===ne?l(e,t,n.props.children,i,n.key):(null!==t&&(t.elementType===r||"object"==typeof r&&null!==r&&r.$$typeof===he&&$a(r)===t.type)?(i=L(t,n.props)).ref=Ja(0,t,n):(i=ou(n.type,n.key,n.props,null,e.mode,i)).ref=Ja(0,t,n),i.return=e,i)}function s(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?(t=cu(n,e.mode,i)).return=e:(t=L(t,n.children||[])).return=e,t}function l(e,t,n,i,r){return null===t||7!==t.tag?(t=su(n,e.mode,i,r)).return=e:(t=L(t,n)).return=e,t}function P(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=uu(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case ee:return(n=ou(t.type,t.key,t.props,null,e.mode,n)).ref=Ja(0,null,t),n.return=e,n;case te:return(t=cu(t,e.mode,n)).return=e,t;case he:return P(e,(0,t._init)(t._payload),n)}if(Ce(t)||fe(t))return(t=su(t,e.mode,n,null)).return=e,t;Qa(0,t)}return null}function U(e,t,n,i){var r=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==r?null:a(e,t,""+n,i);if("object"==typeof n&&null!==n){switch(n.$$typeof){case ee:return n.key===r?o(e,t,n,i):null;case te:return n.key===r?s(e,t,n,i):null;case he:return U(e,t,(r=n._init)(n._payload),i)}if(Ce(n)||fe(n))return null!==r?null:l(e,t,n,i,null);Qa(0,n)}return null}function B(e,t,n,i,r){if("string"==typeof i&&""!==i||"number"==typeof i)return a(t,e=e.get(n)||null,""+i,r);if("object"==typeof i&&null!==i){switch(i.$$typeof){case ee:return o(t,e=e.get(null===i.key?n:i.key)||null,i,r);case te:return s(t,e=e.get(null===i.key?n:i.key)||null,i,r);case he:return B(e,t,n,(0,i._init)(i._payload),r)}if(Ce(i)||fe(i))return l(t,e=e.get(n)||null,i,r,null);Qa(0,i)}return null}return function e(t,n,i,r){if("object"==typeof(i="object"==typeof i&&null!==i&&i.type===ne&&null===i.key?i.props.children:i)&&null!==i){switch(i.$$typeof){case ee:e:{for(var a=i.key,o=n;null!==o;){if(o.key===a){if((a=i.type)===ne){if(7===o.tag){I(t,o.sibling),(n=L(o,i.props.children)).return=t,t=n;break e}}else if(o.elementType===a||"object"==typeof a&&null!==a&&a.$$typeof===he&&$a(a)===o.type){I(t,o.sibling),(n=L(o,i.props)).ref=Ja(0,o,i),n.return=t,t=n;break e}I(t,o);break}N(t,o),o=o.sibling}t=i.type===ne?((n=su(i.props.children,t.mode,r,i.key)).return=t,n):((r=ou(i.type,i.key,i.props,null,t.mode,r)).ref=Ja(0,n,i),r.return=t,r)}return O(t);case te:e:{for(o=i.key;null!==n;){if(n.key===o){if(4===n.tag&&n.stateNode.containerInfo===i.containerInfo&&n.stateNode.implementation===i.implementation){I(t,n.sibling),(n=L(n,i.children||[])).return=t,t=n;break e}I(t,n);break}N(t,n),n=n.sibling}(n=cu(i,t.mode,r)).return=t,t=n}return O(t);case he:return e(t,n,(o=i._init)(i._payload),r)}if(Ce(i)){for(var s=t,l=n,u=i,c=r,h=null,d=null,p=l,f=l=0,m=null;null!==p&&f<u.length;f++){p.index>f?(m=p,p=null):m=p.sibling;var g=U(s,p,u[f],c);if(null===g){null===p&&(p=m);break}R&&p&&null===g.alternate&&N(s,p),l=D(g,l,f),null===d?h=g:d.sibling=g,d=g,p=m}if(f===u.length)I(s,p);else if(null===p)for(;f<u.length;f++)null!==(p=P(s,u[f],c))&&(l=D(p,l,f),null===d?h=p:d.sibling=p,d=p);else{for(p=C(s,p);f<u.length;f++)null!==(m=B(p,s,f,u[f],c))&&(R&&null!==m.alternate&&p.delete(null===m.key?f:m.key),l=D(m,l,f),null===d?h=m:d.sibling=m,d=m);R&&p.forEach(function(e){return N(s,e)})}return z&&aa(s,f),h}if(fe(i)){var v=t,_=n,y=i,E=r,A=fe(y);if("function"!=typeof A)throw Error(F(150));if(null==(y=A.call(y)))throw Error(F(151));for(var x=A=null,T=_,S=_=0,w=null,b=y.next();null!==T&&!b.done;S++,b=y.next()){T.index>S?(w=T,T=null):w=T.sibling;var M=U(v,T,b.value,E);if(null===M){null===T&&(T=w);break}R&&T&&null===M.alternate&&N(v,T),_=D(M,_,S),null===x?A=M:x.sibling=M,x=M,T=w}if(b.done)I(v,T);else if(null===T)for(;!b.done;S++,b=y.next())null!==(b=P(v,b.value,E))&&(_=D(b,_,S),null===x?A=b:x.sibling=b,x=b);else{for(T=C(v,T);!b.done;S++,b=y.next())null!==(b=B(T,v,S,b.value,E))&&(R&&null!==b.alternate&&T.delete(null===b.key?S:b.key),_=D(b,_,S),null===x?A=b:x.sibling=b,x=b);R&&T.forEach(function(e){return N(v,e)})}return z&&aa(v,S),A}Qa(0,i)}return"string"==typeof i&&""!==i||"number"==typeof i?(i=""+i,(n=null!==n&&6===n.tag?(I(t,n.sibling),L(n,i)):(I(t,n),uu(i,t.mode,r))).return=t,O(t=n)):I(t,n)}}var to=eo(!0),no=eo(!1),io={},ro=Ur(io),ao=Ur(io),oo=Ur(io);function so(e){if(e===io)throw Error(F(174));return e}function lo(e,t){switch(v(oo,t),v(ao,e),v(ro,io),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Fe(null,"");break;default:t=Fe(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}u(ro),v(ro,t)}function uo(){u(ro),u(ao),u(oo)}function co(e){so(oo.current);var t=so(ro.current),n=Fe(t,e.type);t!==n&&(v(ao,e),v(ro,n))}function ho(e){ao.current===e&&(u(ro),u(ao))}var T=Ur(0);function po(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(128&t.flags))return t}else if(null!==t.child){t=(t.child.return=t).child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var fo=[];function mo(){for(var e=0;e<fo.length;e++)fo[e]._workInProgressVersionPrimary=null;fo.length=0}var go=$.ReactCurrentDispatcher,vo=$.ReactCurrentBatchConfig,_o=0,S=null,w=null,b=null,yo=!1,Eo=!1,Ao=0,xo=0;function r(){throw Error(F(321))}function To(e,t){if(null!==t){for(var n=0;n<t.length&&n<e.length;n++)if(!xi(e[n],t[n]))return;return 1}}function So(e,t,n,i,r,a){if(_o=a,(S=t).memoizedState=null,t.updateQueue=null,t.lanes=0,go.current=null===e||null===e.memoizedState?rs:as,e=n(i,r),Eo){a=0;do{if(Eo=!1,Ao=0,25<=a)throw Error(F(301))}while(a+=1,b=w=null,t.updateQueue=null,go.current=os,e=n(i,r),Eo)}if(go.current=is,t=null!==w&&null!==w.next,_o=0,b=w=S=null,yo=!1,t)throw Error(F(300));return e}function wo(){var e=0!==Ao;return Ao=0,e}function bo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===b?S.memoizedState=b=e:b=b.next=e,b}function Mo(){e=null===w?null!==(e=S.alternate)?e.memoizedState:null:w.next;var e,t=null===b?S.memoizedState:b.next;if(null!==t)b=t,w=e;else{if(null===e)throw Error(F(310));e={memoizedState:(w=e).memoizedState,baseState:w.baseState,baseQueue:w.baseQueue,queue:w.queue,next:null},null===b?S.memoizedState=b=e:b=b.next=e}return b}function Ro(e,t){return"function"==typeof t?t(e):t}function No(e){var t=Mo(),n=t.queue;if(null===n)throw Error(F(311));n.lastRenderedReducer=e;var i,r=(o=w).baseQueue;if(null!==(a=n.pending)&&(null!==r&&(i=r.next,r.next=a.next,a.next=i),o.baseQueue=r=a,n.pending=null),null!==r){var a=r.next,o=o.baseState,s=i=null,l=null,u=a;do{var c,h=u.lane}while((_o&h)===h?(null!==l&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),o=u.hasEagerState?u.eagerState:e(o,u.action)):(c={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===l?(s=l=c,i=o):l=l.next=c,S.lanes|=h,gl|=h),null!==(u=u.next)&&u!==a);null===l?i=o:l.next=s,xi(o,t.memoizedState)||(M=!0),t.memoizedState=o,t.baseState=i,t.baseQueue=l,n.lastRenderedState=o}if(null!==(e=n.interleaved))for(r=e;a=r.lane,S.lanes|=a,gl|=a,(r=r.next)!==e;);else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Io(e){var t=Mo(),n=t.queue;if(null===n)throw Error(F(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,a=t.memoizedState;if(null!==r){n.pending=null;for(var o=r=r.next;a=e(a,o.action),(o=o.next)!==r;);xi(a,t.memoizedState)||(M=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,i]}function Co(){}function Lo(e,t){var n=S,i=Mo(),r=t(),a=!xi(i.memoizedState,r);if(a&&(i.memoizedState=r,M=!0),i=i.queue,Wo(Po.bind(null,n,i,e),[e]),i.getSnapshot!==t||a||null!==b&&1&b.memoizedState.tag){if(n.flags|=2048,zo(9,Oo.bind(null,n,i,r,t),void 0,null),null===p)throw Error(F(349));0==(30&_o)&&Do(n,t,r)}return r}function Do(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=S.updateQueue)?(S.updateQueue=t={lastEffect:null,stores:null}).stores=[e]:null===(n=t.stores)?t.stores=[e]:n.push(e)}function Oo(e,t,n,i){t.value=n,t.getSnapshot=i,Uo(t)&&Bo(e)}function Po(e,t,n){return n(function(){Uo(t)&&Bo(e)})}function Uo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!xi(e,n)}catch(e){return 1}}function Bo(e){var t=Oa(e,1);null!==t&&Ol(t,e,1,-1)}function Fo(e){var t=bo();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(t.queue=e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ro,lastRenderedState:e}).dispatch=function(e,t,n){var i=Dl(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(es(e))ts(t,r);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o,s=t.lastRenderedState,l=a(s,n);if(r.hasEagerState=!0,r.eagerState=l,xi(l,s))return null===(o=t.interleaved)?(r.next=r,La(t)):(r.next=o.next,o.next=r),void(t.interleaved=r)}catch(e){}null!==(n=Da(e,t,r,i))&&(r=f(),Ol(n,e,i,r),ns(n,t,i))}}.bind(null,S,e),[t.memoizedState,e]}function zo(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=S.updateQueue)?(S.updateQueue=t={lastEffect:null,stores:null}).lastEffect=e.next=e:null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,(n.next=e).next=i,t.lastEffect=e),e}function ko(){return Mo().memoizedState}function Go(e,t,n,i){var r=bo();S.flags|=e,r.memoizedState=zo(1|t,n,void 0,void 0===i?null:i)}function Ho(e,t,n,i){var r=Mo(),a=(i=void 0===i?null:i,void 0);if(null!==w){var o=w.memoizedState,a=o.destroy;if(null!==i&&To(i,o.deps))return void(r.memoizedState=zo(t,n,a,i))}S.flags|=e,r.memoizedState=zo(1|t,n,a,i)}function Vo(e,t){return Go(8390656,8,e,t)}function Wo(e,t){return Ho(2048,8,e,t)}function jo(e,t){return Ho(4,2,e,t)}function Yo(e,t){return Ho(4,4,e,t)}function qo(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Xo(e,t,n){return n=null!=n?n.concat([e]):null,Ho(4,4,qo.bind(null,t,e),n)}function Zo(){}function Ko(e,t){var n=Mo(),i=(t=void 0===t?null:t,n.memoizedState);return null!==i&&null!==t&&To(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Jo(e,t){var n=Mo(),i=(t=void 0===t?null:t,n.memoizedState);return null!==i&&null!==t&&To(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Qo(e,t,n){return 0==(21&_o)?(e.baseState&&(e.baseState=!1,M=!0),e.memoizedState=n):(xi(n,t)||(n=Gt(),S.lanes|=n,gl|=n,e.baseState=!0),t)}function $o(){return Mo().memoizedState}function es(e){var t=e.alternate;return e===S||null!==t&&t===S}function ts(e,t){Eo=yo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function ns(e,t,n){var i;0!=(4194240&n)&&(i=t.lanes,i&=e.pendingLanes,Wt(e,t.lanes=n|=i))}var is={readContext:Ia,useCallback:r,useContext:r,useEffect:r,useImperativeHandle:r,useInsertionEffect:r,useLayoutEffect:r,useMemo:r,useReducer:r,useRef:r,useState:r,useDebugValue:r,useDeferredValue:r,useTransition:r,useMutableSource:r,useSyncExternalStore:r,useId:r,unstable_isNewReconciler:!1},rs={readContext:Ia,useCallback:function(e,t){return bo().memoizedState=[e,void 0===t?null:t],e},useContext:Ia,useEffect:Vo,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,Go(4194308,4,qo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Go(4194308,4,e,t)},useInsertionEffect:function(e,t){return Go(4,2,e,t)},useMemo:function(e,t){var n=bo();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=bo();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e=(i.queue=e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=function(e,t,n){var i=Dl(e);n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},es(e)?ts(t,n):null!==(n=Da(e,t,n,i))&&(Ol(n,e,i,f()),ns(n,t,i))}.bind(null,S,e),[i.memoizedState,e]},useRef:function(e){return bo().memoizedState=e={current:e}},useState:Fo,useDebugValue:Zo,useDeferredValue:function(e){return bo().memoizedState=e},useTransition:function(){var e=(t=Fo(!1))[0],t=function(e,t){var n=A,i=(A=0!==n&&n<4?n:4,e(!0),vo.transition);vo.transition={};try{e(!1),t()}finally{A=n,vo.transition=i}}.bind(null,t[1]);return[e,bo().memoizedState=t]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=S,r=bo();if(z){if(void 0===n)throw Error(F(407));n=n()}else{if(n=t(),null===p)throw Error(F(349));0==(30&_o)&&Do(i,t,n)}var a={value:r.memoizedState=n,getSnapshot:t};return Vo(Po.bind(null,i,r.queue=a,e),[e]),i.flags|=2048,zo(9,Oo.bind(null,i,a,n,t),void 0,null),n},useId:function(){var e,t=bo(),n=p.identifierPrefix;return z?(e=ra,n=":"+n+"R"+(e=(ia&~(1<<32-Lt(ia)-1)).toString(32)+e),0<(e=Ao++)&&(n+="H"+e.toString(32)),n+=":"):n=":"+n+"r"+(e=xo++).toString(32)+":",t.memoizedState=n},unstable_isNewReconciler:!1},as={readContext:Ia,useCallback:Ko,useContext:Ia,useEffect:Wo,useImperativeHandle:Xo,useInsertionEffect:jo,useLayoutEffect:Yo,useMemo:Jo,useReducer:No,useRef:ko,useState:function(){return No(Ro)},useDebugValue:Zo,useDeferredValue:function(e){return Qo(Mo(),w.memoizedState,e)},useTransition:function(){return[No(Ro)[0],Mo().memoizedState]},useMutableSource:Co,useSyncExternalStore:Lo,useId:$o,unstable_isNewReconciler:!1},os={readContext:Ia,useCallback:Ko,useContext:Ia,useEffect:Wo,useImperativeHandle:Xo,useInsertionEffect:jo,useLayoutEffect:Yo,useMemo:Jo,useReducer:Io,useRef:ko,useState:function(){return Io(Ro)},useDebugValue:Zo,useDeferredValue:function(e){var t=Mo();return null===w?t.memoizedState=e:Qo(t,w.memoizedState,e)},useTransition:function(){return[Io(Ro)[0],Mo().memoizedState]},useMutableSource:Co,useSyncExternalStore:Lo,useId:$o,unstable_isNewReconciler:!1};function ss(e,t){try{for(var n="",i=t;n+=(e=>{switch(e.tag){case 5:return ge(e.type);case 16:return ge("Lazy");case 13:return ge("Suspense");case 19:return ge("SuspenseList");case 0:case 2:case 15:return e=_e(e.type,!1);case 11:return e=_e(e.type.render,!1);case 1:return e=_e(e.type,!0);default:return""}})(i),i=i.return;);var r=n}catch(e){r="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:r,digest:null}}function ls(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function us(e,t){try{console.error(t.value)}catch(e){setTimeout(function(){throw e})}}var cs="function"==typeof WeakMap?WeakMap:Map;function hs(e,t,n){(n=Fa(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Tl||(Tl=!0,Sl=i),us(0,t)},n}function ds(e,t,n){(n=Fa(-1,n)).tag=3;var i,r=e.type.getDerivedStateFromError,e=("function"==typeof r&&(i=t.value,n.payload=function(){return r(i)},n.callback=function(){us(0,t)}),e.stateNode);return null!==e&&"function"==typeof e.componentDidCatch&&(n.callback=function(){us(0,t),"function"!=typeof r&&(null===wl?wl=new Set([this]):wl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ps(e,t,n){var i,r=e.pingCache;null===r?(r=e.pingCache=new cs,i=new Set,r.set(t,i)):void 0===(i=r.get(t))&&(i=new Set,r.set(t,i)),i.has(n)||(i.add(n),e=function(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=f(),e.pingedLanes|=e.suspendedLanes&n,p===e&&(D&n)===n&&(4===O||3===O&&(130023424&D)===D&&m()-El<500?Wl(e,0):_l|=n),Pl(e,t)}.bind(null,e,t,n),t.then(e,e))}function fs(e){do{var t;if(t=(t=13===e.tag)?null===(t=e.memoizedState)||null!==t.dehydrated:t)return e}while(null!==(e=e.return));return null}function ms(e,t,n,i,r){if(0==(1&e.mode))return e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Fa(-1,1)).tag=2,za(n,t,1))),n.lanes|=1);e.flags|=65536,e.lanes=r}var gs=$.ReactCurrentOwner,M=!1;function R(e,t,n,i){t.child=null===e?no(t,null,n,i):to(t,e.child,n,i)}function vs(e,t,n,i,r){n=n.render;var a=t.ref;return Na(t,r),i=So(e,t,n,i,a,r),n=wo(),null===e||M?(z&&n&&sa(t),t.flags|=1,R(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Us(e,t,r))}function _s(e,t,n,i,r){var a;if(null===e)return"function"!=typeof(a=n.type)||ru(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=ou(n.type,null,i,t,t.mode,r)).ref=t.ref,(e.return=t).child=e):(t.tag=15,t.type=a,ys(e,t,a,i,r));if(a=e.child,0==(e.lanes&r)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:Ti)(o,i)&&e.ref===t.ref)return Us(e,t,r)}return t.flags|=1,(e=au(a,i)).ref=t.ref,(e.return=t).child=e}function ys(e,t,n,i,r){if(null!==e){var a=e.memoizedProps;if(Ti(a,i)&&e.ref===t.ref){if(M=!1,t.pendingProps=i=a,0==(e.lanes&r))return t.lanes=e.lanes,Us(e,t,r);0!=(131072&e.flags)&&(M=!0)}}return xs(e,t,n,i,r)}function Es(e,t,n){var i=t.pendingProps,r=i.children,a=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0==(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},v(fl,pl),pl|=n;else{if(0==(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,v(fl,pl),pl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==a?a.baseLanes:n,v(fl,pl),pl|=i}else null!==a?(i=a.baseLanes|n,t.memoizedState=null):i=n,v(fl,pl),pl|=i;return R(e,t,r,n),t.child}function As(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function xs(e,t,n,i,r){var a=zr(t,E(n)?Fr:_.current);return Na(t,r),n=So(e,t,n,i,a,r),i=wo(),null===e||M?(z&&i&&sa(t),t.flags|=1,R(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Us(e,t,r))}function Ts(e,t,n,i,r){var a,o,s,l,u,c,h,d,p,f;return E(n)?(a=!0,Vr(t)):a=!1,Na(t,r),i=null===t.stateNode?(Ps(e,t),Xa(t,n,i),Ka(t,n,i,r),!0):null===e?((o=t.stateNode).props=s=t.memoizedProps,d=o.context,l="object"==typeof(l=n.contextType)&&null!==l?Ia(l):zr(t,l=E(n)?Fr:_.current),(c="function"==typeof(u=n.getDerivedStateFromProps)||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||s===i&&d===l||Za(0,o,i,l),Pa=!1,o.state=h=t.memoizedState,Ha(t,i,o,r),d=t.memoizedState,s!==i||h!==d||y.current||Pa?("function"==typeof u&&(ja(t,0,u,i),d=t.memoizedState),(s=Pa||qa(t,n,s,i,h,d,l))?(c||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(t.flags|=4194308)):("function"==typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=d),o.props=i,o.state=d,o.context=l,s):("function"==typeof o.componentDidMount&&(t.flags|=4194308),!1)):(o=t.stateNode,Ba(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:Aa(t.type,s),o.props=l,c=t.pendingProps,h=o.context,d="object"==typeof(d=n.contextType)&&null!==d?Ia(d):zr(t,d=E(n)?Fr:_.current),(u="function"==typeof(p=n.getDerivedStateFromProps)||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||s===c&&h===d||Za(0,o,i,d),Pa=!1,o.state=h=t.memoizedState,Ha(t,i,o,r),f=t.memoizedState,s!==c||h!==f||y.current||Pa?("function"==typeof p&&(ja(t,0,p,i),f=t.memoizedState),(l=Pa||qa(t,n,l,i,h,f,d)||!1)?(u||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(i,f,d),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,f,d)),"function"==typeof o.componentDidUpdate&&(t.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),o.props=i,o.state=f,o.context=d,l):("function"!=typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),!1)),Ss(e,t,n,i,a,r)}function Ss(e,t,n,i,r,a){As(e,t);var o=0!=(128&t.flags);if(!i&&!o)return r&&Wr(t,n,!1),Us(e,t,a);i=t.stateNode,gs.current=t;var s=o&&"function"!=typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&o?(t.child=to(t,e.child,null,a),t.child=to(t,null,s,a)):R(e,t,s,a),t.memoizedState=i.state,r&&Wr(t,n,!0),t.child}function ws(e){var t=e.stateNode;t.pendingContext?Gr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Gr(0,t.context,!1),lo(e,t.containerInfo)}function bs(e,t,n,i,r){return _a(),ya(r),t.flags|=256,R(e,t,n,i),t.child}var Ms={dehydrated:null,treeContext:null,retryLane:0};function Rs(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ns(e,t,n){var i,r,a=t.pendingProps,o=T.current,s=!1,l=0!=(128&t.flags);if((r=(r=l)||(null===e||null!==e.memoizedState)&&0!=(2&o))?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),v(T,1&o),null===e)return fa(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0==(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=a.children,e=a.fallback,s?(a=t.mode,s=t.child,l={mode:"hidden",children:l},0==(1&a)&&null!==s?(s.childLanes=0,s.pendingProps=l):s=lu(l,a,0,null),e=su(e,a,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Rs(n),t.memoizedState=Ms,e):Is(t,l));if(null===(o=e.memoizedState)||null===(r=o.dehydrated))return s?(s=a.fallback,l=t.mode,r=(o=e.child).sibling,u={mode:"hidden",children:a.children},0==(1&l)&&t.child!==o?((a=t.child).childLanes=0,a.pendingProps=u,t.deletions=null):(a=au(o,u)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=au(r,s):(s=su(s,l,n,null)).flags|=2,s.return=t,a.return=t,a.sibling=s,t.child=a,a=s,l=null===(l=e.child.memoizedState)?Rs(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},(s=t.child).memoizedState=l,s.childLanes=e.childLanes&~n,t.memoizedState=Ms):(e=(s=e.child).sibling,a=au(s,{mode:"visible",children:a.children}),0==(1&t.mode)&&(a.lanes=n),a.return=t,(a.sibling=null)!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=a,t.memoizedState=null),a;var u=e,s=t,e=a,c=r,t=o,a=n;if(l)return 256&s.flags?(s.flags&=-257,e=ls(Error(F(422))),Cs(u,s,a,e)):null!==s.memoizedState?(s.child=u.child,s.flags|=128,null):(t=e.fallback,c=s.mode,e=lu({mode:"visible",children:e.children},c,0,null),(t=su(t,c,a,null)).flags|=2,e.return=s,t.return=s,e.sibling=t,s.child=e,0!=(1&s.mode)&&to(s,u.child,null,a),s.child.memoizedState=Rs(a),s.memoizedState=Ms,t);if(0==(1&s.mode))return Cs(u,s,a,null);if("$!"===c.data)return e=i=(e=c.nextSibling&&c.nextSibling.dataset)?e.dgst:i,t=Error(F(419)),e=ls(t,e,void 0),Cs(u,s,a,e);if(i=0!=(a&u.childLanes),M||i){if(null!==(e=p)){switch(a&-a){case 4:c=2;break;case 16:c=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:c=32;break;case 536870912:c=268435456;break;default:c=0}0!==(c=0!=(c&(e.suspendedLanes|a))?0:c)&&c!==t.retryLane&&(t.retryLane=c,Oa(u,c),Ol(e,u,c,-1))}return ql(),e=ls(Error(F(421))),Cs(u,s,a,e)}return"$?"===c.data?(s.flags|=128,s.child=u.child,s=function(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),eu(e,n)}.bind(null,u),c._reactRetry=s,null):(u=t.treeContext,x=xr(c.nextSibling),ua=s,z=!0,(ca=null)!==u&&(ea[ta++]=ia,ea[ta++]=ra,ea[ta++]=na,ia=u.id,ra=u.overflow,na=s),(s=Is(s,e.children)).flags|=4096,s)}function Is(e,t){return((t=lu({mode:"visible",children:t},e.mode,0,null)).return=e).child=t}function Cs(e,t,n,i){return null!==i&&ya(i),to(t,e.child,null,n),(e=Is(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Ls(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Ra(e.return,t,n)}function Ds(e,t,n,i,r){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=r)}function Os(e,t,n){var i=t.pendingProps,r=i.revealOrder,a=i.tail;if(R(e,t,i.children,n),0!=(2&(i=T.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!=(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ls(e,n,t);else if(19===e.tag)Ls(e,n,t);else if(null!==e.child){e=(e.child.return=e).child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(v(T,i),0==(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===po(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Ds(t,!1,r,n,a);break;case"backwards":for(r=t.child,t.child=n=null;null!==r;){if(null!==(e=r.alternate)&&null===po(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Ds(t,!0,n,null,a);break;case"together":Ds(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ps(e,t){0==(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Us(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),gl|=t.lanes,0==(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(F(153));if(null!==t.child){for(n=au(e=t.child,e.pendingProps),(t.child=n).return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=au(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Bs(e,t){if(!z)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":for(var n=e.tail,i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function h(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i=(i|=14680064&r.subtreeFlags)|14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i=(i|=r.subtreeFlags)|r.flags,r.return=e,r=r.sibling;e.subtreeFlags|=i,e.childLanes=n}var Fs=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n=(n.child.return=n).child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},zs=function(){},ks=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,so(ro.current);var a,o=null;switch(n){case"input":r=we(e,r),i=we(e,i),o=[];break;case"select":r=g({},r,{value:void 0}),i=g({},i,{value:void 0}),o=[];break;case"textarea":r=De(e,r),i=De(e,i),o=[];break;default:"function"!=typeof r.onClick&&"function"==typeof i.onClick&&(e.onclick=dr)}for(u in Xe(n,i),n=null,r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var s=r[u];for(a in s)s.hasOwnProperty(a)&&(n=n||{},n[a]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(H.hasOwnProperty(u)?o=o||[]:(o=o||[]).push(u,null));for(u in i){var l=i[u],s=null!=r?r[u]:void 0;if(i.hasOwnProperty(u)&&l!==s&&(null!=l||null!=s))if("style"===u)if(s){for(a in s)!s.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n=n||{},n[a]="");for(a in l)l.hasOwnProperty(a)&&s[a]!==l[a]&&(n=n||{},n[a]=l[a])}else n||(o=o||[]).push(u,n),n=l;else"dangerouslySetInnerHTML"===u?(l=l?l.__html:void 0,s=s?s.__html:void 0,null!=l&&s!==l&&(o=o||[]).push(u,l)):"children"===u?"string"!=typeof l&&"number"!=typeof l||(o=o||[]).push(u,""+l):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(H.hasOwnProperty(u)?(null!=l&&"onScroll"===u&&c("scroll",e),o||s===l||(o=[])):(o=o||[]).push(u,l))}n&&(o=o||[]).push("style",n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}},Gs=function(e,t,n,i){n!==i&&(t.flags|=4)},Hs=!1,N=!1,Vs="function"==typeof WeakSet?WeakSet:Set,I=null;function Ws(t,n){var e=t.ref;if(null!==e)if("function"==typeof e)try{e(null)}catch(e){P(t,n,e)}else e.current=null}function js(t,n,e){try{e()}catch(e){P(t,n,e)}}var Ys=!1;function qs(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r,a=i=i.next;do{}while((a.tag&e)===e&&(r=a.destroy,(a.destroy=void 0)!==r)&&js(t,n,r),(a=a.next)!==i)}}function Xs(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n,i=t=t.next;do{}while((i.tag&e)===e&&(n=i.create,i.destroy=n()),(i=i.next)!==t)}}function Zs(e){var t=e.ref;null!==t&&(e=e.stateNode,"function"==typeof t?t(e):t.current=e)}function Ks(e){return 5===e.tag||3===e.tag||4===e.tag}function Js(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Ks(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e=(e.child.return=e).child}if(!(2&e.flags))return e.stateNode}}var d=null,Qs=!1;function $s(e,t,n){for(n=n.child;null!==n;)el(e,t,n),n=n.sibling}function el(e,t,n){if(Ct&&"function"==typeof Ct.onCommitFiberUnmount)try{Ct.onCommitFiberUnmount(It,n)}catch(e){}switch(n.tag){case 5:N||Ws(n,t);case 6:var i=d,r=Qs;d=null,$s(e,t,n),Qs=r,null!==(d=i)&&(Qs?(e=d,n=n.stateNode,(8===e.nodeType?e.parentNode:e).removeChild(n)):d.removeChild(n.stateNode));break;case 18:null!==d&&(Qs?(e=d,n=n.stateNode,8===e.nodeType?Ar(e.parentNode,n):1===e.nodeType&&Ar(e,n),fn(e)):Ar(d,n.stateNode));break;case 4:i=d,r=Qs,d=n.stateNode.containerInfo,Qs=!0,$s(e,t,n),d=i,Qs=r;break;case 0:case 11:case 14:case 15:if(!N&&null!==(i=n.updateQueue)&&null!==(i=i.lastEffect)){r=i=i.next;do{var a=r.destroy,o=r.tag}while(void 0===a||0==(2&o)&&0==(4&o)||js(n,t,a),(r=r.next)!==i)}$s(e,t,n);break;case 1:if(!N&&(Ws(n,t),"function"==typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(e){P(n,t,e)}$s(e,t,n);break;case 21:$s(e,t,n);break;case 22:1&n.mode?(N=(i=N)||null!==n.memoizedState,$s(e,t,n),N=i):$s(e,t,n);break;default:$s(e,t,n)}}function tl(n){var i,e=n.updateQueue;null!==e&&((n.updateQueue=null)===(i=n.stateNode)&&(i=n.stateNode=new Vs),e.forEach(function(e){var t=function(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(F(314))}null!==i&&i.delete(t),eu(e,n)}.bind(null,n,e);i.has(e)||(i.add(e),e.then(t,t))}))}function nl(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var a=e,o=t,s=o;e:for(;null!==s;){switch(s.tag){case 5:d=s.stateNode,Qs=!1;break e;case 3:case 4:d=s.stateNode.containerInfo,Qs=!0;break e}s=s.return}if(null===d)throw Error(F(160));el(a,o,r),d=null,Qs=!1;var l=r.alternate;null!==l&&(l.return=null),r.return=null}catch(e){P(r,t,e)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)il(t,e),t=t.sibling}function il(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(nl(e,t),rl(t),4&i){try{qs(3,t,t.return),Xs(3,t)}catch(e){P(t,t.return,e)}try{qs(5,t,t.return)}catch(e){P(t,t.return,e)}}break;case 1:nl(e,t),rl(t),512&i&&null!==n&&Ws(n,n.return);break;case 5:if(nl(e,t),rl(t),512&i&&null!==n&&Ws(n,n.return),32&t.flags){var r=t.stateNode;try{He(r,"")}catch(e){P(t,t.return,e)}}if(4&i&&null!=(r=t.stateNode)){var a=t.memoizedProps,o=null!==n?n.memoizedProps:a,s=t.type,l=t.updateQueue;if((t.updateQueue=null)!==l)try{"input"===s&&"radio"===a.type&&null!=a.name&&Me(r,a),Ze(s,o);for(var u=Ze(s,a),o=0;o<l.length;o+=2){var c=l[o],h=l[o+1];"style"===c?Ye(r,h):"dangerouslySetInnerHTML"===c?Ge(r,h):"children"===c?He(r,h):Q(r,c,h,u)}switch(s){case"input":Re(r,a);break;case"textarea":Pe(r,a);break;case"select":var d=r._wrapperState.wasMultiple,p=(r._wrapperState.wasMultiple=!!a.multiple,a.value);null!=p?Le(r,!!a.multiple,p,!1):d!==!!a.multiple&&(null!=a.defaultValue?Le(r,!!a.multiple,a.defaultValue,!0):Le(r,!!a.multiple,a.multiple?[]:"",!1))}r[wr]=a}catch(e){P(t,t.return,e)}}break;case 6:if(nl(e,t),rl(t),4&i){if(null===t.stateNode)throw Error(F(162));r=t.stateNode,a=t.memoizedProps;try{r.nodeValue=a}catch(e){P(t,t.return,e)}}break;case 3:if(nl(e,t),rl(t),4&i&&null!==n&&n.memoizedState.isDehydrated)try{fn(e.containerInfo)}catch(e){P(t,t.return,e)}break;case 4:nl(e,t),rl(t);break;case 13:nl(e,t),rl(t),8192&(r=t.child).flags&&(a=null!==r.memoizedState,!(r.stateNode.isHidden=a)||null!==r.alternate&&null!==r.alternate.memoizedState||(El=m())),4&i&&tl(t);break;case 22:if(c=null!==n&&null!==n.memoizedState,1&t.mode?(N=(u=N)||c,nl(e,t),N=u):nl(e,t),rl(t),8192&i){if(u=null!==t.memoizedState,(t.stateNode.isHidden=u)&&!c&&0!=(1&t.mode))for(c=(I=t).child;null!==c;){for(h=I=c;null!==I;){switch(p=(d=I).child,d.tag){case 0:case 11:case 14:case 15:qs(4,d,d.return);break;case 1:Ws(d,d.return);var f=d.stateNode;if("function"==typeof f.componentWillUnmount){n=(i=d).return;try{e=i,f.props=e.memoizedProps,f.state=e.memoizedState,f.componentWillUnmount()}catch(e){P(i,n,e)}}break;case 5:Ws(d,d.return);break;case 22:if(null!==d.memoizedState){sl(h);continue}}null!==p?(p.return=d,I=p):sl(h)}c=c.sibling}e:for(c=null,h=t;;){if(5===h.tag){if(null===c){c=h;try{r=h.stateNode,u?"function"==typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none":(s=h.stateNode,o=null!=(l=h.memoizedProps.style)&&l.hasOwnProperty("display")?l.display:null,s.style.display=je("display",o))}catch(e){P(t,t.return,e)}}}else if(6===h.tag){if(null===c)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(e){P(t,t.return,e)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===t)&&null!==h.child){h=(h.child.return=h).child;continue}if(h===t)break;for(;null===h.sibling;){if(null===h.return||h.return===t)break e;c===h&&(c=null),h=h.return}c===h&&(c=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:nl(e,t),rl(t),4&i&&tl(t);break;case 21:break;default:nl(e,t),rl(t)}}function rl(t){var e=t.flags;if(2&e){try{e:{for(var n=t.return;null!==n;){if(Ks(n)){var i=n;break e}n=n.return}throw Error(F(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(He(r,""),i.flags&=-33),!function e(t,n,i){var r=t.tag;if(5===r||6===r)t=t.stateNode,n?i.insertBefore(t,n):i.appendChild(t);else if(4!==r&&null!==(t=t.child))for(e(t,n,i),t=t.sibling;null!==t;)e(t,n,i),t=t.sibling}(t,Js(t),r);break;case 3:case 4:var a=i.stateNode.containerInfo;!function e(t,n,i){var r=t.tag;if(5===r||6===r)t=t.stateNode,n?(8===i.nodeType?i.parentNode:i).insertBefore(t,n):(8===i.nodeType?(n=i.parentNode).insertBefore(t,i):(n=i).appendChild(t),null==(i=i._reactRootContainer)&&null===n.onclick&&(n.onclick=dr));else if(4!==r&&null!==(t=t.child))for(e(t,n,i),t=t.sibling;null!==t;)e(t,n,i),t=t.sibling}(t,Js(t),a);break;default:throw Error(F(161))}}catch(e){P(t,t.return,e)}t.flags&=-3}4096&e&&(t.flags&=-4097)}function al(e,t,n){!function e(t,n,i){for(var r=0!=(1&t.mode);null!==I;){var a=I,o=a.child;if(22===a.tag&&r){var s=null!==a.memoizedState||Hs;if(!s){var l=a.alternate,u=null!==l&&null!==l.memoizedState||N,c=(l=Hs,N);if(Hs=s,(N=u)&&!c)for(I=a;null!==I;)u=(s=I).child,(22!==s.tag||null===s.memoizedState)&&null!==u?(u.return=s,I=u):ll(a);for(;null!==o;)e(I=o,n,i),o=o.sibling;I=a,Hs=l,N=c}ol(t)}else 0!=(8772&a.subtreeFlags)&&null!==o?(o.return=a,I=o):ol(t)}}(I=e,t,n)}function ol(e){for(;null!==I;){var t=I;if(0!=(8772&t.flags)){var n,i,r,a=t.alternate;try{if(0!=(8772&t.flags))switch(t.tag){case 0:case 11:case 15:N||Xs(5,t);break;case 1:var o,s=t.stateNode,l=(4&t.flags&&!N&&(null===a?s.componentDidMount():(o=t.elementType===t.type?a.memoizedProps:Aa(t.type,a.memoizedProps),s.componentDidUpdate(o,a.memoizedState,s.__reactInternalSnapshotBeforeUpdate))),t.updateQueue);null!==l&&Va(0,l,s);break;case 3:var u=t.updateQueue;if(null!==u){if((a=null)!==t.child)switch(t.child.tag){case 5:case 1:a=t.child.stateNode}Va(0,u,a)}break;case 5:var c=t.stateNode;if(null===a&&4&t.flags){var a=c,h=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":h.autoFocus&&a.focus();break;case"img":h.src&&(a.src=h.src)}}break;case 6:case 4:case 12:break;case 13:null===t.memoizedState&&null!==(n=t.alternate)&&null!==(i=n.memoizedState)&&null!==(r=i.dehydrated)&&fn(r);break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(F(163))}N||512&t.flags&&Zs(t)}catch(e){P(t,t.return,e)}}if(t===e){I=null;break}if(null!==(a=t.sibling)){a.return=t.return,I=a;break}I=t.return}}function sl(e){for(;null!==I;){var t=I;if(t===e){I=null;break}var n=t.sibling;if(null!==n){n.return=t.return,I=n;break}I=t.return}}function ll(e){for(;null!==I;){var t=I;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Xs(4,t)}catch(e){P(t,n,e)}break;case 1:var i=t.stateNode;if("function"==typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(e){P(t,r,e)}}var a=t.return;try{Zs(t)}catch(e){P(t,a,e)}break;case 5:var o=t.return;try{Zs(t)}catch(e){P(t,o,e)}}}catch(e){P(t,t.return,e)}if(t===e){I=null;break}var s=t.sibling;if(null!==s){s.return=t.return,I=s;break}I=t.return}}var ul=Math.ceil,cl=$.ReactCurrentDispatcher,hl=$.ReactCurrentOwner,dl=$.ReactCurrentBatchConfig,C=0,p=null,L=null,D=0,pl=0,fl=Ur(0),O=0,ml=null,gl=0,vl=0,_l=0,yl=null,s=null,El=0,Al=1/0,xl=null,Tl=!1,Sl=null,wl=null,bl=!1,Ml=null,Rl=0,Nl=0,Il=null,Cl=-1,Ll=0;function f(){return 0!=(6&C)?m():-1!==Cl?Cl:Cl=m()}function Dl(e){return 0==(1&e.mode)?1:0!=(2&C)&&0!==D?D&-D:null!==Ea.transition?Ll=0===Ll?Gt():Ll:0===(e=A)?void 0===(e=window.event)?16:xn(e.type):e}function Ol(e,t,n,i){if(50<Nl)throw Nl=0,Il=null,Error(F(185));Vt(e,n,i),0!=(2&C)&&e===p||(e===p&&(0==(2&C)&&(vl|=n),4===O)&&zl(e,D),Pl(e,i),1===n&&0===C&&0==(1&t.mode)&&(Al=m()+500,Yr)&&Zr())}function Pl(e,t){var n,i=e.callbackNode,r=(zt(e,t),Ft(e,e===p?D:0));if(0===r)null!==i&&At(i),e.callbackNode=null,e.callbackPriority=0;else if(e.callbackPriority!==(t=r&-r)){if(null!=i&&At(i),1===t)0===e.tag?(n=kl.bind(null,e),Yr=!0,Xr(n)):Xr(kl.bind(null,e)),yr(function(){0==(6&C)&&Zr()}),i=null;else{switch(jt(r)){case 1:i=wt;break;case 4:i=bt;break;case 16:i=Mt;break;case 536870912:i=Nt;break;default:i=Mt}i=tu(i,Ul.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function Ul(t,e){if(Cl=-1,(Ll=0)!=(6&C))throw Error(F(327));var n=t.callbackNode;if(Ql()&&t.callbackNode!==n)return null;var i=Ft(t,t===p?D:0);if(0===i)return null;if(0!=(30&i)||0!=(i&t.expiredLanes)||e)e=Xl(t,i);else{e=i;var r=C,a=(C|=2,Yl());for(p===t&&D===e||(xl=null,Al=m()+500,Wl(t,e));;)try{for(;null!==L&&!xt();)Zl(L);break}catch(e){jl(t,e)}ba(),cl.current=a,C=r,e=null!==L?0:(p=null,D=0,O)}if(0!==e){if(1===(e=2===e&&0!==(r=kt(t))?Bl(t,i=r):e))throw n=ml,Wl(t,0),zl(t,i),Pl(t,m()),n;if(6===e)zl(t,i);else{if(r=t.current.alternate,0==(30&i)&&!(e=>{for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],a=r.getSnapshot;r=r.value;try{if(!xi(a(),r))return}catch(e){return}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return 1;t=t.return}t.sibling.return=t.return,t=t.sibling}}return 1})(r)&&1===(e=2===(e=Xl(t,i))&&0!==(a=kt(t))?Bl(t,i=a):e))throw n=ml,Wl(t,0),zl(t,i),Pl(t,m()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(F(345));case 2:Jl(t,s,xl);break;case 3:if(zl(t,i),(130023424&i)===i&&10<(e=El+500-m())){if(0!==Ft(t,0))break;if(((r=t.suspendedLanes)&i)!==i){f(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=gr(Jl.bind(null,t,s,xl),e)}else Jl(t,s,xl);break;case 4:if(zl(t,i),(4194240&i)!==i){for(e=t.eventTimes,r=-1;0<i;){var o=31-Lt(i),a=1<<o;r<(o=e[o])&&(r=o),i&=~a}i=r,10<(i=((i=m()-i)<120?120:i<480?480:i<1080?1080:i<1920?1920:i<3e3?3e3:i<4320?4320:1960*ul(i/1960))-i)?t.timeoutHandle=gr(Jl.bind(null,t,s,xl),i):Jl(t,s,xl)}break;case 5:Jl(t,s,xl);break;default:throw Error(F(329))}}}return Pl(t,m()),t.callbackNode===n?Ul.bind(null,t):null}function Bl(e,t){var n=yl;return e.current.memoizedState.isDehydrated&&(Wl(e,t).flags|=256),2!==(e=Xl(e,t))&&(t=s,s=n,null!==t)&&Fl(t),e}function Fl(e){null===s?s=e:s.push.apply(s,e)}function zl(e,t){for(t=t&~_l&~vl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Lt(t),i=1<<n;e[n]=-1,t&=~i}}function kl(e){if(0!=(6&C))throw Error(F(327));Ql();var t=Ft(e,0);if(0!=(1&t)){var n,i=Xl(e,t);if(1===(i=0!==e.tag&&2===i&&0!==(n=kt(e))?Bl(e,t=n):i))throw i=ml,Wl(e,0),zl(e,t),Pl(e,m()),i;if(6===i)throw Error(F(345));e.finishedWork=e.current.alternate,e.finishedLanes=t,Jl(e,s,xl)}return Pl(e,m()),null}function Gl(e,t){var n=C;C|=1;try{return e(t)}finally{0===(C=n)&&(Al=m()+500,Yr)&&Zr()}}function Hl(e){null!==Ml&&0===Ml.tag&&0==(6&C)&&Ql();var t=C,n=(C|=1,dl.transition),i=A;try{if(dl.transition=null,A=1,e)return e()}finally{A=i,dl.transition=n,0==(6&(C=t))&&Zr()}}function Vl(){pl=fl.current,u(fl)}function Wl(e,t){e.finishedWork=null,e.finishedLanes=0;var n,i,r,a=e.timeoutHandle;if(-1!==a&&(e.timeoutHandle=-1,vr(a)),null!==L)for(a=L.return;null!==a;){var o=a;switch(la(o),o.tag){case 1:null!=(o=o.type.childContextTypes)&&kr();break;case 3:uo(),u(y),u(_),mo();break;case 5:ho(o);break;case 4:uo();break;case 13:case 19:u(T);break;case 10:Ma(o.type._context);break;case 22:case 23:Vl()}a=a.return}if(L=e=au((p=e).current,null),D=pl=t,_l=vl=gl=O=0,(s=yl=ml=null)!==Ca){for(t=0;t<Ca.length;t++)null!==(o=(a=Ca[t]).interleaved)&&(a.interleaved=null,n=o.next,null!==(i=a.pending)&&(r=i.next,i.next=n,o.next=r),a.pending=o);Ca=null}return e}function jl(e,t){do{var n=L;try{if(ba(),go.current=is,yo){for(var i=S.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}yo=!1}if(b=w=S=null,Eo=!1,Ao=_o=0,(hl.current=null)===n||null===n.return){O=1,ml=t,L=null;break}e:{var a=e,o=n.return,s=t;if(t=D,(g=n).flags|=32768,null!==s&&"object"==typeof s&&"function"==typeof s.then){var l,u=s,c=g,h=c.tag,d=(0!=(1&c.mode)||0!==h&&11!==h&&15!==h||((l=c.alternate)?(c.updateQueue=l.updateQueue,c.memoizedState=l.memoizedState,c.lanes=l.lanes):(c.updateQueue=null,c.memoizedState=null)),fs(o));if(null!==d){d.flags&=-257,ms(d,o,g,0,t),1&d.mode&&ps(a,u,t);var p,s=u,f=(t=d).updateQueue;null===f?((p=new Set).add(s),t.updateQueue=p):f.add(s);break e}if(0==(1&t)){ps(a,u,t),ql();break e}s=Error(F(426))}else if(z&&1&g.mode){var m=fs(o);if(null!==m){0==(65536&m.flags)&&(m.flags|=256),ms(m,o,g,0,t),ya(ss(s,g));break e}}a=s=ss(s,g),4!==O&&(O=2),null===yl?yl=[a]:yl.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Ga(a,hs(0,s,t));break e;case 1:var g=s,v=a.type,_=a.stateNode;if(0==(128&a.flags)&&("function"==typeof v.getDerivedStateFromError||null!==_&&"function"==typeof _.componentDidCatch&&(null===wl||!wl.has(_)))){a.flags|=65536,t&=-t,a.lanes|=t,Ga(a,ds(a,g,t));break e}}}while(null!==(a=a.return))}Kl(n)}catch(e){t=e,L===n&&null!==n&&(L=n.return);continue}break}while(1)}function Yl(){var e=cl.current;return cl.current=is,null===e?is:e}function ql(){0!==O&&3!==O&&2!==O||(O=4),null===p||0==(268435455&gl)&&0==(268435455&vl)||zl(p,D)}function Xl(t,e){var n=C,i=(C|=2,Yl());for(p===t&&D===e||(xl=null,Wl(t,e));;)try{for(;null!==L;)Zl(L);break}catch(e){jl(t,e)}if(ba(),C=n,cl.current=i,null!==L)throw Error(F(261));return p=null,D=0,O}function Zl(e){var t=yu(e.alternate,e,pl);e.memoizedProps=e.pendingProps,null===t?Kl(e):L=t,hl.current=null}function Kl(e){var t=e;do{var n=t.alternate;if(e=t.return,0==(32768&t.flags)){if(null!==(n=((e,t,n)=>{var i=t.pendingProps;switch(la(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return h(t),null;case 1:return E(t.type)&&kr(),h(t),null;case 3:return i=t.stateNode,uo(),u(y),u(_),mo(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(ga(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0==(256&t.flags)||(t.flags|=1024,null!==ca&&(Fl(ca),ca=null))),zs(e,t),h(t),null;case 5:ho(t);var r,a=so(oo.current);if(n=t.type,null!==e&&null!=t.stateNode)ks(e,t,n,i,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(F(166));return h(t),null}if(e=so(ro.current),ga(t)){i=t.stateNode,n=t.type;var o,s,l=t.memoizedProps;switch(i[Sr]=t,i[wr]=l,e=0!=(1&t.mode),n){case"dialog":c("cancel",i),c("close",i);break;case"iframe":case"object":case"embed":c("load",i);break;case"video":case"audio":for(a=0;a<Zi.length;a++)c(Zi[a],i);break;case"source":c("error",i);break;case"img":case"image":case"link":c("error",i),c("load",i);break;case"details":c("toggle",i);break;case"input":be(i,l),c("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!l.multiple},c("invalid",i);break;case"textarea":Oe(i,l),c("invalid",i)}for(o in Xe(n,l),a=null,l)l.hasOwnProperty(o)&&(s=l[o],"children"===o?"string"==typeof s?i.textContent!==s&&(!0!==l.suppressHydrationWarning&&hr(i.textContent,s,e),a=["children",s]):"number"==typeof s&&i.textContent!==""+s&&(!0!==l.suppressHydrationWarning&&hr(i.textContent,s,e),a=["children",""+s]):H.hasOwnProperty(o)&&null!=s&&"onScroll"===o&&c("scroll",i));switch(n){case"input":xe(i),Ne(i,l,!0);break;case"textarea":xe(i),Ue(i);break;case"select":case"option":break;default:"function"==typeof l.onClick&&(i.onclick=dr)}i=a,null!==(t.updateQueue=i)&&(t.flags|=4)}else{o=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===(e="http://www.w3.org/1999/xhtml"===e?Be(n):e)?"script"===n?((e=o.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof i.is?e=o.createElement(n,{is:i.is}):(e=o.createElement(n),"select"===n&&(o=e,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):e=o.createElementNS(e,n),e[Sr]=t,e[wr]=i,Fs(e,t,!1,!1),t.stateNode=e;e:{switch(o=Ze(n,i),n){case"dialog":c("cancel",e),c("close",e),a=i;break;case"iframe":case"object":case"embed":c("load",e),a=i;break;case"video":case"audio":for(a=0;a<Zi.length;a++)c(Zi[a],e);a=i;break;case"source":c("error",e),a=i;break;case"img":case"image":case"link":c("error",e),c("load",e),a=i;break;case"details":c("toggle",e),a=i;break;case"input":be(e,i),a=we(e,i),c("invalid",e);break;case"option":a=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},a=g({},i,{value:void 0}),c("invalid",e);break;case"textarea":Oe(e,i),a=De(e,i),c("invalid",e);break;default:a=i}for(l in Xe(n,a),s=a)s.hasOwnProperty(l)&&(r=s[l],"style"===l?Ye(e,r):"dangerouslySetInnerHTML"===l?null!=(r=r?r.__html:void 0)&&Ge(e,r):"children"===l?"string"==typeof r?"textarea"===n&&""===r||He(e,r):"number"==typeof r&&He(e,""+r):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(H.hasOwnProperty(l)?null!=r&&"onScroll"===l&&c("scroll",e):null!=r&&Q(e,l,r,o)));switch(n){case"input":xe(e),Ne(e,i,!1);break;case"textarea":xe(e),Ue(e);break;case"option":null!=i.value&&e.setAttribute("value",""+Ee(i.value));break;case"select":e.multiple=!!i.multiple,null!=(l=i.value)?Le(e,!!i.multiple,l,!1):null!=i.defaultValue&&Le(e,!!i.multiple,i.defaultValue,!0);break;default:"function"==typeof a.onClick&&(e.onclick=dr)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return h(t),null;case 6:if(e&&null!=t.stateNode)Gs(e,t,e.memoizedProps,i);else{if("string"!=typeof i&&null===t.stateNode)throw Error(F(166));if(n=so(oo.current),so(ro.current),ga(t)){if(i=t.stateNode,n=t.memoizedProps,i[Sr]=t,(l=i.nodeValue!==n)&&null!==(e=ua))switch(e.tag){case 3:hr(i.nodeValue,n,0!=(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&hr(i.nodeValue,n,0!=(1&e.mode))}l&&(t.flags|=4)}else((i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[Sr]=t).stateNode=i}return h(t),null;case 13:if(u(T),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(z&&null!==x&&0!=(1&t.mode)&&0==(128&t.flags))va(),_a(),t.flags|=98560,l=!1;else if(l=ga(t),null!==i&&null!==i.dehydrated){if(null===e){if(!l)throw Error(F(318));if(!(l=null!==(l=t.memoizedState)?l.dehydrated:null))throw Error(F(317));l[Sr]=t}else _a(),0==(128&t.flags)&&(t.memoizedState=null),t.flags|=4;h(t),l=!1}else null!==ca&&(Fl(ca),ca=null),l=!0;if(!l)return 65536&t.flags?t:null}return 0!=(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!=(1&t.mode))&&(null===e||0!=(1&T.current)?0===O&&(O=3):ql()),null!==t.updateQueue&&(t.flags|=4),h(t),null);case 4:return uo(),zs(e,t),null===e&&tr(t.stateNode.containerInfo),h(t),null;case 10:return Ma(t.type._context),h(t),null;case 17:return E(t.type)&&kr(),h(t),null;case 19:if(u(T),null===(l=t.memoizedState));else{if(i=0!=(128&t.flags),null===(o=l.rendering))if(i)Bs(l,!1);else{if(0!==O||null!==e&&0!=(128&e.flags))for(e=t.child;null!==e;){if(null!==(o=po(e))){for(t.flags|=128,Bs(l,!1),null!==(i=o.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(l=n).flags&=14680066,null===(o=l.alternate)?(l.childLanes=0,l.lanes=e,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=o.childLanes,l.lanes=o.lanes,l.child=o.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=o.memoizedProps,l.memoizedState=o.memoizedState,l.updateQueue=o.updateQueue,l.type=o.type,e=o.dependencies,l.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return v(T,1&T.current|2),t.child}e=e.sibling}null!==l.tail&&m()>Al&&(t.flags|=128,Bs(l,!(i=!0)),t.lanes=4194304)}else{if(!i)if(null!==(e=po(o))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Bs(l,!0),null===l.tail&&"hidden"===l.tailMode&&!o.alternate&&!z)return h(t),null}else 2*m()-l.renderingStartTime>Al&&1073741824!==n&&(t.flags|=128,Bs(l,!(i=!0)),t.lanes=4194304);l.isBackwards?(o.sibling=t.child,t.child=o):(null!==(n=l.last)?n.sibling=o:t.child=o,l.last=o)}if(null!==l.tail)return t=l.tail,l.rendering=t,l.tail=t.sibling,l.renderingStartTime=m(),t.sibling=null,n=T.current,v(T,i?1&n|2:1&n),t}return h(t),null;case 22:case 23:return Vl(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!=(1&t.mode)?0!=(1073741824&pl)&&(h(t),6&t.subtreeFlags)&&(t.flags|=8192):h(t),null;case 24:case 25:return null}throw Error(F(156,t.tag))})(n,t,pl)))return void(L=n)}else{if(null!==(n=((e,t)=>{switch(la(t),t.tag){case 1:return E(t.type)&&kr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return uo(),u(y),u(_),mo(),0!=(65536&(e=t.flags))&&0==(128&e)?(t.flags=-65537&e|128,t):null;case 5:return ho(t),null;case 13:if(u(T),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(F(340));_a()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return u(T),null;case 4:return uo(),null;case 10:return Ma(t.type._context),null;case 22:case 23:return Vl(),null;default:return null}})(n,t)))return n.flags&=32767,void(L=n);if(null===e)return O=6,void(L=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(L=t)}while(L=t=e,null!==t);0===O&&(O=5)}function Jl(e,t,n){var i=A,r=dl.transition;try{dl.transition=null,A=1;for(var a=e,o=t,s=n,l=i;Ql(),null!==Ml;);if(0!=(6&C))throw Error(F(327));s=a.finishedWork;var u=a.finishedLanes;if(null!==s){if(a.finishedWork=null,a.finishedLanes=0,s===a.current)throw Error(F(177));a.callbackNode=null,a.callbackPriority=0;var c,h,d=s.lanes|s.childLanes;if(((e,t)=>{var n=e.pendingLanes&~t,i=(e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements,e.eventTimes);for(e=e.expirationTimes;0<n;){var r=31-Lt(n),a=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~a}})(a,d),a===p&&(L=p=null,D=0),0==(2064&s.subtreeFlags)&&0==(2064&s.flags)||bl||(bl=!0,tu(Mt,function(){return Ql(),null})),d=0!=(15990&s.flags),0!=(15990&s.subtreeFlags)||d?(d=dl.transition,dl.transition=null,c=A,A=1,h=C,C|=4,hl.current=null,((e,t)=>{if(pr=gn,Mi(e=bi())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:if((a=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection())&&0!==a.rangeCount){var n=a.anchorNode,i=a.anchorOffset,r=a.focusNode,a=a.focusOffset;try{n.nodeType,r.nodeType}catch(e){n=null;break e}var o,s=0,l=-1,u=-1,c=0,h=0,d=e,p=null;t:for(;;){for(;d!==n||0!==i&&3!==d.nodeType||(l=s+i),d!==r||0!==a&&3!==d.nodeType||(u=s+a),3===d.nodeType&&(s+=d.nodeValue.length),null!==(o=d.firstChild);)p=d,d=o;for(;;){if(d===e)break t;if(p===n&&++c===i&&(l=s),p===r&&++h===a&&(u=s),null!==(o=d.nextSibling))break;p=(d=p).parentNode}d=o}n=-1===l||-1===u?null:{start:l,end:u}}else n=null;n=n||{start:0,end:0}}else n=null;for(gn=!(fr={focusedElem:e,selectionRange:n}),I=t;null!==I;)if(e=(t=I).child,0!=(1028&t.subtreeFlags)&&null!==e)e.return=t,I=e;else for(;null!==I;){t=I;try{var f,m,g,v,_=t.alternate;if(0!=(1024&t.flags))switch(t.tag){case 0:case 11:case 15:break;case 1:null!==_&&(f=_.memoizedProps,m=_.memoizedState,v=(g=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?f:Aa(t.type,f),m),g.__reactInternalSnapshotBeforeUpdate=v);break;case 3:var y=t.stateNode.containerInfo;1===y.nodeType?y.textContent="":9===y.nodeType&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(F(163))}}catch(e){P(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,I=e;break}I=t.return}_=Ys,Ys=!1})(a,s),il(s,a),Ri(fr),gn=!!pr,fr=pr=null,al(a.current=s,a,u),Tt(),C=h,A=c,dl.transition=d):a.current=s,bl&&(bl=!1,Ml=a,Rl=u),0===(d=a.pendingLanes)&&(wl=null),(e=>{if(Ct&&"function"==typeof Ct.onCommitFiberRoot)try{Ct.onCommitFiberRoot(It,e,void 0,128==(128&e.current.flags))}catch(e){}})(s.stateNode),Pl(a,m()),null!==o)for(l=a.onRecoverableError,s=0;s<o.length;s++)l((u=o[s]).value,{componentStack:u.stack,digest:u.digest});if(Tl)throw Tl=!1,a=Sl,Sl=null,a;0!=(1&Rl)&&0!==a.tag&&Ql(),0!=(1&(d=a.pendingLanes))?a===Il?Nl++:(Nl=0,Il=a):Nl=0,Zr()}}finally{dl.transition=r,A=i}return null}function Ql(){if(null!==Ml){var e=jt(Rl),t=dl.transition,n=A;try{if(dl.transition=null,A=e<16?16:e,null===Ml)var i=!1;else{if(e=Ml,Ml=null,(Rl=0)!=(6&C))throw Error(F(331));var r=C;for(C|=4,I=e.current;null!==I;){var a=I,o=a.child;if(0!=(16&I.flags)){var s=a.deletions;if(null!==s){for(var l=0;l<s.length;l++){var u=s[l];for(I=u;null!==I;){switch((h=I).tag){case 0:case 11:case 15:qs(8,h,a)}var c=h.child;if(null!==c)c.return=h,I=c;else for(;null!==I;){var h,d=(h=I).sibling,p=h.return;if(!function e(t){var n=t.alternate;null!==n&&(t.alternate=null,e(n)),t.child=null,t.deletions=null,t.sibling=null,5===t.tag&&null!==(n=t.stateNode)&&(delete n[Sr],delete n[wr],delete n[Mr],delete n[Rr],delete n[Nr]),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}(h),h===u){I=null;break}if(null!==d){d.return=p,I=d;break}I=p}}}var f=a.alternate;if(null!==f){var m=f.child;if(null!==m){f.child=null;do{var g=m.sibling}while((m.sibling=null)!==(m=g))}}I=a}}if(0!=(2064&a.subtreeFlags)&&null!==o)o.return=a,I=o;else for(;null!==I;){if(0!=(2048&(a=I).flags))switch(a.tag){case 0:case 11:case 15:qs(9,a,a.return)}var v=a.sibling;if(null!==v){v.return=a.return,I=v;break}I=a.return}}var _=e.current;for(I=_;null!==I;){var y=(o=I).child;if(0!=(2064&o.subtreeFlags)&&null!==y)y.return=o,I=y;else for(o=_;null!==I;){if(0!=(2048&(s=I).flags))try{switch(s.tag){case 0:case 11:case 15:Xs(9,s)}}catch(e){P(s,s.return,e)}if(s===o){I=null;break}var E=s.sibling;if(null!==E){E.return=s.return,I=E;break}I=s.return}}if(C=r,Zr(),Ct&&"function"==typeof Ct.onPostCommitFiberRoot)try{Ct.onPostCommitFiberRoot(It,e)}catch(e){}i=!0}return i}finally{A=n,dl.transition=t}}}function $l(e,t,n){e=za(e,t=hs(0,t=ss(n,t),1),1),t=f(),null!==e&&(Vt(e,1,t),Pl(e,t))}function P(e,t,n){if(3===e.tag)$l(e,e,n);else for(;null!==t;){if(3===t.tag){$l(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===wl||!wl.has(i))){t=za(t,e=ds(t,e=ss(n,e),1),1),e=f(),null!==t&&(Vt(t,1,e),Pl(t,e));break}}t=t.return}}function eu(e,t){0===t&&(0==(1&e.mode)?t=1:(t=Ut,0==(130023424&(Ut<<=1))&&(Ut=4194304)));var n=f();null!==(e=Oa(e,t))&&(Vt(e,t,n),Pl(e,n))}function tu(e,t){return Et(e,t)}function nu(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function iu(e,t,n,i){return new nu(e,t,n,i)}function ru(e){return(e=e.prototype)&&e.isReactComponent}function au(e,t){var n=e.alternate;return null===n?((n=iu(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,(n.alternate=e).alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,n.dependencies=null===(t=e.dependencies)?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function ou(e,t,n,i,r,a){var o=2;if("function"==typeof(i=e))ru(e)&&(o=1);else if("string"==typeof e)o=5;else e:switch(e){case ne:return su(n.children,r,a,t);case ie:r|=o=8;break;case re:return(e=iu(12,n,t,2|r)).elementType=re,e.lanes=a,e;case le:return(e=iu(13,n,t,r)).elementType=le,e.lanes=a,e;case ue:return(e=iu(19,n,t,r)).elementType=ue,e.lanes=a,e;case de:return lu(n,r,a,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case ae:o=10;break e;case oe:o=9;break e;case se:o=11;break e;case ce:o=14;break e;case he:o=16,i=null;break e}throw Error(F(130,null==e?e:typeof e,""))}return(t=iu(o,n,t,r)).elementType=e,t.type=i,t.lanes=a,t}function su(e,t,n,i){return(e=iu(7,e,i,t)).lanes=n,e}function lu(e,t,n,i){return(e=iu(22,e,i,t)).elementType=de,e.lanes=n,e.stateNode={isHidden:!1},e}function uu(e,t,n){return(e=iu(6,e,null,t)).lanes=n,e}function cu(e,t,n){return(t=iu(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function hu(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ht(0),this.expirationTimes=Ht(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ht(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function du(e,t,n,i,r,a,o,s,l){return e=new hu(e,t,0,s,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=iu(3,null,null,t),(e.current=a).stateNode=e,a.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ua(a),e}function pu(e){if(!e)return Br;e:{if(gt(e=e._reactInternals)!==e||1!==e.tag)throw Error(F(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(E(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}}while(null!==(t=t.return));throw Error(F(171))}if(1===e.tag){var n=e.type;if(E(n))return Hr(e,n,t)}return t}function fu(e,t,n,i,r,a,o,s,l){return(e=du(n,i,!0,e,0,a,0,s,l)).context=pu(null),n=e.current,(a=Fa(i=f(),r=Dl(n))).callback=null!=t?t:null,za(n,a,r),e.current.lanes=r,Vt(e,r,i),Pl(e,i),e}function mu(e,t,n,i){var r=t.current,a=f(),o=Dl(r);n=pu(n),null===t.context?t.context=n:t.pendingContext=n,(t=Fa(a,o)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=za(r,t,o))&&(Ol(e,r,o,a),ka(e,r,o))}function gu(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function vu(e,t){var n;null!==(e=e.memoizedState)&&null!==e.dehydrated&&(n=e.retryLane,e.retryLane=0!==n&&n<t?n:t)}function _u(e,t){vu(e,t),(e=e.alternate)&&vu(e,t)}var yu=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||y.current)M=!0;else{if(0==(e.lanes&n)&&0==(128&t.flags)){M=!1;{var i=e;var r=t;var a=n;switch(r.tag){case 3:ws(r),_a();break;case 5:co(r);break;case 1:E(r.type)&&Vr(r);break;case 4:lo(r,r.stateNode.containerInfo);break;case 10:var o=r.type._context,s=r.memoizedProps.value;v(xa,o._currentValue),o._currentValue=s;break;case 13:if(null!==(o=r.memoizedState))return null!==o.dehydrated?(v(T,1&T.current),r.flags|=128,null):0!=(a&r.child.childLanes)?Ns(i,r,a):(v(T,1&T.current),null!==(i=Us(i,r,a))?i.sibling:null);v(T,1&T.current);break;case 19:if(o=0!=(a&r.childLanes),0!=(128&i.flags)){if(o)return Os(i,r,a);r.flags|=128}if(null!==(s=r.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),v(T,T.current),o)break;return null;case 22:case 23:return r.lanes=0,Es(i,r,a)}return Us(i,r,a);return}}M=0!=(131072&e.flags)}else M=!1,z&&0!=(1048576&t.flags)&&oa(t,$r,t.index);switch(t.lanes=0,t.tag){case 2:var l=t.type,u=(Ps(e,t),e=t.pendingProps,zr(t,_.current)),c=(Na(t,n),u=So(null,t,l,e,u,n),wo());return t.flags|=1,t="object"==typeof u&&null!==u&&"function"==typeof u.render&&void 0===u.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,E(l)?(c=!0,Vr(t)):c=!1,t.memoizedState=null!=u.state?u.state:null,Ua(t),u.updater=Ya,Ka((t.stateNode=u)._reactInternals=t,l,e,n),Ss(null,t,l,!0,c,n)):(t.tag=0,z&&c&&sa(t),R(null,t,u,n),t.child);case 16:l=t.elementType;e:{switch(Ps(e,t),e=t.pendingProps,l=(u=l._init)(l._payload),t.type=l,u=t.tag=(e=>{if("function"==typeof e)return ru(e)?1:0;if(null!=e){if((e=e.$$typeof)===se)return 11;if(e===ce)return 14}return 2})(l),e=Aa(l,e),u){case 0:t=xs(null,t,l,e,n);break e;case 1:t=Ts(null,t,l,e,n);break e;case 11:t=vs(null,t,l,e,n);break e;case 14:t=_s(null,t,l,Aa(l.type,e),n);break e}throw Error(F(306,l,""))}return t;case 0:return l=t.type,u=t.pendingProps,xs(e,t,l,u=t.elementType===l?u:Aa(l,u),n);case 1:return l=t.type,u=t.pendingProps,Ts(e,t,l,u=t.elementType===l?u:Aa(l,u),n);case 3:e:{if(ws(t),null===e)throw Error(F(387));l=t.pendingProps,u=(c=t.memoizedState).element,Ba(e,t),Ha(t,l,null,n);var h=t.memoizedState,l=h.element;if(c.isDehydrated){if(c={element:l,isDehydrated:!1,cache:h.cache,pendingSuspenseBoundaries:h.pendingSuspenseBoundaries,transitions:h.transitions},t.updateQueue.baseState=c,t.memoizedState=c,256&t.flags){t=bs(e,t,l,n,u=ss(Error(F(423)),t));break e}if(l!==u){t=bs(e,t,l,n,u=ss(Error(F(424)),t));break e}for(x=xr(t.stateNode.containerInfo.firstChild),z=!0,n=no(ua=t,ca=null,l,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(_a(),l===u){t=Us(e,t,n);break e}R(e,t,l,n)}t=t.child}return t;case 5:return co(t),null===e&&fa(t),l=t.type,u=t.pendingProps,c=null!==e?e.memoizedProps:null,h=u.children,mr(l,u)?h=null:null!==c&&mr(l,c)&&(t.flags|=32),As(e,t),R(e,t,h,n),t.child;case 6:return null===e&&fa(t),null;case 13:return Ns(e,t,n);case 4:return lo(t,t.stateNode.containerInfo),l=t.pendingProps,null===e?t.child=to(t,null,l,n):R(e,t,l,n),t.child;case 11:return l=t.type,u=t.pendingProps,vs(e,t,l,u=t.elementType===l?u:Aa(l,u),n);case 7:return R(e,t,t.pendingProps,n),t.child;case 8:case 12:return R(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(l=t.type._context,u=t.pendingProps,c=t.memoizedProps,h=u.value,v(xa,l._currentValue),l._currentValue=h,null!==c)if(xi(c.value,h)){if(c.children===u.children&&!y.current){t=Us(e,t,n);break e}}else for(null!==(c=t.child)&&(c.return=t);null!==c;){var d=c.dependencies;if(null!==d)for(var p,f,h=c.child,m=d.firstContext;null!==m;){if(m.context===l){1===c.tag&&((m=Fa(-1,n&-n)).tag=2,null!==(p=c.updateQueue))&&(null===(f=(p=p.shared).pending)?m.next=m:(m.next=f.next,f.next=m),p.pending=m),c.lanes|=n,null!==(m=c.alternate)&&(m.lanes|=n),Ra(c.return,n,t),d.lanes|=n;break}m=m.next}else if(10===c.tag)h=c.type===t.type?null:c.child;else if(18===c.tag){if(null===(h=c.return))throw Error(F(341));h.lanes|=n,null!==(d=h.alternate)&&(d.lanes|=n),Ra(h,n,t),h=c.sibling}else h=c.child;if(null!==h)h.return=c;else for(h=c;null!==h;){if(h===t){h=null;break}if(null!==(c=h.sibling)){c.return=h.return,h=c;break}h=h.return}c=h}R(e,t,u.children,n),t=t.child}return t;case 9:return u=t.type,l=t.pendingProps.children,Na(t,n),l=l(u=Ia(u)),t.flags|=1,R(e,t,l,n),t.child;case 14:return u=Aa(l=t.type,t.pendingProps),_s(e,t,l,u=Aa(l.type,u),n);case 15:return ys(e,t,t.type,t.pendingProps,n);case 17:return l=t.type,u=t.pendingProps,u=t.elementType===l?u:Aa(l,u),Ps(e,t),t.tag=1,E(l)?(e=!0,Vr(t)):e=!1,Na(t,n),Xa(t,l,u),Ka(t,l,u,n),Ss(null,t,l,!0,e,n);case 19:return Os(e,t,n);case 22:return Es(e,t,n)}throw Error(F(156,t.tag))},Eu="function"==typeof reportError?reportError:function(e){console.error(e)};function Au(e){this._internalRoot=e}function xu(e){this._internalRoot=e}function Tu(e){return e&&(1===e.nodeType||9===e.nodeType||11===e.nodeType)}function Su(e){return e&&(1===e.nodeType||9===e.nodeType||11===e.nodeType||8===e.nodeType&&" react-mount-point-unstable "===e.nodeValue)}function wu(){}function bu(e,t,n,i,r){var a,o,s=n._reactRootContainer;return s?("function"==typeof r&&(o=r,r=function(){var e=gu(a);o.call(e)}),mu(t,a=s,e,r)):a=((e,t,n,i,r)=>{var a,o,s;if(r)return"function"==typeof i&&(a=i,i=function(){var e=gu(o);a.call(e)}),o=fu(t,i,e,0,null,!1,0,"",wu),e._reactRootContainer=o,e[br]=o.current,tr(8===e.nodeType?e.parentNode:e),Hl(),o;for(;r=e.lastChild;)e.removeChild(r);"function"==typeof i&&(s=i,i=function(){var e=gu(l);s.call(e)});var l=du(e,0,!1,null,0,!1,0,"",wu);return e._reactRootContainer=l,e[br]=l.current,tr(8===e.nodeType?e.parentNode:e),Hl(function(){mu(t,l,n,i)}),l})(n,t,e,r,i),gu(a)}xu.prototype.render=Au.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(F(409));mu(e,t,null,null)},xu.prototype.unmount=Au.prototype.unmount=function(){var e,t=this._internalRoot;null!==t&&(this._internalRoot=null,e=t.containerInfo,Hl(function(){mu(null,t,null,null)}),e[br]=null)},xu.prototype.unstable_scheduleHydration=function(e){if(e){var t=Zt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<an.length&&0!==t&&t<an[n].priority;n++);an.splice(n,0,e),0===n&&un(e)}},Yt=function(n){switch(n.tag){case 3:var e,t=n.stateNode;t.current.memoizedState.isDehydrated&&0!==(e=Bt(t.pendingLanes))&&(Wt(t,1|e),Pl(t,m()),0==(6&C))&&(Al=m()+500,Zr());break;case 13:Hl(function(){var e,t=Oa(n,1);null!==t&&(e=f(),Ol(t,n,1,e))}),_u(n,1)}},qt=function(e){var t;13===e.tag&&(null!==(t=Oa(e,134217728))&&Ol(t,e,134217728,f()),_u(e,134217728))},Xt=function(e){var t,n;13===e.tag&&(null!==(n=Oa(e,t=Dl(e)))&&Ol(n,e,t,f()),_u(e,t))},Zt=function(){return A},Kt=function(e,t){var n=A;try{return A=e,t()}finally{A=n}},at=Hl;e={usingClientEntryPoint:!(Qe=function(e,t,n){switch(t){case"input":if(Re(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=Dr(i);if(!r)throw Error(F(90));Te(i),Re(i,r)}}}break;case"textarea":Pe(e,n);break;case"select":null!=(t=n.value)&&Le(e,!!n.multiple,t,!1)}}),Events:[Cr,Lr,Dr,nt,it,rt=Gl]},t={findFiberByHostInstance:Ir,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},U={bundleType:t.bundleType,version:t.version,rendererPackageName:t.rendererPackageName,rendererConfig:t.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=yt(e))?null:e.stateNode},findFiberByHostInstance:t.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){i=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!i.isDisabled&&i.supportsFiber)try{It=i.inject(U),Ct=i}catch(e){}}l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=e,l.createPortal=function(e,t){if(Tu(t))return function(e,t,n,i){return{$$typeof:te,key:null==(i=3<arguments.length&&void 0!==i?i:null)?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null);throw Error(F(200))},l.createRoot=function(e,t){var n,i,r;if(Tu(e))return n=!1,i="",r=Eu,null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError)&&(r=t.onRecoverableError),t=du(e,1,!1,null,0,n,0,i,r),e[br]=t.current,tr(8===e.nodeType?e.parentNode:e),new Au(t);throw Error(F(299))},l.findDOMNode=function(e){if(null==e)return null;if(1!==e.nodeType){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(F(188));throw e=Object.keys(e).join(","),Error(F(268,e))}e=null===(e=yt(t))?null:e.stateNode}return e},l.flushSync=Hl,l.hydrate=function(e,t,n){if(Su(t))return bu(null,e,t,!0,n);throw Error(F(200))},l.hydrateRoot=function(e,t,n){if(!Tu(e))throw Error(F(405));var i=null!=n&&n.hydratedSources||null,r=!1,a="",o=Eu;if(null!=n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError)&&(o=n.onRecoverableError),t=fu(t,null,e,1,null!=n?n:null,r,0,a,o),e[br]=t.current,tr(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new xu(t)},l.render=function(e,t,n){if(Su(t))return bu(null,e,t,!1,n);throw Error(F(200))},l.unmountComponentAtNode=function(e){if(Su(e))return!!e._reactRootContainer&&(Hl(function(){bu(null,null,e,!1,function(){e._reactRootContainer=null,e[br]=null})}),!0);throw Error(F(40))},l.unstable_batchedUpdates=Gl,l.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Su(n))throw Error(F(200));if(null==e||void 0===e._reactInternals)throw Error(F(38));return bu(e,t,n,!1,i)},l.version="18.2.0-next-9e3b772b8-20220608"},391:(e,t,n)=>{n=n(950);t.createRoot=n.createRoot,t.hydrateRoot=n.hydrateRoot},950:(e,t,n)=>{!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(730)},153:(e,t,n)=>{var n=n(43),s=Symbol.for("react.element"),l=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),u=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function i(e,t,n){var i,r={},a=null,o=null;for(i in void 0!==n&&(a=""+n),void 0!==t.key&&(a=""+t.key),void 0!==t.ref&&(o=t.ref),t)l.call(t,i)&&!c.hasOwnProperty(i)&&(r[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===r[i]&&(r[i]=t[i]);return{$$typeof:s,type:e,key:a,ref:o,props:r,_owner:u.current}}t.jsx=i},202:(e,t)=>{var h=Symbol.for("react.element"),d=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),o=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function _(){}function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},_.prototype=v.prototype;var E=y.prototype=new _,A=(E.constructor=y,m(E,v.prototype),E.isPureReactComponent=!0,Array.isArray),x=Object.prototype.hasOwnProperty,T={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function w(e,t,n){var i,r={},a=null,o=null;if(null!=t)for(i in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)x.call(t,i)&&!S.hasOwnProperty(i)&&(r[i]=t[i]);var s=arguments.length-2;if(1===s)r.children=n;else if(1<s){for(var l=Array(s),u=0;u<s;u++)l[u]=arguments[u+2];r.children=l}if(e&&e.defaultProps)for(i in s=e.defaultProps)void 0===r[i]&&(r[i]=s[i]);return{$$typeof:h,type:e,key:a,ref:o,props:r,_owner:T.current}}function b(e){return"object"==typeof e&&null!==e&&e.$$typeof===h}var M=/\/+/g;function R(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(e=""+e.key,n={"=":"=0",":":"=2"},"$"+e.replace(/[=:]/g,function(e){return n[e]})):t.toString(36);var n}function N(e,t,n,i,r){var a,o,s=!1;if(null===(e="undefined"!==(u=typeof e)&&"boolean"!==u?e:null))s=!0;else switch(u){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case h:case d:s=!0}}if(s)return r=r(s=e),e=""===i?"."+R(s,0):i,A(r)?(n="",N(r,t,n=null!=e?e.replace(M,"$&/")+"/":n,"",function(e){return e})):null!=r&&(b(r)&&(o=n+(!(a=r).key||s&&s.key===r.key?"":(""+r.key).replace(M,"$&/")+"/")+e,r={$$typeof:h,type:a.type,key:o,ref:a.ref,props:a.props,_owner:a._owner}),t.push(r)),1;if(s=0,i=""===i?".":i+":",A(e))for(var l=0;l<e.length;l++){var u,c=i+R(u=e[l],l);s+=N(u,t,n,c,r)}else if("function"==typeof(c=null!==(o=e)&&"object"==typeof o&&"function"==typeof(o=p&&o[p]||o["@@iterator"])?o:null))for(e=c.call(e),l=0;!(u=e.next()).done;)s+=N(u=u.value,t,n,c=i+R(u,l++),r);else if("object"===u)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function I(e,t,n){var i;return null==e||(i=0,N(e,e=[],"","",function(e){return t.call(n,e,i++)})),e}function C(t){var e;if(-1===t._status&&((e=(e=t._result)()).then(function(e){0!==t._status&&-1!==t._status||(t._status=1,t._result=e)},function(e){0!==t._status&&-1!==t._status||(t._status=2,t._result=e)}),-1===t._status)&&(t._status=0,t._result=e),1===t._status)return t._result.default;throw t._result}var L={current:null},D={transition:null},E={ReactCurrentDispatcher:L,ReactCurrentBatchConfig:D,ReactCurrentOwner:T};t.Children={map:I,forEach:function(e,t,n){I(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return I(e,function(){t++}),t},toArray:function(e){return I(e,function(e){return e})||[]},only:function(e){if(b(e))return e;throw Error("React.Children.only expected to receive a single React element child.")}},t.Component=v,t.Fragment=n,t.Profiler=r,t.PureComponent=y,t.StrictMode=i,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=E,t.cloneElement=function(e,t,n){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=m({},e.props),r=e.key,a=e.ref,o=e._owner;if(null!=t)for(s in void 0!==t.ref&&(a=t.ref,o=T.current),void 0!==t.key&&(r=""+t.key),e.type&&e.type.defaultProps&&(l=e.type.defaultProps),t)x.call(t,s)&&!S.hasOwnProperty(s)&&(i[s]=(void 0===t[s]&&void 0!==l?l:t)[s]);var s=arguments.length-2;if(1===s)i.children=n;else if(1<s){for(var l=Array(s),u=0;u<s;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:h,type:e.type,key:r,ref:a,props:i,_owner:o}},t.createContext=function(e){return(e={$$typeof:o,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=w,t.createFactory=function(e){var t=w.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:s,render:e}},t.isValidElement=b,t.lazy=function(e){return{$$typeof:c,_payload:{_status:-1,_result:e},_init:C}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return L.current.useCallback(e,t)},t.useContext=function(e){return L.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return L.current.useDeferredValue(e)},t.useEffect=function(e,t){return L.current.useEffect(e,t)},t.useId=function(){return L.current.useId()},t.useImperativeHandle=function(e,t,n){return L.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return L.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return L.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return L.current.useMemo(e,t)},t.useReducer=function(e,t,n){return L.current.useReducer(e,t,n)},t.useRef=function(e){return L.current.useRef(e)},t.useState=function(e){return L.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return L.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return L.current.useTransition()},t.version="18.2.0"},43:(e,t,n)=>{e.exports=n(202)},579:(e,t,n)=>{e.exports=n(153)},234:(e,s)=>{function a(e,t){var n=e.length;for(e.push(t);0<n;){var i=n-1>>>1,r=e[i];if(!(0<c(r,t)))break;e[i]=t,e[n]=r,n=i}}function l(e){return 0===e.length?null:e[0]}function u(e){if(0!==e.length){var t=e[0],n=e.pop();if(n!==t){e[0]=n;for(var i=0,r=e.length,a=r>>>1;i<a;){var o=2*(i+1)-1,s=e[o],l=1+o,u=e[l];if(c(s,n)<0)i=l<r&&c(u,s)<0?(e[i]=u,e[l]=n,l):(e[i]=s,e[o]=n,o);else{if(!(l<r&&c(u,n)<0))break;e[i]=u,e[l]=n,i=l}}}}}function c(e,t){var n=e.sortIndex-t.sortIndex;return 0!=n?n:e.id-t.id}"object"==typeof performance&&"function"==typeof performance.now?(t=performance,s.unstable_now=function(){return t.now()}):(n=Date,i=n.now(),s.unstable_now=function(){return n.now()-i});var t,n,i,h=[],d=[],o=1,p=null,f=3,m=!1,g=!1,v=!1,r="function"==typeof setTimeout?setTimeout:null,_="function"==typeof clearTimeout?clearTimeout:null,y="undefined"!=typeof setImmediate?setImmediate:null;function E(e){for(var t=l(d);null!==t;){if(null===t.callback)u(d);else{if(!(t.startTime<=e))break;u(d),t.sortIndex=t.expirationTime,a(h,t)}t=l(d)}}function A(e){var t;v=!1,E(e),g||(null!==l(h)?(g=!0,D(x)):null!==(t=l(d))&&O(A,t.startTime-e))}function x(e,t){g=!1,v&&(v=!1,_(R),R=-1),m=!0;var n=f;try{for(E(t),p=l(h);null!==p&&(!(p.expirationTime>t)||e&&!C());){var i,r=p.callback;"function"==typeof r?(p.callback=null,f=p.priorityLevel,i=r(p.expirationTime<=t),t=s.unstable_now(),"function"==typeof i?p.callback=i:p===l(h)&&u(h),E(t)):u(h),p=l(h)}var a,o=null!==p||(null!==(a=l(d))&&O(A,a.startTime-t),!1);return o}finally{p=null,f=n,m=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var T,S,w,b=!1,M=null,R=-1,N=5,I=-1;function C(){return!(s.unstable_now()-I<N)}function L(){if(null!==M){var e=s.unstable_now(),t=(I=e,!0);try{t=M(!0,e)}finally{t?T():(b=!1,M=null)}}else b=!1}function D(e){M=e,b||(b=!0,T())}function O(e,t){R=r(function(){e(s.unstable_now())},t)}T="function"==typeof y?function(){y(L)}:"undefined"!=typeof MessageChannel?(S=new MessageChannel,w=S.port2,S.port1.onmessage=L,function(){w.postMessage(null)}):function(){r(L,0)},s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(e){e.callback=null},s.unstable_continueExecution=function(){g||m||(g=!0,D(x))},s.unstable_forceFrameRate=function(e){e<0||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<e?Math.floor(1e3/e):5},s.unstable_getCurrentPriorityLevel=function(){return f},s.unstable_getFirstCallbackNode=function(){return l(h)},s.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},s.unstable_scheduleCallback=function(e,t,n){var i=s.unstable_now();switch(n="object"==typeof n&&null!==n&&"number"==typeof(n=n.delay)&&0<n?i+n:i,e){case 1:var r=-1;break;case 2:r=250;break;case 5:r=1073741823;break;case 4:r=1e4;break;default:r=5e3}return e={id:o++,callback:t,priorityLevel:e,startTime:n,expirationTime:r=n+r,sortIndex:-1},i<n?(e.sortIndex=n,a(d,e),null===l(h)&&e===l(d)&&(v?(_(R),R=-1):v=!0,O(A,n-i))):(e.sortIndex=r,a(h,e),g||m||(g=!0,D(x))),e},s.unstable_shouldYield=C,s.unstable_wrapCallback=function(t){var n=f;return function(){var e=f;f=n;try{return t.apply(this,arguments)}finally{f=e}}}},853:(e,t,n)=>{e.exports=n(234)}},i={};function Kh(e){var t=i[e];return void 0!==t||(t=i[e]={exports:{}},n[e].call(t.exports,t,t.exports,Kh)),t.exports}Kh.m=n,Kh.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return Kh.d(t,{a:t}),t},Kh.d=(e,t)=>{for(var n in t)Kh.o(t,n)&&!Kh.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},Kh.f={},Kh.e=n=>Promise.all(Object.keys(Kh.f).reduce((e,t)=>(Kh.f[t](n,e),e),[])),Kh.u=e=>"static/js/"+e+".9acc6f80.chunk.js",Kh.miniCssF=e=>{},Kh.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c={},h="portal-react:",Kh.l=(i,e,t,n)=>{if(c[i])c[i].push(e);else{var r,a;if(void 0!==t)for(var o=document.getElementsByTagName("script"),s=0;s<o.length;s++){var l=o[s];if(l.getAttribute("src")==i||l.getAttribute("data-webpack")==h+t){r=l;break}}r||(a=!0,(r=document.createElement("script")).charset="utf-8",r.timeout=120,Kh.nc&&r.setAttribute("nonce",Kh.nc),r.setAttribute("data-webpack",h+t),r.src=i),c[i]=[e];var e=(e,t)=>{r.onerror=r.onload=null,clearTimeout(u);var n=c[i];if(delete c[i],r.parentNode&&r.parentNode.removeChild(r),n&&n.forEach(e=>e(t)),e)return e(t)},u=setTimeout(e.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=e.bind(null,r.onerror),r.onload=e.bind(null,r.onload),a&&document.head.appendChild(r)}},Kh.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},Kh.p="./",l={792:0},Kh.f.j=(n,e)=>{var t,i,r=Kh.o(l,n)?l[n]:void 0;0!==r&&(r?e.push(r[2]):(t=new Promise((e,t)=>r=l[n]=[e,t]),e.push(r[2]=t),e=Kh.p+Kh.u(n),i=new Error,Kh.l(e,e=>{var t;Kh.o(l,n)&&(0!==(r=l[n])&&(l[n]=void 0),r)&&(t=e&&("load"===e.type?"missing":e.type),e=e&&e.target&&e.target.src,i.message="Loading chunk "+n+" failed.\n("+t+": "+e+")",i.name="ChunkLoadError",i.type=t,i.request=e,r[1](i))},"chunk-"+n,n)))},Dd=(e,t)=>{var n,i,r=t[0],a=t[1],o=t[2],s=0;if(r.some(e=>0!==l[e])){for(n in a)Kh.o(a,n)&&(Kh.m[n]=a[n]);o&&o(Kh)}for(e&&e(t);s<r.length;s++)i=r[s],Kh.o(l,i)&&l[i]&&l[i][0](),l[i]=0},(Qh=self.webpackChunkportal_react=self.webpackChunkportal_react||[]).forEach(Dd.bind(null,0)),Qh.push=Dd.bind(null,Qh.push.bind(Qh));{var Ld=Kh(43),Dd=Kh(391);let l="167",ee={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},te={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},X=0,Z=1,K=2,I=1,b=2,C=3,ke=0,Ge=1,He=2,Y=0,fe=1,J=2,Q=3,$=4,ne=5,ie=100,re=101,ae=102,oe=103,se=104,le=200,ue=201,ce=202,he=203,de=204,me=205,ge=206,ve=207,_e=208,ye=209,Ee=210,Ae=211,xe=212,Te=213,Se=214,we=0,be=1,Me=2,Re=3,Ne=4,Ie=5,Ce=6,Le=7,R=0,L=1,D=2,Xe=0,O=1,P=2,U=3,B=4,F=5,z=6,k=7,G=301,De=302,E=303,A=304,Oe=306,H=1e3,Pe=1001,Ue=1002,V=1003,e=1004,Be=1005,W=1006,Fe=1007,Ve=1008,We=1009,x=1010,ze=1011,Ze=1012,Ke=1013,Je=1014,j=1015,Qe=1016,$e=1017,et=1018,tt=1020,nt=35902,it=1021,rt=1022,q=1023,at=1024,ot=1025,st=1026,lt=1027,ut=1028,ct=1029,ht=1030,dt=1031,pt=1033,ft=33776,mt=33777,gt=33778,vt=33779,_t=35840,yt=35841,Et=35842,At=35843,xt=36196,Tt=37492,St=37496,wt=37808,bt=37809,Mt=37810,Rt=37811,Nt=37812,It=37813,Ct=37814,Lt=37815,Dt=37816,Ot=37817,Pt=37818,Ut=37819,Bt=37820,Ft=37821,zt=36492,kt=36494,Gt=36495,Ht=36283,Vt=36284,Wt=36285,jt=36286,Yt=3200,qt=3201,Xt=0,Zt=1,Kt="",je="srgb",Ye="srgb-linear",Jt="display-p3",Qt="display-p3-linear",$t="linear",pe="srgb",en="rec709",tn="p3",nn=512,rn=513,an=514,on=515,sn=516,ln=517,un=518,cn=519,hn="300 es";class J1{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){var n;return void 0!==this._listeners&&void 0!==(n=this._listeners)[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){var n;void 0!==this._listeners&&void 0!==(e=this._listeners[e])&&-1!==(n=e.indexOf(t))&&e.splice(n,1)}dispatchEvent(n){if(void 0!==this._listeners){var e=this._listeners[n.type];if(void 0!==e){n.target=this;var i=e.slice(0);for(let e=0,t=i.length;e<t;e++)i[e].call(this,n);n.target=null}}}}let r=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],t=1234567,dn=Math.PI/180,pn=180/Math.PI;function Od(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(r[255&e]+r[e>>8&255]+r[e>>16&255]+r[e>>24&255]+"-"+r[255&t]+r[t>>8&255]+"-"+r[t>>16&15|64]+r[t>>24&255]+"-"+r[63&n|128]+r[n>>8&255]+"-"+r[n>>16&255]+r[n>>24&255]+r[255&i]+r[i>>8&255]+r[i>>16&255]+r[i>>24&255]).toLowerCase()}function Pd(e,t,n){return Math.max(t,Math.min(n,e))}function Ud(e,t){return(e%t+t)%t}function Bd(e,t,n){return(1-n)*e+n*t}function Fd(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Jh(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}let fn={DEG2RAD:dn,RAD2DEG:pn,generateUUID:Od,clamp:Pd,euclideanModulo:Ud,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Bd,damp:function(e,t,n,i){return Bd(e,t,1-Math.exp(-n*i))},pingpong:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(Ud(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:n<=e?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:n<=e?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(t=e),e=t+=1831565813,e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296},degToRad:function(e){return e*dn},radToDeg:function(e){return e*pn},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,i,r){var a=Math.cos,o=Math.sin,s=a(n/2),l=o(n/2),u=a((t+i)/2),c=o((t+i)/2),h=a((t-i)/2),d=o((t-i)/2),p=a((i-t)/2),f=o((i-t)/2);switch(r){case"XYX":e.set(s*c,l*h,l*d,s*u);break;case"YZY":e.set(l*d,s*c,l*h,s*u);break;case"ZXZ":e.set(l*h,l*d,s*c,s*u);break;case"XZX":e.set(s*c,l*f,l*p,s*u);break;case"YXY":e.set(l*p,s*c,l*f,s*u);break;case"ZYZ":e.set(l*f,l*p,s*c,s*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:Jh,denormalize:Fd};class ld{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;ld.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){var t=this.x,n=this.y,e=e.elements;return this.x=e[0]*t+e[3]*n+e[6],this.y=e[1]*t+e[4]*n+e[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===t?Math.PI/2:(e=this.dot(e)/t,Math.acos(Pd(e,-1,1)))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){var n=Math.cos(t),t=Math.sin(t),i=this.x-e.x,r=this.y-e.y;return this.x=i*n-r*t+e.x,this.y=i*t+r*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ud{constructor(e,t,n,i,r,a,o,s,l){ud.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,a,o,s,l)}set(e,t,n,i,r,a,o,s,l){var u=this.elements;return u[0]=e,u[1]=i,u[2]=o,u[3]=t,u[4]=r,u[5]=s,u[6]=n,u[7]=a,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){var t=this.elements,e=e.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){e=e.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){var e=e.elements,t=t.elements,n=this.elements,i=e[0],r=e[3],a=e[6],o=e[1],s=e[4],l=e[7],u=e[2],c=e[5],e=e[8],h=t[0],d=t[3],p=t[6],f=t[1],m=t[4],g=t[7],v=t[2],_=t[5],t=t[8];return n[0]=i*h+r*f+a*v,n[3]=i*d+r*m+a*_,n[6]=i*p+r*g+a*t,n[1]=o*h+s*f+l*v,n[4]=o*d+s*m+l*_,n[7]=o*p+s*g+l*t,n[2]=u*h+c*f+e*v,n[5]=u*d+c*m+e*_,n[8]=u*p+c*g+e*t,this}multiplyScalar(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],e=e[8];return t*a*e-t*o*l-n*r*e+n*o*s+i*r*l-i*a*s}invert(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=u*a-o*l,h=o*s-u*r,d=l*r-a*s,p=t*c+n*h+i*d;return 0==p?this.set(0,0,0,0,0,0,0,0,0):(e[0]=c*(c=1/p),e[1]=(i*l-u*n)*c,e[2]=(o*n-i*a)*c,e[3]=h*c,e[4]=(u*t-i*s)*c,e[5]=(i*r-o*t)*c,e[6]=d*c,e[7]=(n*s-l*t)*c,e[8]=(a*t-n*r)*c,this)}transpose(){var e=this.elements,t=e[1];return e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,a,o){var s=Math.cos(r),r=Math.sin(r);return this.set(n*s,n*r,-n*(s*a+r*o)+a+e,-i*r,i*s,-i*(-r*a+s*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(n.makeScale(e,t)),this}rotate(e){return this.premultiply(n.makeRotation(-e)),this}translate(e,t){return this.premultiply(n.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,e,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){var t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;for(let e=0;e<9;e++)this.elements[e]=t[e+n];return this}toArray(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}let n=new ud;function zd(t){for(let e=t.length-1;0<=e;--e)if(65535<=t[e])return 1}function kd(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;let mn={};function Gd(e){e in mn||(mn[e]=!0,console.warn(e))}let gn=(new ud).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),vn=(new ud).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),_n={[Ye]:{transfer:$t,primaries:en,luminanceCoefficients:[.2126,.7152,.0722],toReference:e=>e,fromReference:e=>e},[je]:{transfer:pe,primaries:en,luminanceCoefficients:[.2126,.7152,.0722],toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[Qt]:{transfer:$t,primaries:tn,luminanceCoefficients:[.2289,.6917,.0793],toReference:e=>e.applyMatrix3(vn),fromReference:e=>e.applyMatrix3(gn)},[Jt]:{transfer:pe,primaries:tn,luminanceCoefficients:[.2289,.6917,.0793],toReference:e=>e.convertSRGBToLinear().applyMatrix3(vn),fromReference:e=>e.applyMatrix3(gn).convertLinearToSRGB()}},yn=new Set([Ye,Qt]),qe={enabled:!0,_workingColorSpace:Ye,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!yn.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,n){return!1!==this.enabled&&t!==n&&t&&n?(t=_n[t].toReference,(0,_n[n].fromReference)(t(e))):e},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return _n[e].primaries},getTransfer:function(e){return e===Kt?$t:_n[e].transfer},getLuminanceCoefficients:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._workingColorSpace;return e.fromArray(_n[t].luminanceCoefficients)}};function Hd(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Vd(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let En;class Q1{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;var n;return 2048<(t=e instanceof HTMLCanvasElement?e:((En=void 0===En?kd("canvas"):En).width=e.width,En.height=e.height,n=En.getContext("2d"),e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),En)).width||2048<t.height?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var t=kd("canvas"),n=(t.width=e.width,t.height=e.height,t.getContext("2d")),i=(n.drawImage(e,0,0,e.width,e.height),n.getImageData(0,0,e.width,e.height)),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*Hd(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){var a=e.data.slice(0);for(let e=0;e<a.length;e++)a instanceof Uint8Array||a instanceof Uint8ClampedArray?a[e]=Math.floor(255*Hd(a[e]/255)):a[e]=Hd(a[e]);return{data:a,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let An=0;class $1{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,Object.defineProperty(this,"id",{value:An++}),this.uuid=Od(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];var i={uuid:this.uuid,url:""},r=this.data;if(null!==r){let n;if(Array.isArray(r)){n=[];for(let e=0,t=r.length;e<t;e++)r[e].isDataTexture?n.push(Wd(r[e].image)):n.push(Wd(r[e]))}else n=Wd(r);i.url=n}return t||(e.images[this.uuid]=i),i}}function Wd(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Q1.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let xn=0;class eA extends J1{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:eA.DEFAULT_IMAGE,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:eA.DEFAULT_MAPPING,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Pe,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:Pe,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:W,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:Ve,o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:q,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:We,l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:eA.DEFAULT_ANISOTROPY,u=9<arguments.length&&void 0!==arguments[9]?arguments[9]:Kt;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:xn++}),this.uuid=Od(),this.name="",this.source=new $1(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=s,this.offset=new ld(0,0),this.repeat=new ld(1,1),this.center=new ld(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ud,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e){this.source.data=e=void 0===e?null:e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){var t,n=void 0===e||"string"==typeof e;return n||void 0===e.textures[this.uuid]?(t={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment},0<Object.keys(this.userData).length&&(t.userData=this.userData),n||(e.textures[this.uuid]=t),t):e.textures[this.uuid]}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300===this.mapping){if(e.applyMatrix3(this.matrix),e.x<0||1<e.x)switch(this.wrapS){case H:e.x=e.x-Math.floor(e.x);break;case Pe:e.x=e.x<0?0:1;break;case Ue:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||1<e.y)switch(this.wrapT){case H:e.y=e.y-Math.floor(e.y);break;case Pe:e.y=e.y<0?0:1;break;case Ue:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}return e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}eA.DEFAULT_IMAGE=null,eA.DEFAULT_MAPPING=300,eA.DEFAULT_ANISOTROPY=1;class cd{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;cd.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){var t=this.x,n=this.y,i=this.z,r=this.w,e=e.elements;return this.x=e[0]*t+e[4]*n+e[8]*i+e[12]*r,this.y=e[1]*t+e[5]*n+e[9]*i+e[13]*r,this.z=e[2]*t+e[6]*n+e[10]*i+e[14]*r,this.w=e[3]*t+e[7]*n+e[11]*i+e[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;var a,o,s,l,u,c,t=t.elements,h=t[0],d=t[4],p=t[8],f=t[1],m=t[5],g=t[9],v=t[2],_=t[6],t=t[10];if(Math.abs(d-f)<.01&&Math.abs(p-v)<.01&&Math.abs(g-_)<.01)Math.abs(d+f)<.1&&Math.abs(p+v)<.1&&Math.abs(g+_)<.1&&Math.abs(h+m+t-3)<.1?this.set(1,0,0,0):(e=Math.PI,s=(t+1)/2,l=(d+f)/4,u=(p+v)/4,c=(g+_)/4,(o=(m+1)/2)<(a=(h+1)/2)&&s<a?r=a<.01?(n=0,i=.707106781):(n=Math.sqrt(a),i=l/n,u/n):s<o?r=o<.01?(n=.707106781,i=0,.707106781):(i=Math.sqrt(o),n=l/i,c/i):s<.01?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(s),n=u/r,i=c/r),this.set(n,i,r,e));else{let e=Math.sqrt((_-g)*(_-g)+(p-v)*(p-v)+(f-d)*(f-d));Math.abs(e)<.001&&(e=1),this.x=(_-g)/e,this.y=(p-v)/e,this.z=(f-d)/e,this.w=Math.acos((h+m+t-1)/2)}return this}setFromMatrixPosition(e){e=e.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class tA extends J1{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},e=(super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new cd(0,0,e,t),this.scissorTest=!1,this.viewport=new cd(0,0,e,t),{width:e,height:t,depth:1}),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:W,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n),i=new eA(e,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),r=(i.flipY=!1,i.generateMipmaps=n.generateMipmaps,i.internalFormat=n.internalFormat,this.textures=[],n.count);for(let e=0;e<r;e++)this.textures[e]=i.clone(),this.textures[e].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(n,i){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==n||this.height!==i||this.depth!==r){this.width=n,this.height=i,this.depth=r;for(let e=0,t=this.textures.length;e<t;e++)this.textures[e].image.width=n,this.textures[e].image.height=i,this.textures[e].image.depth=r;this.dispose()}this.viewport.set(0,0,n,i),this.scissor.set(0,0,n,i)}clone(){return(new this.constructor).copy(this)}copy(n){this.width=n.width,this.height=n.height,this.depth=n.depth,this.scissor.copy(n.scissor),this.scissorTest=n.scissorTest,this.viewport.copy(n.viewport);for(let e=this.textures.length=0,t=n.textures.length;e<t;e++)this.textures[e]=n.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0;var e=Object.assign({},n.texture.image);return this.texture.source=new $1(e),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,null!==n.depthTexture&&(this.depthTexture=n.depthTexture.clone()),this.samples=n.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class nA extends tA{constructor(){super(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}),this.isWebGLRenderTarget=!0}}class iA extends eA{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=V,this.minFilter=V,this.wrapR=Pe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}(class extends nA{});class rA extends eA{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=V,this.minFilter=V,this.wrapR=Pe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}(class extends nA{});class hd{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,a,o){let s=n[i+0],l=n[i+1],u=n[i+2],c=n[i+3];var n=r[a+0],i=r[a+1],h=r[a+2],r=r[a+3];if(0===o)e[t+0]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c;else if(1===o)e[t+0]=n,e[t+1]=i,e[t+2]=h,e[t+3]=r;else{if(c!==r||s!==n||l!==i||u!==h){let e=1-o;var a=s*n+l*i+u*h+c*r,d=0<=a?1:-1,p=1-a*a,a=(p>Number.EPSILON&&(p=Math.sqrt(p),a=Math.atan2(p,a*d),e=Math.sin(e*a)/p,o=Math.sin(o*a)/p),o*d);s=s*e+n*a,l=l*e+i*a,u=u*e+h*a,c=c*e+r*a,e===1-o&&(p=1/Math.sqrt(s*s+l*l+u*u+c*c),s*=p,l*=p,u*=p,c*=p)}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c}}static multiplyQuaternionsFlat(e,t,n,i,r,a){var o=n[i],s=n[i+1],l=n[i+2],n=n[i+3],i=r[a],u=r[a+1],c=r[a+2],r=r[a+3];return e[t]=o*r+n*i+s*c-l*u,e[t+1]=s*r+n*u+l*i-o*c,e[t+2]=l*r+n*c+o*u-s*i,e[t+3]=n*r-o*i-s*u-l*c,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=e._x,i=e._y,r=e._z,a=e._order,e=Math.cos,o=Math.sin,s=e(n/2),l=e(i/2),u=e(r/2),c=o(n/2),h=o(i/2),d=o(r/2);switch(a){case"XYZ":this._x=c*l*u+s*h*d,this._y=s*h*u-c*l*d,this._z=s*l*d+c*h*u,this._w=s*l*u-c*h*d;break;case"YXZ":this._x=c*l*u+s*h*d,this._y=s*h*u-c*l*d,this._z=s*l*d-c*h*u,this._w=s*l*u+c*h*d;break;case"ZXY":this._x=c*l*u-s*h*d,this._y=s*h*u+c*l*d,this._z=s*l*d+c*h*u,this._w=s*l*u-c*h*d;break;case"ZYX":this._x=c*l*u-s*h*d,this._y=s*h*u+c*l*d,this._z=s*l*d-c*h*u,this._w=s*l*u+c*h*d;break;case"YZX":this._x=c*l*u+s*h*d,this._y=s*h*u+c*l*d,this._z=s*l*d-c*h*u,this._w=s*l*u-c*h*d;break;case"XZY":this._x=c*l*u-s*h*d,this._y=s*h*u-c*l*d,this._z=s*l*d+c*h*u,this._w=s*l*u+c*h*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){var t=t/2,n=Math.sin(t);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(t),this._onChangeCallback(),this}setFromRotationMatrix(e){var e=e.elements,t=e[0],n=e[4],i=e[8],r=e[1],a=e[5],o=e[9],s=e[2],l=e[6],e=e[10],u=t+a+e;return 0<u?(u=.5/Math.sqrt(u+1),this._w=.25/u,this._x=(l-o)*u,this._y=(i-s)*u,this._z=(r-n)*u):a<t&&e<t?(u=2*Math.sqrt(1+t-a-e),this._w=(l-o)/u,this._x=.25*u,this._y=(n+r)/u,this._z=(i+s)/u):e<a?(u=2*Math.sqrt(1+a-t-e),this._w=(i-s)/u,this._x=(n+r)/u,this._y=.25*u,this._z=(o+l)/u):(u=2*Math.sqrt(1+e-t-a),this._w=(r-n)/u,this._x=(i+s)/u,this._y=(o+l)/u,this._z=.25*u),this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=n,this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Pd(this.dot(e),-1,1)))}rotateTowards(e,t){var n=this.angleTo(e);return 0!==n&&(t=Math.min(1,t/n),this.slerp(e,t)),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(e=1/e),this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){var n=e._x,i=e._y,r=e._z,e=e._w,a=t._x,o=t._y,s=t._z,t=t._w;return this._x=n*t+e*a+i*s-r*o,this._y=i*t+e*o+r*a-n*s,this._z=r*t+e*s+n*o-i*a,this._w=e*t-n*a-i*o-r*s,this._onChangeCallback(),this}slerp(t,n){if(0!==n){if(1===n)return this.copy(t);var i,r,a=this._x,o=this._y,s=this._z,l=this._w;let e=l*t._w+a*t._x+o*t._y+s*t._z;e<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,e=-e):this.copy(t),1<=e?(this._w=l,this._x=a,this._y=o,this._z=s):(t=1-e*e)<=Number.EPSILON?(this._w=(i=1-n)*l+n*this._w,this._x=i*a+n*this._x,this._y=i*o+n*this._y,this._z=i*s+n*this._z,this.normalize()):(i=Math.sqrt(t),t=Math.atan2(i,e),r=Math.sin((1-n)*t)/i,n=Math.sin(n*t)/i,this._w=l*r+this._w*n,this._x=a*r+this._x*n,this._y=o*r+this._y*n,this._z=s*r+this._z*n,this._onChangeCallback())}return this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){var e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),n=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),n*Math.sin(t),n*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class dd{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;dd.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Sn.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Sn.setFromAxisAngle(e,t))}applyMatrix3(e){var t=this.x,n=this.y,i=this.z,e=e.elements;return this.x=e[0]*t+e[3]*n+e[6]*i,this.y=e[1]*t+e[4]*n+e[7]*i,this.z=e[2]*t+e[5]*n+e[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){var t=this.x,n=this.y,i=this.z,e=e.elements,r=1/(e[3]*t+e[7]*n+e[11]*i+e[15]);return this.x=(e[0]*t+e[4]*n+e[8]*i+e[12])*r,this.y=(e[1]*t+e[5]*n+e[9]*i+e[13])*r,this.z=(e[2]*t+e[6]*n+e[10]*i+e[14])*r,this}applyQuaternion(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z,e=e.w,s=2*(a*i-o*n),l=2*(o*t-r*i),u=2*(r*n-a*t);return this.x=t+e*s+a*u-o*l,this.y=n+e*l+o*s-r*u,this.z=i+e*u+r*l-a*s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){var t=this.x,n=this.y,i=this.z,e=e.elements;return this.x=e[0]*t+e[4]*n+e[8]*i,this.y=e[1]*t+e[5]*n+e[9]*i,this.z=e[2]*t+e[6]*n+e[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){var n=e.x,i=e.y,e=e.z,r=t.x,a=t.y,t=t.z;return this.x=i*t-e*a,this.y=e*r-n*t,this.z=n*a-i*r,this}projectOnVector(e){var t=e.lengthSq();return 0===t?this.set(0,0,0):(t=e.dot(this)/t,this.copy(e).multiplyScalar(t))}projectOnPlane(e){return Tn.copy(this).projectOnVector(e),this.sub(Tn)}reflect(e){return this.sub(Tn.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===t?Math.PI/2:(e=this.dot(e)/t,Math.acos(Pd(e,-1,1)))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){var t=this.x-e.x,n=this.y-e.y,e=this.z-e.z;return t*t+n*n+e*e}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){var i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){e=e.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),e=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=e,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){var e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}let Tn=new dd,Sn=new hd;class pd{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new dd(1/0,1/0,1/0),t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new dd(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(n){this.makeEmpty();for(let e=0,t=n.length;e<t;e+=3)this.expandByPoint(bn.fromArray(n,e));return this}setFromBufferAttribute(n){this.makeEmpty();for(let e=0,t=n.count;e<t;e++)this.expandByPoint(bn.fromBufferAttribute(n,e));return this}setFromPoints(n){this.makeEmpty();for(let e=0,t=n.length;e<t;e++)this.expandByPoint(n[e]);return this}setFromCenterAndSize(e,t){t=bn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this}setFromObject(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(n){var i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],e=(n.updateWorldMatrix(!1,!1),n.geometry);if(void 0!==e){var r=e.getAttribute("position");if(!0===i&&void 0!==r&&!0!==n.isInstancedMesh)for(let e=0,t=r.count;e<t;e++)!0===n.isMesh?n.getVertexPosition(e,bn):bn.fromBufferAttribute(r,e),bn.applyMatrix4(n.matrixWorld),this.expandByPoint(bn);else void 0!==n.boundingBox?(null===n.boundingBox&&n.computeBoundingBox(),Mn.copy(n.boundingBox)):(null===e.boundingBox&&e.computeBoundingBox(),Mn.copy(e.boundingBox)),Mn.applyMatrix4(n.matrixWorld),this.union(Mn)}var a=n.children;for(let e=0,t=a.length;e<t;e++)this.expandByObject(a[e],i);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,bn),bn.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return n=0<e.normal.x?(t=e.normal.x*this.min.x,e.normal.x*this.max.x):(t=e.normal.x*this.max.x,e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){return!this.isEmpty()&&(this.getCenter(On),Pn.subVectors(this.max,On),Rn.subVectors(e.a,On),Nn.subVectors(e.b,On),In.subVectors(e.c,On),Cn.subVectors(Nn,Rn),Ln.subVectors(In,Nn),Dn.subVectors(Rn,In),!!jd([0,-Cn.z,Cn.y,0,-Ln.z,Ln.y,0,-Dn.z,Dn.y,Cn.z,0,-Cn.x,Ln.z,0,-Ln.x,Dn.z,0,-Dn.x,-Cn.y,Cn.x,0,-Ln.y,Ln.x,0,-Dn.y,Dn.x,0],Rn,Nn,In,Pn))&&!!jd([1,0,0,0,1,0,0,0,1],Rn,Nn,In,Pn)&&(Un.crossVectors(Cn,Ln),jd([Un.x,Un.y,Un.z],Rn,Nn,In,Pn))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,bn).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(bn).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(wn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),wn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),wn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),wn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),wn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),wn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),wn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),wn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(wn)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}let wn=[new dd,new dd,new dd,new dd,new dd,new dd,new dd,new dd],bn=new dd,Mn=new pd,Rn=new dd,Nn=new dd,In=new dd,Cn=new dd,Ln=new dd,Dn=new dd,On=new dd,Pn=new dd,Un=new dd,Bn=new dd;function jd(n,i,r,a,o){for(let e=0,t=n.length-3;e<=t;e+=3){Bn.fromArray(n,e);var s=o.x*Math.abs(Bn.x)+o.y*Math.abs(Bn.y)+o.z*Math.abs(Bn.z),l=i.dot(Bn),u=r.dot(Bn),c=a.dot(Bn);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>s)return!1}return!0}let Fn=new pd,zn=new dd,kn=new dd;class aA{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new dd,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1;this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(n,e){var i=this.center;void 0!==e?i.copy(e):Fn.setFromPoints(n).getCenter(i);let r=0;for(let e=0,t=n.length;e<t;e++)r=Math.max(r,i.distanceToSquared(n[e]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){var n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?e.makeEmpty():(e.set(this.center,this.center),e.expandByScalar(this.radius)),e}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){var t;return this.isEmpty()?(this.center.copy(e),this.radius=0):(zn.subVectors(e,this.center),(e=zn.lengthSq())>this.radius*this.radius&&(t=.5*((e=Math.sqrt(e))-this.radius),this.center.addScaledVector(zn,t/e),this.radius+=t)),this}union(e){return e.isEmpty()||(this.isEmpty()?this.copy(e):!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(kn.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(zn.copy(e.center).add(kn)),this.expandByPoint(zn.copy(e.center).sub(kn)))),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}let Gn=new dd,Hn=new dd,Vn=new dd,Wn=new dd,jn=new dd,Yn=new dd,qn=new dd;class oA{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new dd,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new dd(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Gn)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);e=t.dot(this.direction);return e<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,e)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){var t=Gn.subVectors(e,this.origin).dot(this.direction);return(t<0?this.origin:(Gn.copy(this.origin).addScaledVector(this.direction,t),Gn)).distanceToSquared(e)}distanceSqToSegment(e,t,n,i){Hn.copy(e).add(t).multiplyScalar(.5),Vn.copy(t).sub(e).normalize(),Wn.copy(this.origin).sub(Hn);var e=.5*e.distanceTo(t),t=-this.direction.dot(Vn),r=Wn.dot(this.direction),a=-Wn.dot(Vn),o=Wn.lengthSq(),s=Math.abs(1-t*t);let l,u,c,h;return c=0<s?(l=t*a-r,u=t*r-a,h=e*s,0<=l?u>=-h?u<=h?(s=1/s,l*=s,u*=s,l*(l+t*u+2*r)+u*(t*l+u+2*a)+o):(u=e,-(l=Math.max(0,-(t*u+r)))*l+u*(u+2*a)+o):(u=-e,-(l=Math.max(0,-(t*u+r)))*l+u*(u+2*a)+o):u<=-h?(l=Math.max(0,-(-t*e+r)),u=0<l?-e:Math.min(Math.max(-e,-a),e),-l*l+u*(u+2*a)+o):u<=h?(l=0,(u=Math.min(Math.max(-e,-a),e))*(u+2*a)+o):(l=Math.max(0,-(t*e+r)),u=0<l?e:Math.min(Math.max(-e,-a),e),-l*l+u*(u+2*a)+o)):(u=0<t?-e:e,-(l=Math.max(0,-(t*u+r)))*l+u*(u+2*a)+o),n&&n.copy(this.origin).addScaledVector(this.direction,l),i&&i.copy(Hn).addScaledVector(Vn,u),c}intersectSphere(e,t){Gn.subVectors(e.center,this.origin);var n=Gn.dot(this.direction),i=Gn.dot(Gn)-n*n,e=e.radius*e.radius;return e<i||(i=n-(e=Math.sqrt(e-i)),(n=n+e)<0)?null:i<0?this.at(n,t):this.at(i,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){var t=e.normal.dot(this.direction);return 0===t?0===e.distanceToPoint(this.origin)?0:null:0<=(e=-(this.origin.dot(e.normal)+e.constant)/t)?e:null}intersectPlane(e,t){e=this.distanceToPlane(e);return null===e?null:this.at(e,t)}intersectsPlane(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,a,o,s;var l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return i=0<=l?(n=(e.min.x-h.x)*l,(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,(e.min.x-h.x)*l),a=0<=u?(r=(e.min.y-h.y)*u,(e.max.y-h.y)*u):(r=(e.max.y-h.y)*u,(e.min.y-h.y)*u),n>a||r>i||((r>n||isNaN(n))&&(n=r),(a<i||isNaN(i))&&(i=a),s=0<=c?(o=(e.min.z-h.z)*c,(e.max.z-h.z)*c):(o=(e.max.z-h.z)*c,(e.min.z-h.z)*c),n>s)||o>i||((o>n||n!=n)&&(n=o),(i=s<i||i!=i?s:i)<0)?null:this.at(0<=n?n:i,t)}intersectsBox(e){return null!==this.intersectBox(e,Gn)}intersectTriangle(e,t,n,i,r){jn.subVectors(t,e),Yn.subVectors(n,e),qn.crossVectors(jn,Yn);let a=this.direction.dot(qn),o;if(0<a){if(i)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Wn.subVectors(this.origin,e);t=o*this.direction.dot(Yn.crossVectors(Wn,Yn));return t<0||(n=o*this.direction.dot(jn.cross(Wn)))<0||t+n>a||(i=-o*Wn.dot(qn))<0?null:this.at(i/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class fd{constructor(e,t,n,i,r,a,o,s,l,u,c,h,d,p,f,m){fd.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,a,o,s,l,u,c,h,d,p,f,m)}set(e,t,n,i,r,a,o,s,l,u,c,h,d,p,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new fd).fromArray(this.elements)}copy(e){var t=this.elements,e=e.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this}copyPosition(e){var t=this.elements,e=e.elements;return t[12]=e[12],t[13]=e[13],t[14]=e[14],this}setFromMatrix3(e){e=e.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){var t=this.elements,n=e.elements,i=1/Xn.setFromMatrixColumn(e,0).length(),r=1/Xn.setFromMatrixColumn(e,1).length(),e=1/Xn.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*e,t[9]=n[9]*e,t[10]=n[10]*e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){var t,n,i,r,a=this.elements,o=e.x,s=e.y,l=e.z,u=Math.cos(o),o=Math.sin(o),c=Math.cos(s),s=Math.sin(s),h=Math.cos(l),l=Math.sin(l);return"XYZ"===e.order?(n=u*h,i=u*l,r=o*h,t=o*l,a[0]=c*h,a[4]=-c*l,a[8]=s,a[1]=i+r*s,a[5]=n-t*s,a[9]=-o*c,a[2]=t-n*s,a[6]=r+i*s,a[10]=u*c):"YXZ"===e.order?(t=c*l,n=s*h,a[0]=(r=c*h)+(i=s*l)*o,a[4]=n*o-t,a[8]=u*s,a[1]=u*l,a[5]=u*h,a[9]=-o,a[2]=t*o-n,a[6]=i+r*o,a[10]=u*c):"ZXY"===e.order?(t=c*l,n=s*h,a[0]=(i=c*h)-(r=s*l)*o,a[4]=-u*l,a[8]=n+t*o,a[1]=t+n*o,a[5]=u*h,a[9]=r-i*o,a[2]=-u*s,a[6]=o,a[10]=u*c):"ZYX"===e.order?(t=u*h,n=u*l,r=o*h,i=o*l,a[0]=c*h,a[4]=r*s-n,a[8]=t*s+i,a[1]=c*l,a[5]=i*s+t,a[9]=n*s-r,a[2]=-s,a[6]=o*c,a[10]=u*c):"YZX"===e.order?(i=u*c,t=u*s,n=o*c,r=o*s,a[0]=c*h,a[4]=r-i*l,a[8]=n*l+t,a[1]=l,a[5]=u*h,a[9]=-o*h,a[2]=-s*h,a[6]=t*l+n,a[10]=i-r*l):"XZY"===e.order&&(t=u*c,n=u*s,i=o*c,r=o*s,a[0]=c*h,a[4]=-l,a[8]=s*h,a[1]=t*l+r,a[5]=u*h,a[9]=n*l-i,a[2]=i*l-n,a[6]=o*h,a[10]=r*l+t),a[3]=0,a[7]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Kn,e,Jn)}lookAt(e,t,n){var i=this.elements;return a.subVectors(e,t),0===a.lengthSq()&&(a.z=1),a.normalize(),Qn.crossVectors(n,a),0===Qn.lengthSq()&&(1===Math.abs(n.z)?a.x+=1e-4:a.z+=1e-4,a.normalize(),Qn.crossVectors(n,a)),Qn.normalize(),$n.crossVectors(a,Qn),i[0]=Qn.x,i[4]=$n.x,i[8]=a.x,i[1]=Qn.y,i[5]=$n.y,i[9]=a.y,i[2]=Qn.z,i[6]=$n.z,i[10]=a.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){var e=e.elements,t=t.elements,n=this.elements,i=e[0],r=e[4],a=e[8],o=e[12],s=e[1],l=e[5],u=e[9],c=e[13],h=e[2],d=e[6],p=e[10],f=e[14],m=e[3],g=e[7],v=e[11],e=e[15],_=t[0],y=t[4],E=t[8],A=t[12],x=t[1],T=t[5],S=t[9],w=t[13],b=t[2],M=t[6],R=t[10],N=t[14],I=t[3],C=t[7],L=t[11],t=t[15];return n[0]=i*_+r*x+a*b+o*I,n[4]=i*y+r*T+a*M+o*C,n[8]=i*E+r*S+a*R+o*L,n[12]=i*A+r*w+a*N+o*t,n[1]=s*_+l*x+u*b+c*I,n[5]=s*y+l*T+u*M+c*C,n[9]=s*E+l*S+u*R+c*L,n[13]=s*A+l*w+u*N+c*t,n[2]=h*_+d*x+p*b+f*I,n[6]=h*y+d*T+p*M+f*C,n[10]=h*E+d*S+p*R+f*L,n[14]=h*A+d*w+p*N+f*t,n[3]=m*_+g*x+v*b+e*I,n[7]=m*y+g*T+v*M+e*C,n[11]=m*E+g*S+v*R+e*L,n[15]=m*A+g*w+v*N+e*t,this}multiplyScalar(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],o=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],d=e[14];return e[3]*(+r*s*c-i*l*c-r*o*h+n*l*h+i*o*d-n*s*d)+e[7]*(+t*s*d-t*l*h+r*a*h-i*a*d+i*l*u-r*s*u)+e[11]*(+t*l*c-t*o*d-r*a*c+n*a*d+r*o*u-n*l*u)+e[15]*(-i*o*u-t*s*c+t*o*h+i*a*c-n*a*h+n*s*u)}transpose(){var e=this.elements,t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=c*m*l-f*h*l+f*s*d-o*m*d-c*s*g+o*h*g,_=p*h*l-u*m*l-p*s*d+a*m*d+u*s*g-a*h*g,y=u*f*l-p*c*l+p*o*d-a*f*d-u*o*g+a*c*g,E=p*c*s-u*f*s-p*o*h+a*f*h+u*o*m-a*c*m,A=t*v+n*_+i*y+r*E;return 0==A?this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0):(e[0]=v*(v=1/A),e[1]=(f*h*r-c*m*r-f*i*d+n*m*d+c*i*g-n*h*g)*v,e[2]=(o*m*r-f*s*r+f*i*l-n*m*l-o*i*g+n*s*g)*v,e[3]=(c*s*r-o*h*r-c*i*l+n*h*l+o*i*d-n*s*d)*v,e[4]=_*v,e[5]=(u*m*r-p*h*r+p*i*d-t*m*d-u*i*g+t*h*g)*v,e[6]=(p*s*r-a*m*r-p*i*l+t*m*l+a*i*g-t*s*g)*v,e[7]=(a*h*r-u*s*r+u*i*l-t*h*l-a*i*d+t*s*d)*v,e[8]=y*v,e[9]=(p*c*r-u*f*r-p*n*d+t*f*d+u*n*g-t*c*g)*v,e[10]=(a*f*r-p*o*r+p*n*l-t*f*l-a*n*g+t*o*g)*v,e[11]=(u*o*r-a*c*r-u*n*l+t*c*l+a*n*d-t*o*d)*v,e[12]=E*v,e[13]=(u*f*i-p*c*i+p*n*h-t*f*h-u*n*m+t*c*m)*v,e[14]=(p*o*i-a*f*i-p*n*s+t*f*s+a*n*m-t*o*m)*v,e[15]=(a*c*i-u*o*i+u*n*s-t*c*s-a*n*h+t*o*h)*v,this)}scale(e){var t=this.elements,n=e.x,i=e.y,e=e.z;return t[0]*=n,t[4]*=i,t[8]*=e,t[1]*=n,t[5]*=i,t[9]*=e,t[2]*=n,t[6]*=i,t[10]*=e,t[3]*=n,t[7]*=i,t[11]*=e,this}getMaxScaleOnAxis(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return Math.sqrt(Math.max(t,e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this}makeRotationY(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this}makeRotationZ(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){var n=Math.cos(t),t=Math.sin(t),i=1-n,r=e.x,a=e.y,e=e.z,o=i*r,s=i*a;return this.set(o*r+n,o*a-t*e,o*e+t*a,0,o*a+t*e,s*a+n,s*e-t*r,0,o*e-t*a,s*e+t*r,i*e*e+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,a){return this.set(1,n,r,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){var i=this.elements,r=t._x,a=t._y,o=t._z,t=t._w,s=r+r,l=a+a,u=o+o,c=r*s,h=r*l,r=r*u,d=a*l,a=a*u,o=o*u,s=t*s,l=t*l,t=t*u,u=n.x,p=n.y,n=n.z;return i[0]=(1-(d+o))*u,i[1]=(h+t)*u,i[2]=(r-l)*u,i[3]=0,i[4]=(h-t)*p,i[5]=(1-(c+o))*p,i[6]=(a+s)*p,i[7]=0,i[8]=(r+l)*n,i[9]=(a-s)*n,i[10]=(1-(c+d))*n,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){var i=this.elements;let r=Xn.set(i[0],i[1],i[2]).length();var a=Xn.set(i[4],i[5],i[6]).length(),o=Xn.set(i[8],i[9],i[10]).length(),e=(this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Zn.copy(this),1/r),i=1/a,s=1/o;return Zn.elements[0]*=e,Zn.elements[1]*=e,Zn.elements[2]*=e,Zn.elements[4]*=i,Zn.elements[5]*=i,Zn.elements[6]*=i,Zn.elements[8]*=s,Zn.elements[9]*=s,Zn.elements[10]*=s,t.setFromRotationMatrix(Zn),n.x=r,n.y=a,n.z=o,this}makePerspective(e,t,n,i,r,a){var o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:2e3,s=this.elements,l=2*r/(t-e),u=2*r/(n-i),t=(t+e)/(t-e),e=(n+i)/(n-i);let c,h;if(2e3===o)c=-(a+r)/(a-r),h=-2*a*r/(a-r);else{if(2001!==o)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);c=-a/(a-r),h=-a*r/(a-r)}return s[0]=l,s[4]=0,s[8]=t,s[12]=0,s[1]=0,s[5]=u,s[9]=e,s[13]=0,s[2]=0,s[6]=0,s[10]=c,s[14]=h,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,n,i,r,a){var o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:2e3,s=this.elements,l=1/(t-e),u=1/(n-i),c=1/(a-r),t=(t+e)*l,e=(n+i)*u;let h,d;if(2e3===o)h=(a+r)*c,d=-2*c;else{if(2001!==o)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);h=r*c,d=-1*c}return s[0]=2*l,s[4]=0,s[8]=0,s[12]=-t,s[1]=0,s[5]=2*u,s[9]=0,s[13]=-e,s[2]=0,s[6]=0,s[10]=d,s[14]=-h,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){var t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;for(let e=0;e<16;e++)this.elements[e]=t[e+n];return this}toArray(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}let Xn=new dd,Zn=new fd,Kn=new dd(0,0,0),Jn=new dd(1,1,1),Qn=new dd,$n=new dd,a=new dd,ei=new fd,ti=new hd;class md{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:md.DEFAULT_ORDER;this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._order,n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],e=e.elements,i=e[0],r=e[4],a=e[8],o=e[1],s=e[5],l=e[9],u=e[2],c=e[6],h=e[10];switch(t){case"XYZ":this._y=Math.asin(Pd(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,h),this._z=Math.atan2(-r,i)):(this._x=Math.atan2(c,s),this._z=0);break;case"YXZ":this._x=Math.asin(-Pd(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(a,h),this._z=Math.atan2(o,s)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(Pd(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(-u,h),this._z=Math.atan2(-r,s)):(this._y=0,this._z=Math.atan2(o,i));break;case"ZYX":this._y=Math.asin(-Pd(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(c,h),this._z=Math.atan2(o,i)):(this._x=0,this._z=Math.atan2(-r,s));break;case"YZX":this._z=Math.asin(Pd(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,s),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(a,h));break;case"XZY":this._z=Math.asin(-Pd(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(c,s),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-l,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return ei.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ei,t,n)}setFromVector3(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return ti.setFromEuler(this),this.setFromQuaternion(ti,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}md.DEFAULT_ORDER="XYZ";class sA{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let ni=0,ii=new dd,ri=new hd,ai=new fd,oi=new dd,si=new dd,li=new dd,ui=new hd,ci=new dd(1,0,0),hi=new dd(0,1,0),di=new dd(0,0,1),pi={type:"added"},fi={type:"removed"},mi={type:"childadded",child:null},gi={type:"childremoved",child:null};class gd extends J1{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ni++}),this.uuid=Od(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=gd.DEFAULT_UP.clone();var e=new dd;let t=new md,n=new hd;var i=new dd(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new fd},normalMatrix:{value:new ud}}),this.matrix=new fd,this.matrixWorld=new fd,this.matrixAutoUpdate=gd.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=gd.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new sA,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ri.setFromAxisAngle(e,t),this.quaternion.multiply(ri),this}rotateOnWorldAxis(e,t){return ri.setFromAxisAngle(e,t),this.quaternion.premultiply(ri),this}rotateX(e){return this.rotateOnAxis(ci,e)}rotateY(e){return this.rotateOnAxis(hi,e)}rotateZ(e){return this.rotateOnAxis(di,e)}translateOnAxis(e,t){return ii.copy(e).applyQuaternion(this.quaternion),this.position.add(ii.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(ci,e)}translateY(e){return this.translateOnAxis(hi,e)}translateZ(e){return this.translateOnAxis(di,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ai.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?oi.copy(e):oi.set(e,t,n);e=this.parent;this.updateWorldMatrix(!0,!1),si.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ai.lookAt(si,oi,this.up):ai.lookAt(oi,si,this.up),this.quaternion.setFromRotationMatrix(ai),e&&(ai.extractRotation(e.matrixWorld),ri.setFromRotationMatrix(ai),this.quaternion.premultiply(ri.invert()))}add(e){if(1<arguments.length)for(let e=0;e<arguments.length;e++)this.add(arguments[e]);else e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(e.removeFromParent(),(e.parent=this).children.push(e),e.dispatchEvent(pi),mi.child=e,this.dispatchEvent(mi),mi.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e);return this}remove(e){if(1<arguments.length)for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);else{var t=this.children.indexOf(e);-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(fi),gi.child=e,this.dispatchEvent(gi),gi.child=null)}return this}removeFromParent(){var e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),ai.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ai.multiply(e.parent.matrixWorld)),e.applyMatrix4(ai),e.removeFromParent(),(e.parent=this).children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(pi),mi.child=e,this.dispatchEvent(mi),mi.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(n,i){if(this[n]===i)return this;for(let e=0,t=this.children.length;e<t;e++){var r=this.children[e].getObjectByProperty(n,i);if(void 0!==r)return r}}getObjectsByProperty(n,i){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],a=(this[n]===i&&r.push(this),this.children);for(let e=0,t=a.length;e<t;e++)a[e].getObjectsByProperty(n,i,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(si,e,li),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(si,ui,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(n){n(this);var i=this.children;for(let e=0,t=i.length;e<t;e++)i[e].traverse(n)}traverseVisible(n){if(!1!==this.visible){n(this);var i=this.children;for(let e=0,t=i.length;e<t;e++)i[e].traverseVisible(n)}}traverseAncestors(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(n){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||n)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),n=!(this.matrixWorldNeedsUpdate=!1));var i=this.children;for(let e=0,t=i.length;e<t;e++)i[e].updateMatrixWorld(n)}updateWorldMatrix(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){var i=this.children;for(let e=0,t=i.length;e<t;e++)i[e].updateWorldMatrix(!1,!0)}}toJSON(n){var e,t,i,r,a,o,s=void 0===n||"string"==typeof n,l={},u=(s&&(n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},l.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"}),{});function c(e,t){return void 0===e[t.uuid]&&(e[t.uuid]=t.toJSON(n)),t.uuid}if(u.uuid=this.uuid,u.type=this.type,""!==this.name&&(u.name=this.name),!0===this.castShadow&&(u.castShadow=!0),!0===this.receiveShadow&&(u.receiveShadow=!0),!1===this.visible&&(u.visible=!1),!1===this.frustumCulled&&(u.frustumCulled=!1),0!==this.renderOrder&&(u.renderOrder=this.renderOrder),0<Object.keys(this.userData).length&&(u.userData=this.userData),u.layers=this.layers.mask,u.matrix=this.matrix.toArray(),u.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(u.matrixAutoUpdate=!1),this.isInstancedMesh&&(u.type="InstancedMesh",u.count=this.count,u.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor)&&(u.instanceColor=this.instanceColor.toJSON()),this.isBatchedMesh&&(u.type="BatchedMesh",u.perObjectFrustumCulled=this.perObjectFrustumCulled,u.sortObjects=this.sortObjects,u.drawRanges=this._drawRanges,u.reservedRanges=this._reservedRanges,u.visibility=this._visibility,u.active=this._active,u.bounds=this._bounds.map(e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()})),u.maxInstanceCount=this._maxInstanceCount,u.maxVertexCount=this._maxVertexCount,u.maxIndexCount=this._maxIndexCount,u.geometryInitialized=this._geometryInitialized,u.geometryCount=this._geometryCount,u.matricesTexture=this._matricesTexture.toJSON(n),null!==this._colorsTexture&&(u.colorsTexture=this._colorsTexture.toJSON(n)),null!==this.boundingSphere&&(u.boundingSphere={center:u.boundingSphere.center.toArray(),radius:u.boundingSphere.radius}),null!==this.boundingBox)&&(u.boundingBox={min:u.boundingBox.min.toArray(),max:u.boundingBox.max.toArray()}),this.isScene)this.background&&(this.background.isColor?u.background=this.background.toJSON():this.background.isTexture&&(u.background=this.background.toJSON(n).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(u.environment=this.environment.toJSON(n).uuid);else if(this.isMesh||this.isLine||this.isPoints){u.geometry=c(n.geometries,this.geometry);var h=this.geometry.parameters;if(void 0!==h&&void 0!==h.shapes){var d=h.shapes;if(Array.isArray(d))for(let e=0,t=d.length;e<t;e++){var p=d[e];c(n.shapes,p)}else c(n.shapes,d)}}if(this.isSkinnedMesh&&(u.bindMode=this.bindMode,u.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton)&&(c(n.skeletons,this.skeleton),u.skeleton=this.skeleton.uuid),void 0!==this.material)if(Array.isArray(this.material)){var f=[];for(let e=0,t=this.material.length;e<t;e++)f.push(c(n.materials,this.material[e]));u.material=f}else u.material=c(n.materials,this.material);if(0<this.children.length){u.children=[];for(let e=0;e<this.children.length;e++)u.children.push(this.children[e].toJSON(n).object)}if(0<this.animations.length){u.animations=[];for(let e=0;e<this.animations.length;e++){var m=this.animations[e];u.animations.push(c(n.animations,m))}}return s&&(h=g(n.geometries),s=g(n.materials),e=g(n.textures),t=g(n.images),i=g(n.shapes),r=g(n.skeletons),a=g(n.animations),o=g(n.nodes),0<h.length&&(l.geometries=h),0<s.length&&(l.materials=s),0<e.length&&(l.textures=e),0<t.length&&(l.images=t),0<i.length&&(l.shapes=i),0<r.length&&(l.skeletons=r),0<a.length&&(l.animations=a),0<o.length)&&(l.nodes=o),l.object=u,l;function g(e){var t,n=[];for(t in e){var i=e[t];delete i.metadata,n.push(i)}return n}}clone(e){return(new this.constructor).copy(this,e)}copy(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){var n=t.children[e];this.add(n.clone())}return this}}gd.DEFAULT_UP=new dd(0,1,0),gd.DEFAULT_MATRIX_AUTO_UPDATE=!0,gd.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;let vi=new dd,_i=new dd,yi=new dd,Ei=new dd,Ai=new dd,xi=new dd,Ti=new dd,Si=new dd,wi=new dd,bi=new dd;class lA{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new dd,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new dd,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new dd;this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),vi.subVectors(e,t),i.cross(vi);n=i.lengthSq();return 0<n?i.multiplyScalar(1/Math.sqrt(n)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){vi.subVectors(i,t),_i.subVectors(n,t),yi.subVectors(e,t);var i=vi.dot(vi),n=vi.dot(_i),e=vi.dot(yi),t=_i.dot(_i),a=_i.dot(yi),o=i*t-n*n;return 0==o?(r.set(0,0,0),null):r.set(1-(t=(t*e-n*a)*(r=1/o))-(o=(i*a-n*e)*r),o,t)}static containsPoint(e,t,n,i){return null!==this.getBarycoord(e,t,n,i,Ei)&&0<=Ei.x&&0<=Ei.y&&Ei.x+Ei.y<=1}static getInterpolation(e,t,n,i,r,a,o,s){return null===this.getBarycoord(e,t,n,i,Ei)?(s.x=0,s.y=0,"z"in s&&(s.z=0),"w"in s&&(s.w=0),null):(s.setScalar(0),s.addScaledVector(r,Ei.x),s.addScaledVector(a,Ei.y),s.addScaledVector(o,Ei.z),s)}static isFrontFacing(e,t,n,i){return vi.subVectors(n,t),_i.subVectors(e,t),vi.cross(_i).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return vi.subVectors(this.c,this.b),_i.subVectors(this.a,this.b),.5*vi.cross(_i).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return lA.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return lA.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,r){return lA.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return lA.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return lA.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){var n=this.a,i=this.b,r=this.c;let a,o;Ai.subVectors(i,n),xi.subVectors(r,n),Si.subVectors(e,n);var s=Ai.dot(Si),l=xi.dot(Si);if(s<=0&&l<=0)return t.copy(n);wi.subVectors(e,i);var u=Ai.dot(wi),c=xi.dot(wi);if(0<=u&&c<=u)return t.copy(i);var h=s*c-u*l;if(h<=0&&0<=s&&u<=0)return a=s/(s-u),t.copy(n).addScaledVector(Ai,a);bi.subVectors(e,r);var e=Ai.dot(bi),d=xi.dot(bi);return 0<=d&&e<=d?t.copy(r):(s=e*l-s*d)<=0&&0<=l&&d<=0?(o=l/(l-d),t.copy(n).addScaledVector(xi,o)):(l=u*d-e*c)<=0&&0<=c-u&&0<=e-d?(Ti.subVectors(r,i),o=(c-u)/(c-u+(e-d)),t.copy(i).addScaledVector(Ti,o)):(r=1/(l+s+h),a=s*r,o=h*r,t.copy(n).addScaledVector(Ai,a).addScaledVector(xi,o))}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Mi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ri={h:0,s:0,l:0},Ni={h:0,s:0,l:0};function Yd(e,t,n){return n<0&&(n+=1),1<n&&--n,n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class vd{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){var i;return void 0===t&&void 0===n?(i=e)&&i.isColor?this.copy(i):"number"==typeof i?this.setHex(i):"string"==typeof i&&this.setStyle(i):this.setRGB(e,t,n),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:je;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,qe.toWorkingColorSpace(this,t),this}setRGB(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:qe.workingColorSpace;return this.r=e,this.g=t,this.b=n,qe.toWorkingColorSpace(this,i),this}setHSL(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:qe.workingColorSpace;return e=Ud(e,1),t=Pd(t,0,1),n=Pd(n,0,1),0===t?this.r=this.g=this.b=n:(this.r=Yd(t=2*n-(n=n<=.5?n*(1+t):n+t-n*t),n,e+1/3),this.g=Yd(t,n,e),this.b=Yd(t,n,e-1/3)),qe.toWorkingColorSpace(this,i),this}setStyle(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:je;function i(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}if(o=/^(\w+)\(([^\)]*)\)/.exec(t)){let e;var r=o[1],a=o[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(e[4]),this.setRGB(Math.min(255,parseInt(e[1],10))/255,Math.min(255,parseInt(e[2],10))/255,Math.min(255,parseInt(e[3],10))/255,n);if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(e[4]),this.setRGB(Math.min(100,parseInt(e[1],10))/100,Math.min(100,parseInt(e[2],10))/100,Math.min(100,parseInt(e[3],10))/100,n);break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(e[4]),this.setHSL(parseFloat(e[1])/360,parseFloat(e[2])/100,parseFloat(e[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(o=/^\#([A-Fa-f\d]+)$/.exec(t)){var r=o[1],o=r.length;if(3===o)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,n);if(6===o)return this.setHex(parseInt(r,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&0<t.length)return this.setColorName(t,n);return this}setColorName(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:je,n=Mi[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Hd(e.r),this.g=Hd(e.g),this.b=Hd(e.b),this}copyLinearToSRGB(e){return this.r=Vd(e.r),this.g=Vd(e.g),this.b=Vd(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:je;return qe.fromWorkingColorSpace(c.copy(this),e),65536*Math.round(Pd(255*c.r,0,255))+256*Math.round(Pd(255*c.g,0,255))+Math.round(Pd(255*c.b,0,255))}getHexString(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:je;return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:qe.workingColorSpace,n=(qe.fromWorkingColorSpace(c.copy(this),t),c.r),i=c.g,r=c.b,t=Math.max(n,i,r),a=Math.min(n,i,r);let o,s;var l=(a+t)/2;if(a===t)o=0,s=0;else{var u=t-a;switch(s=l<=.5?u/(t+a):u/(2-t-a),t){case n:o=(i-r)/u+(i<r?6:0);break;case i:o=(r-n)/u+2;break;case r:o=(n-i)/u+4}o/=6}return e.h=o,e.s=s,e.l=l,e}getRGB(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:qe.workingColorSpace;return qe.fromWorkingColorSpace(c.copy(this),t),e.r=c.r,e.g=c.g,e.b=c.b,e}getStyle(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:je,t=(qe.fromWorkingColorSpace(c.copy(this),e),c.r),n=c.g,i=c.b;return e!==je?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(e,t,n){return this.getHSL(Ri),this.setHSL(Ri.h+e,Ri.s+t,Ri.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Ri),e.getHSL(Ni);var e=Bd(Ri.h,Ni.h,t),n=Bd(Ri.s,Ni.s,t),t=Bd(Ri.l,Ni.l,t);return this.setHSL(e,n,t),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){var t=this.r,n=this.g,i=this.b,e=e.elements;return this.r=e[0]*t+e[3]*n+e[6]*i,this.g=e[1]*t+e[4]*n+e[7]*i,this.b=e[2]*t+e[5]*n+e[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let c=new vd,Ii=(vd.NAMES=Mi,0);class uA extends J1{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Ii++}),this.uuid=Od(),this.name="",this.type="Material",this.blending=fe,this.side=ke,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=de,this.blendDst=me,this.blendEquation=ie,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new vd(0,0,0),this.blendAlpha=0,this.depthFunc=Re,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){0<this._alphaTest!=0<e&&this.version++,this._alphaTest=e}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(var t in e){var n,i=e[t];void 0===i?console.warn(`THREE.Material: parameter '${t}' has value of undefined.`):void 0===(n=this[t])?console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`):n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i}}toJSON(e){var t=void 0===e||"string"==typeof e,n=(t&&(e={textures:{},images:{}}),{metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}});function i(e){var t,n=[];for(t in e){var i=e[t];delete i.metadata,n.push(i)}return n}return n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine)&&(n.combine=this.combine),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==fe&&(n.blending=this.blending),this.side!==ke&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==de&&(n.blendSrc=this.blendSrc),this.blendDst!==me&&(n.blendDst=this.blendDst),this.blendEquation!==ie&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Re&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),7680!==this.stencilFail&&(n.stencilFail=this.stencilFail),7680!==this.stencilZFail&&(n.stencilZFail=this.stencilZFail),7680!==this.stencilZPass&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),0<this.alphaTest&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),1<this.wireframeLinewidth&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),0<Object.keys(this.userData).length&&(n.userData=this.userData),t&&(t=i(e.textures),e=i(e.images),0<t.length&&(n.textures=t),0<e.length)&&(n.images=e),n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes;let n=null;if(null!==t){var i=t.length;n=new Array(i);for(let e=0;e!==i;++e)n[e]=t[e].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}onBeforeRender(){console.warn("Material: onBeforeRender() has been removed.")}}class _d extends uA{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new vd(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new md,this.combine=R,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}let i=new dd,Ci=new ld;class yd{constructor(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=35044,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=j,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return Gd("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(n,i,r){n*=this.itemSize,r*=i.itemSize;for(let e=0,t=this.itemSize;e<t;e++)this.array[n+e]=i.array[r+e];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(n){if(2===this.itemSize)for(let e=0,t=this.count;e<t;e++)Ci.fromBufferAttribute(this,e),Ci.applyMatrix3(n),this.setXY(e,Ci.x,Ci.y);else if(3===this.itemSize)for(let e=0,t=this.count;e<t;e++)i.fromBufferAttribute(this,e),i.applyMatrix3(n),this.setXYZ(e,i.x,i.y,i.z);return this}applyMatrix4(n){for(let e=0,t=this.count;e<t;e++)i.fromBufferAttribute(this,e),i.applyMatrix4(n),this.setXYZ(e,i.x,i.y,i.z);return this}applyNormalMatrix(n){for(let e=0,t=this.count;e<t;e++)i.fromBufferAttribute(this,e),i.applyNormalMatrix(n),this.setXYZ(e,i.x,i.y,i.z);return this}transformDirection(n){for(let e=0,t=this.count;e<t;e++)i.fromBufferAttribute(this,e),i.transformDirection(n),this.setXYZ(e,i.x,i.y,i.z);return this}set(e){return this.array.set(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:0),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return n=this.normalized?Fd(n,this.array):n}setComponent(e,t,n){return this.normalized&&(n=Jh(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return t=this.normalized?Fd(t,this.array):t}setX(e,t){return this.normalized&&(t=Jh(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return t=this.normalized?Fd(t,this.array):t}setY(e,t){return this.normalized&&(t=Jh(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return t=this.normalized?Fd(t,this.array):t}setZ(e,t){return this.normalized&&(t=Jh(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return t=this.normalized?Fd(t,this.array):t}setW(e,t){return this.normalized&&(t=Jh(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Jh(t,this.array),n=Jh(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Jh(t,this.array),n=Jh(n,this.array),i=Jh(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=Jh(t,this.array),n=Jh(n,this.array),i=Jh(i,this.array),r=Jh(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),e}}(class extends yd{}),class extends yd{},class extends yd{},class extends yd{};class cA extends yd{constructor(e,t,n){super(new Uint16Array(e),t,n)}}(class extends yd{});class hA extends yd{constructor(e,t,n){super(new Uint32Array(e),t,n)}}(class extends yd{});class Ed extends yd{constructor(e,t,n){super(new Float32Array(e),t,n)}}let Li=0,o=new fd,Di=new gd,Oi=new dd,u=new pd,Pi=new pd,h=new dd;class Ad extends J1{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Li++}),this.uuid=Od(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(zd(e)?hA:cA)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){this.groups.push({start:e,count:t,materialIndex:2<arguments.length&&void 0!==arguments[2]?arguments[2]:0})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){var t=this.attributes.position,t=(void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0),this.attributes.normal),n=(void 0!==t&&(n=(new ud).getNormalMatrix(e),t.applyNormalMatrix(n),t.needsUpdate=!0),this.attributes.tangent);return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return o.makeRotationFromQuaternion(e),this.applyMatrix4(o),this}rotateX(e){return o.makeRotationX(e),this.applyMatrix4(o),this}rotateY(e){return o.makeRotationY(e),this.applyMatrix4(o),this}rotateZ(e){return o.makeRotationZ(e),this.applyMatrix4(o),this}translate(e,t,n){return o.makeTranslation(e,t,n),this.applyMatrix4(o),this}scale(e,t,n){return o.makeScale(e,t,n),this.applyMatrix4(o),this}lookAt(e){return Di.lookAt(e),Di.updateMatrix(),this.applyMatrix4(Di.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Oi).negate(),this.translate(Oi.x,Oi.y,Oi.z),this}setFromPoints(n){var i=[];for(let e=0,t=n.length;e<t;e++){var r=n[e];i.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Ed(i,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new pd);var e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new dd(-1/0,-1/0,-1/0),new dd(1/0,1/0,1/0));else{if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),n)for(let e=0,t=n.length;e<t;e++){var i=n[e];u.setFromBufferAttribute(i),this.morphTargetsRelative?(h.addVectors(this.boundingBox.min,u.min),this.boundingBox.expandByPoint(h),h.addVectors(this.boundingBox.max,u.max),this.boundingBox.expandByPoint(h)):(this.boundingBox.expandByPoint(u.min),this.boundingBox.expandByPoint(u.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new aA);var i=this.attributes.position,r=this.morphAttributes.position;if(i&&i.isGLBufferAttribute)console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new dd,1/0);else if(i){var a=this.boundingSphere.center;if(u.setFromBufferAttribute(i),r)for(let e=0,t=r.length;e<t;e++){var o=r[e];Pi.setFromBufferAttribute(o),this.morphTargetsRelative?(h.addVectors(u.min,Pi.min),u.expandByPoint(h),h.addVectors(u.max,Pi.max),u.expandByPoint(h)):(u.expandByPoint(Pi.min),u.expandByPoint(Pi.max))}u.getCenter(a);let n=0;for(let e=0,t=i.count;e<t;e++)h.fromBufferAttribute(i,e),n=Math.max(n,a.distanceToSquared(h));if(r)for(let e=0,t=r.length;e<t;e++){var s=r[e],l=this.morphTargetsRelative;for(let e=0,t=s.count;e<t;e++)h.fromBufferAttribute(s,e),l&&(Oi.fromBufferAttribute(i,e),h.add(Oi)),n=Math.max(n,a.distanceToSquared(h))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){var A,x,T,S,w=this.index,e=this.attributes;if(null===w||void 0===e.position||void 0===e.normal||void 0===e.uv)console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");else{let n=e.position,i=e.normal,r=e.uv,a=(!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new yd(new Float32Array(4*n.count),4)),this.getAttribute("tangent")),o=[],s=[];for(let e=0;e<n.count;e++)o[e]=new dd,s[e]=new dd;let l=new dd,u=new dd,c=new dd,h=new ld,d=new ld,p=new ld,f=new dd,m=new dd,g=this.groups;for(let e=0,t=(g=0===g.length?[{start:0,count:w.count}]:g).length;e<t;++e){var b=g[e],M=b.start;for(let e=M,t=M+b.count;e<t;e+=3)A=w.getX(e+0),x=w.getX(e+1),T=w.getX(e+2),S=void 0,l.fromBufferAttribute(n,A),u.fromBufferAttribute(n,x),c.fromBufferAttribute(n,T),h.fromBufferAttribute(r,A),d.fromBufferAttribute(r,x),p.fromBufferAttribute(r,T),u.sub(l),c.sub(l),d.sub(h),p.sub(h),S=1/(d.x*p.y-p.x*d.y),isFinite(S)&&(f.copy(u).multiplyScalar(p.y).addScaledVector(c,-d.y).multiplyScalar(S),m.copy(c).multiplyScalar(d.x).addScaledVector(u,-p.x).multiplyScalar(S),o[A].add(f),o[x].add(f),o[T].add(f),s[A].add(m),s[x].add(m),s[T].add(m))}let v=new dd,_=new dd,y=new dd,E=new dd;for(let e=0,t=g.length;e<t;++e){var R=g[e],N=R.start;for(let e=N,t=N+R.count;e<t;e+=3)I(w.getX(e+0)),I(w.getX(e+1)),I(w.getX(e+2))}function I(e){y.fromBufferAttribute(i,e),E.copy(y);var t=o[e],t=(v.copy(t),v.sub(y.multiplyScalar(y.dot(t))).normalize(),_.crossVectors(E,t),_.dot(s[e])),t=t<0?-1:1;a.setXYZW(e,v.x,v.y,v.z,t)}}}computeVertexNormals(){var i=this.index,r=this.getAttribute("position");if(void 0!==r){let n=this.getAttribute("normal");if(void 0===n)n=new yd(new Float32Array(3*r.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);var a=new dd,o=new dd,s=new dd,l=new dd,u=new dd,c=new dd,h=new dd,d=new dd;if(i)for(let e=0,t=i.count;e<t;e+=3){var p=i.getX(e+0),f=i.getX(e+1),m=i.getX(e+2);a.fromBufferAttribute(r,p),o.fromBufferAttribute(r,f),s.fromBufferAttribute(r,m),h.subVectors(s,o),d.subVectors(a,o),h.cross(d),l.fromBufferAttribute(n,p),u.fromBufferAttribute(n,f),c.fromBufferAttribute(n,m),l.add(h),u.add(h),c.add(h),n.setXYZ(p,l.x,l.y,l.z),n.setXYZ(f,u.x,u.y,u.z),n.setXYZ(m,c.x,c.y,c.z)}else for(let e=0,t=r.count;e<t;e+=3)a.fromBufferAttribute(r,e+0),o.fromBufferAttribute(r,e+1),s.fromBufferAttribute(r,e+2),h.subVectors(s,o),d.subVectors(a,o),h.cross(d),n.setXYZ(e+0,h.x,h.y,h.z),n.setXYZ(e+1,h.x,h.y,h.z),n.setXYZ(e+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){var n=this.attributes.normal;for(let e=0,t=n.count;e<t;e++)h.fromBufferAttribute(n,e),h.normalize(),n.setXYZ(e,h.x,h.y,h.z)}toNonIndexed(){function n(n,i){var r=n.array,a=n.itemSize,e=n.normalized,o=new r.constructor(i.length*a);let s=0,l=0;for(let e=0,t=i.length;e<t;e++){s=n.isInterleavedBufferAttribute?i[e]*n.data.stride+n.offset:i[e]*a;for(let e=0;e<a;e++)o[l++]=r[s++]}return new yd(o,a,e)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var e,i=new Ad,r=this.index.array,t=this.attributes;for(e in t){var a=n(t[e],r);i.setAttribute(e,a)}var o,s=this.morphAttributes;for(o in s){var l=[],u=s[o];for(let e=0,t=u.length;e<t;e++){var c=n(u[e],r);l.push(c)}i.morphAttributes[o]=l}i.morphTargetsRelative=this.morphTargetsRelative;var h=this.groups;for(let e=0,t=h.length;e<t;e++){var d=h[e];i.addGroup(d.start,d.count,d.materialIndex)}return i}toJSON(){var n={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),0<Object.keys(this.userData).length&&(n.userData=this.userData),void 0!==this.parameters){var e,t=this.parameters;for(e in t)void 0!==t[e]&&(n[e]=t[e])}else{n.data={attributes:{}};var i,r=this.index,a=(null!==r&&(n.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)}),this.attributes);for(i in a){var o=a[i];n.data.attributes[i]=o.toJSON(n.data)}var s,l={};let e=!1;for(s in this.morphAttributes){var u=this.morphAttributes[s],c=[];for(let e=0,t=u.length;e<t;e++){var h=u[e];c.push(h.toJSON(n.data))}0<c.length&&(l[s]=c,e=!0)}e&&(n.data.morphAttributes=l,n.data.morphTargetsRelative=this.morphTargetsRelative);r=this.groups,r=(0<r.length&&(n.data.groups=JSON.parse(JSON.stringify(r))),this.boundingSphere);null!==r&&(n.data.boundingSphere={center:r.center.toArray(),radius:r.radius})}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t,n={},i=(this.name=e.name,e.index),r=(null!==i&&this.setIndex(i.clone(n)),e.attributes);for(t in r){var a=r[t];this.setAttribute(t,a.clone(n))}var o,s=e.morphAttributes;for(o in s){var l=[],u=s[o];for(let e=0,t=u.length;e<t;e++)l.push(u[e].clone(n));this.morphAttributes[o]=l}this.morphTargetsRelative=e.morphTargetsRelative;var c=e.groups;for(let e=0,t=c.length;e<t;e++){var h=c[e];this.addGroup(h.start,h.count,h.materialIndex)}i=e.boundingBox,null!==i&&(this.boundingBox=i.clone()),i=e.boundingSphere;return null!==i&&(this.boundingSphere=i.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}let Ui=new fd,Bi=new oA,Fi=new aA,zi=new dd,ki=new dd,Gi=new dd,Hi=new dd,Vi=new dd,Wi=new dd,ji=new ld,Yi=new ld,qi=new ld,Xi=new dd,Zi=new dd,Ki=new dd,Ji=new dd,Qi=new dd;class xd extends gd{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Ad,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new _d;super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(0<t.length){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){var i=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}getVertexPosition(n,i){var e=this.geometry,t=e.attributes.position,r=e.morphAttributes.position,a=e.morphTargetsRelative,o=(i.fromBufferAttribute(t,n),this.morphTargetInfluences);if(r&&o){Wi.set(0,0,0);for(let e=0,t=r.length;e<t;e++){var s=o[e],l=r[e];0!==s&&(Vi.fromBufferAttribute(l,n),a?Wi.addScaledVector(Vi,s):Wi.addScaledVector(Vi.sub(i),s))}i.add(Wi)}return i}raycast(e,t){var n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),Fi.copy(n.boundingSphere),Fi.applyMatrix4(r),Bi.copy(e.ray).recast(e.near),!1===Fi.containsPoint(Bi.origin)){if(null===Bi.intersectSphere(Fi,zi))return;if(Bi.origin.distanceToSquared(zi)>(e.far-e.near)**2)return}Ui.copy(r).invert(),Bi.copy(e.ray).applyMatrix4(Ui),null!==n.boundingBox&&!1===Bi.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Bi)}}_computeIntersections(n,i,r){let a;var e=this.geometry,o=this.material,s=e.index,l=e.attributes.position,u=e.attributes.uv,c=e.attributes.uv1,h=e.attributes.normal,d=e.groups,p=e.drawRange;if(null!==s)if(Array.isArray(o))for(let e=0,t=d.length;e<t;e++){var f=d[e],m=o[f.materialIndex];for(let e=Math.max(f.start,p.start),t=Math.min(s.count,Math.min(f.start+f.count,p.start+p.count));e<t;e+=3){var g=s.getX(e),v=s.getX(e+1),_=s.getX(e+2);(a=qd(this,m,n,r,u,c,h,g,v,_))&&(a.faceIndex=Math.floor(e/3),a.face.materialIndex=f.materialIndex,i.push(a))}}else for(let e=Math.max(0,p.start),t=Math.min(s.count,p.start+p.count);e<t;e+=3){var y=s.getX(e),E=s.getX(e+1),A=s.getX(e+2);(a=qd(this,o,n,r,u,c,h,y,E,A))&&(a.faceIndex=Math.floor(e/3),i.push(a))}else if(void 0!==l)if(Array.isArray(o))for(let e=0,t=d.length;e<t;e++){var x=d[e],T=o[x.materialIndex];for(let e=Math.max(x.start,p.start),t=Math.min(l.count,Math.min(x.start+x.count,p.start+p.count));e<t;e+=3){var S=e,w=e+1,b=e+2;(a=qd(this,T,n,r,u,c,h,S,w,b))&&(a.faceIndex=Math.floor(e/3),a.face.materialIndex=x.materialIndex,i.push(a))}}else for(let e=Math.max(0,p.start),t=Math.min(l.count,p.start+p.count);e<t;e+=3){var M=e,R=e+1,N=e+2;(a=qd(this,o,n,r,u,c,h,M,R,N))&&(a.faceIndex=Math.floor(e/3),i.push(a))}}}function qd(e,t,n,i,r,a,o,s,l,u){e.getVertexPosition(s,ki),e.getVertexPosition(l,Gi),e.getVertexPosition(u,Hi);e=((e,t,n,i,r,a,o,s)=>{let l;return null===(l=t.side===Ge?i.intersectTriangle(o,a,r,!0,s):i.intersectTriangle(r,a,o,t.side===ke,s))||(Qi.copy(s),Qi.applyMatrix4(e.matrixWorld),(i=n.ray.origin.distanceTo(Qi))<n.near)||i>n.far?null:{distance:i,point:Qi.clone(),object:e}})(e,t,n,i,ki,Gi,Hi,Ji);return e&&(r&&(ji.fromBufferAttribute(r,s),Yi.fromBufferAttribute(r,l),qi.fromBufferAttribute(r,u),e.uv=lA.getInterpolation(Ji,ki,Gi,Hi,ji,Yi,qi,new ld)),a&&(ji.fromBufferAttribute(a,s),Yi.fromBufferAttribute(a,l),qi.fromBufferAttribute(a,u),e.uv1=lA.getInterpolation(Ji,ki,Gi,Hi,ji,Yi,qi,new ld)),o&&(Xi.fromBufferAttribute(o,s),Zi.fromBufferAttribute(o,l),Ki.fromBufferAttribute(o,u),e.normal=lA.getInterpolation(Ji,ki,Gi,Hi,Xi,Zi,Ki,new dd),0<e.normal.dot(i.direction))&&e.normal.multiplyScalar(-1),t={a:s,b:l,c:u,normal:new dd,materialIndex:0},lA.getNormal(ki,Gi,Hi,t.normal),e.face=t),e}class dA extends Ad{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:a};let M=this,R=(i=Math.floor(i),r=Math.floor(r),a=Math.floor(a),[]),N=[],I=[],C=[],L=0,D=0;function o(n,i,r,a,o,e,t,s,l,u,c){var h=e/l,d=t/u,p=e/2,f=t/2,m=s/2,g=l+1,v=u+1;let _=0,y=0;var E=new dd;for(let t=0;t<v;t++){var A=t*d-f;for(let e=0;e<g;e++){var x=e*h-p;E[n]=x*a,E[i]=A*o,E[r]=m,N.push(E.x,E.y,E.z),E[n]=0,E[i]=0,E[r]=0<s?1:-1,I.push(E.x,E.y,E.z),C.push(e/l),C.push(1-t/u),_+=1}}for(let t=0;t<u;t++)for(let e=0;e<l;e++){var T=L+e+g*t,S=L+e+g*(t+1),w=L+(e+1)+g*(t+1),b=L+(e+1)+g*t;R.push(T,S,b),R.push(S,w,b),y+=6}M.addGroup(D,y,c),D+=y,L+=_}o("z","y","x",-1,-1,n,t,e,a,r,0),o("z","y","x",1,-1,n,t,-e,a,r,1),o("x","z","y",1,1,e,n,t,i,a,2),o("x","z","y",1,-1,e,n,-t,i,a,3),o("x","y","z",1,-1,e,t,n,i,r,4),o("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(R),this.setAttribute("position",new Ed(N,3)),this.setAttribute("normal",new Ed(I,3)),this.setAttribute("uv",new Ed(C,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new dA(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Xd(e){var t,n={};for(t in e)for(var i in n[t]={},e[t]){var r=e[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),n[t][i]=null):n[t][i]=r.clone():Array.isArray(r)?n[t][i]=r.slice():n[t][i]=r}return n}function Zd(t){var n={};for(let e=0;e<t.length;e++){var i,r=Xd(t[e]);for(i in r)n[i]=r[i]}return n}function Kd(e){var t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:qe.workingColorSpace}let $i={clone:Xd,merge:Zd};class Td extends uA{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Xd(e.uniforms),this.uniformsGroups=(t=>{var n=[];for(let e=0;e<t.length;e++)n.push(t[e].clone());return n})(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){var t,n=super.toJSON(e);for(t in n.glslVersion=this.glslVersion,n.uniforms={},this.uniforms){var i=this.uniforms[t].value;i&&i.isTexture?n.uniforms[t]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?n.uniforms[t]={type:"c",value:i.getHex()}:i&&i.isVector2?n.uniforms[t]={type:"v2",value:i.toArray()}:i&&i.isVector3?n.uniforms[t]={type:"v3",value:i.toArray()}:i&&i.isVector4?n.uniforms[t]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?n.uniforms[t]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?n.uniforms[t]={type:"m4",value:i.toArray()}:n.uniforms[t]={value:i}}0<Object.keys(this.defines).length&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;var r,a={};for(r in this.extensions)!0===this.extensions[r]&&(a[r]=!0);return 0<Object.keys(a).length&&(n.extensions=a),n}}class pA extends gd{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new fd,this.projectionMatrix=new fd,this.projectionMatrixInverse=new fd,this.coordinateSystem=2e3}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}let er=new dd,tr=new ld,nr=new ld;class fA extends pA{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:50,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){e=.5*this.getFilmHeight()/e;this.fov=2*pn*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){var e=Math.tan(.5*dn*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*pn*Math.atan(Math.tan(.5*dn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){er.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(er.x,er.y).multiplyScalar(-e/er.z),er.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(er.x,er.y).multiplyScalar(-e/er.z)}getViewSize(e,t){return this.getViewBounds(e,tr,nr),t.subVectors(nr,tr)}setViewOffset(e,t,n,i,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){var e=this.near;let t=e*Math.tan(.5*dn*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;var a,o=this.view,s=(null!==this.view&&this.view.enabled&&(s=o.fullWidth,a=o.fullHeight,r+=o.offsetX*i/s,t-=o.offsetY*n/a,i*=o.width/s,n*=o.height/a),this.filmOffset);0!==s&&(r+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){e=super.toJSON(e);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}class mA extends gd{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;n=new fA(-90,1,e,t),n.layers=this.layers,this.add(n),n=new fA(-90,1,e,t),n.layers=this.layers,this.add(n),n=new fA(-90,1,e,t),n.layers=this.layers,this.add(n),n=new fA(-90,1,e,t),n.layers=this.layers,this.add(n),n=new fA(-90,1,e,t),n.layers=this.layers,this.add(n),n=new fA(-90,1,e,t);n.layers=this.layers,this.add(n)}updateCoordinateSystem(){var e,t,n=this.coordinateSystem,i=this.children.concat(),[r,a,o,s,l,u]=i;for(e of i)this.remove(e);if(2e3===n)r.up.set(0,1,0),r.lookAt(1,0,0),a.up.set(0,1,0),a.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),u.up.set(0,1,0);else{if(2001!==n)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+n);r.up.set(0,-1,0),r.lookAt(-1,0,0),a.up.set(0,-1,0),a.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),u.up.set(0,-1,0)}u.lookAt(0,0,-1);for(t of i)this.add(t),t.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();var{renderTarget:n,activeMipmapLevel:i}=this,[r,a,o,s,l,u]=(this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem()),this.children),c=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=e.xr.enabled,f=(e.xr.enabled=!1,n.texture.generateMipmaps);n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,r),e.setRenderTarget(n,1,i),e.render(t,a),e.setRenderTarget(n,2,i),e.render(t,o),e.setRenderTarget(n,3,i),e.render(t,s),e.setRenderTarget(n,4,i),e.render(t,l),n.texture.generateMipmaps=f,e.setRenderTarget(n,5,i),e.render(t,u),e.setRenderTarget(c,h,d),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class gA extends eA{constructor(e,t,n,i,r,a,o,s,l,u){super(e=void 0!==e?e:[],t=void 0!==t?t:G,n,i,r,a,o,s,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class vA extends nA{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=(super(e,e,t),this.isWebGLCubeRenderTarget=!0,{width:e,height:e,depth:1}),e=[e,e,e,e,e,e];this.texture=new gA(e,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:W}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new dA(5,5,5),n=new Td({name:"CubemapFromEquirect",uniforms:Xd(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Ge,blending:Y}),i=(n.uniforms.tEquirect.value=t,new xd(i,n)),n=t.minFilter;return t.minFilter===Ve&&(t.minFilter=W),new mA(1,10,this).update(e,i),t.minFilter=n,i.geometry.dispose(),i.material.dispose(),this}clear(t,n,i,r){var e=t.getRenderTarget();for(let e=0;e<6;e++)t.setRenderTarget(this,e),t.clear(n,i,r);t.setRenderTarget(e)}}let ir=new dd,rr=new dd,ar=new ud;class _A{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new dd(1,0,0),t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){n=ir.subVectors(n,t).cross(rr.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){var n=e.delta(ir),i=this.normal.dot(n);return 0===i?0===this.distanceToPoint(e.start)?t.copy(e.start):null:(i=-(e.start.dot(this.normal)+this.constant)/i)<0||1<i?null:t.copy(e.start).addScaledVector(n,i)}intersectsLine(e){var t=this.distanceToPoint(e.start),e=this.distanceToPoint(e.end);return t<0&&0<e||e<0&&0<t}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){t=t||ar.getNormalMatrix(e),e=this.coplanarPoint(ir).applyMatrix4(e),t=this.normal.applyMatrix3(t).normalize();return this.constant=-e.dot(t),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}let or=new aA,sr=new dd;class yA{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new _A,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new _A,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new _A,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new _A,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new _A,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new _A;this.planes=[e,t,n,i,r,a]}set(e,t,n,i,r,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(a),this}copy(t){var n=this.planes;for(let e=0;e<6;e++)n[e].copy(t.planes[e]);return this}setFromProjectionMatrix(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2e3,n=this.planes,e=e.elements,i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],v=e[14],e=e[15];if(n[0].setComponents(o-i,c-s,f-h,e-m).normalize(),n[1].setComponents(o+i,c+s,f+h,e+m).normalize(),n[2].setComponents(o+r,c+l,f+d,e+g).normalize(),n[3].setComponents(o-r,c-l,f-d,e-g).normalize(),n[4].setComponents(o-a,c-u,f-p,e-v).normalize(),2e3===t)n[5].setComponents(o+a,c+u,f+p,e+v).normalize();else{if(2001!==t)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(a,u,p,v).normalize()}return this}intersectsObject(e){var t;return(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),or.copy(e.boundingSphere)):(null===(t=e.geometry).boundingSphere&&t.computeBoundingSphere(),or.copy(t.boundingSphere))).applyMatrix4(e.matrixWorld),this.intersectsSphere(or)}intersectsSprite(e){return or.center.set(0,0,0),or.radius=.7071067811865476,or.applyMatrix4(e.matrixWorld),this.intersectsSphere(or)}intersectsSphere(e){var t=this.planes,n=e.center,i=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<i)return!1;return!0}intersectsBox(t){var n=this.planes;for(let e=0;e<6;e++){var i=n[e];if(sr.x=(0<i.normal.x?t.max:t.min).x,sr.y=(0<i.normal.y?t.max:t.min).y,sr.z=(0<i.normal.z?t.max:t.min).z,i.distanceToPoint(sr)<0)return!1}return!0}containsPoint(t){var n=this.planes;for(let e=0;e<6;e++)if(n[e].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Jd(){let n=null,e=!1,i=null,r=null;function a(e,t){i(e,t),r=n.requestAnimationFrame(a)}return{start:function(){!0!==e&&null!==i&&(r=n.requestAnimationFrame(a),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(e){i=e},setContext:function(e){n=e}}}function Qd(u){let c=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),c.get(e)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var t=c.get(e);t&&(u.deleteBuffer(t.buffer),c.delete(e))},update:function(e,t){if((e=e.isInterleavedBufferAttribute?e.data:e).isGLBufferAttribute)(!(n=c.get(e))||n.version<e.version)&&c.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version});else{var n=c.get(e);if(void 0===n)c.set(e,((e,t)=>{var n=e.array,i=e.usage,r=n.byteLength,a=u.createBuffer();u.bindBuffer(t,a),u.bufferData(t,n,i),e.onUploadCallback();let o;if(n instanceof Float32Array)o=u.FLOAT;else if(n instanceof Uint16Array)o=e.isFloat16BufferAttribute?u.HALF_FLOAT:u.UNSIGNED_SHORT;else if(n instanceof Int16Array)o=u.SHORT;else if(n instanceof Uint32Array)o=u.UNSIGNED_INT;else if(n instanceof Int32Array)o=u.INT;else if(n instanceof Int8Array)o=u.BYTE;else{if(!(n instanceof Uint8Array||n instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+n);o=u.UNSIGNED_BYTE}return{buffer:a,type:o,bytesPerElement:n.BYTES_PER_ELEMENT,version:e.version,size:r}})(e,t));else if(n.version<e.version){if(n.size!==e.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");var i=n.buffer,r=e,a=t,o=r.array,t=r._updateRange,s=r.updateRanges;if(u.bindBuffer(a,i),-1===t.count&&0===s.length&&u.bufferSubData(a,0,o),0!==s.length){for(let e=0,t=s.length;e<t;e++){var l=s[e];u.bufferSubData(a,l.start*o.BYTES_PER_ELEMENT,o,l.start,l.count)}r.clearUpdateRanges()}-1!==t.count&&(u.bufferSubData(a,t.offset*o.BYTES_PER_ELEMENT,o,t.offset,t.count),t.count=-1),r.onUploadCallback(),n.version=e.version}}}}}class EA extends Ad{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,r=(super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i},e/2),a=t/2,o=Math.floor(n),s=Math.floor(i),l=o+1,u=s+1,c=e/o,h=t/s,d=[],p=[],f=[],m=[];for(let t=0;t<u;t++){var g=t*h-a;for(let e=0;e<l;e++){var v=e*c-r;p.push(v,-g,0),f.push(0,0,1),m.push(e/o),m.push(1-t/s)}}for(let t=0;t<s;t++)for(let e=0;e<o;e++){var _=e+l*t,y=e+l*(t+1),E=e+1+l*(t+1),A=e+1+l*t;d.push(_,y,A),d.push(y,E,A)}this.setIndex(d),this.setAttribute("position",new Ed(p,3)),this.setAttribute("normal",new Ed(f,3)),this.setAttribute("uv",new Ed(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new EA(e.width,e.height,e.widthSegments,e.heightSegments)}}let S={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},N={common:{diffuse:{value:new vd(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new ud},alphaMap:{value:null},alphaMapTransform:{value:new ud},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new ud}},envmap:{envMap:{value:null},envMapRotation:{value:new ud},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new ud}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new ud}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new ud},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new ud},normalScale:{value:new ld(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new ud},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new ud}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new ud}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new ud}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new vd(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new vd(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new ud},alphaTest:{value:0},uvTransform:{value:new ud}},sprite:{diffuse:{value:new vd(16777215)},opacity:{value:1},center:{value:new ld(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new ud},alphaMap:{value:null},alphaMapTransform:{value:new ud},alphaTest:{value:0}}},lr={basic:{uniforms:Zd([N.common,N.specularmap,N.envmap,N.aomap,N.lightmap,N.fog]),vertexShader:S.meshbasic_vert,fragmentShader:S.meshbasic_frag},lambert:{uniforms:Zd([N.common,N.specularmap,N.envmap,N.aomap,N.lightmap,N.emissivemap,N.bumpmap,N.normalmap,N.displacementmap,N.fog,N.lights,{emissive:{value:new vd(0)}}]),vertexShader:S.meshlambert_vert,fragmentShader:S.meshlambert_frag},phong:{uniforms:Zd([N.common,N.specularmap,N.envmap,N.aomap,N.lightmap,N.emissivemap,N.bumpmap,N.normalmap,N.displacementmap,N.fog,N.lights,{emissive:{value:new vd(0)},specular:{value:new vd(1118481)},shininess:{value:30}}]),vertexShader:S.meshphong_vert,fragmentShader:S.meshphong_frag},standard:{uniforms:Zd([N.common,N.envmap,N.aomap,N.lightmap,N.emissivemap,N.bumpmap,N.normalmap,N.displacementmap,N.roughnessmap,N.metalnessmap,N.fog,N.lights,{emissive:{value:new vd(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:S.meshphysical_vert,fragmentShader:S.meshphysical_frag},toon:{uniforms:Zd([N.common,N.aomap,N.lightmap,N.emissivemap,N.bumpmap,N.normalmap,N.displacementmap,N.gradientmap,N.fog,N.lights,{emissive:{value:new vd(0)}}]),vertexShader:S.meshtoon_vert,fragmentShader:S.meshtoon_frag},matcap:{uniforms:Zd([N.common,N.bumpmap,N.normalmap,N.displacementmap,N.fog,{matcap:{value:null}}]),vertexShader:S.meshmatcap_vert,fragmentShader:S.meshmatcap_frag},points:{uniforms:Zd([N.points,N.fog]),vertexShader:S.points_vert,fragmentShader:S.points_frag},dashed:{uniforms:Zd([N.common,N.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:S.linedashed_vert,fragmentShader:S.linedashed_frag},depth:{uniforms:Zd([N.common,N.displacementmap]),vertexShader:S.depth_vert,fragmentShader:S.depth_frag},normal:{uniforms:Zd([N.common,N.bumpmap,N.normalmap,N.displacementmap,{opacity:{value:1}}]),vertexShader:S.meshnormal_vert,fragmentShader:S.meshnormal_frag},sprite:{uniforms:Zd([N.sprite,N.fog]),vertexShader:S.sprite_vert,fragmentShader:S.sprite_frag},background:{uniforms:{uvTransform:{value:new ud},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:S.background_vert,fragmentShader:S.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new ud}},vertexShader:S.backgroundCube_vert,fragmentShader:S.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:S.cube_vert,fragmentShader:S.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:S.equirect_vert,fragmentShader:S.equirect_frag},distanceRGBA:{uniforms:Zd([N.common,N.displacementmap,{referencePosition:{value:new dd},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:S.distanceRGBA_vert,fragmentShader:S.distanceRGBA_frag},shadow:{uniforms:Zd([N.lights,N.fog,{color:{value:new vd(0)},opacity:{value:1}}]),vertexShader:S.shadow_vert,fragmentShader:S.shadow_frag}},ur=(lr.physical={uniforms:Zd([lr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new ud},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new ud},clearcoatNormalScale:{value:new ld(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new ud},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new ud},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new ud},sheen:{value:0},sheenColor:{value:new vd(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new ud},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new ud},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new ud},transmissionSamplerSize:{value:new ld},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new ud},attenuationDistance:{value:0},attenuationColor:{value:new vd(0)},specularColor:{value:new vd(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new ud},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new ud},anisotropyVector:{value:new ld},anisotropyMap:{value:null},anisotropyMapTransform:{value:new ud}}]),vertexShader:S.meshphysical_vert,fragmentShader:S.meshphysical_frag},{r:0,b:0,g:0}),cr=new md,hr=new fd;function $d(i,n,r,a,o,e,s){let l=new vd(0),u=!0===e?0:1,c,h,d=null,p=0,f=null;function m(e){let t=!0===e.isScene?e.background:null;return t&&t.isTexture&&(e=0<e.backgroundBlurriness,t=(e?r:n).get(t)),t}function g(e,t){e.getRGB(ur,Kd(i)),a.buffers.color.setClear(ur.r,ur.g,ur.b,t,s)}return{getClearColor:function(){return l},setClearColor:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;l.set(e),u=t,g(l,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,g(l,u)},render:function(e){let t=!1;null===(e=m(e))?g(l,u):e&&e.isColor&&(g(e,1),t=!0),"additive"===(e=i.xr.getEnvironmentBlendMode())?a.buffers.color.setClear(0,0,0,1,s):"alpha-blend"===e&&a.buffers.color.setClear(0,0,0,0,s),(i.autoClear||t)&&(a.buffers.depth.setTest(!0),a.buffers.depth.setMask(!0),a.buffers.color.setMask(!0),i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil))},addToRenderList:function(e,t){var n=m(t);n&&(n.isCubeTexture||n.mapping===Oe)?(void 0===h&&((h=new xd(new dA(1,1,1),new Td({name:"BackgroundCubeMaterial",uniforms:Xd(lr.backgroundCube.uniforms),vertexShader:lr.backgroundCube.vertexShader,fragmentShader:lr.backgroundCube.fragmentShader,side:Ge,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(h)),cr.copy(t.backgroundRotation),cr.x*=-1,cr.y*=-1,cr.z*=-1,n.isCubeTexture&&!1===n.isRenderTargetTexture&&(cr.y*=-1,cr.z*=-1),h.material.uniforms.envMap.value=n,h.material.uniforms.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,h.material.uniforms.backgroundBlurriness.value=t.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=t.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(hr.makeRotationFromEuler(cr)),h.material.toneMapped=qe.getTransfer(n.colorSpace)!==pe,d===n&&p===n.version&&f===i.toneMapping||(h.material.needsUpdate=!0,d=n,p=n.version,f=i.toneMapping),h.layers.enableAll(),e.unshift(h,h.geometry,h.material,0,0,null)):n&&n.isTexture&&(void 0===c&&((c=new xd(new EA(2,2),new Td({name:"BackgroundMaterial",uniforms:Xd(lr.background.uniforms),vertexShader:lr.background.vertexShader,fragmentShader:lr.background.fragmentShader,side:ke,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(c)),c.material.uniforms.t2D.value=n,c.material.uniforms.backgroundIntensity.value=t.backgroundIntensity,c.material.toneMapped=qe.getTransfer(n.colorSpace)!==pe,!0===n.matrixAutoUpdate&&n.updateMatrix(),c.material.uniforms.uvTransform.value.copy(n.matrix),d===n&&p===n.version&&f===i.toneMapping||(c.material.needsUpdate=!0,d=n,p=n.version,f=i.toneMapping),c.layers.enableAll(),e.unshift(c,c.geometry,c.material,0,0,null))}}}function ep(N,I){let r=N.getParameter(N.MAX_VERTEX_ATTRIBS),C={},e=P(null),L=e,D=!1;function O(e){N.bindVertexArray(e)}function a(e){N.deleteVertexArray(e)}function P(e){var t=[],n=[],i=[];for(let e=0;e<r;e++)t[e]=0,n[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function U(){var n=L.newAttributes;for(let e=0,t=n.length;e<t;e++)n[e]=0}function B(e){F(e,0)}function F(e,t){var n=L.newAttributes,i=L.enabledAttributes,r=L.attributeDivisors;n[e]=1,0===i[e]&&(N.enableVertexAttribArray(e),i[e]=1),r[e]!==t&&(N.vertexAttribDivisor(e,t),r[e]=t)}function z(){var n=L.newAttributes,i=L.enabledAttributes;for(let e=0,t=i.length;e<t;e++)i[e]!==n[e]&&(N.disableVertexAttribArray(e),i[e]=0)}function k(e,t,n,i,r,a,o){!0===o?N.vertexAttribIPointer(e,t,n,r,a):N.vertexAttribPointer(e,t,n,i,r,a)}function o(){t(),D=!0,L!==e&&O((L=e).object)}function t(){e.geometry=null,e.program=null,e.wireframe=!1}return{setup:function(r,e,a,o,s){var t=((e,t,n)=>{let i=!0===n.wireframe,r=C[e.id],a=(void 0===r&&(r={},C[e.id]=r),r[t.id]),o=(void 0===a&&(a={},r[t.id]=a),a[i]);return void 0===o&&(o=P(N.createVertexArray()),a[i]=o),o})(o,a,e);if(L!==t&&O((L=t).object),t=((t,e,n,i)=>{let r=L.attributes,a=e.attributes,o=0,s=n.getAttributes();for(var l in s)if(0<=s[l].location){var u=r[l];let e=a[l];if(void 0===e&&("instanceMatrix"===l&&t.instanceMatrix&&(e=t.instanceMatrix),"instanceColor"===l)&&t.instanceColor&&(e=t.instanceColor),void 0===u)return!0;if(u.attribute!==e)return!0;if(e&&u.data!==e.data)return!0;o++}return L.attributesNum!==o||L.index!==i})(r,o,a,s)){var l,u=r,c=a,h=s;let t={},n=o.attributes,i=0,e=c.getAttributes();for(l in e)if(0<=e[l].location){let e=n[l];void 0===e&&("instanceMatrix"===l&&u.instanceMatrix&&(e=u.instanceMatrix),"instanceColor"===l)&&u.instanceColor&&(e=u.instanceColor);var d={};(d.attribute=e)&&e.data&&(d.data=e.data),t[l]=d,i++}L.attributes=t,L.attributesNum=i,L.index=h}if(null!==s&&I.update(s,N.ELEMENT_ARRAY_BUFFER),t||D){D=!1;var n=r,c=e,h=a,i=o;U();var p,f=i.attributes,m=h.getAttributes(),g=c.defaultAttributeValues;for(p in m){var v=m[p];if(0<=v.location){let t=f[p];if(void 0!==(t=void 0===t&&("instanceMatrix"===p&&n.instanceMatrix&&(t=n.instanceMatrix),"instanceColor"===p)&&n.instanceColor?n.instanceColor:t)){var _=t.normalized,y=t.itemSize,E=I.get(t);if(void 0!==E){var A=E.buffer,x=E.type,T=E.bytesPerElement,S=x===N.INT||x===N.UNSIGNED_INT||t.gpuType===Ke;if(t.isInterleavedBufferAttribute){var w=t.data,b=w.stride,M=t.offset;if(w.isInstancedInterleavedBuffer){for(let e=0;e<v.locationSize;e++)F(v.location+e,w.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===i._maxInstanceCount&&(i._maxInstanceCount=w.meshPerAttribute*w.count)}else for(let e=0;e<v.locationSize;e++)B(v.location+e);N.bindBuffer(N.ARRAY_BUFFER,A);for(let e=0;e<v.locationSize;e++)k(v.location+e,y/v.locationSize,x,_,b*T,(M+y/v.locationSize*e)*T,S)}else{if(t.isInstancedBufferAttribute){for(let e=0;e<v.locationSize;e++)F(v.location+e,t.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===i._maxInstanceCount&&(i._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<v.locationSize;e++)B(v.location+e);N.bindBuffer(N.ARRAY_BUFFER,A);for(let e=0;e<v.locationSize;e++)k(v.location+e,y/v.locationSize,x,_,y*T,y/v.locationSize*e*T,S)}}}else if(void 0!==g){var R=g[p];if(void 0!==R)switch(R.length){case 2:N.vertexAttrib2fv(v.location,R);break;case 3:N.vertexAttrib3fv(v.location,R);break;case 4:N.vertexAttrib4fv(v.location,R);break;default:N.vertexAttrib1fv(v.location,R)}}}}z(),null!==s&&N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,I.get(s).buffer)}},reset:o,resetDefaultState:t,dispose:function(){for(var e in o(),C){var t,n=C[e];for(t in n){var i,r=n[t];for(i in r)a(r[i].object),delete r[i];delete n[t]}delete C[e]}},releaseStatesOfGeometry:function(e){if(void 0!==C[e.id]){var t,n=C[e.id];for(t in n){var i,r=n[t];for(i in r)a(r[i].object),delete r[i];delete n[t]}delete C[e.id]}},releaseStatesOfProgram:function(e){for(var t in C){t=C[t];if(void 0!==t[e.id]){var n,i=t[e.id];for(n in i)a(i[n].object),delete i[n];delete t[e.id]}}},initAttributes:U,enableAttribute:B,disableUnusedAttributes:z}}function tp(i,o,s){let l;function t(e,t,n){0!==n&&(i.drawArraysInstanced(l,e,t,n),s.update(t,l,n))}this.setMode=function(e){l=e},this.render=function(e,t){i.drawArrays(l,e,t),s.update(t,l,1)},this.renderInstances=t,this.renderMultiDraw=function(e,n,i){if(0!==i){o.get("WEBGL_multi_draw").multiDrawArraysWEBGL(l,e,0,n,0,i);let t=0;for(let e=0;e<i;e++)t+=n[e];s.update(t,l,1)}},this.renderMultiDrawInstances=function(n,i,r,a){if(0!==r){var e=o.get("WEBGL_multi_draw");if(null===e)for(let e=0;e<n.length;e++)t(n[e],i[e],a[e]);else{e.multiDrawArraysInstancedWEBGL(l,n,0,i,0,a,0,r);let t=0;for(let e=0;e<r;e++)t+=i[e];for(let e=0;e<a.length;e++)s.update(t,l,a[e])}}}}function np(n,i,e,r){let t;function a(e){if("highp"===e){if(0<n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision&&0<n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision)return"highp";e="mediump"}return"mediump"===e&&0<n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision&&0<n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision?"mediump":"lowp"}let o=void 0!==e.precision?e.precision:"highp";var s=a(o),s=(s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s),!0===e.logarithmicDepthBuffer),e=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),l=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),u=n.getParameter(n.MAX_TEXTURE_SIZE),c=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),h=n.getParameter(n.MAX_VERTEX_ATTRIBS),d=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),p=n.getParameter(n.MAX_VARYING_VECTORS),f=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),m=0<l,g=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:function(){var e;return t=void 0===t?!0===i.has("EXT_texture_filter_anisotropic")?(e=i.get("EXT_texture_filter_anisotropic"),n.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT)):0:t},getMaxPrecision:a,textureFormatReadable:function(e){return e===q||r.convert(e)===n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(e){var t=e===Qe&&(i.has("EXT_color_buffer_half_float")||i.has("EXT_color_buffer_float"));return!(e!==We&&r.convert(e)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&e!==j&&!t)},precision:o,logarithmicDepthBuffer:s,maxTextures:e,maxVertexTextures:l,maxTextureSize:u,maxCubemapSize:c,maxAttributes:h,maxVertexUniforms:d,maxVaryings:p,maxFragmentUniforms:f,vertexTextures:m,maxSamples:g}}function ip(l){let u=this,c=null,h=0,d=!1,p=!1,s=new _A,f=new ud,m={value:null,needsUpdate:!1};function g(n,e,i,t){var r=null!==n?n.length:0;let a=null;if(0!==r){if(a=m.value,!0!==t||null===a){var t=i+4*r,o=e.matrixWorldInverse;f.getNormalMatrix(o),(null===a||a.length<t)&&(a=new Float32Array(t));for(let e=0,t=i;e!==r;++e,t+=4)s.copy(n[e]).applyMatrix4(o,f),s.normal.toArray(a,t),a[t+3]=s.constant}m.value=a,m.needsUpdate=!0}return u.numPlanes=r,u.numIntersection=0,a}this.uniform=m,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){var n=0!==e.length||t||0!==h||d;return d=t,h=e.length,n},this.beginShadows=function(){p=!0,g(null)},this.endShadows=function(){p=!1},this.setGlobalState=function(e,t){c=g(e,t,0)},this.setState=function(e,t,n){var i=e.clippingPlanes,r=e.clipIntersection,a=e.clipShadows,e=l.get(e);if(!d||null===i||0===i.length||p&&!a)p?g(null):(m.value!==c&&(m.value=c,m.needsUpdate=0<h),u.numPlanes=h,u.numIntersection=0);else{var a=p?0:h,o=4*a,s=e.clippingState||null;m.value=s,s=g(i,t,o,n);for(let e=0;e!==o;++e)s[e]=c[e];e.clippingState=s,this.numIntersection=r?this.numPlanes:0,this.numPlanes+=a}}}function rp(n){let i=new WeakMap;function r(e,t){return t===E?e.mapping=G:t===A&&(e.mapping=De),e}function a(e){var e=e.target,t=(e.removeEventListener("dispose",a),i.get(e));void 0!==t&&(i.delete(e),t.dispose())}return{get:function(e){if(e&&e.isTexture){var t=e.mapping;if(t===E||t===A)return i.has(e)?r(i.get(e).texture,e.mapping):(t=e.image)&&0<t.height?((t=new vA(t.height)).fromEquirectangularTexture(n,e),i.set(e,t),e.addEventListener("dispose",a),r(t.texture,e.mapping)):null}return e},dispose:function(){i=new WeakMap}}}class AA extends pA{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:-1,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.1,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,a=n+e,o=i+t,s=i-t;null!==this.view&&this.view.enabled&&(n=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom,r+=n*this.view.offsetX,a=r+n*this.view.width,o-=e*this.view.offsetY,s=o-e*this.view.height),this.projectionMatrix.makeOrthographic(r,a,o,s,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){e=super.toJSON(e);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}let dr=[.125,.215,.35,.446,.526,.582],pr=new AA,fr=new vd,mr=null,gr=0,vr=0,_r=!1;var Qh,$h=1/(Qh=(1+Math.sqrt(5))/2);let yr=[new dd(-Qh,$h,0),new dd(Qh,$h,0),new dd(-$h,0,Qh),new dd($h,0,Qh),new dd(0,Qh,-$h),new dd(0,Qh,$h),new dd(-1,1,-1),new dd(1,1,-1),new dd(-1,1,1),new dd(1,1,1)];class xA{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:100,r=(mr=this._renderer.getRenderTarget(),gr=this._renderer.getActiveCubeFace(),vr=this._renderer.getActiveMipmapLevel(),_r=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256),this._allocateTargets());return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),0<t&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e){return this._fromTexture(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)}fromCubemap(e){return this._fromTexture(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=lp(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=sp(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(mr,gr,vr),this._renderer.xr.enabled=_r,e.scissorTest=!1,op(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===G||e.mapping===De?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),mr=this._renderer.getRenderTarget(),gr=this._renderer.getActiveCubeFace(),vr=this._renderer.getActiveMipmapLevel(),_r=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;t=t||this._allocateTargets();return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(){var e,t,n=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,r={magFilter:W,minFilter:W,generateMipmaps:!1,type:Qe,format:q,colorSpace:Ye,depthBuffer:!1},a=ap(n,i,r);return null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.width===n&&this._pingPongRenderTarget.height===i||(null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=ap(n,i,r),r=this._lodMax,{sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=(n=>{let i=[],r=[],a=[],o=n,e=n-4+1+dr.length;for(let t=0;t<e;t++){var s=Math.pow(2,o);r.push(s);let e=1/s;t>n-4?e=dr[t-n+4-1]:0===t&&(e=0),a.push(e);var s=1/(s-2),l=-s,s=1+s,u=[l,l,s,l,s,s,l,l,s,s,l,s],c=new Float32Array(108),h=new Float32Array(72),d=new Float32Array(36);for(let e=0;e<6;e++){var p=e%3*2/3-1,f=2<e?0:-1,p=(c.set([p,f,0,p+2/3,f,0,p+2/3,1+f,0,p,f,0,p+2/3,1+f,0,p,1+f,0],18*e),h.set(u,12*e),[e,e,e,e,e,e]);d.set(p,6*e)}l=new Ad;l.setAttribute("position",new yd(c,3)),l.setAttribute("uv",new yd(h,2)),l.setAttribute("faceIndex",new yd(d,1)),i.push(l),4<o&&o--}return{lodPlanes:i,sizeLods:r,sigmas:a}})(r),this._blurMaterial=(r=r,n=n,i=i,e=new Float32Array(20),t=new dd(0,1,0),n=new Td({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/n,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:r+".0"},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:t}},vertexShader:up(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Y,depthTest:!1,depthWrite:!1}))),a}_compileMaterial(e){e=new xd(this._lodPlanes[0],e);this._renderer.compile(e,pr)}_sceneToCubeUV(t,e,n,i){var r=new fA(90,1,e,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,e=s.autoClear,n=s.toneMapping,l=(s.getClearColor(fr),s.toneMapping=Xe,s.autoClear=!1,new _d({name:"PMREM.Background",side:Ge,depthWrite:!1,depthTest:!1})),u=new xd(new dA,l);let c=!1;var h=t.background;h?h.isColor&&(l.color.copy(h),t.background=null,c=!0):(l.color.copy(fr),c=!0);for(let e=0;e<6;e++){var d=e%3,p=(0==d?(r.up.set(0,a[e],0),r.lookAt(o[e],0,0)):1==d?(r.up.set(0,0,a[e]),r.lookAt(0,o[e],0)):(r.up.set(0,a[e],0),r.lookAt(0,0,o[e])),this._cubeSize);op(i,d*p,2<e?p:0,p,p),s.setRenderTarget(i),c&&s.render(u,r),s.render(t,r)}u.geometry.dispose(),u.material.dispose(),s.toneMapping=n,s.autoClear=e,t.background=h}_textureToCubeUV(e,t){var n=this._renderer,i=e.mapping===G||e.mapping===De,i=(i?(null===this._cubemapMaterial&&(this._cubemapMaterial=lp()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=sp()),i?this._cubemapMaterial:this._equirectMaterial),r=new xd(this._lodPlanes[0],i),i=(i.uniforms.envMap.value=e,this._cubeSize);op(t,0,0,3*i,2*i),n.setRenderTarget(t),n.render(r,pr)}_applyPMREM(t){var e=this._renderer,n=e.autoClear,i=(e.autoClear=!1,this._lodPlanes.length);for(let e=1;e<i;e++){var r=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),a=yr[(i-e-1)%yr.length];this._blur(t,e-1,e,r,a)}e.autoClear=n}_blur(e,t,n,i,r){var a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",r),this._halfBlur(a,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,a,o){var s=this._renderer,l=this._blurMaterial,u=("latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!"),new xd(this._lodPlanes[i],l)),l=l.uniforms,c=this._sizeLods[n]-1,c=isFinite(r)?Math.PI/(2*c):2*Math.PI/39,h=r/c,d=isFinite(r)?1+Math.floor(3*h):20,p=(20<d&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${d} samples when the maximum is set to 20`),[]);let f=0;for(let t=0;t<20;++t){let e=t/h;var m=Math.exp(-e*e/2);p.push(m),0===t?f+=m:t<d&&(f+=2*m)}for(let e=0;e<p.length;e++)p[e]=p[e]/f;l.envMap.value=e.texture,l.samples.value=d,l.weights.value=p,l.latitudinal.value="latitudinal"===a,o&&(l.poleAxis.value=o);r=this._lodMax,l.dTheta.value=c,l.mipInt.value=r-n,e=this._sizeLods[i];let g=3*e*(r-4<i?i-r+4:0);a=4*(this._cubeSize-e);op(t,g,a,3*e,2*e),s.setRenderTarget(t),s.render(u,pr)}}function ap(e,t,n){e=new nA(e,t,n);return e.texture.mapping=Oe,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function op(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function sp(){return new Td({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:up(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Y,depthTest:!1,depthWrite:!1})}function lp(){return new Td({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:up(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Y,depthTest:!1,depthWrite:!1})}function up(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function cp(a){let o=new WeakMap,s=null;function l(e){var e=e.target,t=(e.removeEventListener("dispose",l),o.get(e));void 0!==t&&(o.delete(e),t.dispose())}return{get:function(t){if(t&&t.isTexture){var n=t.mapping,i=n===E||n===A,n=n===G||n===De;if(i||n){let e=o.get(t);var r=void 0!==e?e.texture.pmremVersion:0;return t.isRenderTargetTexture&&t.pmremVersion!==r?(null===s&&(s=new xA(a)),(e=i?s.fromEquirectangular(t,e):s.fromCubemap(t,e)).texture.pmremVersion=t.pmremVersion,o.set(t,e),e.texture):void 0!==e?e.texture:(r=t.image,i&&r&&0<r.height||n&&r&&(t=>{let n=0;for(let e=0;e<6;e++)void 0!==t[e]&&n++;return 6===n})(r)?(null===s&&(s=new xA(a)),(e=i?s.fromEquirectangular(t):s.fromCubemap(t)).texture.pmremVersion=t.pmremVersion,o.set(t,e),t.addEventListener("dispose",l),e.texture):null)}}return t},dispose:function(){o=new WeakMap,null!==s&&(s.dispose(),s=null)}}}function hp(n){let i={};function r(e){if(void 0!==i[e])return i[e];let t;switch(e){case"WEBGL_depth_texture":t=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":t=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":t=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":t=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:t=n.getExtension(e)}return i[e]=t}return{has:function(e){return null!==r(e)},init:function(){r("EXT_color_buffer_float"),r("WEBGL_clip_cull_distance"),r("OES_texture_float_linear"),r("EXT_color_buffer_half_float"),r("WEBGL_multisampled_render_to_texture"),r("WEBGL_render_shared_exponent")},get:function(e){var t=r(e);return null===t&&Gd("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function dp(o,d,a,s){let l={},p=new WeakMap;function u(e){var t,n,i=e.target;for(t in null!==i.index&&d.remove(i.index),i.attributes)d.remove(i.attributes[t]);for(n in i.morphAttributes){var r=i.morphAttributes[n];for(let e=0,t=r.length;e<t;e++)d.remove(r[e])}i.removeEventListener("dispose",u),delete l[i.id];e=p.get(i);e&&(d.remove(e),p.delete(i)),s.releaseStatesOfGeometry(i),!0===i.isInstancedBufferGeometry&&delete i._maxInstanceCount,a.memory.geometries--}function i(e){var n=[],i=e.index,t=e.attributes.position;let r=0;if(null!==i){var a=i.array;r=i.version;for(let e=0,t=a.length;e<t;e+=3){var o=a[e+0],s=a[e+1],l=a[e+2];n.push(o,s,s,l,l,o)}}else{if(void 0===t)return;i=t.array;r=t.version;for(let e=0,t=i.length/3-1;e<t;e+=3){var u=e+0,c=e+1,h=e+2;n.push(u,c,c,h,h,u)}}t=new(zd(n)?hA:cA)(n,1),t.version=r,i=p.get(e);i&&d.remove(i),p.set(e,t)}return{get:function(e,t){return!0!==l[t.id]&&(t.addEventListener("dispose",u),l[t.id]=!0,a.memory.geometries++),t},update:function(e){var t,n=e.attributes;for(t in n)d.update(n[t],o.ARRAY_BUFFER);var i,r=e.morphAttributes;for(i in r){var a=r[i];for(let e=0,t=a.length;e<t;e++)d.update(a[e],o.ARRAY_BUFFER)}},getWireframeAttribute:function(e){var t,n=p.get(e);return(!n||null!==(t=e.index)&&n.version<t.version)&&i(e),p.get(e)}}}function pp(i,o,s){let l;let u,c;function t(e,t,n){0!==n&&(i.drawElementsInstanced(l,t,u,e*c,n),s.update(t,l,n))}this.setMode=function(e){l=e},this.setIndex=function(e){u=e.type,c=e.bytesPerElement},this.render=function(e,t){i.drawElements(l,t,u,e*c),s.update(t,l,1)},this.renderInstances=t,this.renderMultiDraw=function(e,n,i){if(0!==i){o.get("WEBGL_multi_draw").multiDrawElementsWEBGL(l,n,0,u,e,0,i);let t=0;for(let e=0;e<i;e++)t+=n[e];s.update(t,l,1)}},this.renderMultiDrawInstances=function(n,i,r,a){if(0!==r){var e=o.get("WEBGL_multi_draw");if(null===e)for(let e=0;e<n.length;e++)t(n[e]/c,i[e],a[e]);else{e.multiDrawElementsInstancedWEBGL(l,i,0,u,n,0,a,0,r);let t=0;for(let e=0;e<r;e++)t+=i[e];for(let e=0;e<a.length;e++)s.update(t,l,a[e])}}}}function fp(i){let r={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:r,programs:null,autoReset:!0,reset:function(){r.calls=0,r.triangles=0,r.points=0,r.lines=0},update:function(e,t,n){switch(r.calls++,t){case i.TRIANGLES:r.triangles+=n*(e/3);break;case i.LINES:r.lines+=n*(e/2);break;case i.LINE_STRIP:r.lines+=n*(e-1);break;case i.LINE_LOOP:r.lines+=n*e;break;case i.POINTS:r.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",t)}}}}function mp(A,x,t){let T=new WeakMap,S=new cd;return{update:function(e,r,n){var i=e.morphTargetInfluences,a=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,o=void 0!==a?a.length:0;let s=T.get(r);if(void 0===s||s.count!==o){void 0!==s&&s.texture.dispose();var l=void 0!==r.morphAttributes.position,u=void 0!==r.morphAttributes.normal,c=void 0!==r.morphAttributes.color,h=r.morphAttributes.position||[],d=r.morphAttributes.normal||[],p=r.morphAttributes.color||[];let e=!0==c?3:!0==u?2:!0==l?1:0,t=r.attributes.position.count*e,n=1;t>x.maxTextureSize&&(n=Math.ceil(t/x.maxTextureSize),t=x.maxTextureSize);var f=new Float32Array(t*n*4*o);let i=new iA(f,t,n,o);i.type=j,i.needsUpdate=!0;var m=4*e;for(let e=0;e<o;e++){var g=h[e],v=d[e],_=p[e],y=t*n*4*e;for(let e=0;e<g.count;e++){var E=e*m;!0==l&&(S.fromBufferAttribute(g,e),f[y+E]=S.x,f[y+E+1]=S.y,f[y+E+2]=S.z,f[y+E+3]=0),!0==u&&(S.fromBufferAttribute(v,e),f[y+E+4]=S.x,f[y+E+5]=S.y,f[y+E+6]=S.z,f[y+E+7]=0),!0==c&&(S.fromBufferAttribute(_,e),f[y+E+8]=S.x,f[y+E+9]=S.y,f[y+E+10]=S.z,f[y+E+11]=4===_.itemSize?S.w:1)}}s={count:o,texture:i,size:new ld(t,n)},T.set(r,s),r.addEventListener("dispose",function e(){i.dispose(),T.delete(r),r.removeEventListener("dispose",e)})}if(!0===e.isInstancedMesh&&null!==e.morphTexture)n.getUniforms().setValue(A,"morphTexture",e.morphTexture,t);else{let t=0;for(let e=0;e<i.length;e++)t+=i[e];a=r.morphTargetsRelative?1:1-t;n.getUniforms().setValue(A,"morphTargetBaseInfluence",a),n.getUniforms().setValue(A,"morphTargetInfluences",i)}n.getUniforms().setValue(A,"morphTargetsTexture",s.texture,t),n.getUniforms().setValue(A,"morphTargetsTextureSize",s.size)}}}function gp(i,r,a,o){let s=new WeakMap;function l(e){e=e.target;e.removeEventListener("dispose",l),a.remove(e.instanceMatrix),null!==e.instanceColor&&a.remove(e.instanceColor)}return{update:function(e){var t=o.render.frame,n=e.geometry,n=r.get(e,n);return s.get(n)!==t&&(r.update(n),s.set(n,t)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",l)&&e.addEventListener("dispose",l),s.get(e)!==t)&&(a.update(e.instanceMatrix,i.ARRAY_BUFFER),null!==e.instanceColor&&a.update(e.instanceColor,i.ARRAY_BUFFER),s.set(e,t)),e.isSkinnedMesh&&(e=e.skeleton,s.get(e)!==t)&&(e.update(),s.set(e,t)),n},dispose:function(){s=new WeakMap}}}class TA extends eA{constructor(e,t,n,i,r,a,o,s,l){var u=9<arguments.length&&void 0!==arguments[9]?arguments[9]:st;if(u!==st&&u!==lt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,i,r,a,o,s,u,n=void 0===(n=void 0===n&&u===st?Je:n)&&u===lt?tt:n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==o?o:V,this.minFilter=void 0!==s?s:V,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){e=super.toJSON(e);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}let Er=new eA,Ar=new TA(1,1),xr=new iA,Tr=new rA,Sr=new gA,wr=[],br=[],Mr=new Float32Array(16),Rr=new Float32Array(9),Nr=new Float32Array(4);function vp(n,i,r){var e=n[0];if(e<=0||0<e)return n;var t=i*r;let a=wr[t];if(void 0===a&&(a=new Float32Array(t),wr[t]=a),0!==i){e.toArray(a,0);for(let e=1,t=0;e!==i;++e)t+=r,n[e].toArray(a,t)}return a}function _p(n,i){if(n.length===i.length){for(let e=0,t=n.length;e<t;e++)if(n[e]!==i[e])return;return 1}}function yp(n,i){for(let e=0,t=i.length;e<t;e++)n[e]=i[e]}function Ep(t,n){let i=br[n];void 0===i&&(i=new Int32Array(n),br[n]=i);for(let e=0;e!==n;++e)i[e]=t.allocateTextureUnit();return i}function Ap(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function xp(e,t){var n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y):_p(n,t)||(e.uniform2fv(this.addr,t),yp(n,t))}function Tp(e,t){var n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z):void 0!==t.r?n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b):_p(n,t)||(e.uniform3fv(this.addr,t),yp(n,t))}function Sp(e,t){var n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w):_p(n,t)||(e.uniform4fv(this.addr,t),yp(n,t))}function wp(e,t){var n=this.cache,i=t.elements;void 0===i?_p(n,t)||(e.uniformMatrix2fv(this.addr,!1,t),yp(n,t)):_p(n,i)||(Nr.set(i),e.uniformMatrix2fv(this.addr,!1,Nr),yp(n,i))}function bp(e,t){var n=this.cache,i=t.elements;void 0===i?_p(n,t)||(e.uniformMatrix3fv(this.addr,!1,t),yp(n,t)):_p(n,i)||(Rr.set(i),e.uniformMatrix3fv(this.addr,!1,Rr),yp(n,i))}function Mp(e,t){var n=this.cache,i=t.elements;void 0===i?_p(n,t)||(e.uniformMatrix4fv(this.addr,!1,t),yp(n,t)):_p(n,i)||(Mr.set(i),e.uniformMatrix4fv(this.addr,!1,Mr),yp(n,i))}function Rp(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Np(e,t){var n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y):_p(n,t)||(e.uniform2iv(this.addr,t),yp(n,t))}function Ip(e,t){var n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z):_p(n,t)||(e.uniform3iv(this.addr,t),yp(n,t))}function Cp(e,t){var n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w):_p(n,t)||(e.uniform4iv(this.addr,t),yp(n,t))}function Lp(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Dp(e,t){var n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y):_p(n,t)||(e.uniform2uiv(this.addr,t),yp(n,t))}function Op(e,t){var n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z):_p(n,t)||(e.uniform3uiv(this.addr,t),yp(n,t))}function Pp(e,t){var n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w):_p(n,t)||(e.uniform4uiv(this.addr,t),yp(n,t))}function Up(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r);let a;a=this.type===e.SAMPLER_2D_SHADOW?(Ar.compareFunction=on,Ar):Er,n.setTexture2D(t||a,r)}function Bp(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||Tr,r)}function Fp(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||Sr,r)}function zp(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||xr,r)}function kp(e,t){e.uniform1fv(this.addr,t)}function Gp(e,t){t=vp(t,this.size,2);e.uniform2fv(this.addr,t)}function Hp(e,t){t=vp(t,this.size,3);e.uniform3fv(this.addr,t)}function Vp(e,t){t=vp(t,this.size,4);e.uniform4fv(this.addr,t)}function Wp(e,t){t=vp(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,t)}function jp(e,t){t=vp(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,t)}function Yp(e,t){t=vp(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,t)}function qp(e,t){e.uniform1iv(this.addr,t)}function Xp(e,t){e.uniform2iv(this.addr,t)}function Zp(e,t){e.uniform3iv(this.addr,t)}function Kp(e,t){e.uniform4iv(this.addr,t)}function Jp(e,t){e.uniform1uiv(this.addr,t)}function Qp(e,t){e.uniform2uiv(this.addr,t)}function $p(e,t){e.uniform3uiv(this.addr,t)}function ef(e,t){e.uniform4uiv(this.addr,t)}function tf(e,t,n){var i=this.cache,r=t.length,a=Ep(n,r);_p(i,a)||(e.uniform1iv(this.addr,a),yp(i,a));for(let e=0;e!==r;++e)n.setTexture2D(t[e]||Er,a[e])}function nf(e,t,n){var i=this.cache,r=t.length,a=Ep(n,r);_p(i,a)||(e.uniform1iv(this.addr,a),yp(i,a));for(let e=0;e!==r;++e)n.setTexture3D(t[e]||Tr,a[e])}function rf(e,t,n){var i=this.cache,r=t.length,a=Ep(n,r);_p(i,a)||(e.uniform1iv(this.addr,a),yp(i,a));for(let e=0;e!==r;++e)n.setTextureCube(t[e]||Sr,a[e])}function af(e,t,n){var i=this.cache,r=t.length,a=Ep(n,r);_p(i,a)||(e.uniform1iv(this.addr,a),yp(i,a));for(let e=0;e!==r;++e)n.setTexture2DArray(t[e]||xr,a[e])}class SA{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=(e=>{switch(e){case 5126:return Ap;case 35664:return xp;case 35665:return Tp;case 35666:return Sp;case 35674:return wp;case 35675:return bp;case 35676:return Mp;case 5124:case 35670:return Rp;case 35667:case 35671:return Np;case 35668:case 35672:return Ip;case 35669:case 35673:return Cp;case 5125:return Lp;case 36294:return Dp;case 36295:return Op;case 36296:return Pp;case 35678:case 36198:case 36298:case 36306:case 35682:return Up;case 35679:case 36299:case 36307:return Bp;case 35680:case 36300:case 36308:case 36293:return Fp;case 36289:case 36303:case 36311:case 36292:return zp}})(t.type)}}class wA{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=(e=>{switch(e){case 5126:return kp;case 35664:return Gp;case 35665:return Hp;case 35666:return Vp;case 35674:return Wp;case 35675:return jp;case 35676:return Yp;case 5124:case 35670:return qp;case 35667:case 35671:return Xp;case 35668:case 35672:return Zp;case 35669:case 35673:return Kp;case 5125:return Jp;case 36294:return Qp;case 36295:return $p;case 36296:return ef;case 35678:case 36198:case 36298:case 36306:case 35682:return tf;case 35679:case 36299:case 36307:return nf;case 35680:case 36300:case 36308:case 36293:return rf;case 36289:case 36303:case 36311:case 36292:return af}})(t.type)}}class bA{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(n,i,r){var a=this.seq;for(let e=0,t=a.length;e!==t;++e){var o=a[e];o.setValue(n,i[o.id],r)}}}let Ir=/(\w+)(\])?(\[|\.)?/g;function of(e,t){e.seq.push(t),e.map[t.id]=t}class MA{constructor(t,n){this.seq=[],this.map={};var i=t.getProgramParameter(n,t.ACTIVE_UNIFORMS);for(let e=0;e<i;++e){var r=t.getActiveUniform(n,e),a=t.getUniformLocation(n,r.name),o=(p=d=h=c=u=l=s=o=void 0,r),s=a,l=this,u=o.name,c=u.length;for(Ir.lastIndex=0;;){var h=Ir.exec(u),d=Ir.lastIndex;let t=h[1];var p=h[3];if("]"===h[2]&&(t|=0),void 0===p||"["===p&&d+2===c){of(l,new(void 0===p?SA:wA)(t,o,s));break}{let e=l.map[t];void 0===e&&of(l,e=new bA(t)),l=e}}}}setValue(e,t,n,i){t=this.map[t];void 0!==t&&t.setValue(e,n,i)}setOptional(e,t,n){t=t[n];void 0!==t&&this.setValue(e,n,t)}static upload(n,i,r,a){for(let e=0,t=i.length;e!==t;++e){var o=i[e],s=r[o.id];!1!==s.needsUpdate&&o.setValue(n,s.value,a)}}static seqWithValue(n,i){var r=[];for(let e=0,t=n.length;e!==t;++e){var a=n[e];a.id in i&&r.push(a)}return r}}function sf(e,t,n){t=e.createShader(t);return e.shaderSource(t,n),e.compileShader(t),t}let Cr=37297,Lr=0;function lf(e,t,n){var i=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();return i&&""===r?"":(i=/ERROR: 0:(\d+)/.exec(r))?(i=parseInt(i[1]),n.toUpperCase()+"\n\n"+r+"\n\n"+((t,n)=>{var i=t.split("\n"),r=[],t=Math.max(n-6,0),a=Math.min(n+6,i.length);for(let e=t;e<a;e++){var o=e+1;r.push(`${o===n?">":" "} ${o}: `+i[e])}return r.join("\n")})(e.getShaderSource(t),i)):r}function uf(e,t){t=(e=>{var t=qe.getPrimaries(qe.workingColorSpace),n=qe.getPrimaries(e);let i;switch(t===n?i="":t===tn&&n===en?i="LinearDisplayP3ToLinearSRGB":t===en&&n===tn&&(i="LinearSRGBToLinearDisplayP3"),e){case Ye:case Qt:return[i,"LinearTransferOETF"];case je:case Jt:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[i,"LinearTransferOETF"]}})(t);return`vec4 ${e}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}let Dr=new dd;function cf(e){return""!==e}function hf(e,t){var n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function df(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}let Or=/^[ \t]*#include +<([\w\d./]+)>/gm;function pf(e){return e.replace(Or,ff)}let Pr=new Map;function ff(e,t){let n=S[t];if(void 0===n){var i=Pr.get(t);if(void 0===i)throw new Error("Can not resolve #include <"+t+">");n=S[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,i)}return pf(n)}let Ur=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function mf(e){return e.replace(Ur,gf)}function gf(e,t,n,i){let r="";for(let e=parseInt(t);e<parseInt(n);e++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function vf(e){let t=`precision ${e.precision} float;
	precision ${e.precision} int;
	precision ${e.precision} sampler2D;
	precision ${e.precision} samplerCube;
	precision ${e.precision} sampler3D;
	precision ${e.precision} sampler2DArray;
	precision ${e.precision} sampler2DShadow;
	precision ${e.precision} samplerCubeShadow;
	precision ${e.precision} sampler2DArrayShadow;
	precision ${e.precision} isampler2D;
	precision ${e.precision} isampler3D;
	precision ${e.precision} isamplerCube;
	precision ${e.precision} isampler2DArray;
	precision ${e.precision} usampler2D;
	precision ${e.precision} usampler3D;
	precision ${e.precision} usamplerCube;
	precision ${e.precision} usampler2DArray;
	`;return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function _f(l,e,t,n){let u=l.getContext();var i=t.defines,r=t.vertexShader,a=t.fragmentShader,o=(e=>{let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===I?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===b?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===C&&(t="SHADOWMAP_TYPE_VSM"),t})(t),s=(e=>{let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case G:case De:t="ENVMAP_TYPE_CUBE";break;case Oe:t="ENVMAP_TYPE_CUBE_UV"}return t})(t),c=(e=>{let t="ENVMAP_MODE_REFLECTION";return t=e.envMap&&e.envMapMode===De?"ENVMAP_MODE_REFRACTION":t})(t),h=(e=>{let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case R:t="ENVMAP_BLENDING_MULTIPLY";break;case L:t="ENVMAP_BLENDING_MIX";break;case D:t="ENVMAP_BLENDING_ADD"}return t})(t),d=null===(d=(d=t).envMapCubeUVHeight)?null:(p=Math.log2(d)-2,d=1/d,{texelWidth:1/(3*Math.max(Math.pow(2,p),112)),texelHeight:d,maxMip:p}),p=[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(cf).join("\n"),i=(e=>{var t,n=[];for(t in e){var i=e[t];!1!==i&&n.push("#define "+t+" "+i)}return n.join("\n")})(i);let f=u.createProgram(),m,g,v=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(0<(m=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,i].filter(cf).join("\n")).length&&(m+="\n"),0<(g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,i].filter(cf).join("\n")).length&&(g+="\n")):(m=[vf(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,i,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&!1===t.flatShading?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",0<t.morphTargetsCount?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",0<t.morphTargetsCount?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+o:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",0<t.numLightProbes?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(cf).join("\n"),g=[vf(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,i,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+s:"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&!1===t.flatShading?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+o:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",0<t.numLightProbes?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Xe?"#define TONE_MAPPING":"",t.toneMapping!==Xe?S.tonemapping_pars_fragment:"",t.toneMapping!==Xe?((e,t)=>{let n;switch(t){case O:n="Linear";break;case P:n="Reinhard";break;case U:n="OptimizedCineon";break;case B:n="ACESFilmic";break;case z:n="AgX";break;case k:n="Neutral";break;case F:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"})("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",S.colorspace_pars_fragment,uf("linearToOutputTexel",t.outputColorSpace),(qe.getLuminanceCoefficients(Dr),["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${Dr.x.toFixed(4)}, ${Dr.y.toFixed(4)}, ${Dr.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(cf).join("\n")),r=df(hf(pf(r),t),t),a=df(hf(pf(a),t),t),r=mf(r),a=mf(a),!0!==t.isRawShaderMaterial&&(v="#version 300 es\n",m=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,g=["#define varying in",t.glslVersion===hn?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===hn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+g);i=v+m+r,s=v+g+a;let _=sf(u,u.VERTEX_SHADER,i),y=sf(u,u.FRAGMENT_SHADER,s);function E(n){if(l.debug.checkShaderErrors){var i,r,a=u.getProgramInfoLog(f).trim(),o=u.getShaderInfoLog(_).trim(),s=u.getShaderInfoLog(y).trim();let e=!0,t=!0;!1===u.getProgramParameter(f,u.LINK_STATUS)?(e=!1,"function"==typeof l.debug.onShaderError?l.debug.onShaderError(u,f,_,y):(i=lf(u,_,"vertex"),r=lf(u,y,"fragment"),console.error("THREE.WebGLProgram: Shader Error "+u.getError()+" - VALIDATE_STATUS "+u.getProgramParameter(f,u.VALIDATE_STATUS)+"\n\nMaterial Name: "+n.name+"\nMaterial Type: "+n.type+"\n\nProgram Info Log: "+a+"\n"+i+"\n"+r))):""!==a?console.warn("THREE.WebGLProgram: Program Info Log:",a):""!==o&&""!==s||(t=!1),t&&(n.diagnostics={runnable:e,programLog:a,vertexShader:{log:o,prefix:m},fragmentShader:{log:s,prefix:g}})}u.deleteShader(_),u.deleteShader(y),A=new MA(u,f),x=((n,i)=>{var r={},e=n.getProgramParameter(i,n.ACTIVE_ATTRIBUTES);for(let t=0;t<e;t++){var a=n.getActiveAttrib(i,t),o=a.name;let e=1;a.type===n.FLOAT_MAT2&&(e=2),a.type===n.FLOAT_MAT3&&(e=3),a.type===n.FLOAT_MAT4&&(e=4),r[o]={type:a.type,location:n.getAttribLocation(i,o),locationSize:e}}return r})(u,f)}u.attachShader(f,_),u.attachShader(f,y),void 0!==t.index0AttributeName?u.bindAttribLocation(f,0,t.index0AttributeName):!0===t.morphTargets&&u.bindAttribLocation(f,0,"position"),u.linkProgram(f);let A;this.getUniforms=function(){return void 0===A&&E(this),A};let x,T=!(this.getAttributes=function(){return void 0===x&&E(this),x})===t.rendererExtensionParallelShaderCompile;return this.isReady=function(){return T=!1===T?u.getProgramParameter(f,Cr):T},this.destroy=function(){n.releaseStatesOfProgram(this),u.deleteProgram(f),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=Lr++,this.cacheKey=e,this.usedTimes=1,this.program=f,this.vertexShader=_,this.fragmentShader=y,this}let Br=0;class RA{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){var t=e.vertexShader,n=e.fragmentShader,t=this._getShaderStage(t),n=this._getShaderStage(n),e=this._getShaderCacheForMaterial(e);return!1===e.has(t)&&(e.add(t),t.usedTimes++),!1===e.has(n)&&(e.add(n),n.usedTimes++),this}remove(e){var t;for(t of this.materialCache.get(e))t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){var t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){var t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new NA(e),t.set(e,n)),n}}class NA{constructor(e){this.id=Br++,this.code=e,this.usedTimes=0}}function yf(ee,te,ne,ie,re,t,ae){let a=new sA,oe=new RA,se=new Set,o=[],le=re.logarithmicDepthBuffer,ue=re.vertexTextures,ce=re.precision,he={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function de(e){return se.add(e),0===e?"uv":"uv"+e}return{getParameters:function(e,t,U,n,i){var r=n.fog,a=i.geometry,n=e.isMeshStandardMaterial?n.environment:null,B=(n=(e.isMeshStandardMaterial?ne:te).get(e.envMap||n))&&n.mapping===Oe?n.image.height:null,o=he[e.type];null!==e.precision&&(ce=re.getMaxPrecision(e.precision))!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",ce,"instead.");var s=void 0!==(s=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color)?s.length:0;let l=0;void 0!==a.morphAttributes.position&&(l=1),void 0!==a.morphAttributes.normal&&(l=2),void 0!==a.morphAttributes.color&&(l=3);let u,c,h,d;o?(p=lr[o],u=p.vertexShader,c=p.fragmentShader):(u=e.vertexShader,c=e.fragmentShader,oe.update(e),h=oe.getVertexShaderID(e),d=oe.getFragmentShaderID(e));var p=ee.getRenderTarget(),f=!0===i.isInstancedMesh,m=!0===i.isBatchedMesh,g=!!e.map,F=!!e.matcap,v=!!n,_=!!e.aoMap,y=!!e.lightMap,E=!!e.bumpMap,A=!!e.normalMap,x=!!e.displacementMap,T=!!e.emissiveMap,S=!!e.metalnessMap,w=!!e.roughnessMap,b=0<e.anisotropy,M=0<e.clearcoat,z=0<e.dispersion,R=0<e.iridescence,N=0<e.sheen,I=0<e.transmission,C=b&&!!e.anisotropyMap,L=M&&!!e.clearcoatMap,D=M&&!!e.clearcoatNormalMap,O=M&&!!e.clearcoatRoughnessMap,k=R&&!!e.iridescenceMap,G=R&&!!e.iridescenceThicknessMap,H=N&&!!e.sheenColorMap,V=N&&!!e.sheenRoughnessMap,W=!!e.specularMap,j=!!e.specularColorMap,Y=!!e.specularIntensityMap,q=I&&!!e.transmissionMap,X=I&&!!e.thicknessMap,Z=!!e.gradientMap,P=!!e.alphaMap,K=0<e.alphaTest,J=!!e.alphaHash,Q=!!e.extensions;let $=Xe;return!e.toneMapped||null!==p&&!0!==p.isXRRenderTarget||($=ee.toneMapping),(o={shaderID:o,shaderType:e.type,shaderName:e.name,vertexShader:u,fragmentShader:c,defines:e.defines,customVertexShaderID:h,customFragmentShaderID:d,isRawShaderMaterial:!0===e.isRawShaderMaterial,glslVersion:e.glslVersion,precision:ce,batching:m,batchingColor:m&&null!==i._colorsTexture,instancing:f,instancingColor:f&&null!==i.instanceColor,instancingMorph:f&&null!==i.morphTexture,supportsVertexTextures:ue,outputColorSpace:null===p?ee.outputColorSpace:!0===p.isXRRenderTarget?p.texture.colorSpace:Ye,alphaToCoverage:!!e.alphaToCoverage,map:g,matcap:F,envMap:v,envMapMode:v&&n.mapping,envMapCubeUVHeight:B,aoMap:_,lightMap:y,bumpMap:E,normalMap:A,displacementMap:ue&&x,emissiveMap:T,normalMapObjectSpace:A&&e.normalMapType===Zt,normalMapTangentSpace:A&&e.normalMapType===Xt,metalnessMap:S,roughnessMap:w,anisotropy:b,anisotropyMap:C,clearcoat:M,clearcoatMap:L,clearcoatNormalMap:D,clearcoatRoughnessMap:O,dispersion:z,iridescence:R,iridescenceMap:k,iridescenceThicknessMap:G,sheen:N,sheenColorMap:H,sheenRoughnessMap:V,specularMap:W,specularColorMap:j,specularIntensityMap:Y,transmission:I,transmissionMap:q,thicknessMap:X,gradientMap:Z,opaque:!1===e.transparent&&e.blending===fe&&!1===e.alphaToCoverage,alphaMap:P,alphaTest:K,alphaHash:J,combine:e.combine,mapUv:g&&de(e.map.channel),aoMapUv:_&&de(e.aoMap.channel),lightMapUv:y&&de(e.lightMap.channel),bumpMapUv:E&&de(e.bumpMap.channel),normalMapUv:A&&de(e.normalMap.channel),displacementMapUv:x&&de(e.displacementMap.channel),emissiveMapUv:T&&de(e.emissiveMap.channel),metalnessMapUv:S&&de(e.metalnessMap.channel),roughnessMapUv:w&&de(e.roughnessMap.channel),anisotropyMapUv:C&&de(e.anisotropyMap.channel),clearcoatMapUv:L&&de(e.clearcoatMap.channel),clearcoatNormalMapUv:D&&de(e.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:O&&de(e.clearcoatRoughnessMap.channel),iridescenceMapUv:k&&de(e.iridescenceMap.channel),iridescenceThicknessMapUv:G&&de(e.iridescenceThicknessMap.channel),sheenColorMapUv:H&&de(e.sheenColorMap.channel),sheenRoughnessMapUv:V&&de(e.sheenRoughnessMap.channel),specularMapUv:W&&de(e.specularMap.channel),specularColorMapUv:j&&de(e.specularColorMap.channel),specularIntensityMapUv:Y&&de(e.specularIntensityMap.channel),transmissionMapUv:q&&de(e.transmissionMap.channel),thicknessMapUv:X&&de(e.thicknessMap.channel),alphaMapUv:P&&de(e.alphaMap.channel),vertexTangents:!!a.attributes.tangent&&(A||b),vertexColors:e.vertexColors,vertexAlphas:!0===e.vertexColors&&!!a.attributes.color&&4===a.attributes.color.itemSize,pointsUvs:!0===i.isPoints&&!!a.attributes.uv&&(g||P),fog:!!r,useFog:!0===e.fog,fogExp2:!!r&&r.isFogExp2,flatShading:!0===e.flatShading,sizeAttenuation:!0===e.sizeAttenuation,logarithmicDepthBuffer:le,skinning:!0===i.isSkinnedMesh,morphTargets:void 0!==a.morphAttributes.position,morphNormals:void 0!==a.morphAttributes.normal,morphColors:void 0!==a.morphAttributes.color,morphTargetsCount:s,morphTextureStride:l,numDirLights:t.directional.length,numPointLights:t.point.length,numSpotLights:t.spot.length,numSpotLightMaps:t.spotLightMap.length,numRectAreaLights:t.rectArea.length,numHemiLights:t.hemi.length,numDirLightShadows:t.directionalShadowMap.length,numPointLightShadows:t.pointShadowMap.length,numSpotLightShadows:t.spotShadowMap.length,numSpotLightShadowsWithMaps:t.numSpotLightShadowsWithMaps,numLightProbes:t.numLightProbes,numClippingPlanes:ae.numPlanes,numClipIntersection:ae.numIntersection,dithering:e.dithering,shadowMapEnabled:ee.shadowMap.enabled&&0<U.length,shadowMapType:ee.shadowMap.type,toneMapping:$,decodeVideoTexture:g&&!0===e.map.isVideoTexture&&qe.getTransfer(e.map.colorSpace)===pe,premultipliedAlpha:e.premultipliedAlpha,doubleSided:e.side===He,flipSided:e.side===Ge,useDepthPacking:0<=e.depthPacking,depthPacking:e.depthPacking||0,index0AttributeName:e.index0AttributeName,extensionClipCullDistance:Q&&!0===e.extensions.clipCullDistance&&ie.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Q&&!0===e.extensions.multiDraw||m)&&ie.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:ie.has("KHR_parallel_shader_compile"),customProgramCacheKey:e.customProgramCacheKey()}).vertexUv1s=se.has(1),o.vertexUv2s=se.has(2),o.vertexUv3s=se.has(3),se.clear(),o},getProgramCacheKey:function(e){var t,n,i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.customVertexShaderID),i.push(e.customFragmentShaderID)),void 0!==e.defines)for(var r in e.defines)i.push(r),i.push(e.defines[r]);return!1===e.isRawShaderMaterial&&((t=i).push((n=e).precision),t.push(n.outputColorSpace),t.push(n.envMapMode),t.push(n.envMapCubeUVHeight),t.push(n.mapUv),t.push(n.alphaMapUv),t.push(n.lightMapUv),t.push(n.aoMapUv),t.push(n.bumpMapUv),t.push(n.normalMapUv),t.push(n.displacementMapUv),t.push(n.emissiveMapUv),t.push(n.metalnessMapUv),t.push(n.roughnessMapUv),t.push(n.anisotropyMapUv),t.push(n.clearcoatMapUv),t.push(n.clearcoatNormalMapUv),t.push(n.clearcoatRoughnessMapUv),t.push(n.iridescenceMapUv),t.push(n.iridescenceThicknessMapUv),t.push(n.sheenColorMapUv),t.push(n.sheenRoughnessMapUv),t.push(n.specularMapUv),t.push(n.specularColorMapUv),t.push(n.specularIntensityMapUv),t.push(n.transmissionMapUv),t.push(n.thicknessMapUv),t.push(n.combine),t.push(n.fogExp2),t.push(n.sizeAttenuation),t.push(n.morphTargetsCount),t.push(n.morphAttributeCount),t.push(n.numDirLights),t.push(n.numPointLights),t.push(n.numSpotLights),t.push(n.numSpotLightMaps),t.push(n.numHemiLights),t.push(n.numRectAreaLights),t.push(n.numDirLightShadows),t.push(n.numPointLightShadows),t.push(n.numSpotLightShadows),t.push(n.numSpotLightShadowsWithMaps),t.push(n.numLightProbes),t.push(n.shadowMapType),t.push(n.toneMapping),t.push(n.numClippingPlanes),t.push(n.numClipIntersection),t.push(n.depthPacking),t=i,n=e,a.disableAll(),n.supportsVertexTextures&&a.enable(0),n.instancing&&a.enable(1),n.instancingColor&&a.enable(2),n.instancingMorph&&a.enable(3),n.matcap&&a.enable(4),n.envMap&&a.enable(5),n.normalMapObjectSpace&&a.enable(6),n.normalMapTangentSpace&&a.enable(7),n.clearcoat&&a.enable(8),n.iridescence&&a.enable(9),n.alphaTest&&a.enable(10),n.vertexColors&&a.enable(11),n.vertexAlphas&&a.enable(12),n.vertexUv1s&&a.enable(13),n.vertexUv2s&&a.enable(14),n.vertexUv3s&&a.enable(15),n.vertexTangents&&a.enable(16),n.anisotropy&&a.enable(17),n.alphaHash&&a.enable(18),n.batching&&a.enable(19),n.dispersion&&a.enable(20),n.batchingColor&&a.enable(21),t.push(a.mask),a.disableAll(),n.fog&&a.enable(0),n.useFog&&a.enable(1),n.flatShading&&a.enable(2),n.logarithmicDepthBuffer&&a.enable(3),n.skinning&&a.enable(4),n.morphTargets&&a.enable(5),n.morphNormals&&a.enable(6),n.morphColors&&a.enable(7),n.premultipliedAlpha&&a.enable(8),n.shadowMapEnabled&&a.enable(9),n.doubleSided&&a.enable(10),n.flipSided&&a.enable(11),n.useDepthPacking&&a.enable(12),n.dithering&&a.enable(13),n.transmission&&a.enable(14),n.sheen&&a.enable(15),n.opaque&&a.enable(16),n.pointsUvs&&a.enable(17),n.decodeVideoTexture&&a.enable(18),n.alphaToCoverage&&a.enable(19),t.push(a.mask),i.push(ee.outputColorSpace)),i.push(e.customProgramCacheKey),i.join()},getUniforms:function(e){var t=he[e.type];let n;return n=t?(t=lr[t],$i.clone(t.uniforms)):e.uniforms},acquireProgram:function(e,n){let i;for(let e=0,t=o.length;e<t;e++){var r=o[e];if(r.cacheKey===n){++(i=r).usedTimes;break}}return void 0===i&&(i=new _f(ee,n,e,t),o.push(i)),i},releaseProgram:function(e){var t;0==--e.usedTimes&&(t=o.indexOf(e),o[t]=o[o.length-1],o.pop(),e.destroy())},releaseShaderCache:function(e){oe.remove(e)},programs:o,dispose:function(){oe.dispose()}}}function Ef(){let i=new WeakMap;return{get:function(e){let t=i.get(e);return void 0===t&&(t={},i.set(e,t)),t},remove:function(e){i.delete(e)},update:function(e,t,n){i.get(e)[t]=n},dispose:function(){i=new WeakMap}}}function Af(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function xf(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Tf(){let s=[],l=0,o=[],u=[],c=[];function h(e,t,n,i,r,a){let o=s[l];return void 0===o?(o={id:e.id,object:e,geometry:t,material:n,groupOrder:i,renderOrder:e.renderOrder,z:r,group:a},s[l]=o):(o.id=e.id,o.object=e,o.geometry=t,o.material=n,o.groupOrder=i,o.renderOrder=e.renderOrder,o.z=r,o.group=a),l++,o}return{opaque:o,transmissive:u,transparent:c,init:function(){l=0,o.length=0,u.length=0,c.length=0},push:function(e,t,n,i,r,a){e=h(e,t,n,i,r,a),(0<n.transmission?u:!0===n.transparent?c:o).push(e)},unshift:function(e,t,n,i,r,a){e=h(e,t,n,i,r,a),(0<n.transmission?u:!0===n.transparent?c:o).unshift(e)},finish:function(){for(let e=l,t=s.length;e<t;e++){var n=s[e];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.group=null}},sort:function(e,t){1<o.length&&o.sort(e||Af),1<u.length&&u.sort(t||xf),1<c.length&&c.sort(t||xf)}}}function Sf(){let r=new WeakMap;return{get:function(e,t){var n=r.get(e);let i;return void 0===n?(i=new Tf,r.set(e,[i])):t>=n.length?(i=new Tf,n.push(i)):i=n[t],i},dispose:function(){r=new WeakMap}}}function wf(){let n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new dd,color:new vd};break;case"SpotLight":t={position:new dd,direction:new dd,color:new vd,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new dd,color:new vd,distance:0,decay:0};break;case"HemisphereLight":t={direction:new dd,skyColor:new vd,groundColor:new vd};break;case"RectAreaLight":t={color:new vd,position:new dd,halfWidth:new dd,halfHeight:new dd}}return n[e.id]=t}}}let Fr=0;function bf(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Mf(t){let b=new wf,M=(()=>{let n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ld};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ld,shadowCameraNear:1,shadowCameraFar:1e3}}return n[e.id]=t}}})(),R={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)R.probe.push(new dd);let p=new dd,f=new fd,m=new fd;return{setup:function(n){let i=0,r=0,a=0;for(let e=0;e<9;e++)R.probe[e].set(0,0,0);let o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,f=0,m=0,g=0;n.sort(bf);for(let e=0,t=n.length;e<t;e++){var v,_,y,E,A=n[e],x=A.color,T=A.intensity,S=A.distance,w=A.shadow&&A.shadow.map?A.shadow.map.texture:null;if(A.isAmbientLight)i+=x.r*T,r+=x.g*T,a+=x.b*T;else if(A.isLightProbe){for(let e=0;e<9;e++)R.probe[e].addScaledVector(A.sh.coefficients[e],T);g++}else A.isDirectionalLight?((y=b.get(A)).color.copy(A.color).multiplyScalar(A.intensity),A.castShadow&&(v=A.shadow,(_=M.get(A)).shadowIntensity=v.intensity,_.shadowBias=v.bias,_.shadowNormalBias=v.normalBias,_.shadowRadius=v.radius,_.shadowMapSize=v.mapSize,R.directionalShadow[o]=_,R.directionalShadowMap[o]=w,R.directionalShadowMatrix[o]=A.shadow.matrix,h++),R.directional[o]=y,o++):A.isSpotLight?((v=b.get(A)).position.setFromMatrixPosition(A.matrixWorld),v.color.copy(x).multiplyScalar(T),v.distance=S,v.coneCos=Math.cos(A.angle),v.penumbraCos=Math.cos(A.angle*(1-A.penumbra)),v.decay=A.decay,R.spot[l]=v,_=A.shadow,A.map&&(R.spotLightMap[f]=A.map,f++,_.updateMatrices(A),A.castShadow)&&m++,R.spotLightMatrix[l]=_.matrix,A.castShadow&&((y=M.get(A)).shadowIntensity=_.intensity,y.shadowBias=_.bias,y.shadowNormalBias=_.normalBias,y.shadowRadius=_.radius,y.shadowMapSize=_.mapSize,R.spotShadow[l]=y,R.spotShadowMap[l]=w,p++),l++):A.isRectAreaLight?((S=b.get(A)).color.copy(x).multiplyScalar(T),S.halfWidth.set(.5*A.width,0,0),S.halfHeight.set(0,.5*A.height,0),R.rectArea[u]=S,u++):A.isPointLight?((x=b.get(A)).color.copy(A.color).multiplyScalar(A.intensity),x.distance=A.distance,x.decay=A.decay,A.castShadow&&(S=A.shadow,(E=M.get(A)).shadowIntensity=S.intensity,E.shadowBias=S.bias,E.shadowNormalBias=S.normalBias,E.shadowRadius=S.radius,E.shadowMapSize=S.mapSize,E.shadowCameraNear=S.camera.near,E.shadowCameraFar=S.camera.far,R.pointShadow[s]=E,R.pointShadowMap[s]=w,R.pointShadowMatrix[s]=A.shadow.matrix,d++),R.point[s]=x,s++):A.isHemisphereLight&&((S=b.get(A)).skyColor.copy(A.color).multiplyScalar(T),S.groundColor.copy(A.groundColor).multiplyScalar(T),R.hemi[c]=S,c++)}0<u&&(!0===t.has("OES_texture_float_linear")?(R.rectAreaLTC1=N.LTC_FLOAT_1,R.rectAreaLTC2=N.LTC_FLOAT_2):(R.rectAreaLTC1=N.LTC_HALF_1,R.rectAreaLTC2=N.LTC_HALF_2)),R.ambient[0]=i,R.ambient[1]=r,R.ambient[2]=a;var e=R.hash;e.directionalLength===o&&e.pointLength===s&&e.spotLength===l&&e.rectAreaLength===u&&e.hemiLength===c&&e.numDirectionalShadows===h&&e.numPointShadows===d&&e.numSpotShadows===p&&e.numSpotMaps===f&&e.numLightProbes===g||(R.directional.length=o,R.spot.length=l,R.rectArea.length=u,R.point.length=s,R.hemi.length=c,R.directionalShadow.length=h,R.directionalShadowMap.length=h,R.pointShadow.length=d,R.pointShadowMap.length=d,R.spotShadow.length=p,R.spotShadowMap.length=p,R.directionalShadowMatrix.length=h,R.pointShadowMatrix.length=d,R.spotLightMatrix.length=p+f-m,R.spotLightMap.length=f,R.numSpotLightShadowsWithMaps=m,R.numLightProbes=g,e.directionalLength=o,e.pointLength=s,e.spotLength=l,e.rectAreaLength=u,e.hemiLength=c,e.numDirectionalShadows=h,e.numPointShadows=d,e.numSpotShadows=p,e.numSpotMaps=f,e.numLightProbes=g,R.version=Fr++)},setupView:function(n,e){let i=0,r=0,a=0,o=0,s=0;var l=e.matrixWorldInverse;for(let e=0,t=n.length;e<t;e++){var u,c,h,d=n[e];d.isDirectionalLight?((u=R.directional[i]).direction.setFromMatrixPosition(d.matrixWorld),p.setFromMatrixPosition(d.target.matrixWorld),u.direction.sub(p),u.direction.transformDirection(l),i++):d.isSpotLight?((u=R.spot[a]).position.setFromMatrixPosition(d.matrixWorld),u.position.applyMatrix4(l),u.direction.setFromMatrixPosition(d.matrixWorld),p.setFromMatrixPosition(d.target.matrixWorld),u.direction.sub(p),u.direction.transformDirection(l),a++):d.isRectAreaLight?((c=R.rectArea[o]).position.setFromMatrixPosition(d.matrixWorld),c.position.applyMatrix4(l),m.identity(),f.copy(d.matrixWorld),f.premultiply(l),m.extractRotation(f),c.halfWidth.set(.5*d.width,0,0),c.halfHeight.set(0,.5*d.height,0),c.halfWidth.applyMatrix4(m),c.halfHeight.applyMatrix4(m),o++):d.isPointLight?((c=R.point[r]).position.setFromMatrixPosition(d.matrixWorld),c.position.applyMatrix4(l),r++):d.isHemisphereLight&&((h=R.hemi[s]).direction.setFromMatrixPosition(d.matrixWorld),h.direction.transformDirection(l),s++)}},state:R}}function Rf(e){let t=new Mf(e),n=[],i=[];let r={lightsArray:n,shadowsArray:i,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){r.camera=e,n.length=0,i.length=0},state:r,setupLights:function(){t.setup(n)},setupLightsView:function(e){t.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){i.push(e)}}}function Nf(r){let a=new WeakMap;return{get:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=a.get(e);let i;return void 0===n?(i=new Rf(r),a.set(e,[i])):t>=n.length?(i=new Rf(r),n.push(i)):i=n[t],i},dispose:function(){a=new WeakMap}}}class IA extends uA{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Yt,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class CA extends uA{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}let zr="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",kr="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function If(g,v,e){let _=new yA,y=new ld,E=new ld,A=new cd,o=new IA({depthPacking:qt}),s=new CA,l={},x=e.maxTextureSize,u={[ke]:Ge,[Ge]:ke,[He]:He},T=new Td({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ld},radius:{value:4}},vertexShader:zr,fragmentShader:kr}),S=T.clone();S.defines.HORIZONTAL_PASS=1;e=new Ad;e.setAttribute("position",new yd(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let w=new xd(e,T),b=this,M=(this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=I,this.type);function R(n,i,e,t){let r=null;n=!0===e.isPointLight?n.customDistanceMaterial:n.customDepthMaterial;if(void 0!==n)r=n;else if(r=!0===e.isPointLight?s:o,g.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&0<i.alphaTest||i.map&&0<i.alphaTest){var n=r.uuid,a=i.uuid;let e=l[n],t=(void 0===e&&(e={},l[n]=e),e[a]);void 0===t&&(t=r.clone(),e[a]=t,i.addEventListener("dispose",c)),r=t}return r.visible=i.visible,r.wireframe=i.wireframe,t===C?r.side=null!==i.shadowSide?i.shadowSide:i.side:r.side=null!==i.shadowSide?i.shadowSide:u[i.side],r.alphaMap=i.alphaMap,r.alphaTest=i.alphaTest,r.map=i.map,r.clipShadows=i.clipShadows,r.clippingPlanes=i.clippingPlanes,r.clipIntersection=i.clipIntersection,r.displacementMap=i.displacementMap,r.displacementScale=i.displacementScale,r.displacementBias=i.displacementBias,r.wireframeLinewidth=i.wireframeLinewidth,r.linewidth=i.linewidth,!0===e.isPointLight&&!0===r.isMeshDistanceMaterial&&(g.properties.get(r).light=e),r}function c(e){for(var t in e.target.removeEventListener("dispose",c),l){var t=l[t],n=e.target.uuid;n in t&&(t[n].dispose(),delete t[n])}}this.render=function(n,i,r){if(!1!==b.enabled&&(!1!==b.autoUpdate||!1!==b.needsUpdate)&&0!==n.length){var e=g.getRenderTarget(),t=g.getActiveCubeFace(),a=g.getActiveMipmapLevel(),o=g.state,s=(o.setBlending(Y),o.buffers.color.setClear(1,1,1,1),o.buffers.depth.setTest(!0),o.setScissorTest(!1),M!==C&&this.type===C),l=M===C&&this.type!==C;for(let e=0,t=n.length;e<t;e++){var u=n[e],c=u.shadow;if(void 0===c)console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");else if(!1!==c.autoUpdate||!1!==c.needsUpdate){y.copy(c.mapSize);var h,d,p=c.getFrameExtents(),f=(y.multiply(p),E.copy(c.mapSize),(y.x>x||y.y>x)&&(y.x>x&&(E.x=Math.floor(x/p.x),y.x=E.x*p.x,c.mapSize.x=E.x),y.y>x)&&(E.y=Math.floor(x/p.y),y.y=E.y*p.y,c.mapSize.y=E.y),null!==c.map&&!0!=s&&!0!=l||(p=this.type!==C?{minFilter:V,magFilter:V}:{},null!==c.map&&c.map.dispose(),c.map=new nA(y.x,y.y,p),c.map.texture.name=u.name+".shadowMap",c.camera.updateProjectionMatrix()),g.setRenderTarget(c.map),g.clear(),c.getViewportCount());for(let e=0;e<f;e++){var m=c.getViewport(e);A.set(E.x*m.x,E.y*m.y,E.x*m.z,E.y*m.w),o.viewport(A),c.updateMatrices(u,e),_=c.getFrustum(),!function n(o,s,l,u,c){if(!1===o.visible)return;let e=o.layers.test(s.layers);if(e&&(o.isMesh||o.isLine||o.isPoints)&&(o.castShadow||o.receiveShadow&&c===C)&&(!o.frustumCulled||_.intersectsObject(o))){o.modelViewMatrix.multiplyMatrices(l.matrixWorldInverse,o.matrixWorld);let r=v.update(o),a=o.material;if(Array.isArray(a)){let i=r.groups;for(let e=0,t=i.length;e<t;e++){let t=i[e],n=a[t.materialIndex];if(n&&n.visible){let e=R(o,n,u,c);o.onBeforeShadow(g,o,s,l,r,e,t),g.renderBufferDirect(l,null,r,e,o,t),o.onAfterShadow(g,o,s,l,r,e,t)}}}else if(a.visible){let e=R(o,a,u,c);o.onBeforeShadow(g,o,s,l,r,e,null),g.renderBufferDirect(l,null,r,e,o,null),o.onAfterShadow(g,o,s,l,r,e,null)}}let i=o.children;for(let e=0,t=i.length;e<t;e++)n(i[e],s,l,u,c)}(i,r,c.camera,u,this.type)}!0!==c.isPointLightShadow&&this.type===C&&(d=h=p=void 0,p=c,h=r,d=v.update(w),T.defines.VSM_SAMPLES!==p.blurSamples&&(T.defines.VSM_SAMPLES=p.blurSamples,S.defines.VSM_SAMPLES=p.blurSamples,T.needsUpdate=!0,S.needsUpdate=!0),null===p.mapPass&&(p.mapPass=new nA(y.x,y.y)),T.uniforms.shadow_pass.value=p.map.texture,T.uniforms.resolution.value=p.mapSize,T.uniforms.radius.value=p.radius,g.setRenderTarget(p.mapPass),g.clear(),g.renderBufferDirect(h,null,d,T,w,null),S.uniforms.shadow_pass.value=p.mapPass.texture,S.uniforms.resolution.value=p.mapSize,S.uniforms.radius.value=p.radius,g.setRenderTarget(p.map),g.clear(),g.renderBufferDirect(h,null,d,S,w,null)),c.needsUpdate=!1}}M=this.type,b.needsUpdate=!1,g.setRenderTarget(e,t,a)}}}function Cf(c){let i=new function(){let t=!1,a=new cd,n=null,o=new cd(0,0,0,0);return{setMask:function(e){n===e||t||(c.colorMask(e,e,e,e),n=e)},setLocked:function(e){t=e},setClear:function(e,t,n,i,r){!0===r&&(e*=i,t*=i,n*=i),a.set(e,t,n,i),!1===o.equals(a)&&(c.clearColor(e,t,n,i),o.copy(a))},reset:function(){t=!1,n=null,o.set(-1,0,0,0)}}},r=new function(){let t=!1,n=null,i=null,r=null;return{setTest:function(e){(e?C:L)(c.DEPTH_TEST)},setMask:function(e){n===e||t||(c.depthMask(e),n=e)},setFunc:function(e){if(i!==e){switch(e){case we:c.depthFunc(c.NEVER);break;case be:c.depthFunc(c.ALWAYS);break;case Me:c.depthFunc(c.LESS);break;case Re:c.depthFunc(c.LEQUAL);break;case Ne:c.depthFunc(c.EQUAL);break;case Ie:c.depthFunc(c.GEQUAL);break;case Ce:c.depthFunc(c.GREATER);break;case Le:c.depthFunc(c.NOTEQUAL);break;default:c.depthFunc(c.LEQUAL)}i=e}},setLocked:function(e){t=e},setClear:function(e){r!==e&&(c.clearDepth(e),r=e)},reset:function(){t=!1,n=null,i=null,r=null}}},a=new function(){let t=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,u=null;return{setTest:function(e){t||(e?C:L)(c.STENCIL_TEST)},setMask:function(e){n===e||t||(c.stencilMask(e),n=e)},setFunc:function(e,t,n){i===e&&r===t&&a===n||(c.stencilFunc(e,t,n),i=e,r=t,a=n)},setOp:function(e,t,n){o===e&&s===t&&l===n||(c.stencilOp(e,t,n),o=e,s=t,l=n)},setLocked:function(e){t=e},setClear:function(e){u!==e&&(c.clearStencil(e),u=e)},reset:function(){t=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,u=null}}},U=new WeakMap,o=new WeakMap,t={},n={},s=new WeakMap,B=[],l=null,h=!1,d=null,p=null,f=null,m=null,g=null,v=null,_=null,y=new vd(0,0,0),E=0,A=!1,u=null,x=null,T=null,S=null,w=null,F=c.getParameter(c.MAX_COMBINED_TEXTURE_IMAGE_UNITS),z=!1,e=0;var b=c.getParameter(c.VERSION);-1!==b.indexOf("WebGL")?(e=parseFloat(/^WebGL (\d)/.exec(b)[1]),z=1<=e):-1!==b.indexOf("OpenGL ES")&&(e=parseFloat(/^OpenGL ES (\d)/.exec(b)[1]),z=2<=e);let M=null,R={};var b=c.getParameter(c.SCISSOR_BOX),k=c.getParameter(c.VIEWPORT);let G=(new cd).fromArray(b),H=(new cd).fromArray(k);function N(t,n,i,r){var a=new Uint8Array(4),e=c.createTexture();c.bindTexture(t,e),c.texParameteri(t,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(t,c.TEXTURE_MAG_FILTER,c.NEAREST);for(let e=0;e<i;e++)t===c.TEXTURE_3D||t===c.TEXTURE_2D_ARRAY?c.texImage3D(n,0,c.RGBA,1,1,r,0,c.RGBA,c.UNSIGNED_BYTE,a):c.texImage2D(n+e,0,c.RGBA,1,1,0,c.RGBA,c.UNSIGNED_BYTE,a);return e}let I={};function C(e){!0!==t[e]&&(c.enable(e),t[e]=!0)}function L(e){!1!==t[e]&&(c.disable(e),t[e]=!1)}I[c.TEXTURE_2D]=N(c.TEXTURE_2D,c.TEXTURE_2D,1),I[c.TEXTURE_CUBE_MAP]=N(c.TEXTURE_CUBE_MAP,c.TEXTURE_CUBE_MAP_POSITIVE_X,6),I[c.TEXTURE_2D_ARRAY]=N(c.TEXTURE_2D_ARRAY,c.TEXTURE_2D_ARRAY,1,1),I[c.TEXTURE_3D]=N(c.TEXTURE_3D,c.TEXTURE_3D,1,1),i.setClear(0,0,0,1),r.setClear(1),a.setClear(0),C(c.DEPTH_TEST),r.setFunc(Re),V(!1),W(Z),C(c.CULL_FACE),P(Y);let D={[ie]:c.FUNC_ADD,[re]:c.FUNC_SUBTRACT,[ae]:c.FUNC_REVERSE_SUBTRACT},O=(D[oe]=c.MIN,D[se]=c.MAX,{[le]:c.ZERO,[ue]:c.ONE,[ce]:c.SRC_COLOR,[de]:c.SRC_ALPHA,[Ee]:c.SRC_ALPHA_SATURATE,[_e]:c.DST_COLOR,[ge]:c.DST_ALPHA,[he]:c.ONE_MINUS_SRC_COLOR,[me]:c.ONE_MINUS_SRC_ALPHA,[ye]:c.ONE_MINUS_DST_COLOR,[ve]:c.ONE_MINUS_DST_ALPHA,[Ae]:c.CONSTANT_COLOR,[xe]:c.ONE_MINUS_CONSTANT_COLOR,[Te]:c.CONSTANT_ALPHA,[Se]:c.ONE_MINUS_CONSTANT_ALPHA});function P(e,t,n,i,r,a,o,s,l,u){if(e===Y)!0===h&&(L(c.BLEND),h=!1);else if(!1===h&&(C(c.BLEND),h=!0),e!==ne){if(e!==d||u!==A){if(p===ie&&g===ie||(c.blendEquation(c.FUNC_ADD),p=ie,g=ie),u)switch(e){case fe:c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case J:c.blendFunc(c.ONE,c.ONE);break;case Q:c.blendFuncSeparate(c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ZERO,c.ONE);break;case $:c.blendFuncSeparate(c.ZERO,c.SRC_COLOR,c.ZERO,c.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case fe:c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case J:c.blendFunc(c.SRC_ALPHA,c.ONE);break;case Q:c.blendFuncSeparate(c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ZERO,c.ONE);break;case $:c.blendFunc(c.ZERO,c.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}f=null,m=null,v=null,_=null,y.set(0,0,0),E=0,d=e,A=u}}else r=r||t,a=a||n,o=o||i,t===p&&r===g||(c.blendEquationSeparate(D[t],D[r]),p=t,g=r),n===f&&i===m&&a===v&&o===_||(c.blendFuncSeparate(O[n],O[i],O[a],O[o]),f=n,m=i,v=a,_=o),!1!==s.equals(y)&&l===E||(c.blendColor(s.r,s.g,s.b,l),y.copy(s),E=l),d=e,A=!1}function V(e){u!==e&&(e?c.frontFace(c.CW):c.frontFace(c.CCW),u=e)}function W(e){e!==X?(C(c.CULL_FACE),e!==x&&(e===Z?c.cullFace(c.BACK):e===K?c.cullFace(c.FRONT):c.cullFace(c.FRONT_AND_BACK))):L(c.CULL_FACE),x=e}function j(e,t,n){e?(C(c.POLYGON_OFFSET_FILL),S===t&&w===n||(c.polygonOffset(t,n),S=t,w=n)):L(c.POLYGON_OFFSET_FILL)}return{buffers:{color:i,depth:r,stencil:a},enable:C,disable:L,bindFramebuffer:function(e,t){return n[e]!==t&&(c.bindFramebuffer(e,t),n[e]=t,e===c.DRAW_FRAMEBUFFER&&(n[c.FRAMEBUFFER]=t),e===c.FRAMEBUFFER&&(n[c.DRAW_FRAMEBUFFER]=t),!0)},drawBuffers:function(e,n){let i=B,t=!1;if(e){void 0===(i=s.get(n))&&(i=[],s.set(n,i));n=e.textures;if(i.length!==n.length||i[0]!==c.COLOR_ATTACHMENT0){for(let e=0,t=n.length;e<t;e++)i[e]=c.COLOR_ATTACHMENT0+e;i.length=n.length,t=!0}}else i[0]!==c.BACK&&(i[0]=c.BACK,t=!0);t&&c.drawBuffers(i)},useProgram:function(e){return l!==e&&(c.useProgram(e),l=e,!0)},setBlending:P,setMaterial:function(e,t){(e.side===He?L:C)(c.CULL_FACE);let n=e.side===Ge;V(n=t?!n:n),e.blending===fe&&!1===e.transparent?P(Y):P(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.blendColor,e.blendAlpha,e.premultipliedAlpha),r.setFunc(e.depthFunc),r.setTest(e.depthTest),r.setMask(e.depthWrite),i.setMask(e.colorWrite),t=e.stencilWrite,a.setTest(t),t&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),j(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),(!0===e.alphaToCoverage?C:L)(c.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:V,setCullFace:W,setLineWidth:function(e){e!==T&&(z&&c.lineWidth(e),T=e)},setPolygonOffset:j,setScissorTest:function(e){(e?C:L)(c.SCISSOR_TEST)},activeTexture:function(e){void 0===e&&(e=c.TEXTURE0+F-1),M!==e&&(c.activeTexture(e),M=e)},bindTexture:function(e,t,n){void 0===n&&(n=null===M?c.TEXTURE0+F-1:M);let i=R[n];void 0===i&&(i={type:void 0,texture:void 0},R[n]=i),i.type===e&&i.texture===t||(M!==n&&(c.activeTexture(n),M=n),c.bindTexture(e,t||I[e]),i.type=e,i.texture=t)},unbindTexture:function(){var e=R[M];void 0!==e&&void 0!==e.type&&(c.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{c.compressedTexImage2D.apply(c,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{c.compressedTexImage3D.apply(c,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{c.texImage2D.apply(c,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{c.texImage3D.apply(c,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(e,t){let n=o.get(t);void 0===n&&(n=new WeakMap,o.set(t,n)),void 0===n.get(e)&&(t=c.getUniformBlockIndex(t,e.name),n.set(e,t))},uniformBlockBinding:function(e,t){var n=o.get(t).get(e);U.get(t)!==n&&(c.uniformBlockBinding(t,n,e.__bindingPointIndex),U.set(t,n))},texStorage2D:function(){try{c.texStorage2D.apply(c,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{c.texStorage3D.apply(c,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{c.texSubImage2D.apply(c,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{c.texSubImage3D.apply(c,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{c.compressedTexSubImage2D.apply(c,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{c.compressedTexSubImage3D.apply(c,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(e){!1===G.equals(e)&&(c.scissor(e.x,e.y,e.z,e.w),G.copy(e))},viewport:function(e){!1===H.equals(e)&&(c.viewport(e.x,e.y,e.z,e.w),H.copy(e))},reset:function(){c.disable(c.BLEND),c.disable(c.CULL_FACE),c.disable(c.DEPTH_TEST),c.disable(c.POLYGON_OFFSET_FILL),c.disable(c.SCISSOR_TEST),c.disable(c.STENCIL_TEST),c.disable(c.SAMPLE_ALPHA_TO_COVERAGE),c.blendEquation(c.FUNC_ADD),c.blendFunc(c.ONE,c.ZERO),c.blendFuncSeparate(c.ONE,c.ZERO,c.ONE,c.ZERO),c.blendColor(0,0,0,0),c.colorMask(!0,!0,!0,!0),c.clearColor(0,0,0,0),c.depthMask(!0),c.depthFunc(c.LESS),c.clearDepth(1),c.stencilMask(4294967295),c.stencilFunc(c.ALWAYS,0,4294967295),c.stencilOp(c.KEEP,c.KEEP,c.KEEP),c.clearStencil(0),c.cullFace(c.BACK),c.frontFace(c.CCW),c.polygonOffset(0,0),c.activeTexture(c.TEXTURE0),c.bindFramebuffer(c.FRAMEBUFFER,null),c.bindFramebuffer(c.DRAW_FRAMEBUFFER,null),c.bindFramebuffer(c.READ_FRAMEBUFFER,null),c.useProgram(null),c.lineWidth(1),c.scissor(0,0,c.canvas.width,c.canvas.height),c.viewport(0,0,c.canvas.width,c.canvas.height),t={},M=null,R={},n={},s=new WeakMap,B=[],l=null,h=!1,d=null,p=null,f=null,m=null,g=null,v=null,_=null,y=new vd(0,0,0),E=0,A=!1,u=null,x=null,T=null,S=null,w=null,G.set(0,0,c.canvas.width,c.canvas.height),H.set(0,0,c.canvas.width,c.canvas.height),i.reset(),r.reset(),a.reset()}}}function Lf(e,t,n,i){var r=(e=>{switch(e){case We:case x:return{byteLength:1,components:1};case Ze:case ze:case Qe:return{byteLength:2,components:1};case $e:case et:return{byteLength:2,components:4};case Je:case Ke:case j:return{byteLength:4,components:1};case nt:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${e}.`)})(i);switch(n){case it:case at:return e*t;case ot:return e*t*2;case ut:case ct:return e*t/r.components*r.byteLength;case ht:case dt:return e*t*2/r.components*r.byteLength;case rt:return e*t*3/r.components*r.byteLength;case q:case pt:return e*t*4/r.components*r.byteLength;case ft:case mt:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case gt:case vt:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case yt:case At:return Math.max(e,16)*Math.max(t,8)/4;case _t:case Et:return Math.max(e,8)*Math.max(t,8)/2;case xt:case Tt:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case St:case wt:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case bt:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case Mt:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case Rt:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case Nt:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case It:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case Ct:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case Lt:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case Dt:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case Ot:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case Pt:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case Ut:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case Bt:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case Ft:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case zt:case kt:case Gt:return Math.ceil(e/4)*Math.ceil(t/4)*16;case Ht:case Vt:return Math.ceil(e/4)*Math.ceil(t/4)*8;case Wt:case jt:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function Df(T,o,S,w,b,M,d){let h=o.has("WEBGL_multisampled_render_to_texture")?o.get("WEBGL_multisampled_render_to_texture"):null,p="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),t=new ld,a=new WeakMap,s,l=new WeakMap,n=!1;try{n="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function u(e,t){return n?new OffscreenCanvas(e,t):kd("canvas")}function R(e,t,n){let i=1;var r,a=U(e);return(i=a.width>n||a.height>n?n/Math.max(a.width,a.height):i)<1?"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?(n=Math.floor(i*a.width),r=Math.floor(i*a.height),void 0===s&&(s=u(n,r)),(t=t?u(n,r):s).width=n,t.height=r,t.getContext("2d").drawImage(e,0,0,n,r),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+a.width+"x"+a.height+") to ("+n+"x"+r+")."),t):("data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+a.width+"x"+a.height+")."),e):e}function N(e){return e.generateMipmaps&&e.minFilter!==V&&e.minFilter!==W}function I(e){T.generateMipmap(e)}function C(e,t,n,i,r){r=4<arguments.length&&void 0!==r&&r;if(null!==e){if(void 0!==T[e])return T[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let a=t;return t===T.RED&&(n===T.FLOAT&&(a=T.R32F),n===T.HALF_FLOAT&&(a=T.R16F),n===T.UNSIGNED_BYTE)&&(a=T.R8),t===T.RED_INTEGER&&(n===T.UNSIGNED_BYTE&&(a=T.R8UI),n===T.UNSIGNED_SHORT&&(a=T.R16UI),n===T.UNSIGNED_INT&&(a=T.R32UI),n===T.BYTE&&(a=T.R8I),n===T.SHORT&&(a=T.R16I),n===T.INT)&&(a=T.R32I),t===T.RG&&(n===T.FLOAT&&(a=T.RG32F),n===T.HALF_FLOAT&&(a=T.RG16F),n===T.UNSIGNED_BYTE)&&(a=T.RG8),t===T.RG_INTEGER&&(n===T.UNSIGNED_BYTE&&(a=T.RG8UI),n===T.UNSIGNED_SHORT&&(a=T.RG16UI),n===T.UNSIGNED_INT&&(a=T.RG32UI),n===T.BYTE&&(a=T.RG8I),n===T.SHORT&&(a=T.RG16I),n===T.INT)&&(a=T.RG32I),t===T.RGB&&n===T.UNSIGNED_INT_5_9_9_9_REV&&(a=T.RGB9_E5),(a=t===T.RGBA&&(e=r?$t:qe.getTransfer(i),n===T.FLOAT&&(a=T.RGBA32F),n===T.HALF_FLOAT&&(a=T.RGBA16F),n===T.UNSIGNED_BYTE&&(a=e===pe?T.SRGB8_ALPHA8:T.RGBA8),n===T.UNSIGNED_SHORT_4_4_4_4&&(a=T.RGBA4),n===T.UNSIGNED_SHORT_5_5_5_1)?T.RGB5_A1:a)!==T.R16F&&a!==T.R32F&&a!==T.RG16F&&a!==T.RG32F&&a!==T.RGBA16F&&a!==T.RGBA32F||o.get("EXT_color_buffer_float"),a}function L(e,t){let n;return e?null===t||t===Je||t===tt?n=T.DEPTH24_STENCIL8:t===j?n=T.DEPTH32F_STENCIL8:t===Ze&&(n=T.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===t||t===Je||t===tt?n=T.DEPTH_COMPONENT24:t===j?n=T.DEPTH_COMPONENT32F:t===Ze&&(n=T.DEPTH_COMPONENT16),n}function D(e,t){return!0===N(e)||e.isFramebufferTexture&&e.minFilter!==V&&e.minFilter!==W?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&0<e.mipmaps.length?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function c(e){var t,n,i,r,e=e.target;e.removeEventListener("dispose",c),t=e,void 0!==(n=w.get(t)).__webglInit&&(i=t.source,(r=l.get(i))&&((n=r[n.__cacheKey]).usedTimes--,0===n.usedTimes&&m(t),0===Object.keys(r).length)&&l.delete(i),w.remove(t)),e.isVideoTexture&&a.delete(e)}function f(e){var e=e.target,n=(e.removeEventListener("dispose",f),w.get(e));if(e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(n.__webglFramebuffer[t]))for(let e=0;e<n.__webglFramebuffer[t].length;e++)T.deleteFramebuffer(n.__webglFramebuffer[t][e]);else T.deleteFramebuffer(n.__webglFramebuffer[t]);n.__webglDepthbuffer&&T.deleteRenderbuffer(n.__webglDepthbuffer[t])}else{if(Array.isArray(n.__webglFramebuffer))for(let e=0;e<n.__webglFramebuffer.length;e++)T.deleteFramebuffer(n.__webglFramebuffer[e]);else T.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&T.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&T.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let e=0;e<n.__webglColorRenderbuffer.length;e++)n.__webglColorRenderbuffer[e]&&T.deleteRenderbuffer(n.__webglColorRenderbuffer[e]);n.__webglDepthRenderbuffer&&T.deleteRenderbuffer(n.__webglDepthRenderbuffer)}var i=e.textures;for(let e=0,t=i.length;e<t;e++){var r=w.get(i[e]);r.__webglTexture&&(T.deleteTexture(r.__webglTexture),d.memory.textures--),w.remove(i[e])}w.remove(e)}function m(e){var t=w.get(e),e=(T.deleteTexture(t.__webglTexture),e.source);delete l.get(e)[t.__cacheKey],d.memory.textures--}let i=0;function B(e,t){var n,i=w.get(e);if(e.isVideoTexture&&(n=e,r=d.render.frame,a.get(n)!==r)&&(a.set(n,r),n.update()),!1===e.isRenderTargetTexture&&0<e.version&&i.__version!==e.version){var r=e.image;if(null===r)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==r.complete)return void g(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}S.bindTexture(T.TEXTURE_2D,i.__webglTexture,T.TEXTURE0+t)}let r={[H]:T.REPEAT,[Pe]:T.CLAMP_TO_EDGE,[Ue]:T.MIRRORED_REPEAT},F={[V]:T.NEAREST,[e]:T.NEAREST_MIPMAP_NEAREST,[Be]:T.NEAREST_MIPMAP_LINEAR,[W]:T.LINEAR,[Fe]:T.LINEAR_MIPMAP_NEAREST,[Ve]:T.LINEAR_MIPMAP_LINEAR},z={[nn]:T.NEVER,[cn]:T.ALWAYS,[rn]:T.LESS,[on]:T.LEQUAL,[an]:T.EQUAL,[un]:T.GEQUAL,[sn]:T.GREATER,[ln]:T.NOTEQUAL};function O(e,t){var n;t.type!==j||!1!==o.has("OES_texture_float_linear")||t.magFilter!==W&&t.magFilter!==Fe&&t.magFilter!==Be&&t.magFilter!==Ve&&t.minFilter!==W&&t.minFilter!==Fe&&t.minFilter!==Be&&t.minFilter!==Ve||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),T.texParameteri(e,T.TEXTURE_WRAP_S,r[t.wrapS]),T.texParameteri(e,T.TEXTURE_WRAP_T,r[t.wrapT]),e!==T.TEXTURE_3D&&e!==T.TEXTURE_2D_ARRAY||T.texParameteri(e,T.TEXTURE_WRAP_R,r[t.wrapR]),T.texParameteri(e,T.TEXTURE_MAG_FILTER,F[t.magFilter]),T.texParameteri(e,T.TEXTURE_MIN_FILTER,F[t.minFilter]),t.compareFunction&&(T.texParameteri(e,T.TEXTURE_COMPARE_MODE,T.COMPARE_REF_TO_TEXTURE),T.texParameteri(e,T.TEXTURE_COMPARE_FUNC,z[t.compareFunction])),!0!==o.has("EXT_texture_filter_anisotropic")||t.magFilter===V||t.minFilter!==Be&&t.minFilter!==Ve||t.type===j&&!1===o.has("OES_texture_float_linear")||(1<t.anisotropy||w.get(t).__currentAnisotropy)&&(n=o.get("EXT_texture_filter_anisotropic"),T.texParameterf(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,b.getMaxAnisotropy())),w.get(t).__currentAnisotropy=t.anisotropy)}function k(e,t){let n=!1;void 0===e.__webglInit&&(e.__webglInit=!0,t.addEventListener("dispose",c));var i=t.source;let r=l.get(i);void 0===r&&(r={},l.set(i,r));(i=[]).push((a=t).wrapS),i.push(a.wrapT),i.push(a.wrapR||0),i.push(a.magFilter),i.push(a.minFilter),i.push(a.anisotropy),i.push(a.internalFormat),i.push(a.format),i.push(a.type),i.push(a.generateMipmaps),i.push(a.premultiplyAlpha),i.push(a.flipY),i.push(a.unpackAlignment),i.push(a.colorSpace);var a=i.join();return a!==e.__cacheKey&&(void 0===r[a]&&(r[a]={texture:T.createTexture(),usedTimes:0},d.memory.textures++,n=!0),r[a].usedTimes++,void 0!==(i=r[e.__cacheKey])&&(r[e.__cacheKey].usedTimes--,0===i.usedTimes)&&m(t),e.__cacheKey=a,e.__webglTexture=r[a].texture),n}function g(e,r,t){let a=T.TEXTURE_2D;(r.isDataArrayTexture||r.isCompressedArrayTexture)&&(a=T.TEXTURE_2D_ARRAY),r.isData3DTexture&&(a=T.TEXTURE_3D);var o=k(e,r),s=r.source,l=(S.bindTexture(a,e.__webglTexture,T.TEXTURE0+t),w.get(s));if(s.version!==l.__version||!0===o){S.activeTexture(T.TEXTURE0+t);var t=qe.getPrimaries(qe.workingColorSpace),u=r.colorSpace===Kt?null:qe.getPrimaries(r.colorSpace),t=r.colorSpace===Kt||t===u?T.NONE:T.BROWSER_DEFAULT_WEBGL;T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,r.flipY),T.pixelStorei(T.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),T.pixelStorei(T.UNPACK_ALIGNMENT,r.unpackAlignment),T.pixelStorei(T.UNPACK_COLORSPACE_CONVERSION_WEBGL,t);var c=G(r,c=R(r.image,!1,b.maxTextureSize)),h=M.convert(r.format,r.colorSpace),d=M.convert(r.type);let i=C(r.internalFormat,h,d,r.colorSpace,r.isVideoTexture);O(a,r);let n;var p=r.mipmaps,f=!0!==r.isVideoTexture,u=void 0===l.__version||!0===o,m=s.dataReady,g=D(r,c);if(r.isDepthTexture)i=L(r.format===lt,r.type),u&&(f?S.texStorage2D(T.TEXTURE_2D,1,i,c.width,c.height):S.texImage2D(T.TEXTURE_2D,0,i,c.width,c.height,0,h,d,null));else if(r.isDataTexture)if(0<p.length){f&&u&&S.texStorage2D(T.TEXTURE_2D,g,i,p[0].width,p[0].height);for(let e=0,t=p.length;e<t;e++)n=p[e],f?m&&S.texSubImage2D(T.TEXTURE_2D,e,0,0,n.width,n.height,h,d,n.data):S.texImage2D(T.TEXTURE_2D,e,i,n.width,n.height,0,h,d,n.data);r.generateMipmaps=!1}else f?(u&&S.texStorage2D(T.TEXTURE_2D,g,i,c.width,c.height),m&&S.texSubImage2D(T.TEXTURE_2D,0,0,0,c.width,c.height,h,d,c.data)):S.texImage2D(T.TEXTURE_2D,0,i,c.width,c.height,0,h,d,c.data);else if(r.isCompressedTexture)if(r.isCompressedArrayTexture){f&&u&&S.texStorage3D(T.TEXTURE_2D_ARRAY,g,i,p[0].width,p[0].height,c.depth);for(let e=0,t=p.length;e<t;e++)if(n=p[e],r.format!==q)if(null!==h)if(f){if(m)if(0<r.layerUpdates.size){var v,_=Lf(n.width,n.height,r.format,r.type);for(v of r.layerUpdates){var y=n.data.subarray(v*_/n.data.BYTES_PER_ELEMENT,(v+1)*_/n.data.BYTES_PER_ELEMENT);S.compressedTexSubImage3D(T.TEXTURE_2D_ARRAY,e,0,0,v,n.width,n.height,1,h,y,0,0)}r.clearLayerUpdates()}else S.compressedTexSubImage3D(T.TEXTURE_2D_ARRAY,e,0,0,0,n.width,n.height,c.depth,h,n.data,0,0)}else S.compressedTexImage3D(T.TEXTURE_2D_ARRAY,e,i,n.width,n.height,c.depth,0,n.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else f?m&&S.texSubImage3D(T.TEXTURE_2D_ARRAY,e,0,0,0,n.width,n.height,c.depth,h,d,n.data):S.texImage3D(T.TEXTURE_2D_ARRAY,e,i,n.width,n.height,c.depth,0,h,d,n.data)}else{f&&u&&S.texStorage2D(T.TEXTURE_2D,g,i,p[0].width,p[0].height);for(let e=0,t=p.length;e<t;e++)n=p[e],r.format!==q?null!==h?f?m&&S.compressedTexSubImage2D(T.TEXTURE_2D,e,0,0,n.width,n.height,h,n.data):S.compressedTexImage2D(T.TEXTURE_2D,e,i,n.width,n.height,0,n.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):f?m&&S.texSubImage2D(T.TEXTURE_2D,e,0,0,n.width,n.height,h,d,n.data):S.texImage2D(T.TEXTURE_2D,e,i,n.width,n.height,0,h,d,n.data)}else if(r.isDataArrayTexture)if(f){if(u&&S.texStorage3D(T.TEXTURE_2D_ARRAY,g,i,c.width,c.height,c.depth),m)if(0<r.layerUpdates.size){var E,A=Lf(c.width,c.height,r.format,r.type);for(E of r.layerUpdates){var x=c.data.subarray(E*A/c.data.BYTES_PER_ELEMENT,(E+1)*A/c.data.BYTES_PER_ELEMENT);S.texSubImage3D(T.TEXTURE_2D_ARRAY,0,0,0,E,c.width,c.height,1,h,d,x)}r.clearLayerUpdates()}else S.texSubImage3D(T.TEXTURE_2D_ARRAY,0,0,0,0,c.width,c.height,c.depth,h,d,c.data)}else S.texImage3D(T.TEXTURE_2D_ARRAY,0,i,c.width,c.height,c.depth,0,h,d,c.data);else if(r.isData3DTexture)f?(u&&S.texStorage3D(T.TEXTURE_3D,g,i,c.width,c.height,c.depth),m&&S.texSubImage3D(T.TEXTURE_3D,0,0,0,0,c.width,c.height,c.depth,h,d,c.data)):S.texImage3D(T.TEXTURE_3D,0,i,c.width,c.height,c.depth,0,h,d,c.data);else if(r.isFramebufferTexture){if(u)if(f)S.texStorage2D(T.TEXTURE_2D,g,i,c.width,c.height);else{let t=c.width,n=c.height;for(let e=0;e<g;e++)S.texImage2D(T.TEXTURE_2D,e,i,t,n,0,h,d,null),t>>=1,n>>=1}}else if(0<p.length){f&&u&&(t=U(p[0]),S.texStorage2D(T.TEXTURE_2D,g,i,t.width,t.height));for(let e=0,t=p.length;e<t;e++)n=p[e],f?m&&S.texSubImage2D(T.TEXTURE_2D,e,0,0,h,d,n):S.texImage2D(T.TEXTURE_2D,e,i,h,d,n);r.generateMipmaps=!1}else f?(u&&(o=U(c),S.texStorage2D(T.TEXTURE_2D,g,i,o.width,o.height)),m&&S.texSubImage2D(T.TEXTURE_2D,0,0,0,h,d,c)):S.texImage2D(T.TEXTURE_2D,0,i,h,d,c);N(r)&&I(a),l.__version=s.version,r.onUpdate&&r.onUpdate(r)}e.__version=r.version}function v(e,t,n,i,r,a){var o,s,l=M.convert(n.format,n.colorSpace),u=M.convert(n.type),c=C(n.internalFormat,l,u,n.colorSpace);w.get(t).__hasExternalTextures||(o=Math.max(1,t.width>>a),s=Math.max(1,t.height>>a),r===T.TEXTURE_3D||r===T.TEXTURE_2D_ARRAY?S.texImage3D(r,a,c,o,s,t.depth,0,l,u,null):S.texImage2D(r,a,c,o,s,0,l,u,null)),S.bindFramebuffer(T.FRAMEBUFFER,e),P(t)?h.framebufferTexture2DMultisampleEXT(T.FRAMEBUFFER,i,r,w.get(n).__webglTexture,0,x(t)):(r===T.TEXTURE_2D||r>=T.TEXTURE_CUBE_MAP_POSITIVE_X&&r<=T.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&T.framebufferTexture2D(T.FRAMEBUFFER,i,r,w.get(n).__webglTexture,a),S.bindFramebuffer(T.FRAMEBUFFER,null)}function _(e,t,n){if(T.bindRenderbuffer(T.RENDERBUFFER,e),t.depthBuffer){var i=t.depthTexture,i=i&&i.isDepthTexture?i.type:null,i=L(t.stencilBuffer,i),r=t.stencilBuffer?T.DEPTH_STENCIL_ATTACHMENT:T.DEPTH_ATTACHMENT,a=x(t);P(t)?h.renderbufferStorageMultisampleEXT(T.RENDERBUFFER,a,i,t.width,t.height):n?T.renderbufferStorageMultisample(T.RENDERBUFFER,a,i,t.width,t.height):T.renderbufferStorage(T.RENDERBUFFER,i,t.width,t.height),T.framebufferRenderbuffer(T.FRAMEBUFFER,r,T.RENDERBUFFER,e)}else{var o=t.textures;for(let e=0;e<o.length;e++){var s=o[e],l=M.convert(s.format,s.colorSpace),u=M.convert(s.type),l=C(s.internalFormat,l,u,s.colorSpace),u=x(t);n&&!1===P(t)?T.renderbufferStorageMultisample(T.RENDERBUFFER,u,l,t.width,t.height):P(t)?h.renderbufferStorageMultisampleEXT(T.RENDERBUFFER,u,l,t.width,t.height):T.renderbufferStorage(T.RENDERBUFFER,l,t.width,t.height)}}T.bindRenderbuffer(T.RENDERBUFFER,null)}function y(t){var n=w.get(t),e=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!n.__autoAllocateDepthBuffer){if(e)throw new Error("target.depthTexture not supported in Cube render targets");var i=n.__webglFramebuffer,r=t;if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(S.bindFramebuffer(T.FRAMEBUFFER,i),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");w.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),B(r.depthTexture,0);var i=w.get(r.depthTexture).__webglTexture,a=x(r);if(r.depthTexture.format===st)P(r)?h.framebufferTexture2DMultisampleEXT(T.FRAMEBUFFER,T.DEPTH_ATTACHMENT,T.TEXTURE_2D,i,0,a):T.framebufferTexture2D(T.FRAMEBUFFER,T.DEPTH_ATTACHMENT,T.TEXTURE_2D,i,0);else{if(r.depthTexture.format!==lt)throw new Error("Unknown depthTexture format");P(r)?h.framebufferTexture2DMultisampleEXT(T.FRAMEBUFFER,T.DEPTH_STENCIL_ATTACHMENT,T.TEXTURE_2D,i,0,a):T.framebufferTexture2D(T.FRAMEBUFFER,T.DEPTH_STENCIL_ATTACHMENT,T.TEXTURE_2D,i,0)}}else if(e){n.__webglDepthbuffer=[];for(let e=0;e<6;e++)S.bindFramebuffer(T.FRAMEBUFFER,n.__webglFramebuffer[e]),n.__webglDepthbuffer[e]=T.createRenderbuffer(),_(n.__webglDepthbuffer[e],t,!1)}else S.bindFramebuffer(T.FRAMEBUFFER,n.__webglFramebuffer),n.__webglDepthbuffer=T.createRenderbuffer(),_(n.__webglDepthbuffer,t,!1);S.bindFramebuffer(T.FRAMEBUFFER,null)}let E=[],A=[];function x(e){return Math.min(b.maxSamples,e.samples)}function P(e){var t=w.get(e);return 0<e.samples&&!0===o.has("WEBGL_multisampled_render_to_texture")&&!1!==t.__useRenderToTexture}function G(e,t){var n=e.colorSpace,i=e.format,r=e.type;return!0!==e.isCompressedTexture&&!0!==e.isVideoTexture&&n!==Ye&&n!==Kt&&(qe.getTransfer(n)===pe?i===q&&r===We||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),t}function U(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?(t.width=e.naturalWidth||e.width,t.height=e.naturalHeight||e.height):"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?(t.width=e.displayWidth,t.height=e.displayHeight):(t.width=e.width,t.height=e.height),t}this.allocateTextureUnit=function(){var e=i;return e>=b.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+b.maxTextures),i+=1,e},this.resetTextureUnits=function(){i=0},this.setTexture2D=B,this.setTexture2DArray=function(e,t){var n=w.get(e);0<e.version&&n.__version!==e.version?g(n,e,t):S.bindTexture(T.TEXTURE_2D_ARRAY,n.__webglTexture,T.TEXTURE0+t)},this.setTexture3D=function(e,t){var n=w.get(e);0<e.version&&n.__version!==e.version?g(n,e,t):S.bindTexture(T.TEXTURE_3D,n.__webglTexture,T.TEXTURE0+t)},this.setTextureCube=function(t,e){var n=w.get(t);if(0<t.version&&n.__version!==t.version){var i=n,r=t,t=e;if(6===r.image.length){var a=k(i,r),o=r.source,s=(S.bindTexture(T.TEXTURE_CUBE_MAP,i.__webglTexture,T.TEXTURE0+t),w.get(o));if(o.version!==s.__version||!0===a){S.activeTexture(T.TEXTURE0+t);var t=qe.getPrimaries(qe.workingColorSpace),l=r.colorSpace===Kt?null:qe.getPrimaries(r.colorSpace),t=r.colorSpace===Kt||t===l?T.NONE:T.BROWSER_DEFAULT_WEBGL,u=(T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,r.flipY),T.pixelStorei(T.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),T.pixelStorei(T.UNPACK_ALIGNMENT,r.unpackAlignment),T.pixelStorei(T.UNPACK_COLORSPACE_CONVERSION_WEBGL,t),r.isCompressedTexture||r.image[0].isCompressedTexture),c=r.image[0]&&r.image[0].isDataTexture,h=[];for(let e=0;e<6;e++)h[e]=u||c?c?r.image[e].image:r.image[e]:R(r.image[e],!0,b.maxCubemapSize),h[e]=G(r,h[e]);var l=h[0],d=M.convert(r.format,r.colorSpace),p=M.convert(r.type),f=C(r.internalFormat,d,p,r.colorSpace),m=!0!==r.isVideoTexture,t=void 0===s.__version||!0===a,g=o.dataReady;let e=D(r,l);O(T.TEXTURE_CUBE_MAP,r);let n;if(u){m&&t&&S.texStorage2D(T.TEXTURE_CUBE_MAP,e,f,l.width,l.height);for(let t=0;t<6;t++){n=h[t].mipmaps;for(let e=0;e<n.length;e++){var v=n[e];r.format!==q?null!==d?m?g&&S.compressedTexSubImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+t,e,0,0,v.width,v.height,d,v.data):S.compressedTexImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+t,e,f,v.width,v.height,0,v.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):m?g&&S.texSubImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+t,e,0,0,v.width,v.height,d,p,v.data):S.texImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+t,e,f,v.width,v.height,0,d,p,v.data)}}}else{n=r.mipmaps,m&&t&&(0<n.length&&e++,a=U(h[0]),S.texStorage2D(T.TEXTURE_CUBE_MAP,e,f,a.width,a.height));for(let t=0;t<6;t++)if(c){m?g&&S.texSubImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,h[t].width,h[t].height,d,p,h[t].data):S.texImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,f,h[t].width,h[t].height,0,d,p,h[t].data);for(let e=0;e<n.length;e++){var _=n[e].image[t].image;m?g&&S.texSubImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+t,e+1,0,0,_.width,_.height,d,p,_.data):S.texImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+t,e+1,f,_.width,_.height,0,d,p,_.data)}}else{m?g&&S.texSubImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,d,p,h[t]):S.texImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,f,d,p,h[t]);for(let e=0;e<n.length;e++){var y=n[e];m?g&&S.texSubImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+t,e+1,0,0,d,p,y.image[t]):S.texImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+t,e+1,f,d,p,y.image[t])}}}N(r)&&I(T.TEXTURE_CUBE_MAP),s.__version=o.version,r.onUpdate&&r.onUpdate(r)}i.__version=r.version}}else S.bindTexture(T.TEXTURE_CUBE_MAP,n.__webglTexture,T.TEXTURE0+e)},this.rebindTextures=function(e,t,n){var i=w.get(e);void 0!==t&&v(i.__webglFramebuffer,e,e.texture,T.COLOR_ATTACHMENT0,T.TEXTURE_2D,0),void 0!==n&&y(e)},this.setupRenderTarget=function(n){let i=n.texture;var r=w.get(n),e=w.get(i),a=(n.addEventListener("dispose",f),n.textures),t=!0===n.isWebGLCubeRenderTarget,o=1<a.length;if(o||(void 0===e.__webglTexture&&(e.__webglTexture=T.createTexture()),e.__version=i.version,d.memory.textures++),t){r.__webglFramebuffer=[];for(let t=0;t<6;t++)if(i.mipmaps&&0<i.mipmaps.length){r.__webglFramebuffer[t]=[];for(let e=0;e<i.mipmaps.length;e++)r.__webglFramebuffer[t][e]=T.createFramebuffer()}else r.__webglFramebuffer[t]=T.createFramebuffer()}else{if(i.mipmaps&&0<i.mipmaps.length){r.__webglFramebuffer=[];for(let e=0;e<i.mipmaps.length;e++)r.__webglFramebuffer[e]=T.createFramebuffer()}else r.__webglFramebuffer=T.createFramebuffer();if(o)for(let e=0,t=a.length;e<t;e++){var s=w.get(a[e]);void 0===s.__webglTexture&&(s.__webglTexture=T.createTexture(),d.memory.textures++)}if(0<n.samples&&!1===P(n)){r.__webglMultisampledFramebuffer=T.createFramebuffer(),r.__webglColorRenderbuffer=[],S.bindFramebuffer(T.FRAMEBUFFER,r.__webglMultisampledFramebuffer);for(let t=0;t<a.length;t++){let e=a[t];r.__webglColorRenderbuffer[t]=T.createRenderbuffer(),T.bindRenderbuffer(T.RENDERBUFFER,r.__webglColorRenderbuffer[t]);var l=M.convert(e.format,e.colorSpace),u=M.convert(e.type),l=C(e.internalFormat,l,u,e.colorSpace,!0===n.isXRRenderTarget),u=x(n);T.renderbufferStorageMultisample(T.RENDERBUFFER,u,l,n.width,n.height),T.framebufferRenderbuffer(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0+t,T.RENDERBUFFER,r.__webglColorRenderbuffer[t])}T.bindRenderbuffer(T.RENDERBUFFER,null),n.depthBuffer&&(r.__webglDepthRenderbuffer=T.createRenderbuffer(),_(r.__webglDepthRenderbuffer,n,!0)),S.bindFramebuffer(T.FRAMEBUFFER,null)}}if(t){S.bindTexture(T.TEXTURE_CUBE_MAP,e.__webglTexture),O(T.TEXTURE_CUBE_MAP,i);for(let t=0;t<6;t++)if(i.mipmaps&&0<i.mipmaps.length)for(let e=0;e<i.mipmaps.length;e++)v(r.__webglFramebuffer[t][e],n,i,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+t,e);else v(r.__webglFramebuffer[t],n,i,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+t,0);N(i)&&I(T.TEXTURE_CUBE_MAP)}else if(o)for(let e=0,t=a.length;e<t;e++){var c=a[e],h=w.get(c);S.bindTexture(T.TEXTURE_2D,h.__webglTexture),O(T.TEXTURE_2D,c),v(r.__webglFramebuffer,n,c,T.COLOR_ATTACHMENT0+e,T.TEXTURE_2D,0),N(c)&&I(T.TEXTURE_2D)}else{let t=T.TEXTURE_2D;if((n.isWebGL3DRenderTarget||n.isWebGLArrayRenderTarget)&&(t=n.isWebGL3DRenderTarget?T.TEXTURE_3D:T.TEXTURE_2D_ARRAY),S.bindTexture(t,e.__webglTexture),O(t,i),i.mipmaps&&0<i.mipmaps.length)for(let e=0;e<i.mipmaps.length;e++)v(r.__webglFramebuffer[e],n,i,T.COLOR_ATTACHMENT0,t,e);else v(r.__webglFramebuffer,n,i,T.COLOR_ATTACHMENT0,t,0);N(i)&&I(t)}S.unbindTexture(),n.depthBuffer&&y(n)},this.updateRenderTargetMipmap=function(n){var i=n.textures;for(let e=0,t=i.length;e<t;e++){var r,a=i[e];N(a)&&(r=n.isWebGLCubeRenderTarget?T.TEXTURE_CUBE_MAP:T.TEXTURE_2D,a=w.get(a).__webglTexture,S.bindTexture(r,a),I(r),S.unbindTexture())}},this.updateMultisampleRenderTarget=function(n){if(0<n.samples)if(!1===P(n)){var i=n.textures,r=n.width,a=n.height;let t=T.COLOR_BUFFER_BIT;var o,s=n.stencilBuffer?T.DEPTH_STENCIL_ATTACHMENT:T.DEPTH_ATTACHMENT,l=w.get(n),u=1<i.length;if(u)for(let e=0;e<i.length;e++)S.bindFramebuffer(T.FRAMEBUFFER,l.__webglMultisampledFramebuffer),T.framebufferRenderbuffer(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0+e,T.RENDERBUFFER,null),S.bindFramebuffer(T.FRAMEBUFFER,l.__webglFramebuffer),T.framebufferTexture2D(T.DRAW_FRAMEBUFFER,T.COLOR_ATTACHMENT0+e,T.TEXTURE_2D,null,0);S.bindFramebuffer(T.READ_FRAMEBUFFER,l.__webglMultisampledFramebuffer),S.bindFramebuffer(T.DRAW_FRAMEBUFFER,l.__webglFramebuffer);for(let e=0;e<i.length;e++)n.resolveDepthBuffer&&(n.depthBuffer&&(t|=T.DEPTH_BUFFER_BIT),n.stencilBuffer)&&n.resolveStencilBuffer&&(t|=T.STENCIL_BUFFER_BIT),u&&(T.framebufferRenderbuffer(T.READ_FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.RENDERBUFFER,l.__webglColorRenderbuffer[e]),o=w.get(i[e]).__webglTexture,T.framebufferTexture2D(T.DRAW_FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_2D,o,0)),T.blitFramebuffer(0,0,r,a,0,0,r,a,t,T.NEAREST),!0===p&&(E.length=0,A.length=0,E.push(T.COLOR_ATTACHMENT0+e),n.depthBuffer&&!1===n.resolveDepthBuffer&&(E.push(s),A.push(s),T.invalidateFramebuffer(T.DRAW_FRAMEBUFFER,A)),T.invalidateFramebuffer(T.READ_FRAMEBUFFER,E));if(S.bindFramebuffer(T.READ_FRAMEBUFFER,null),S.bindFramebuffer(T.DRAW_FRAMEBUFFER,null),u)for(let e=0;e<i.length;e++){S.bindFramebuffer(T.FRAMEBUFFER,l.__webglMultisampledFramebuffer),T.framebufferRenderbuffer(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0+e,T.RENDERBUFFER,l.__webglColorRenderbuffer[e]);var c=w.get(i[e]).__webglTexture;S.bindFramebuffer(T.FRAMEBUFFER,l.__webglFramebuffer),T.framebufferTexture2D(T.DRAW_FRAMEBUFFER,T.COLOR_ATTACHMENT0+e,T.TEXTURE_2D,c,0)}S.bindFramebuffer(T.DRAW_FRAMEBUFFER,l.__webglMultisampledFramebuffer)}else{var e;n.depthBuffer&&!1===n.resolveDepthBuffer&&p&&(e=n.stencilBuffer?T.DEPTH_STENCIL_ATTACHMENT:T.DEPTH_ATTACHMENT,T.invalidateFramebuffer(T.DRAW_FRAMEBUFFER,[e]))}},this.setupDepthRenderbuffer=y,this.setupFrameBufferTexture=v,this.useMultisampledRTT=P}function Of(i,r){return{convert:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Kt;let n;if(t=qe.getTransfer(t),e===We)return i.UNSIGNED_BYTE;if(e===$e)return i.UNSIGNED_SHORT_4_4_4_4;if(e===et)return i.UNSIGNED_SHORT_5_5_5_1;if(e===nt)return i.UNSIGNED_INT_5_9_9_9_REV;if(e===x)return i.BYTE;if(e===ze)return i.SHORT;if(e===Ze)return i.UNSIGNED_SHORT;if(e===Ke)return i.INT;if(e===Je)return i.UNSIGNED_INT;if(e===j)return i.FLOAT;if(e===Qe)return i.HALF_FLOAT;if(e===it)return i.ALPHA;if(e===rt)return i.RGB;if(e===q)return i.RGBA;if(e===at)return i.LUMINANCE;if(e===ot)return i.LUMINANCE_ALPHA;if(e===st)return i.DEPTH_COMPONENT;if(e===lt)return i.DEPTH_STENCIL;if(e===ut)return i.RED;if(e===ct)return i.RED_INTEGER;if(e===ht)return i.RG;if(e===dt)return i.RG_INTEGER;if(e===pt)return i.RGBA_INTEGER;if(e===ft||e===mt||e===gt||e===vt)if(t===pe){if(null===(n=r.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(e===ft)return n.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===mt)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===gt)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===vt)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(n=r.get("WEBGL_compressed_texture_s3tc")))return null;if(e===ft)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===mt)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===gt)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===vt)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===_t||e===yt||e===Et||e===At){if(null===(n=r.get("WEBGL_compressed_texture_pvrtc")))return null;if(e===_t)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===yt)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Et)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===At)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===xt||e===Tt||e===St){if(null===(n=r.get("WEBGL_compressed_texture_etc")))return null;if(e===xt||e===Tt)return t===pe?n.COMPRESSED_SRGB8_ETC2:n.COMPRESSED_RGB8_ETC2;if(e===St)return t===pe?n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:n.COMPRESSED_RGBA8_ETC2_EAC}if(e===wt||e===bt||e===Mt||e===Rt||e===Nt||e===It||e===Ct||e===Lt||e===Dt||e===Ot||e===Pt||e===Ut||e===Bt||e===Ft){if(null===(n=r.get("WEBGL_compressed_texture_astc")))return null;if(e===wt)return t===pe?n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:n.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===bt)return t===pe?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:n.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===Mt)return t===pe?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:n.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===Rt)return t===pe?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:n.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===Nt)return t===pe?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:n.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===It)return t===pe?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:n.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===Ct)return t===pe?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:n.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===Lt)return t===pe?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:n.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===Dt)return t===pe?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:n.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===Ot)return t===pe?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:n.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===Pt)return t===pe?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:n.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===Ut)return t===pe?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:n.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===Bt)return t===pe?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:n.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===Ft)return t===pe?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:n.COMPRESSED_RGBA_ASTC_12x12_KHR}if(e===zt||e===kt||e===Gt){if(null===(n=r.get("EXT_texture_compression_bptc")))return null;if(e===zt)return t===pe?n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:n.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(e===kt)return n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(e===Gt)return n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(e===Ht||e===Vt||e===Wt||e===jt){if(null===(n=r.get("EXT_texture_compression_rgtc")))return null;if(e===zt)return n.COMPRESSED_RED_RGTC1_EXT;if(e===Vt)return n.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===Wt)return n.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===jt)return n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return e===tt?i.UNSIGNED_INT_24_8:void 0!==i[e]?i[e]:null}}}class LA extends fA{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.cameras=e}}class Sd extends gd{constructor(){super(),this.isGroup=!0,this.type="Group"}}let Gr={type:"move"};class DA{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Sd,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Sd,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new dd,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new dd),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Sd,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new dd,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new dd),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){var t=this._hand;if(t)for(var n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,a=null;var o=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){a=!0;for(var u of e.hand.values()){var c=t.getJointPose(u,n),u=this._getHandJoint(l,u);null!==c&&(u.matrix.fromArray(c.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,u.jointRadius=c.radius),u.visible=null!==c}var h=l.joints["index-finger-tip"],d=l.joints["thumb-tip"],h=h.position.distanceTo(d.position);l.inputState.pinching&&.025<h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&h<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&null!==(r=t.getPose(e.gripSpace,n))&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1);null!==o&&null!==(i=null===(i=t.getPose(e.targetRaySpace,n))&&null!==r?r:i)&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Gr))}return null!==o&&(o.visible=null!==i),null!==s&&(s.visible=null!==r),null!==l&&(l.visible=null!==a),this}_getHandJoint(e,t){var n;return void 0===e.joints[t.jointName]&&((n=new Sd).matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)),e.joints[t.jointName]}}class OA{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){var i;null===this.texture&&(i=new eA,e.properties.get(i).__webglTexture=t.texture,t.depthNear==n.depthNear&&t.depthFar==n.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i)}getMesh(e){return null!==this.texture&&null===this.mesh&&(e=e.cameras[0].viewport,e=new Td({vertexShader:`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,fragmentShader:`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`,uniforms:{depthColor:{value:this.texture},depthWidth:{value:e.z},depthHeight:{value:e.w}}}),this.mesh=new xd(new EA(20,20),e)),this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class PA extends J1{constructor(l,r){super();let u=this,f=null,a=1,c=null,t="local-floor",n=1,h=null,d=null,p=null,m=null,g=null,v=null,_=new OA,o=r.getContextAttributes(),e=null,y=null,E=[],A=[],s=new ld,x=null,T=new fA,S=(T.layers.enable(1),T.viewport=new cd,new fA),w=(S.layers.enable(2),S.viewport=new cd,[T,S]),b=new LA,M=(b.layers.enable(1),b.layers.enable(2),null),R=null;function N(e){var t=A.indexOf(e.inputSource);-1!==t&&void 0!==(t=E[t])&&(t.update(e.inputSource,e.frame,h||c),t.dispatchEvent({type:e.type,data:e.inputSource}))}function I(){f.removeEventListener("select",N),f.removeEventListener("selectstart",N),f.removeEventListener("selectend",N),f.removeEventListener("squeeze",N),f.removeEventListener("squeezestart",N),f.removeEventListener("squeezeend",N),f.removeEventListener("end",I),f.removeEventListener("inputsourceschange",C);for(let e=0;e<E.length;e++){var t=A[e];null!==t&&(A[e]=null,E[e].disconnect(t))}M=null,R=null,_.reset(),l.setRenderTarget(e),g=null,m=null,p=null,f=null,y=null,U.stop(),u.isPresenting=!1,l.setPixelRatio(x),l.setSize(s.width,s.height,!1),u.dispatchEvent({type:"sessionend"})}function C(n){for(let e=0;e<n.removed.length;e++){var t=n.removed[e],i=A.indexOf(t);0<=i&&(A[i]=null,E[i].disconnect(t))}for(let e=0;e<n.added.length;e++){var r=n.added[e];let t=A.indexOf(r);if(-1===t){for(let e=0;e<E.length;e++){if(e>=A.length){A.push(r),t=e;break}if(null===A[e]){A[e]=r,t=e;break}}if(-1===t)break}var a=E[t];a&&a.connect(r)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=E[e];return void 0===t&&(t=new DA,E[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=E[e];return void 0===t&&(t=new DA,E[e]=t),t.getGripSpace()},this.getHand=function(e){let t=E[e];return void 0===t&&(t=new DA,E[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){a=e,!0===u.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){t=e,!0===u.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h||c},this.setReferenceSpace=function(e){h=e},this.getBaseLayer=function(){return null!==m?m:g},this.getBinding=function(){return p},this.getFrame=function(){return v},this.getSession=function(){return f},this.setSession=async function(i){if(null!==(f=i)){if(e=l.getRenderTarget(),f.addEventListener("select",N),f.addEventListener("selectstart",N),f.addEventListener("selectend",N),f.addEventListener("squeeze",N),f.addEventListener("squeezestart",N),f.addEventListener("squeezeend",N),f.addEventListener("end",I),f.addEventListener("inputsourceschange",C),!0!==o.xrCompatible&&await r.makeXRCompatible(),x=l.getPixelRatio(),l.getSize(s),void 0===f.renderState.layers){i={antialias:o.antialias,alpha:!0,depth:o.depth,stencil:o.stencil,framebufferScaleFactor:a};g=new XRWebGLLayer(f,r,i),f.updateRenderState({baseLayer:g}),l.setPixelRatio(1),l.setSize(g.framebufferWidth,g.framebufferHeight,!1),y=new nA(g.framebufferWidth,g.framebufferHeight,{format:q,type:We,colorSpace:l.outputColorSpace,stencilBuffer:o.stencil})}else{let e=null,t=null,n=null;o.depth&&(n=o.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,e=o.stencil?lt:st,t=o.stencil?tt:Je);i={colorFormat:r.RGBA8,depthFormat:n,scaleFactor:a};p=new XRWebGLBinding(f,r),m=p.createProjectionLayer(i),f.updateRenderState({layers:[m]}),l.setPixelRatio(1),l.setSize(m.textureWidth,m.textureHeight,!1),y=new nA(m.textureWidth,m.textureHeight,{format:q,type:We,depthTexture:new TA(m.textureWidth,m.textureHeight,t,void 0,void 0,void 0,void 0,void 0,void 0,e),stencilBuffer:o.stencil,colorSpace:l.outputColorSpace,samples:o.antialias?4:0,resolveDepthBuffer:!1===m.ignoreDepthValues})}y.isXRRenderTarget=!0,this.setFoveation(n),h=null,c=await f.requestReferenceSpace(t),U.setContext(f),U.start(),u.isPresenting=!0,u.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==f)return f.environmentBlendMode},this.getDepthTexture=function(){return _.getDepthTexture()};let L=new dd,D=new dd;function O(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null!==f){null!==_.texture&&(e.near=_.depthNear,e.far=_.depthFar),b.near=S.near=T.near=e.near,b.far=S.far=T.far=e.far,M===b.near&&R===b.far||(f.updateRenderState({depthNear:b.near,depthFar:b.far}),M=b.near,R=b.far,T.near=M,T.far=R,S.near=M,S.far=R,T.updateProjectionMatrix(),S.updateProjectionMatrix(),e.updateProjectionMatrix());var t,n,i,r,a,o,s,l,u=e.parent,c=b.cameras;O(b,u);for(let e=0;e<c.length;e++)O(c[e],u);2===c.length?(t=b,n=T,h=S,L.setFromMatrixPosition(n.matrixWorld),D.setFromMatrixPosition(h.matrixWorld),p=L.distanceTo(D),i=n.projectionMatrix.elements,h=h.projectionMatrix.elements,r=i[14]/(i[10]-1),a=i[14]/(i[10]+1),o=(i[9]+1)/i[5],s=(i[9]-1)/i[5],i=(i[8]-1)/i[0],h=(h[8]+1)/h[0],d=r*i,l=r*h,i=(h=p/(h-i))*-i,n.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(i),t.translateZ(h),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert(),n=r+h,r=a+h,t.projectionMatrix.makePerspective(d-i,p-i+l,o*a/r*n,s*a/r*n,n,r),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()):b.projectionMatrix.copy(T.projectionMatrix);var h=e,d=b,p=u;null===p?h.matrix.copy(d.matrixWorld):(h.matrix.copy(p.matrixWorld),h.matrix.invert(),h.matrix.multiply(d.matrixWorld)),h.matrix.decompose(h.position,h.quaternion,h.scale),h.updateMatrixWorld(!0),h.projectionMatrix.copy(d.projectionMatrix),h.projectionMatrixInverse.copy(d.projectionMatrixInverse),h.isPerspectiveCamera&&(h.fov=2*pn*Math.atan(1/h.projectionMatrix.elements[5]),h.zoom=1)}},this.getCamera=function(){return b},this.getFoveation=function(){if(null!==m||null!==g)return n},this.setFoveation=function(e){n=e,null!==m&&(m.fixedFoveation=e),null!==g&&void 0!==g.fixedFoveation&&(g.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==_.texture},this.getDepthSensingMesh=function(){return _.getMesh(b)};let P=null;let U=new Jd;U.setAnimationLoop(function(e,t){if(d=t.getViewerPose(h||c),v=t,null!==d){var r=d.views;null!==g&&(l.setRenderTargetFramebuffer(y,g.framebuffer),l.setRenderTarget(y));let i=!1;r.length!==b.cameras.length&&(b.cameras.length=0,i=!0);for(let n=0;n<r.length;n++){var a,o=r[n];let e=null,t=(null!==g?e=g.getViewport(o):(a=p.getViewSubImage(m,o),e=a.viewport,0===n&&(l.setRenderTargetTextures(y,a.colorTexture,m.ignoreDepthValues?void 0:a.depthStencilTexture),l.setRenderTarget(y))),w[n]);void 0===t&&((t=new fA).layers.enable(n),t.viewport=new cd,w[n]=t),t.matrix.fromArray(o.transform.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale),t.projectionMatrix.fromArray(o.projectionMatrix),t.projectionMatrixInverse.copy(t.projectionMatrix).invert(),t.viewport.set(e.x,e.y,e.width,e.height),0===n&&(b.matrix.copy(t.matrix),b.matrix.decompose(b.position,b.quaternion,b.scale)),!0===i&&b.cameras.push(t)}var n=f.enabledFeatures;n&&n.includes("depth-sensing")&&(n=p.getDepthInformation(r[0]))&&n.isValid&&n.texture&&_.init(l,n,f.renderState)}for(let e=0;e<E.length;e++){var i=A[e],s=E[e];null!==i&&void 0!==s&&s.update(i,t,h||c)}P&&P(e,t),t.detectedPlanes&&u.dispatchEvent({type:"planesdetected",data:t}),v=null}),this.setAnimationLoop=function(e){P=e},this.dispose=function(){}}}let Hr=new md,Vr=new fd;function Pf(n,h){function d(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function p(e,t){e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map,d(t.map,e.mapTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,d(t.alphaMap,e.alphaMapTransform)),t.bumpMap&&(e.bumpMap.value=t.bumpMap,d(t.bumpMap,e.bumpMapTransform),e.bumpScale.value=t.bumpScale,t.side===Ge)&&(e.bumpScale.value*=-1),t.normalMap&&(e.normalMap.value=t.normalMap,d(t.normalMap,e.normalMapTransform),e.normalScale.value.copy(t.normalScale),t.side===Ge)&&e.normalScale.value.negate(),t.displacementMap&&(e.displacementMap.value=t.displacementMap,d(t.displacementMap,e.displacementMapTransform),e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap,d(t.emissiveMap,e.emissiveMapTransform)),t.specularMap&&(e.specularMap.value=t.specularMap,d(t.specularMap,e.specularMapTransform)),0<t.alphaTest&&(e.alphaTest.value=t.alphaTest);var n=h.get(t),i=n.envMap,n=n.envMapRotation;i&&(e.envMap.value=i,Hr.copy(n),Hr.x*=-1,Hr.y*=-1,Hr.z*=-1,i.isCubeTexture&&!1===i.isRenderTargetTexture&&(Hr.y*=-1,Hr.z*=-1),e.envMapRotation.value.setFromMatrix4(Vr.makeRotationFromEuler(Hr)),e.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,e.reflectivity.value=t.reflectivity,e.ior.value=t.ior,e.refractionRatio.value=t.refractionRatio),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity,d(t.lightMap,e.lightMapTransform)),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity,d(t.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(e,t){t.color.getRGB(e.fogColor.value,Kd(n)),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,t,n,i,r){var a,o,s,l,u,c;t.isMeshBasicMaterial||t.isMeshLambertMaterial?p(e,t):t.isMeshToonMaterial?(p(e,t),u=e,(c=t).gradientMap&&(u.gradientMap.value=c.gradientMap)):t.isMeshPhongMaterial?(p(e,t),u=t,(c=e).specular.value.copy(u.specular),c.shininess.value=Math.max(u.shininess,1e-4)):t.isMeshStandardMaterial?(p(e,t),s=t,(l=e).metalness.value=s.metalness,s.metalnessMap&&(l.metalnessMap.value=s.metalnessMap,d(s.metalnessMap,l.metalnessMapTransform)),l.roughness.value=s.roughness,s.roughnessMap&&(l.roughnessMap.value=s.roughnessMap,d(s.roughnessMap,l.roughnessMapTransform)),s.envMap&&(l.envMapIntensity.value=s.envMapIntensity),t.isMeshPhysicalMaterial&&(l=t,s=r,(r=e).ior.value=l.ior,0<l.sheen&&(r.sheenColor.value.copy(l.sheenColor).multiplyScalar(l.sheen),r.sheenRoughness.value=l.sheenRoughness,l.sheenColorMap&&(r.sheenColorMap.value=l.sheenColorMap,d(l.sheenColorMap,r.sheenColorMapTransform)),l.sheenRoughnessMap)&&(r.sheenRoughnessMap.value=l.sheenRoughnessMap,d(l.sheenRoughnessMap,r.sheenRoughnessMapTransform)),0<l.clearcoat&&(r.clearcoat.value=l.clearcoat,r.clearcoatRoughness.value=l.clearcoatRoughness,l.clearcoatMap&&(r.clearcoatMap.value=l.clearcoatMap,d(l.clearcoatMap,r.clearcoatMapTransform)),l.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap.value=l.clearcoatRoughnessMap,d(l.clearcoatRoughnessMap,r.clearcoatRoughnessMapTransform)),l.clearcoatNormalMap)&&(r.clearcoatNormalMap.value=l.clearcoatNormalMap,d(l.clearcoatNormalMap,r.clearcoatNormalMapTransform),r.clearcoatNormalScale.value.copy(l.clearcoatNormalScale),l.side===Ge)&&r.clearcoatNormalScale.value.negate(),0<l.dispersion&&(r.dispersion.value=l.dispersion),0<l.iridescence&&(r.iridescence.value=l.iridescence,r.iridescenceIOR.value=l.iridescenceIOR,r.iridescenceThicknessMinimum.value=l.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum.value=l.iridescenceThicknessRange[1],l.iridescenceMap&&(r.iridescenceMap.value=l.iridescenceMap,d(l.iridescenceMap,r.iridescenceMapTransform)),l.iridescenceThicknessMap)&&(r.iridescenceThicknessMap.value=l.iridescenceThicknessMap,d(l.iridescenceThicknessMap,r.iridescenceThicknessMapTransform)),0<l.transmission&&(r.transmission.value=l.transmission,r.transmissionSamplerMap.value=s.texture,r.transmissionSamplerSize.value.set(s.width,s.height),l.transmissionMap&&(r.transmissionMap.value=l.transmissionMap,d(l.transmissionMap,r.transmissionMapTransform)),r.thickness.value=l.thickness,l.thicknessMap&&(r.thicknessMap.value=l.thicknessMap,d(l.thicknessMap,r.thicknessMapTransform)),r.attenuationDistance.value=l.attenuationDistance,r.attenuationColor.value.copy(l.attenuationColor)),0<l.anisotropy&&(r.anisotropyVector.value.set(l.anisotropy*Math.cos(l.anisotropyRotation),l.anisotropy*Math.sin(l.anisotropyRotation)),l.anisotropyMap)&&(r.anisotropyMap.value=l.anisotropyMap,d(l.anisotropyMap,r.anisotropyMapTransform)),r.specularIntensity.value=l.specularIntensity,r.specularColor.value.copy(l.specularColor),l.specularColorMap&&(r.specularColorMap.value=l.specularColorMap,d(l.specularColorMap,r.specularColorMapTransform)),l.specularIntensityMap)&&(r.specularIntensityMap.value=l.specularIntensityMap,d(l.specularIntensityMap,r.specularIntensityMapTransform))):t.isMeshMatcapMaterial?(p(e,t),s=e,(l=t).matcap&&(s.matcap.value=l.matcap)):t.isMeshDepthMaterial?p(e,t):t.isMeshDistanceMaterial?(p(e,t),r=e,o=t,o=h.get(o).light,r.referencePosition.value.setFromMatrixPosition(o.matrixWorld),r.nearDistance.value=o.shadow.camera.near,r.farDistance.value=o.shadow.camera.far):t.isMeshNormalMaterial?p(e,t):t.isLineBasicMaterial?(r=t,(o=e).diffuse.value.copy(r.color),o.opacity.value=r.opacity,r.map&&(o.map.value=r.map,d(r.map,o.mapTransform)),t.isLineDashedMaterial&&(r=t,(a=e).dashSize.value=r.dashSize,a.totalSize.value=r.dashSize+r.gapSize,a.scale.value=r.scale)):t.isPointsMaterial?(a=t,r=n,n=i,(i=e).diffuse.value.copy(a.color),i.opacity.value=a.opacity,i.size.value=a.size*r,i.scale.value=.5*n,a.map&&(i.map.value=a.map,d(a.map,i.uvTransform)),a.alphaMap&&(i.alphaMap.value=a.alphaMap,d(a.alphaMap,i.alphaMapTransform)),0<a.alphaTest&&(i.alphaTest.value=a.alphaTest)):t.isSpriteMaterial?(r=t,(n=e).diffuse.value.copy(r.color),n.opacity.value=r.opacity,n.rotation.value=r.rotation,r.map&&(n.map.value=r.map,d(r.map,n.mapTransform)),r.alphaMap&&(n.alphaMap.value=r.alphaMap,d(r.alphaMap,n.alphaMapTransform)),0<r.alphaTest&&(n.alphaTest.value=r.alphaTest)):t.isShadowMaterial?(e.color.value.copy(t.color),e.opacity.value=t.opacity):t.isShaderMaterial&&(t.uniformsNeedUpdate=!1)}}}function Uf(A,x,e,T){let S={},w={},b=[],M=A.getParameter(A.MAX_UNIFORM_BUFFER_BINDINGS);function R(e){var t={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function N(e){var e=e.target,t=(e.removeEventListener("dispose",N),b.indexOf(e.__bindingPointIndex));b.splice(t,1),A.deleteBuffer(S[e.id]),delete S[e.id],delete w[e.id]}return{bind:function(e,t){t=t.program,T.uniformBlockBinding(e,t)},update:function(t,e){var n;if(void 0===(n=S[t.id])){{var r=t;let n=r.uniforms,i=0;for(let e=0,t=n.length;e<t;e++){var a=Array.isArray(n[e])?n[e]:[n[e]];for(let e=0,t=a.length;e<t;e++){var o=a[e],s=Array.isArray(o.value)?o.value:[o.value];for(let t=0,e=s.length;t<e;t++){var l=R(s[t]);let e=i%16;var u=e%l.boundary,c=e+u;i+=u,0!=c&&16-c<l.storage&&(i+=16-c),o.__data=new Float32Array(l.storage/Float32Array.BYTES_PER_ELEMENT),o.__offset=i,i+=l.storage}}}let e=i%16;0<e&&(i+=16-e),r.__size=i,r.__cache={}}r=t,h=(()=>{for(let e=0;e<M;e++)if(-1===b.indexOf(e))return b.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0})(),r.__bindingPointIndex=h,d=A.createBuffer(),i=r.__size,r=r.usage,A.bindBuffer(A.UNIFORM_BUFFER,d),A.bufferData(A.UNIFORM_BUFFER,i,r),A.bindBuffer(A.UNIFORM_BUFFER,null),A.bindBufferBase(A.UNIFORM_BUFFER,h,d),n=d,S[t.id]=n,t.addEventListener("dispose",N)}var i=e.program,r=(T.updateUBOMapping(t,i),x.render.frame);if(w[t.id]!==r){var h=t,d=S[h.id],p=h.uniforms,f=h.__cache;A.bindBuffer(A.UNIFORM_BUFFER,d);for(let n=0,e=p.length;n<e;n++){var m=Array.isArray(p[n])?p[n]:[p[n]];for(let e=0,t=m.length;e<t;e++){var g=m[e];if(!0===((e,t,n,i)=>{if(e=e.value,void 0===i[t=t+"_"+n])return i[t]="number"==typeof e||"boolean"==typeof e?e:e.clone(),!0;if(n=i[t],"number"==typeof e||"boolean"==typeof e){if(n!==e)return i[t]=e,!0}else if(!1===n.equals(e))return n.copy(e),!0;return!1})(g,n,e,f)){var v=g.__offset,_=Array.isArray(g.value)?g.value:[g.value];let t=0;for(let e=0;e<_.length;e++){var y=_[e],E=R(y);"number"==typeof y||"boolean"==typeof y?(g.__data[0]=y,A.bufferSubData(A.UNIFORM_BUFFER,v+t,g.__data)):y.isMatrix3?(g.__data[0]=y.elements[0],g.__data[1]=y.elements[1],g.__data[2]=y.elements[2],g.__data[3]=0,g.__data[4]=y.elements[3],g.__data[5]=y.elements[4],g.__data[6]=y.elements[5],g.__data[7]=0,g.__data[8]=y.elements[6],g.__data[9]=y.elements[7],g.__data[10]=y.elements[8],g.__data[11]=0):(y.toArray(g.__data,t),t+=E.storage/Float32Array.BYTES_PER_ELEMENT)}A.bufferSubData(A.UNIFORM_BUFFER,v,g.__data)}}}A.bindBuffer(A.UNIFORM_BUFFER,null),w[t.id]=r}},dispose:function(){for(var e in S)A.deleteBuffer(S[e]);b=[],S={},w={}}}}class UA{constructor(){let e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{canvas:i=(Y=kd("canvas"),Y.style.display="block",Y),context:n=null,depth:o=!0,stencil:x=!1,alpha:S=!1,antialias:w=!1,premultipliedAlpha:b=!0,preserveDrawingBuffer:M=!1,powerPreference:W="default",failIfMajorPerformanceCaveat:j=!1}=e;var Y;this.isWebGLRenderer=!0;let q;if(null!==n){if("undefined"!=typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");q=n.getContextAttributes().alpha}else q=S;let l=new Uint32Array(4),u=new Int32Array(4),d=null,R=null,s=[],c=[],N=(this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=je,this.toneMapping=Xe,this.toneMappingExposure=1,this),X=!1,Z=0,K=0,I=null,C=-1,L=null,p=new cd,J=new cd,Q=null,$=new vd(0),ee=0,r=i.width,D=i.height,O=1,te=null,ne=null,ie=new cd(0,0,r,D),re=new cd(0,0,r,D),ae=!1,oe=new yA,P=!1,se=!1,le=new fd,ue=new dd,f=new cd,ce={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0},he=!1;function de(){return null===I?O:1}let U=n;function pe(e,t){return i.getContext(e,t)}try{var fe={alpha:!0,depth:o,stencil:x,antialias:w,premultipliedAlpha:b,preserveDrawingBuffer:M,powerPreference:W,failIfMajorPerformanceCaveat:j};if("setAttribute"in i&&i.setAttribute("data-engine","three.js r167"),i.addEventListener("webglcontextlost",Se,!1),i.addEventListener("webglcontextrestored",we,!1),i.addEventListener("webglcontextcreationerror",be,!1),null===U)if(null===(U=pe("webgl2",fe)))throw pe("webgl2")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}let g,B,F,a,z,k,G,H,v,me,m,h,ge,ve,_e,V,_,y,ye,Ee,Ae,T,E,xe;function Te(){(g=new hp(U)).init(),T=new Of(U,g),B=new np(U,g,e,T),F=new Cf(U),a=new fp(U),z=new Ef,k=new Df(U,g,F,z,B,T,a),G=new rp(N),H=new cp(N),v=new Qd(U),E=new ep(U,v),me=new dp(U,v,a,E),m=new gp(U,me,v,a),ye=new mp(U,B,k),V=new ip(z),h=new yf(N,G,H,g,B,E,V),ge=new Pf(N,z),ve=new Sf,_e=new Nf(g),y=new $d(N,G,H,F,m,q,b),_=new If(N,m,B),xe=new Uf(U,a,B,F),Ee=new tp(U,g,a),Ae=new pp(U,g,a),a.programs=h.programs,N.capabilities=B,N.extensions=g,N.properties=z,N.renderLists=ve,N.shadowMap=_,N.state=F,N.info=a}Te();let A=new PA(N,U);function Se(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),X=!0}function we(){console.log("THREE.WebGLRenderer: Context Restored."),X=!1;var e=a.autoReset,t=_.enabled,n=_.autoUpdate,i=_.needsUpdate,r=_.type;Te(),a.autoReset=e,_.enabled=t,_.autoUpdate=n,_.needsUpdate=i,_.type=r}function be(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Me(e){var e=e.target,t=(e.removeEventListener("dispose",Me),e=e),n=z.get(t).programs;void 0!==n&&(n.forEach(function(e){h.releaseProgram(e)}),t.isShaderMaterial)&&h.releaseShaderCache(t),z.remove(e)}function Re(e,t,n){!0===e.transparent&&e.side===He&&!1===e.forceSinglePass?(e.side=Ge,e.needsUpdate=!0,Be(e,t,n),e.side=ke,e.needsUpdate=!0,Be(e,t,n),e.side=He):Be(e,t,n)}this.xr=A,this.getContext=function(){return U},this.getContextAttributes=function(){return U.getContextAttributes()},this.forceContextLoss=function(){var e=g.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=g.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return O},this.setPixelRatio=function(e){void 0!==e&&(O=e,this.setSize(r,D,!1))},this.getSize=function(e){return e.set(r,D)},this.setSize=function(e,t){var n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];A.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(r=e,D=t,i.width=Math.floor(e*O),i.height=Math.floor(t*O),!0===n&&(i.style.width=e+"px",i.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(r*O,D*O).floor()},this.setDrawingBufferSize=function(e,t,n){r=e,D=t,O=n,i.width=Math.floor(e*n),i.height=Math.floor(t*n),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(p)},this.getViewport=function(e){return e.copy(ie)},this.setViewport=function(e,t,n,i){e.isVector4?ie.set(e.x,e.y,e.z,e.w):ie.set(e,t,n,i),F.viewport(p.copy(ie).multiplyScalar(O).round())},this.getScissor=function(e){return e.copy(re)},this.setScissor=function(e,t,n,i){e.isVector4?re.set(e.x,e.y,e.z,e.w):re.set(e,t,n,i),F.scissor(J.copy(re).multiplyScalar(O).round())},this.getScissorTest=function(){return ae},this.setScissorTest=function(e){F.setScissorTest(ae=e)},this.setOpaqueSort=function(e){te=e},this.setTransparentSort=function(e){ne=e},this.getClearColor=function(e){return e.copy(y.getClearColor())},this.setClearColor=function(){y.setClearColor.apply(y,arguments)},this.getClearAlpha=function(){return y.getClearAlpha()},this.setClearAlpha=function(){y.setClearAlpha.apply(y,arguments)},this.clear=function(){var t,n,i,r,a=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],o=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];let s=0;if(a){let e=!1;null!==I&&(a=I.texture.format,e=a===pt||a===dt||a===ct),e?(a=(a=I.texture.type)===We||a===Je||a===Ze||a===tt||a===$e||a===et,r=y.getClearColor(),t=y.getClearAlpha(),n=r.r,i=r.g,r=r.b,a?(l[0]=n,l[1]=i,l[2]=r,l[3]=t,U.clearBufferuiv(U.COLOR,0,l)):(u[0]=n,u[1]=i,u[2]=r,u[3]=t,U.clearBufferiv(U.COLOR,0,u))):s|=U.COLOR_BUFFER_BIT}e&&(s|=U.DEPTH_BUFFER_BIT),o&&(s|=U.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),U.clear(s)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",Se,!1),i.removeEventListener("webglcontextrestored",we,!1),i.removeEventListener("webglcontextcreationerror",be,!1),ve.dispose(),_e.dispose(),z.dispose(),G.dispose(),H.dispose(),m.dispose(),E.dispose(),xe.dispose(),h.dispose(),A.dispose(),A.removeEventListener("sessionstart",Ie),A.removeEventListener("sessionend",Ce),t.stop()},this.renderBufferDirect=function(e,t,i,r,a,o){null===t&&(t=ce);var s=a.isMesh&&a.matrixWorld.determinant()<0,e=((e,t,n,i,r)=>{!0!==t.isScene&&(t=ce),k.resetTextureUnits();let a=t.fog,o=i.isMeshStandardMaterial?t.environment:null,s=null===I?N.outputColorSpace:!0===I.isXRRenderTarget?I.texture.colorSpace:Ye,l=(i.isMeshStandardMaterial?H:G).get(i.envMap||o),u=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!n.attributes.tangent&&(!!i.normalMap||0<i.anisotropy),h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color,f=Xe;!i.toneMapped||null!==I&&!0!==I.isXRRenderTarget||(f=N.toneMapping);var m,g=void 0!==(g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)?g.length:0,v=z.get(i),_=R.state.lights;!0!==P||!0!==se&&e===L||(m=e===L&&i.id===C,V.setState(i,e,m));let y=!1,E=(i.version===v.__version?(v.needsLights&&v.lightsStateVersion!==_.state.version||v.outputColorSpace!==s||r.isBatchedMesh&&!1===v.batching||!r.isBatchedMesh&&!0===v.batching||r.isBatchedMesh&&!0===v.batchingColor&&null===r.colorTexture||r.isBatchedMesh&&!1===v.batchingColor&&null!==r.colorTexture||r.isInstancedMesh&&!1===v.instancing||!r.isInstancedMesh&&!0===v.instancing||r.isSkinnedMesh&&!1===v.skinning||!r.isSkinnedMesh&&!0===v.skinning||r.isInstancedMesh&&!0===v.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===v.instancingColor&&null!==r.instanceColor||r.isInstancedMesh&&!0===v.instancingMorph&&null===r.morphTexture||r.isInstancedMesh&&!1===v.instancingMorph&&null!==r.morphTexture||v.envMap!==l||!0===i.fog&&v.fog!==a||void 0!==v.numClippingPlanes&&(v.numClippingPlanes!==V.numPlanes||v.numIntersection!==V.numIntersection)||v.vertexAlphas!==u||v.vertexTangents!==c||v.morphTargets!==h||v.morphNormals!==d||v.morphColors!==p||v.toneMapping!==f||v.morphTargetsCount!==g)&&(y=!0):(y=!0,v.__version=i.version),v.currentProgram),A=(!0===y&&(E=Be(i,t,r)),!1),x=!1,T=!1,S=E.getUniforms(),w=v.uniforms;F.useProgram(E.program)&&(A=!0,x=!0,T=!0),i.id!==C&&(C=i.id,x=!0),!A&&L===e||(S.setValue(U,"projectionMatrix",e.projectionMatrix),S.setValue(U,"viewMatrix",e.matrixWorldInverse),void 0!==(m=S.map.cameraPosition)&&m.setValue(U,ue.setFromMatrixPosition(e.matrixWorld)),B.logarithmicDepthBuffer&&S.setValue(U,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&S.setValue(U,"isOrthographic",!0===e.isOrthographicCamera),L===e)||(L=e,x=!0,T=!0),r.isSkinnedMesh&&(S.setOptional(U,r,"bindMatrix"),S.setOptional(U,r,"bindMatrixInverse"),_=r.skeleton)&&(null===_.boneTexture&&_.computeBoneTexture(),S.setValue(U,"boneTexture",_.boneTexture,k)),r.isBatchedMesh&&(S.setOptional(U,r,"batchingTexture"),S.setValue(U,"batchingTexture",r._matricesTexture,k),S.setOptional(U,r,"batchingIdTexture"),S.setValue(U,"batchingIdTexture",r._indirectTexture,k),S.setOptional(U,r,"batchingColorTexture"),null!==r._colorsTexture)&&S.setValue(U,"batchingColorTexture",r._colorsTexture,k),void 0===(g=n.morphAttributes).position&&void 0===g.normal&&void 0===g.color||ye.update(r,n,E),!x&&v.receiveShadow===r.receiveShadow||(v.receiveShadow=r.receiveShadow,S.setValue(U,"receiveShadow",r.receiveShadow)),i.isMeshGouraudMaterial&&null!==i.envMap&&(w.envMap.value=l,w.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),i.isMeshStandardMaterial&&null===i.envMap&&null!==t.environment&&(w.envMapIntensity.value=t.environmentIntensity),x&&(S.setValue(U,"toneMappingExposure",N.toneMappingExposure),v.needsLights&&(_=w,g=T,_.ambientLightColor.needsUpdate=g,_.lightProbe.needsUpdate=g,_.directionalLights.needsUpdate=g,_.directionalLightShadows.needsUpdate=g,_.pointLights.needsUpdate=g,_.pointLightShadows.needsUpdate=g,_.spotLights.needsUpdate=g,_.spotLightShadows.needsUpdate=g,_.rectAreaLights.needsUpdate=g,_.hemisphereLights.needsUpdate=g),a&&!0===i.fog&&ge.refreshFogUniforms(w,a),ge.refreshMaterialUniforms(w,i,O,D,R.state.transmissionRenderTarget[e.id]),MA.upload(U,Fe(v),w,k));if(i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(MA.upload(U,Fe(v),w,k),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&S.setValue(U,"center",r.center),S.setValue(U,"modelViewMatrix",r.modelViewMatrix),S.setValue(U,"normalMatrix",r.normalMatrix),S.setValue(U,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){var b=i.uniformsGroups;for(let e=0,t=b.length;e<t;e++){var M=b[e];xe.update(M,E),xe.bind(M,E)}}return E})(e,t,i,r,a);F.setMaterial(r,s);let l=i.index,n=1;if(!0===r.wireframe){if(void 0===(l=me.getWireframeAttribute(i)))return;n=2}var t=i.drawRange,s=i.attributes.position;let u=t.start*n,c=(t.start+t.count)*n,h=(null!==o&&(u=Math.max(u,o.start*n),c=Math.min(c,(o.start+o.count)*n)),null!==l?(u=Math.max(u,0),c=Math.min(c,l.count)):null!=s&&(u=Math.max(u,0),c=Math.min(c,s.count)),c-u);if(!(h<0||h===1/0)){E.setup(a,r,e,i,l);let n=Ee;if(null!==l&&(t=v.get(l),(n=Ae).setIndex(t)),a.isMesh)!0===r.wireframe?(F.setLineWidth(r.wireframeLinewidth*de()),n.setMode(U.LINES)):n.setMode(U.TRIANGLES);else if(a.isLine){let e=r.linewidth;void 0===e&&(e=1),F.setLineWidth(e*de()),a.isLineSegments?n.setMode(U.LINES):a.isLineLoop?n.setMode(U.LINE_LOOP):n.setMode(U.LINE_STRIP)}else a.isPoints?n.setMode(U.POINTS):a.isSprite&&n.setMode(U.TRIANGLES);if(a.isBatchedMesh)if(null!==a._multiDrawInstances)n.renderMultiDrawInstances(a._multiDrawStarts,a._multiDrawCounts,a._multiDrawCount,a._multiDrawInstances);else if(g.get("WEBGL_multi_draw"))n.renderMultiDraw(a._multiDrawStarts,a._multiDrawCounts,a._multiDrawCount);else{var d=a._multiDrawStarts,p=a._multiDrawCounts;let t=a._multiDrawCount;var f=l?v.get(l).bytesPerElement:1,m=z.get(r).currentProgram.getUniforms();for(let e=0;e<t;e++)m.setValue(U,"_gl_DrawID",e),n.render(d[e]/f,p[e])}else a.isInstancedMesh?n.renderInstances(u,h,a.count):i.isInstancedBufferGeometry?(o=void 0!==i._maxInstanceCount?i._maxInstanceCount:1/0,s=Math.min(i.instanceCount,o),n.renderInstances(u,h,s)):n.render(u,h)}},this.compile=function(e,t){let r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,a=(null===r&&(r=e),(R=_e.get(r)).init(t),c.push(R),r.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(R.pushLight(e),e.castShadow)&&R.pushShadow(e)}),e!==r&&e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(R.pushLight(e),e.castShadow)&&R.pushShadow(e)}),R.setupLights(),new Set);return e.traverse(function(t){var n=t.material;if(n)if(Array.isArray(n))for(let e=0;e<n.length;e++){var i=n[e];Re(i,r,t),a.add(i)}else Re(n,r,t),a.add(n)}),c.pop(),R=null,a},this.compileAsync=function(n,e){let i=this.compile(n,e,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null);return new Promise(e=>{function t(){i.forEach(function(e){z.get(e).currentProgram.isReady()&&i.delete(e)}),0===i.size?e(n):setTimeout(t,10)}null!==g.get("KHR_parallel_shader_compile")?t():setTimeout(t,10)})};let Ne=null;function Ie(){t.stop()}function Ce(){t.start()}let t=new Jd;function Le(n,i,r,a){if(!1!==n.visible){var e,t;if(n.layers.test(i.layers))if(n.isGroup)r=n.renderOrder;else if(n.isLOD)!0===n.autoUpdate&&n.update(i);else if(n.isLight)R.pushLight(n),n.castShadow&&R.pushShadow(n);else if(n.isSprite)n.frustumCulled&&!oe.intersectsSprite(n)||(a&&f.setFromMatrixPosition(n.matrixWorld).applyMatrix4(le),e=m.update(n),(t=n.material).visible&&d.push(n,e,t,r,f.z,null));else if((n.isMesh||n.isLine||n.isPoints)&&(!n.frustumCulled||oe.intersectsObject(n))){var o=m.update(n),s=n.material;if(a&&(void 0!==n.boundingSphere?(null===n.boundingSphere&&n.computeBoundingSphere(),f.copy(n.boundingSphere.center)):(null===o.boundingSphere&&o.computeBoundingSphere(),f.copy(o.boundingSphere.center)),f.applyMatrix4(n.matrixWorld).applyMatrix4(le)),Array.isArray(s)){var l=o.groups;for(let e=0,t=l.length;e<t;e++){var u=l[e],c=s[u.materialIndex];c&&c.visible&&d.push(n,o,c,r,f.z,u)}}else s.visible&&d.push(n,o,s,r,f.z,null)}var h=n.children;for(let e=0,t=h.length;e<t;e++)Le(h[e],i,r,a)}}function De(e,t,n,i){var r=e.opaque,a=e.transmissive,e=e.transparent;R.setupLightsView(n),!0===P&&V.setGlobalState(N.clippingPlanes,n),i&&F.viewport(p.copy(i)),0<r.length&&Pe(r,t,n),0<a.length&&Pe(a,t,n),0<e.length&&Pe(e,t,n),F.buffers.depth.setTest(!0),F.buffers.depth.setMask(!0),F.buffers.color.setMask(!0),F.setPolygonOffset(!1)}function Oe(e,i,r,a){var t=!0===r.isScene?r.overrideMaterial:null;if(null===t){void 0===R.state.transmissionRenderTarget[a.id]&&(R.state.transmissionRenderTarget[a.id]=new nA(1,1,{generateMipmaps:!0,type:g.has("EXT_color_buffer_half_float")||g.has("EXT_color_buffer_float")?Qe:We,minFilter:Ve,samples:4,stencilBuffer:x,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:qe.workingColorSpace}));var t=R.state.transmissionRenderTarget[a.id],n=a.viewport||p,n=(t.setSize(n.z,n.w),N.getRenderTarget()),o=(N.setRenderTarget(t),N.getClearColor($),(ee=N.getClearAlpha())<1&&N.setClearColor(16777215,.5),N.clear(),he&&y.render(r),N.toneMapping),s=(N.toneMapping=Xe,a.viewport);if(void 0!==a.viewport&&(a.viewport=void 0),R.setupLightsView(a),!0===P&&V.setGlobalState(N.clippingPlanes,a),Pe(e,r,a),k.updateMultisampleRenderTarget(t),k.updateRenderTargetMipmap(t),!1===g.has("WEBGL_multisampled_render_to_texture")){let n=!1;for(let e=0,t=i.length;e<t;e++){var l,u=i[e],c=u.object,h=u.geometry,d=u.material,u=u.group;d.side===He&&c.layers.test(a.layers)&&(l=d.side,d.side=Ge,d.needsUpdate=!0,Ue(c,r,a,h,d,u),d.side=l,d.needsUpdate=!0,n=!0)}!0===n&&(k.updateMultisampleRenderTarget(t),k.updateRenderTargetMipmap(t))}N.setRenderTarget(n),N.setClearColor($,ee),void 0!==s&&(a.viewport=s),N.toneMapping=o}}function Pe(n,i,r){var a=!0===i.isScene?i.overrideMaterial:null;for(let e=0,t=n.length;e<t;e++){var o=n[e],s=o.object,l=o.geometry,u=null===a?o.material:a,o=o.group;s.layers.test(r.layers)&&Ue(s,i,r,l,u,o)}}function Ue(e,t,n,i,r,a){e.onBeforeRender(N,t,n,i,r,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),!0===r.transparent&&r.side===He&&!1===r.forceSinglePass?(r.side=Ge,r.needsUpdate=!0,N.renderBufferDirect(n,t,i,r,e,a),r.side=ke,r.needsUpdate=!0,N.renderBufferDirect(n,t,i,r,e,a),r.side=He):N.renderBufferDirect(n,t,i,r,e,a),e.onAfterRender(N,t,n,i,r,a)}function Be(e,t,n){!0!==t.isScene&&(t=ce);var i=z.get(e),r=R.state.lights,a=R.state.shadowsArray,o=r.state.version,a=h.getParameters(e,r.state,a,t,n),n=h.getProgramCacheKey(a);let s=i.programs,l=(i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?H:G).get(e.envMap||i.environment),i.envMapRotation=null!==i.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===s&&(e.addEventListener("dispose",Me),s=new Map,i.programs=s),s.get(n));if(void 0!==l){if(i.currentProgram===l&&i.lightsStateVersion===o)return ze(e,a),l}else a.uniforms=h.getUniforms(e),e.onBeforeCompile(a,N),l=h.acquireProgram(a,n),s.set(n,l),i.uniforms=a.uniforms;t=i.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(t.clippingPlanes=V.uniform),ze(e,a),i.needsLights=(n=e).isMeshLambertMaterial||n.isMeshToonMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial||n.isShadowMaterial||n.isShaderMaterial&&!0===n.lights,i.lightsStateVersion=o,i.needsLights&&(t.ambientLightColor.value=r.state.ambient,t.lightProbe.value=r.state.probe,t.directionalLights.value=r.state.directional,t.directionalLightShadows.value=r.state.directionalShadow,t.spotLights.value=r.state.spot,t.spotLightShadows.value=r.state.spotShadow,t.rectAreaLights.value=r.state.rectArea,t.ltc_1.value=r.state.rectAreaLTC1,t.ltc_2.value=r.state.rectAreaLTC2,t.pointLights.value=r.state.point,t.pointLightShadows.value=r.state.pointShadow,t.hemisphereLights.value=r.state.hemi,t.directionalShadowMap.value=r.state.directionalShadowMap,t.directionalShadowMatrix.value=r.state.directionalShadowMatrix,t.spotShadowMap.value=r.state.spotShadowMap,t.spotLightMatrix.value=r.state.spotLightMatrix,t.spotLightMap.value=r.state.spotLightMap,t.pointShadowMap.value=r.state.pointShadowMap,t.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=l,i.uniformsList=null,l}function Fe(e){var t;return null===e.uniformsList&&(t=e.currentProgram.getUniforms(),e.uniformsList=MA.seqWithValue(t.seq,e.uniforms)),e.uniformsList}function ze(e,t){e=z.get(e);e.outputColorSpace=t.outputColorSpace,e.batching=t.batching,e.batchingColor=t.batchingColor,e.instancing=t.instancing,e.instancingColor=t.instancingColor,e.instancingMorph=t.instancingMorph,e.skinning=t.skinning,e.morphTargets=t.morphTargets,e.morphNormals=t.morphNormals,e.morphColors=t.morphColors,e.morphTargetsCount=t.morphTargetsCount,e.numClippingPlanes=t.numClippingPlanes,e.numIntersection=t.numClipIntersection,e.vertexAlphas=t.vertexAlphas,e.vertexTangents=t.vertexTangents,e.toneMapping=t.toneMapping}t.setAnimationLoop(function(e){Ne&&Ne(e)}),"undefined"!=typeof self&&t.setContext(self),this.setAnimationLoop=function(e){Ne=e,A.setAnimationLoop(e),null===e?t.stop():t.start()},A.addEventListener("sessionstart",Ie),A.addEventListener("sessionend",Ce),this.render=function(n,e){if(void 0!==e&&!0!==e.isCamera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else if(!0!==X){!0===n.matrixWorldAutoUpdate&&n.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===A.enabled&&!0===A.isPresenting&&(!0===A.cameraAutoUpdate&&A.updateCamera(e),e=A.getCamera()),!0===n.isScene&&n.onBeforeRender(N,n,e,I),(R=_e.get(n,c.length)).init(e),c.push(R),le.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),oe.setFromProjectionMatrix(le),se=this.localClippingEnabled,P=V.init(this.clippingPlanes,se),(d=ve.get(n,s.length)).init(),s.push(d),!0===A.enabled&&!0===A.isPresenting&&null!==(t=N.xr.getDepthSensingMesh())&&Le(t,e,-1/0,N.sortObjects),Le(n,e,0,N.sortObjects),d.finish(),!0===N.sortObjects&&d.sort(te,ne),(he=!1===A.enabled||!1===A.isPresenting||!1===A.hasDepthSensing())&&y.addToRenderList(d,n),this.info.render.frame++,!0===P&&V.beginShadows();var t=R.state.shadowsArray,i=(_.render(t,n,e),!0===P&&V.endShadows(),!0===this.info.autoReset&&this.info.reset(),d.opaque),r=d.transmissive;if(R.setupLights(),e.isArrayCamera){var a=e.cameras;if(0<r.length)for(let e=0,t=a.length;e<t;e++)Oe(i,r,n,a[e]);he&&y.render(n);for(let e=0,t=a.length;e<t;e++){var o=a[e];De(d,n,o,o.viewport)}}else 0<r.length&&Oe(i,r,n,e),he&&y.render(n),De(d,n,e);null!==I&&(k.updateMultisampleRenderTarget(I),k.updateRenderTargetMipmap(I)),!0===n.isScene&&n.onAfterRender(N,n,e),E.resetDefaultState(),C=-1,L=null,c.pop(),0<c.length?(R=c[c.length-1],!0===P&&V.setGlobalState(N.clippingPlanes,R.state.camera)):R=null,s.pop(),d=0<s.length?s[s.length-1]:null}},this.getActiveCubeFace=function(){return Z},this.getActiveMipmapLevel=function(){return K},this.getRenderTarget=function(){return I},this.setRenderTargetTextures=function(e,t,n){z.get(e.texture).__webglTexture=t,z.get(e.depthTexture).__webglTexture=n;t=z.get(e);t.__hasExternalTextures=!0,t.__autoAllocateDepthBuffer=void 0===n,t.__autoAllocateDepthBuffer||!0===g.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),t.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(e,t){e=z.get(e);e.__webglFramebuffer=t,e.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;I=e,Z=n,K=i;let r=!0,a=null,o=!1,s=!1;Q=e?(void 0!==(t=z.get(e)).__useDefaultFramebuffer?(F.bindFramebuffer(U.FRAMEBUFFER,null),r=!1):void 0===t.__webglFramebuffer?k.setupRenderTarget(e):t.__hasExternalTextures&&k.rebindTextures(e,z.get(e.texture).__webglTexture,z.get(e.depthTexture).__webglTexture),((t=e.texture).isData3DTexture||t.isDataArrayTexture||t.isCompressedArrayTexture)&&(s=!0),t=z.get(e).__webglFramebuffer,e.isWebGLCubeRenderTarget?(a=Array.isArray(t[n])?t[n][i]:t[n],o=!0):a=0<e.samples&&!1===k.useMultisampledRTT(e)?z.get(e).__webglMultisampledFramebuffer:Array.isArray(t)?t[i]:t,p.copy(e.viewport),J.copy(e.scissor),e.scissorTest):(p.copy(ie).multiplyScalar(O).floor(),J.copy(re).multiplyScalar(O).floor(),ae),F.bindFramebuffer(U.FRAMEBUFFER,a)&&r&&F.drawBuffers(e,a),F.viewport(p),F.scissor(J),F.setScissorTest(Q),o?(t=z.get(e.texture),U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_CUBE_MAP_POSITIVE_X+n,t.__webglTexture,i)):s&&(t=z.get(e.texture),e=n||0,U.framebufferTextureLayer(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,t.__webglTexture,i||0,e)),C=-1},this.readRenderTargetPixels=function(t,n,i,r,a,o,s){if(t&&t.isWebGLRenderTarget){let e=z.get(t).__webglFramebuffer;if(e=t.isWebGLCubeRenderTarget&&void 0!==s?e[s]:e){F.bindFramebuffer(U.FRAMEBUFFER,e);try{var l=t.texture,u=l.format,c=l.type;B.textureFormatReadable(u)?B.textureTypeReadable(c)?0<=n&&n<=t.width-r&&0<=i&&i<=t.height-a&&U.readPixels(n,i,r,a,T.convert(u),T.convert(c),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.")}finally{let e=null!==I?z.get(I).__webglFramebuffer:null;F.bindFramebuffer(U.FRAMEBUFFER,e)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.readRenderTargetPixelsAsync=async function(e,t,n,i,r,a,o){if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=z.get(e).__webglFramebuffer;if(s=e.isWebGLCubeRenderTarget&&void 0!==o?s[o]:s){F.bindFramebuffer(U.FRAMEBUFFER,s);try{var l=e.texture,u=l.format,c=l.type;if(!B.textureFormatReadable(u))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!B.textureTypeReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(0<=t&&t<=e.width-i&&0<=n&&n<=e.height-r){var h=U.createBuffer(),d=(U.bindBuffer(U.PIXEL_PACK_BUFFER,h),U.bufferData(U.PIXEL_PACK_BUFFER,a.byteLength,U.STREAM_READ),U.readPixels(t,n,i,r,T.convert(u),T.convert(c),0),U.flush(),U.fenceSync(U.SYNC_GPU_COMMANDS_COMPLETE,0));p=U,f=d,m=4,await new Promise(function(t,n){setTimeout(function e(){switch(p.clientWaitSync(f,p.SYNC_FLUSH_COMMANDS_BIT,0)){case p.WAIT_FAILED:n();break;case p.TIMEOUT_EXPIRED:setTimeout(e,m);break;default:t()}},m)});try{U.bindBuffer(U.PIXEL_PACK_BUFFER,h),U.getBufferSubData(U.PIXEL_PACK_BUFFER,0,a)}finally{U.deleteBuffer(h),U.deleteSync(d)}return a}}finally{let e=null!==I?z.get(I).__webglFramebuffer:null;F.bindFramebuffer(U.FRAMEBUFFER,e)}}var p,f,m},this.copyFramebufferToTexture=function(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=(!0!==e.isTexture&&(Gd("WebGLRenderer: copyFramebufferToTexture function signature has changed."),t=arguments[0]||null,e=arguments[1]),Math.pow(2,-n)),r=Math.floor(e.image.width*i),i=Math.floor(e.image.height*i),a=null!==t?t.x:0,o=null!==t?t.y:0;k.setTexture2D(e,0),U.copyTexSubImage2D(U.TEXTURE_2D,n,0,0,a,o,r,i),F.unbindTexture()},this.copyTextureToTexture=function(e,t){let n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;!0!==e.isTexture&&(Gd("WebGLRenderer: copyTextureToTexture function signature has changed."),i=arguments[0]||null,e=arguments[1],t=arguments[2],r=arguments[3]||0,n=null);let a,o,s,l,u,c;l=null!==n?(a=n.max.x-n.min.x,o=n.max.y-n.min.y,s=n.min.x,n.min.y):(a=e.image.width,o=e.image.height,s=0),c=null!==i?(u=i.x,i.y):u=0;var h=T.convert(t.format),d=T.convert(t.type),p=(k.setTexture2D(t,0),U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,t.flipY),U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),U.pixelStorei(U.UNPACK_ALIGNMENT,t.unpackAlignment),U.getParameter(U.UNPACK_ROW_LENGTH)),f=U.getParameter(U.UNPACK_IMAGE_HEIGHT),m=U.getParameter(U.UNPACK_SKIP_PIXELS),g=U.getParameter(U.UNPACK_SKIP_ROWS),v=U.getParameter(U.UNPACK_SKIP_IMAGES),_=e.isCompressedTexture?e.mipmaps[r]:e.image;U.pixelStorei(U.UNPACK_ROW_LENGTH,_.width),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,_.height),U.pixelStorei(U.UNPACK_SKIP_PIXELS,s),U.pixelStorei(U.UNPACK_SKIP_ROWS,l),e.isDataTexture?U.texSubImage2D(U.TEXTURE_2D,r,u,c,a,o,h,d,_.data):e.isCompressedTexture?U.compressedTexSubImage2D(U.TEXTURE_2D,r,u,c,_.width,_.height,h,_.data):U.texSubImage2D(U.TEXTURE_2D,r,u,c,a,o,h,d,_),U.pixelStorei(U.UNPACK_ROW_LENGTH,p),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,f),U.pixelStorei(U.UNPACK_SKIP_PIXELS,m),U.pixelStorei(U.UNPACK_SKIP_ROWS,g),U.pixelStorei(U.UNPACK_SKIP_IMAGES,v),0===r&&t.generateMipmaps&&U.generateMipmap(U.TEXTURE_2D),F.unbindTexture()},this.copyTextureToTexture3D=function(e,t){let n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;!0!==e.isTexture&&(Gd("WebGLRenderer: copyTextureToTexture3D function signature has changed."),n=arguments[0]||null,i=arguments[1]||null,e=arguments[2],t=arguments[3],r=arguments[4]||0);let a,o,s,l,u,c,h,d,p;var f=e.isCompressedTexture?e.mipmaps[r]:e.image,m=(c=null!==n?(a=n.max.x-n.min.x,o=n.max.y-n.min.y,s=n.max.z-n.min.z,l=n.min.x,u=n.min.y,n.min.z):(a=f.width,o=f.height,s=f.depth,l=0,u=0),p=null!==i?(h=i.x,d=i.y,i.z):(h=0,d=0),T.convert(t.format)),g=T.convert(t.type);let v;if(t.isData3DTexture)k.setTexture3D(t,0),v=U.TEXTURE_3D;else{if(!t.isDataArrayTexture&&!t.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");k.setTexture2DArray(t,0),v=U.TEXTURE_2D_ARRAY}U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,t.flipY),U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),U.pixelStorei(U.UNPACK_ALIGNMENT,t.unpackAlignment);var _=U.getParameter(U.UNPACK_ROW_LENGTH),y=U.getParameter(U.UNPACK_IMAGE_HEIGHT),E=U.getParameter(U.UNPACK_SKIP_PIXELS),A=U.getParameter(U.UNPACK_SKIP_ROWS),x=U.getParameter(U.UNPACK_SKIP_IMAGES);U.pixelStorei(U.UNPACK_ROW_LENGTH,f.width),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,f.height),U.pixelStorei(U.UNPACK_SKIP_PIXELS,l),U.pixelStorei(U.UNPACK_SKIP_ROWS,u),U.pixelStorei(U.UNPACK_SKIP_IMAGES,c),e.isDataTexture||e.isData3DTexture?U.texSubImage3D(v,r,h,d,p,a,o,s,m,g,f.data):t.isCompressedArrayTexture?U.compressedTexSubImage3D(v,r,h,d,p,a,o,s,m,f.data):U.texSubImage3D(v,r,h,d,p,a,o,s,m,g,f),U.pixelStorei(U.UNPACK_ROW_LENGTH,_),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,y),U.pixelStorei(U.UNPACK_SKIP_PIXELS,E),U.pixelStorei(U.UNPACK_SKIP_ROWS,A),U.pixelStorei(U.UNPACK_SKIP_IMAGES,x),0===r&&t.generateMipmaps&&U.generateMipmap(v),F.unbindTexture()},this.initRenderTarget=function(e){void 0===z.get(e).__webglFramebuffer&&k.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?k.setTextureCube(e,0):e.isData3DTexture?k.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?k.setTexture2DArray(e,0):k.setTexture2D(e,0),F.unbindTexture()},this.resetState=function(){Z=0,K=0,I=null,F.reset(),E.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return 2e3}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;var t=this.getContext();t.drawingBufferColorSpace=e===Jt?"display-p3":"srgb",t.unpackColorSpace=qe.workingColorSpace===Qt?"display-p3":"srgb"}}class BA extends gd{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new md,this.environmentIntensity=1,this.environmentRotation=new md,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){e=super.toJSON(e);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),0<this.backgroundBlurriness&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class FA{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=Od()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return Gd("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(n,i,r){n*=this.stride,r*=i.stride;for(let e=0,t=this.stride;e<t;e++)this.array[n+e]=i.array[r+e];return this}set(e){return this.array.set(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:0),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Od()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);e=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),e=new this.constructor(e,this.stride);return e.setUsage(this.usage),e}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Od()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}let s=new dd;class zA{constructor(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(n){for(let e=0,t=this.data.count;e<t;e++)s.fromBufferAttribute(this,e),s.applyMatrix4(n),this.setXYZ(e,s.x,s.y,s.z);return this}applyNormalMatrix(n){for(let e=0,t=this.count;e<t;e++)s.fromBufferAttribute(this,e),s.applyNormalMatrix(n),this.setXYZ(e,s.x,s.y,s.z);return this}transformDirection(n){for(let e=0,t=this.count;e<t;e++)s.fromBufferAttribute(this,e),s.transformDirection(n),this.setXYZ(e,s.x,s.y,s.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return n=this.normalized?Fd(n,this.array):n}setComponent(e,t,n){return this.normalized&&(n=Jh(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=Jh(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Jh(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Jh(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Jh(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return t=this.normalized?Fd(t,this.array):t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return t=this.normalized?Fd(t,this.array):t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return t=this.normalized?Fd(t,this.array):t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return t=this.normalized?Fd(t,this.array):t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Jh(t,this.array),n=Jh(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Jh(t,this.array),n=Jh(n,this.array),i=Jh(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Jh(t,this.array),n=Jh(n,this.array),i=Jh(i,this.array),r=Jh(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new zA(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");var t=[];for(let e=0;e<this.count;e++){var n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new yd(new this.array.constructor(t),this.itemSize,this.normalized)}toJSON(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");var t=[];for(let e=0;e<this.count;e++){var n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}}(class extends uA{}),class extends gd{},class extends gd{};let Wr=new dd,jr=new cd,Yr=new cd,qr=new dd,Xr=new fd,Zr=new dd,Kr=new aA,Jr=new fd,Qr=new oA;class kA extends xd{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new fd,this.bindMatrixInverse=new fd,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){var e=this.geometry,t=(null===this.boundingBox&&(this.boundingBox=new pd),this.boundingBox.makeEmpty(),e.getAttribute("position"));for(let e=0;e<t.count;e++)this.getVertexPosition(e,Zr),this.boundingBox.expandByPoint(Zr)}computeBoundingSphere(){var e=this.geometry,t=(null===this.boundingSphere&&(this.boundingSphere=new aA),this.boundingSphere.makeEmpty(),e.getAttribute("position"));for(let e=0;e<t.count;e++)this.getVertexPosition(e,Zr),this.boundingSphere.expandByPoint(Zr)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){var n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),Kr.copy(this.boundingSphere),Kr.applyMatrix4(i),!1!==e.ray.intersectsSphere(Kr))&&(Jr.copy(i).invert(),Qr.copy(e.ray).applyMatrix4(Jr),null===this.boundingBox||!1!==Qr.intersectsBox(this.boundingBox))&&this._computeIntersections(e,t,Qr)}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){var n=new cd,i=this.geometry.attributes.skinWeight;for(let e=0,t=i.count;e<t;e++){n.fromBufferAttribute(i,e);var r=1/n.manhattanLength();r!=1/0?n.multiplyScalar(r):n.set(1,0,0,0),i.setXYZW(e,n.x,n.y,n.z,n.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){var n=this.skeleton,i=this.geometry;jr.fromBufferAttribute(i.attributes.skinIndex,e),Yr.fromBufferAttribute(i.attributes.skinWeight,e),Wr.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){var r,a=Yr.getComponent(e);0!==a&&(r=jr.getComponent(e),Xr.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),t.addScaledVector(qr.copy(Wr).applyMatrix4(Xr),a))}return t.applyMatrix4(this.bindMatrixInverse)}}class GA extends gd{constructor(){super(),this.isBone=!0,this.type="Bone"}}class HA extends eA{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length?arguments[3]:void 0,r=4<arguments.length?arguments[4]:void 0;super(null,5<arguments.length?arguments[5]:void 0,6<arguments.length?arguments[6]:void 0,7<arguments.length?arguments[7]:void 0,8<arguments.length&&void 0!==arguments[8]?arguments[8]:V,9<arguments.length&&void 0!==arguments[9]?arguments[9]:V,i,r,10<arguments.length?arguments[10]:void 0,11<arguments.length?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let $r=new fd,ea=new fd;class VA{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];this.uuid=Od(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){var e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new fd)}}calculateInverses(){for(let e=this.boneInverses.length=0,t=this.bones.length;e<t;e++){var n=new fd;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){var n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){var i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){var n=this.bones,i=this.boneInverses,r=this.boneMatrices,e=this.boneTexture;for(let e=0,t=n.length;e<t;e++){var a=n[e]?n[e].matrixWorld:ea;$r.multiplyMatrices(a,i[e]),$r.toArray(r,16*e)}null!==e&&(e.needsUpdate=!0)}clone(){return new VA(this.bones,this.boneInverses)}computeBoneTexture(){var e=Math.sqrt(4*this.bones.length),e=4*Math.ceil(e/4),t=(e=Math.max(e,4),new Float32Array(e*e*4)),e=(t.set(this.boneMatrices),new HA(t,e,e,q,j));return e.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=e,this}getBoneByName(n){for(let e=0,t=this.bones.length;e<t;e++){var i=this.bones[e];if(i.name===n)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(n,i){this.uuid=n.uuid;for(let t=0,e=n.bones.length;t<e;t++){var r=n.bones[t];let e=i[r];void 0===e&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),e=new GA),this.bones.push(e),this.boneInverses.push((new fd).fromArray(n.boneInverses[t]))}return this.init(),this}toJSON(){var n={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]},i=(n.uuid=this.uuid,this.bones),r=this.boneInverses;for(let e=0,t=i.length;e<t;e++){var a=i[e],a=(n.bones.push(a.uuid),r[e]);n.boneInverses.push(a.toArray())}return n}}class WA extends yd{constructor(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){var e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}let ta=new fd,na=new fd,ia=[],ra=new pd,aa=new fd,oa=new xd,sa=new aA;class jA extends xd{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new WA(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<n;e++)this.setMatrixAt(e,aa)}computeBoundingBox(){var t=this.geometry,n=this.count;null===this.boundingBox&&(this.boundingBox=new pd),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let e=0;e<n;e++)this.getMatrixAt(e,ta),ra.copy(t.boundingBox).applyMatrix4(ta),this.boundingBox.union(ra)}computeBoundingSphere(){var t=this.geometry,n=this.count;null===this.boundingSphere&&(this.boundingSphere=new aA),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let e=0;e<n;e++)this.getMatrixAt(e,ta),sa.copy(t.boundingSphere).applyMatrix4(ta),this.boundingSphere.union(sa)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){var n=t.morphTargetInfluences,i=this.morphTexture.source.data.data,r=e*(n.length+1)+1;for(let e=0;e<n.length;e++)n[e]=i[r+e]}raycast(e,i){var t=this.matrixWorld,r=this.count;if(oa.geometry=this.geometry,oa.material=this.material,void 0!==oa.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),sa.copy(this.boundingSphere),sa.applyMatrix4(t),!1!==e.ray.intersectsSphere(sa)))for(let n=0;n<r;n++){this.getMatrixAt(n,ta),na.multiplyMatrices(t,ta),oa.matrixWorld=na,oa.raycast(e,ia);for(let e=0,t=ia.length;e<t;e++){var a=ia[e];a.instanceId=n,a.object=this,i.push(a)}ia.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new WA(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){var n=t.morphTargetInfluences,t=n.length+1,i=(null===this.morphTexture&&(this.morphTexture=new HA(new Float32Array(t*this.count),t,this.count,ut,j)),this.morphTexture.source.data.data);let r=0;for(let e=0;e<n.length;e++)r+=n[e];var a=this.geometry.morphTargetsRelative?1:1-r,t=t*e;i[t]=a,i.set(n,1+t)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function Bf(e,t){return e.z-t.z}function Ff(e,t){return t.z-e.z}class YA{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n){var i=this.pool,r=this.list,i=(this.index>=i.length&&i.push({start:-1,count:-1,z:-1,index:-1}),i[this.index]);r.push(i),this.index++,i.start=e.start,i.count=e.count,i.z=t,i.index=n}reset(){this.list.length=0,this.index=0}}let la=new fd,ua=new fd,ca=new fd,ha=new vd(1,1,1),da=new fd,pa=new yA,fa=new pd,ma=new aA,ga=new dd,va=new dd,_a=new dd,ya=new YA,d=new xd,Ea=[];class qA extends xd{get maxInstanceCount(){return this._maxInstanceCount}constructor(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2*t,i=3<arguments.length?arguments[3]:void 0;super(new Ad,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawInfo=[],this._drawRanges=[],this._reservedRanges=[],this._bounds=[],this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){var e=Math.sqrt(4*this._maxInstanceCount),e=4*Math.ceil(e/4),t=(e=Math.max(e,4),new Float32Array(e*e*4)),t=new HA(t,e,e,q,j);this._matricesTexture=t}_initIndirectTexture(){var e=Math.sqrt(this._maxInstanceCount),e=Math.ceil(e),t=new Uint32Array(e*e),t=new HA(t,e,e,ct,Je);this._indirectTexture=t}_initColorsTexture(){var e=Math.sqrt(this._maxIndexCount),e=Math.ceil(e),t=new Float32Array(e*e*4).fill(1),t=new HA(t,e,e,q,j);t.colorSpace=qe.workingColorSpace,this._colorsTexture=t}_initializeGeometry(e){var t=this.geometry,n=this._maxVertexCount,i=this._maxIndexCount;if(!1===this._geometryInitialized){for(var r in e.attributes){var{array:a,itemSize:o,normalized:s}=e.getAttribute(r),a=new a.constructor(n*o),a=new yd(a,o,s);t.setAttribute(r,a)}null!==e.getIndex()&&(i=new(65535<n?Uint32Array:Uint16Array)(i),t.setIndex(new yd(i,1))),this._geometryInitialized=!0}}_validateGeometry(e){var t,n=this.geometry;if(Boolean(e.getIndex())!==Boolean(n.getIndex()))throw new Error('BatchedMesh: All geometries must consistently have "index".');for(t in n.attributes){if(!e.hasAttribute(t))throw new Error(`BatchedMesh: Added geometry missing "${t}". All geometries must have consistent attributes.`);var i=e.getAttribute(t),r=n.getAttribute(t);if(i.itemSize!==r.itemSize||i.normalized!==r.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new pd);var t,n=this._geometryCount,i=this.boundingBox,r=this._drawInfo;i.makeEmpty();for(let e=0;e<n;e++)!1!==r[e].active&&(t=r[e].geometryIndex,this.getMatrixAt(e,la),this.getBoundingBoxAt(t,fa).applyMatrix4(la),i.union(fa))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new aA);var n,i=this.boundingSphere,r=this._drawInfo;i.makeEmpty();for(let e=0,t=r.length;e<t;e++)!1!==r[e].active&&(n=r[e].geometryIndex,this.getMatrixAt(e,la),this.getBoundingSphereAt(n,ma).applyMatrix4(la),i.union(ma))}addInstance(e){if(this._drawInfo.length>=this._maxInstanceCount)throw new Error("BatchedMesh: Maximum item count reached.");this._drawInfo.push({visible:!0,active:!0,geometryIndex:e});var e=this._drawInfo.length-1,t=this._matricesTexture,n=t.image.data,n=(ca.toArray(n,16*e),t.needsUpdate=!0,this._colorsTexture);return n&&(ha.toArray(n.image.data,4*e),n.needsUpdate=!0),e}addGeometry(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1;if(this._initializeGeometry(e),this._validateGeometry(e),this._drawInfo.length>=this._maxInstanceCount)throw new Error("BatchedMesh: Maximum item count reached.");var i={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let r=null;var a=this._reservedRanges,o=this._drawRanges,s=this._bounds,t=(0!==this._geometryCount&&(r=a[a.length-1]),i.vertexCount=-1===t?e.getAttribute("position").count:t,null===r?i.vertexStart=0:i.vertexStart=r.vertexStart+r.vertexCount,e.getIndex()),l=null!==t;if(l&&(i.indexCount=-1===n?t.count:n,null===r?i.indexStart=0:i.indexStart=r.indexStart+r.indexCount),-1!==i.indexStart&&i.indexStart+i.indexCount>this._maxIndexCount||i.vertexStart+i.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");t=this._geometryCount;return this._geometryCount++,a.push(i),o.push({start:l?i.indexStart:i.vertexStart,count:-1}),s.push({boxInitialized:!1,box:new pd,sphereInitialized:!1,sphere:new aA}),this.setGeometryAt(t,e),t}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);var n=this.geometry,i=null!==n.getIndex(),r=n.getIndex(),a=t.getIndex(),o=this._reservedRanges[e];if(i&&a.count>o.indexCount||t.attributes.position.count>o.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");var s,l=o.vertexStart,u=o.vertexCount;for(s in n.attributes){var c=t.getAttribute(s),h=n.getAttribute(s),d=(!function(n,i,e){var r=2<arguments.length&&void 0!==e?e:0,a=i.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==i.array.constructor){var o=n.count;for(let t=0;t<o;t++)for(let e=0;e<a;e++)i.setComponent(t+r,e,n.getComponent(t,e))}else i.array.set(n.array,r*a);i.needsUpdate=!0}(c,h,l),c.itemSize);for(let e=c.count,t=u;e<t;e++){var p=l+e;for(let e=0;e<d;e++)h.setComponent(p,e,0)}h.needsUpdate=!0,h.addUpdateRange(l*d,u*d)}if(i){var f=o.indexStart;for(let e=0;e<a.count;e++)r.setX(f+e,l+a.getX(e));for(let e=a.count,t=o.indexCount;e<t;e++)r.setX(f+e,l);r.needsUpdate=!0,r.addUpdateRange(f,o.indexCount)}var o=this._bounds[e],o=(null!==t.boundingBox?(o.box.copy(t.boundingBox),o.boxInitialized=!0):o.boxInitialized=!1,null!==t.boundingSphere?(o.sphere.copy(t.boundingSphere),o.sphereInitialized=!0):o.sphereInitialized=!1,this._drawRanges[e]),m=t.getAttribute("position");return o.count=(i?a:m).count,this._visibilityChanged=!0,e}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;var n=this._bounds[e],i=n.box,r=this.geometry;if(!1===n.boxInitialized){i.makeEmpty();var a=r.index,o=r.attributes.position,r=this._drawRanges[e];for(let t=r.start,e=r.start+r.count;t<e;t++){let e=t;a&&(e=a.getX(e)),i.expandByPoint(ga.fromBufferAttribute(o,e))}n.boxInitialized=!0}return t.copy(i),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;var i=this._bounds[e],r=i.sphere,a=this.geometry;if(!1===i.sphereInitialized){r.makeEmpty(),this.getBoundingBoxAt(e,fa),fa.getCenter(r.center);var o=a.index,s=a.attributes.position,a=this._drawRanges[e];let n=0;for(let t=a.start,e=a.start+a.count;t<e;t++){let e=t;o&&(e=o.getX(e)),ga.fromBufferAttribute(s,e),n=Math.max(n,r.center.distanceToSquared(ga))}r.radius=Math.sqrt(n),i.sphereInitialized=!0}return t.copy(r),t}setMatrixAt(e,t){var n=this._drawInfo,i=this._matricesTexture,r=this._matricesTexture.image.data;return e>=n.length||!1===n[e].active||(t.toArray(r,16*e),i.needsUpdate=!0),this}getMatrixAt(e,t){var n=this._drawInfo,i=this._matricesTexture.image.data;return e>=n.length||!1===n[e].active?null:t.fromArray(i,16*e)}setColorAt(e,t){null===this._colorsTexture&&this._initColorsTexture();var n=this._colorsTexture,i=this._colorsTexture.image.data,r=this._drawInfo;return e>=r.length||!1===r[e].active||(t.toArray(i,4*e),n.needsUpdate=!0),this}getColorAt(e,t){var n=this._colorsTexture.image.data,i=this._drawInfo;return e>=i.length||!1===i[e].active?null:t.fromArray(n,4*e)}setVisibleAt(e,t){var n=this._drawInfo;return e>=n.length||!1===n[e].active||n[e].visible===t||(n[e].visible=t,this._visibilityChanged=!0),this}getVisibleAt(e){var t=this._drawInfo;return!(e>=t.length||!1===t[e].active)&&t[e].visible}raycast(t,i){var r=this._drawInfo,a=this._drawRanges,o=this.matrixWorld,e=this.geometry;d.material=this.material,d.geometry.index=e.index,d.geometry.attributes=e.attributes,null===d.geometry.boundingBox&&(d.geometry.boundingBox=new pd),null===d.geometry.boundingSphere&&(d.geometry.boundingSphere=new aA);for(let n=0,e=r.length;n<e;n++)if(r[n].visible&&r[n].active){var s=r[n].geometryIndex,l=a[s];d.geometry.setDrawRange(l.start,l.count),this.getMatrixAt(n,d.matrixWorld).premultiply(o),this.getBoundingBoxAt(s,d.geometry.boundingBox),this.getBoundingSphereAt(s,d.geometry.boundingSphere),d.raycast(t,Ea);for(let e=0,t=Ea.length;e<t;e++){var u=Ea[e];u.object=this,u.batchId=n,i.push(u)}Ea.length=0}d.material=null,d.geometry.index=null,d.geometry.attributes={},d.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(e=>({...e})),this._reservedRanges=e._reservedRanges.map(e=>({...e})),this._drawInfo=e._drawInfo.map(e=>({...e})),this._bounds=e._bounds.map(e=>({boxInitialized:e.boxInitialized,box:e.box.clone(),sphereInitialized:e.sphereInitialized,sphere:e.sphere.clone()})),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),(this._indirectTexture=null)!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(e,t,i,r,a){if(this._visibilityChanged||this.perObjectFrustumCulled||this.sortObjects){var r=r.getIndex(),o=null===r?1:r.array.BYTES_PER_ELEMENT,s=this._drawInfo,l=this._multiDrawStarts,u=this._multiDrawCounts,c=this._drawRanges,h=this.perObjectFrustumCulled,r=this._indirectTexture,d=r.image.data;h&&(da.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(this.matrixWorld),pa.setFromProjectionMatrix(da,e.coordinateSystem));let n=0;if(this.sortObjects){ua.copy(this.matrixWorld).invert(),ga.setFromMatrixPosition(i.matrixWorld).applyMatrix4(ua),va.set(0,0,-1).transformDirection(i.matrixWorld).transformDirection(ua);for(let t=0,e=s.length;t<e;t++)if(s[t].visible&&s[t].active){var p,f=s[t].geometryIndex;this.getMatrixAt(t,la),this.getBoundingSphereAt(f,ma).applyMatrix4(la);let e=!1;(e=h?!pa.intersectsSphere(ma):e)||(p=_a.subVectors(ma.center,ga).dot(va),ya.push(c[f],p,t))}var m=ya.list,e=this.customSort;null===e?m.sort(a.transparent?Ff:Bf):e.call(this,m,i);for(let e=0,t=m.length;e<t;e++){var g=m[e];l[n]=g.start*o,u[n]=g.count,d[n]=g.index,n++}ya.reset()}else for(let t=0,e=s.length;t<e;t++)if(s[t].visible&&s[t].active){var v=s[t].geometryIndex;let e=!1;h&&(this.getMatrixAt(t,la),this.getBoundingSphereAt(v,ma).applyMatrix4(la),e=!pa.intersectsSphere(ma)),e||(v=c[v],l[n]=v.start*o,u[n]=v.count,d[n]=t,n++)}r.needsUpdate=!0,this._multiDrawCount=n,this._visibilityChanged=!1}}onBeforeShadow(e,t,n,i,r,a){this.onBeforeRender(e,null,i,r,a)}}class XA extends uA{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new vd(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}let Aa=new dd,xa=new dd,Ta=new fd,Sa=new oA,wa=new aA,ba=new dd,Ma=new dd;class ZA extends gd{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Ad,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new XA;super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){var e=this.geometry;if(null===e.index){var n=e.attributes.position,i=[0];for(let e=1,t=n.count;e<t;e++)Aa.fromBufferAttribute(n,e-1),xa.fromBufferAttribute(n,e),i[e]=i[e-1],i[e]+=Aa.distanceTo(xa);e.setAttribute("lineDistance",new Ed(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(n,i){var r=this.geometry,a=this.matrixWorld,e=n.params.Line.threshold,t=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),wa.copy(r.boundingSphere),wa.applyMatrix4(a),wa.radius+=e,!1!==n.ray.intersectsSphere(wa)){Ta.copy(a).invert(),Sa.copy(n.ray).applyMatrix4(Ta);var a=e/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,s=this.isLineSegments?2:1,l=r.index,e=r.attributes.position;if(null!==l){var a=Math.max(0,t.start),r=Math.min(l.count,t.start+t.count);for(let e=a,t=r-1;e<t;e+=s){var u=l.getX(e),c=l.getX(e+1),u=zf(this,n,Sa,o,u,c);u&&i.push(u)}this.isLineLoop&&(r=l.getX(r-1),a=l.getX(a),r=zf(this,n,Sa,o,r,a))&&i.push(r)}else{a=Math.max(0,t.start),r=Math.min(e.count,t.start+t.count);for(let e=a,t=r-1;e<t;e+=s){var h=zf(this,n,Sa,o,e,e+1);h&&i.push(h)}this.isLineLoop&&(e=zf(this,n,Sa,o,r-1,a))&&i.push(e)}}}updateMorphTargets(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(0<t.length){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){var i=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}}function zf(e,t,n,i,r,a){var o=e.geometry.attributes.position,o=(Aa.fromBufferAttribute(o,r),xa.fromBufferAttribute(o,a),n.distanceSqToSegment(Aa,xa,ba,Ma));if(!(i<o)){ba.applyMatrix4(e.matrixWorld);a=t.ray.origin.distanceTo(ba);if(!(a<t.near||a>t.far))return{distance:a,point:Ma.clone().applyMatrix4(e.matrixWorld),index:r,face:null,faceIndex:null,object:e}}}let Ra=new dd,Na=new dd;class KA extends ZA{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){var e=this.geometry;if(null===e.index){var n=e.attributes.position,i=[];for(let e=0,t=n.count;e<t;e+=2)Ra.fromBufferAttribute(n,e),Na.fromBufferAttribute(n,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+Ra.distanceTo(Na);e.setAttribute("lineDistance",new Ed(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class JA extends ZA{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class QA extends uA{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new vd(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Ia=new fd,Ca=new oA,La=new aA,Da=new dd;class $A extends gd{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Ad,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new QA;super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(n,i){var e=this.geometry,r=this.matrixWorld,t=n.params.Points.threshold,a=e.drawRange;if(null===e.boundingSphere&&e.computeBoundingSphere(),La.copy(e.boundingSphere),La.applyMatrix4(r),La.radius+=t,!1!==n.ray.intersectsSphere(La)){Ia.copy(r).invert(),Ca.copy(n.ray).applyMatrix4(Ia);var t=t/((this.scale.x+this.scale.y+this.scale.z)/3),o=t*t,s=e.index,l=e.attributes.position;if(null!==s)for(let e=Math.max(0,a.start),t=Math.min(s.count,a.start+a.count);e<t;e++){var u=s.getX(e);Da.fromBufferAttribute(l,u),kf(Da,u,o,r,n,i,this)}else for(let e=Math.max(0,a.start),t=Math.min(l.count,a.start+a.count);e<t;e++)Da.fromBufferAttribute(l,e),kf(Da,e,o,r,n,i,this)}}updateMorphTargets(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(0<t.length){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){var i=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}}function kf(e,t,n,i,r,a,o){var s=Ca.distanceSqToPoint(e);s<n&&(n=new dd,Ca.closestPointToPoint(e,n),n.applyMatrix4(i),(e=r.ray.origin.distanceTo(n))<r.near||e>r.far||a.push({distance:e,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,object:o}))}(class extends eA{}),class extends eA{};class ex extends eA{constructor(e,t,n,i,r,a,o,s,l,u,c,h){super(null,a,o,s,l,u,i,r,c,h),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}ex,ex,class extends eA{};class tx{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){e=this.getUtoTmapping(e);return this.getPoint(e,t)}getPoints(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:5,n=[];for(let e=0;e<=t;e++)n.push(this.getPoint(e/t));return n}getSpacedPoints(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:5,n=[];for(let e=0;e<=t;e++)n.push(this.getPointAt(e/t));return n}getLength(){var e=this.getLengths();return e[e.length-1]}getLengths(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var n=[];let i,r=this.getPoint(0),a=0;n.push(0);for(let e=1;e<=t;e++)i=this.getPoint(e/t),a+=i.distanceTo(r),n.push(a),r=i;return this.cacheArcLengths=n}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){var n=this.getLengths();let i=0;var r=n.length;let a,o=(a=t||e*n[r-1],0),s=r-1,l;for(;o<=s;)if((l=n[i=Math.floor(o+(s-o)/2)]-a)<0)o=i+1;else{if(!(0<l)){s=i;break}s=i-1}return n[i=s]===a?i/(r-1):(t=n[i],e=n[i+1],e=(a-t)/(e-t),(i+e)/(r-1))}getTangent(e,t){let n=e-1e-4,i=e+1e-4;n<0&&(n=0),1<i&&(i=1);var e=this.getPoint(n),r=this.getPoint(i),t=t||new(e.isVector2?ld:dd);return t.copy(r).sub(e).normalize(),t}getTangentAt(e,t){e=this.getUtoTmapping(e);return this.getTangent(e,t)}computeFrenetFrames(n,e){var t=new dd,i=[],r=[],a=[],o=new dd,s=new fd;for(let e=0;e<=n;e++){var l=e/n;i[e]=this.getTangentAt(l,new dd)}r[0]=new dd,a[0]=new dd;let u=Number.MAX_VALUE;var c,h=Math.abs(i[0].x),d=Math.abs(i[0].y),p=Math.abs(i[0].z);h<=u&&(u=h,t.set(1,0,0)),d<=u&&(u=d,t.set(0,1,0)),p<=u&&t.set(0,0,1),o.crossVectors(i[0],t).normalize(),r[0].crossVectors(i[0],o),a[0].crossVectors(i[0],r[0]);for(let e=1;e<=n;e++)r[e]=r[e-1].clone(),a[e]=a[e-1].clone(),o.crossVectors(i[e-1],i[e]),o.length()>Number.EPSILON&&(o.normalize(),c=Math.acos(Pd(i[e-1].dot(i[e]),-1,1)),r[e].applyMatrix4(s.makeRotationAxis(o,c))),a[e].crossVectors(i[e],r[e]);if(!0===e){let t=Math.acos(Pd(r[0].dot(r[n]),-1,1));t/=n,0<i[0].dot(o.crossVectors(r[0],r[n]))&&(t=-t);for(let e=1;e<=n;e++)r[e].applyMatrix4(s.makeRotationAxis(i[e],t*e)),a[e].crossVectors(i[e],r[e])}return{tangents:i,normals:r,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){var e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class nx extends tx{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:2*Math.PI,o=6<arguments.length&&void 0!==arguments[6]&&arguments[6],s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:0;super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=a,this.aClockwise=o,this.aRotation=s}getPoint(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new ld,n=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;for(var r=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=r?0:n),!0!==this.aClockwise||r||(i===n?i=-n:i-=n);var a,o,r=this.aStartAngle+e*i;let s=this.aX+this.xRadius*Math.cos(r),l=this.aY+this.yRadius*Math.sin(r);return 0!==this.aRotation&&(e=Math.cos(this.aRotation),r=Math.sin(this.aRotation),a=s-this.aX,o=l-this.aY,s=a*e-o*r+this.aX,l=a*r+o*e+this.aY),t.set(s,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){var e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class ix extends nx{constructor(e,t,n,i,r,a){super(e,t,n,n,i,r,a),this.isArcCurve=!0,this.type="ArcCurve"}}function Gf(){let r=0,a=0,o=0,s=0;function l(e,t,n,i){r=e,a=n,o=-3*e+3*t-2*n-i,s=2*e-2*t+n+i}return{initCatmullRom:function(e,t,n,i,r){l(t,n,r*(n-e),r*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,r,a,o){e=(t-e)/r-(n-e)/(r+a)+(n-t)/a,r=(n-t)/a-(i-t)/(a+o)+(i-n)/o;l(t,n,e*=a,r*=a)},calc:function(e){var t=e*e,n=t*e;return r+a*e+o*t+s*n}}}let Oa=new dd,Pa=new Gf,Ua=new Gf,Ba=new Gf;class rx extends tx{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"centripetal",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.5;super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(i){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new dd,r=this.points,t=r.length,i=(t-(this.closed?0:1))*i;let n=Math.floor(i),a=i-n;this.closed?n+=0<n?0:(Math.floor(Math.abs(n)/t)+1)*t:0===a&&n===t-1&&(n=t-2,a=1);let o,s;o=this.closed||0<n?r[(n-1)%t]:(Oa.subVectors(r[0],r[1]).add(r[0]),Oa);var i=r[n%t],l=r[(n+1)%t];if(s=this.closed||n+2<t?r[(n+2)%t]:(Oa.subVectors(r[t-1],r[t-2]).add(r[t-1]),Oa),"centripetal"===this.curveType||"chordal"===this.curveType){r="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(i),r),t=Math.pow(i.distanceToSquared(l),r),n=Math.pow(l.distanceToSquared(s),r);t<1e-4&&(t=1),e<1e-4&&(e=t),n<1e-4&&(n=t),Pa.initNonuniformCatmullRom(o.x,i.x,l.x,s.x,e,t,n),Ua.initNonuniformCatmullRom(o.y,i.y,l.y,s.y,e,t,n),Ba.initNonuniformCatmullRom(o.z,i.z,l.z,s.z,e,t,n)}else"catmullrom"===this.curveType&&(Pa.initCatmullRom(o.x,i.x,l.x,s.x,this.tension),Ua.initCatmullRom(o.y,i.y,l.y,s.y,this.tension),Ba.initCatmullRom(o.z,i.z,l.z,s.z,this.tension));return e.set(Pa.calc(a),Ua.calc(a),Ba.calc(a)),e}copy(n){super.copy(n),this.points=[];for(let e=0,t=n.points.length;e<t;e++){var i=n.points[e];this.points.push(i.clone())}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this}toJSON(){var n=super.toJSON();n.points=[];for(let e=0,t=this.points.length;e<t;e++){var i=this.points[e];n.points.push(i.toArray())}return n.closed=this.closed,n.curveType=this.curveType,n.tension=this.tension,n}fromJSON(n){super.fromJSON(n),this.points=[];for(let e=0,t=n.points.length;e<t;e++){var i=n.points[e];this.points.push((new dd).fromArray(i))}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this}}function Hf(e,t,n,i,r){var t=.5*(i-t),r=.5*(r-n),a=e*e;return(2*n-2*i+t+r)*(e*a)+(-3*n+3*i-2*t-r)*a+t*e+n}function Vf(e,t,n,i){return(r=1-(r=e))*r*t+2*(1-e)*e*n+e*e*i;var r}function Wf(e,t,n,i,r){return(a=1-(a=e))*a*a*t+3*(a=1-e)*a*e*n+3*(1-e)*e*e*i+e*e*e*r;var a}class ax extends tx{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new ld,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new ld,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new ld,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new ld;super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new ld,n=this.v0,i=this.v1,r=this.v2,a=this.v3;return t.set(Wf(e,n.x,i.x,r.x,a.x),Wf(e,n.y,i.y,r.y,a.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){var e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class ox extends tx{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new dd,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new dd,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new dd,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new dd;super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new dd,n=this.v0,i=this.v1,r=this.v2,a=this.v3;return t.set(Wf(e,n.x,i.x,r.x,a.x),Wf(e,n.y,i.y,r.y,a.y),Wf(e,n.z,i.z,r.z,a.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){var e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class sx extends tx{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new ld,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new ld;super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new ld;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(1<arguments.length&&void 0!==arguments[1]?arguments[1]:new ld).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){var e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class lx extends tx{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new dd,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new dd;super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new dd;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(1<arguments.length&&void 0!==arguments[1]?arguments[1]:new dd).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){var e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ux extends tx{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new ld,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new ld,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new ld;super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new ld,n=this.v0,i=this.v1,r=this.v2;return t.set(Vf(e,n.x,i.x,r.x),Vf(e,n.y,i.y,r.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){var e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class cx extends tx{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new dd,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new dd,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new dd;super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new dd,n=this.v0,i=this.v1,r=this.v2;return t.set(Vf(e,n.x,i.x,r.x),Vf(e,n.y,i.y,r.y),Vf(e,n.z,i.z,r.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){var e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class hx extends tx{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new ld,n=this.points,e=(n.length-1)*e,i=Math.floor(e),e=e-i,r=n[0===i?i:i-1],a=n[i],o=n[i>n.length-2?n.length-1:i+1],n=n[i>n.length-3?n.length-1:i+2];return t.set(Hf(e,r.x,a.x,o.x,n.x),Hf(e,r.y,a.y,o.y,n.y)),t}copy(n){super.copy(n),this.points=[];for(let e=0,t=n.points.length;e<t;e++){var i=n.points[e];this.points.push(i.clone())}return this}toJSON(){var n=super.toJSON();n.points=[];for(let e=0,t=this.points.length;e<t;e++){var i=this.points[e];n.points.push(i.toArray())}return n}fromJSON(n){super.fromJSON(n),this.points=[];for(let e=0,t=n.points.length;e<t;e++){var i=n.points[e];this.points.push((new ld).fromArray(i))}return this}}var jf=Object.freeze({__proto__:null,ArcCurve:ix,CatmullRomCurve3:rx,CubicBezierCurve:ax,CubicBezierCurve3:ox,EllipseCurve:nx,LineCurve:sx,LineCurve3:lx,QuadraticBezierCurve:ux,QuadraticBezierCurve3:cx,SplineCurve:hx});class dx extends tx{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){var e,t=this.curves[0].getPoint(0),n=this.curves[this.curves.length-1].getPoint(1);return t.equals(n)||(e=!0===t.isVector2?"LineCurve":"LineCurve3",this.curves.push(new jf[e](n,t))),this}getPoint(e,t){var n,i,r,a=e*this.getLength(),o=this.getCurveLengths();let s=0;for(;s<o.length;){if(o[s]>=a)return n=o[s]-a,r=(i=this.curves[s]).getLength(),i.getPointAt(0===r?0:1-n/r,t);s++}return null}getLength(){var e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;var n=[];let i=0;for(let e=0,t=this.curves.length;e<t;e++)i+=this.curves[e].getLength(),n.push(i);return this.cacheLengths=n}getSpacedPoints(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:40,n=[];for(let e=0;e<=t;e++)n.push(this.getPoint(e/t));return this.autoClose&&n.push(n[0]),n}getPoints(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:12,i=[];let r;for(let e=0,t=this.curves;e<t.length;e++){var a=t[e],o=a.isEllipseCurve?2*n:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?n*a.points.length:n,s=a.getPoints(o);for(let e=0;e<s.length;e++){var l=s[e];r&&r.equals(l)||(i.push(l),r=l)}}return this.autoClose&&1<i.length&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(n){super.copy(n),this.curves=[];for(let e=0,t=n.curves.length;e<t;e++){var i=n.curves[e];this.curves.push(i.clone())}return this.autoClose=n.autoClose,this}toJSON(){var n=super.toJSON();n.autoClose=this.autoClose,n.curves=[];for(let e=0,t=this.curves.length;e<t;e++){var i=this.curves[e];n.curves.push(i.toJSON())}return n}fromJSON(n){super.fromJSON(n),this.autoClose=n.autoClose,this.curves=[];for(let e=0,t=n.curves.length;e<t;e++){var i=n.curves[e];this.curves.push((new jf[i.type]).fromJSON(i))}return this}}class px extends dx{constructor(e){super(),this.type="Path",this.currentPoint=new ld,e&&this.setFromPoints(e)}setFromPoints(n){this.moveTo(n[0].x,n[0].y);for(let e=1,t=n.length;e<t;e++)this.lineTo(n[e].x,n[e].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){var n=new sx(this.currentPoint.clone(),new ld(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){e=new ux(this.currentPoint.clone(),new ld(e,t),new ld(n,i));return this.curves.push(e),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,a){e=new ax(this.currentPoint.clone(),new ld(e,t),new ld(n,i),new ld(r,a));return this.curves.push(e),this.currentPoint.set(r,a),this}splineThru(e){var t=[this.currentPoint.clone()].concat(e),t=new hx(t);return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,i,r,a),this}absarc(e,t,n,i,r,a){return this.absellipse(e,t,n,n,i,r,a),this}ellipse(e,t,n,i,r,a,o,s){var l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,n,i,r,a,o,s),this}absellipse(e,t,n,i,r,a,o,s){e=new nx(e,t,n,i,r,a,o,s),0<this.curves.length&&((t=e.getPoint(0)).equals(this.currentPoint)||this.lineTo(t.x,t.y)),this.curves.push(e),n=e.getPoint(1);return this.currentPoint.copy(n),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){var e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class fx extends Ad{constructor(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[new ld(0,-.5),new ld(.5,0),new ld(0,.5)],i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:12,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:2*Math.PI,a=(super(),this.type="LatheGeometry",this.parameters={points:n,segments:i,phiStart:e,phiLength:r},i=Math.floor(i),r=Pd(r,0,2*Math.PI),[]),o=[],s=[],l=[],u=[],c=1/i,h=new dd,d=new ld,t=new dd,p=new dd,f=new dd;let m=0,g=0;for(let e=0;e<=n.length-1;e++)switch(e){case 0:m=n[e+1].x-n[e].x,g=n[e+1].y-n[e].y,t.x=+g,t.y=-m,t.z=0*g,f.copy(t),t.normalize(),l.push(t.x,t.y,t.z);break;case n.length-1:l.push(f.x,f.y,f.z);break;default:m=n[e+1].x-n[e].x,g=n[e+1].y-n[e].y,t.x=+g,t.y=-m,t.z=0*g,p.copy(t),t.x+=f.x,t.y+=f.y,t.z+=f.z,t.normalize(),l.push(t.x,t.y,t.z),f.copy(p)}for(let t=0;t<=i;t++){var v=e+t*c*r,_=Math.sin(v),y=Math.cos(v);for(let e=0;e<=n.length-1;e++){h.x=n[e].x*_,h.y=n[e].y,h.z=n[e].x*y,o.push(h.x,h.y,h.z),d.x=t/i,d.y=e/(n.length-1),s.push(d.x,d.y);var E=l[3*e+0]*_,A=l[3*e+1],x=l[3*e+0]*y;u.push(E,A,x)}}for(let t=0;t<i;t++)for(let e=0;e<n.length-1;e++){var T=e+t*n.length,S=T+n.length,w=T+n.length+1,b=T+1;a.push(T,S,b),a.push(w,b,S)}this.setIndex(a),this.setAttribute("position",new Ed(o,3)),this.setAttribute("uv",new Ed(s,2)),this.setAttribute("normal",new Ed(u,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fx(e.points,e.segments,e.phiStart,e.phiLength)}}class mx extends fx{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:4,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,r=new px;r.absarc(0,-t/2,e,1.5*Math.PI,0),r.absarc(0,t/2,e,0,.5*Math.PI),super(r.getPoints(n),i),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:n,radialSegments:i}}static fromJSON(e){return new mx(e.radius,e.length,e.capSegments,e.radialSegments)}}class gx extends Ad{constructor(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:32,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:2*Math.PI,t=(super(),this.type="CircleGeometry",this.parameters={radius:n,segments:i,thetaStart:r,thetaLength:a},i=Math.max(3,i),[]),o=[],s=[],l=[],u=new dd,c=new ld;o.push(0,0,0),s.push(0,0,1),l.push(.5,.5);for(let e=0,t=3;e<=i;e++,t+=3){var h=r+e/i*a;u.x=n*Math.cos(h),u.y=n*Math.sin(h),o.push(u.x,u.y,u.z),s.push(0,0,1),c.x=(o[t]/n+1)/2,c.y=(o[t+1]/n+1)/2,l.push(c.x,c.y)}for(let e=1;e<=i;e++)t.push(e,e+1,0);this.setIndex(t),this.setAttribute("position",new Ed(o,3)),this.setAttribute("normal",new Ed(s,3)),this.setAttribute("uv",new Ed(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new gx(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class vx extends Ad{constructor(){let p=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,f=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,m=3<arguments.length&&void 0!==arguments[3]?arguments[3]:32,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1;var e=5<arguments.length&&void 0!==arguments[5]&&arguments[5];let g=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,v=7<arguments.length&&void 0!==arguments[7]?arguments[7]:2*Math.PI,_=(super(),this.type="CylinderGeometry",this.parameters={radiusTop:p,radiusBottom:f,height:a,radialSegments:m,heightSegments:o,openEnded:e,thetaStart:g,thetaLength:v},this),y=(m=Math.floor(m),o=Math.floor(o),[]),E=[],A=[],x=[],T=0,s=[],S=a/2,w=0;{let t=new dd,n=new dd,i=0,r=(f-p)/a;for(let e=0;e<=o;e++){var l=[],u=e/o,c=u*(f-p)+p;for(let e=0;e<=m;e++){var h=e/m,d=h*v+g,b=Math.sin(d),d=Math.cos(d);n.x=c*b,n.y=-u*a+S,n.z=c*d,E.push(n.x,n.y,n.z),t.set(b,r,d).normalize(),A.push(t.x,t.y,t.z),x.push(h,1-u),l.push(T++)}s.push(l)}for(let t=0;t<m;t++)for(let e=0;e<o;e++){var M=s[e][t],R=s[e+1][t],N=s[e+1][t+1],I=s[e][t+1];y.push(M,R,I),y.push(R,N,I),i+=6}_.addGroup(w,i,0),w+=i}function t(t){var n=T,i=new ld,r=new dd;let a=0;var o=!0===t?p:f,s=!0===t?1:-1;for(let e=1;e<=m;e++)E.push(0,S*s,0),A.push(0,s,0),x.push(.5,.5),T++;var l=T;for(let e=0;e<=m;e++){var u=e/m*v+g,c=Math.cos(u),u=Math.sin(u);r.x=o*u,r.y=S*s,r.z=o*c,E.push(r.x,r.y,r.z),A.push(0,s,0),i.x=.5*c+.5,i.y=.5*u*s+.5,x.push(i.x,i.y),T++}for(let e=0;e<m;e++){var h=n+e,d=l+e;!0===t?y.push(d,d+1,h):y.push(d+1,d,h),a+=3}_.addGroup(w,a,!0===t?1:2),w+=a}!1===e&&(0<p&&t(!0),0<f)&&t(!1),this.setIndex(y),this.setAttribute("position",new Ed(E,3)),this.setAttribute("normal",new Ed(A,3)),this.setAttribute("uv",new Ed(x,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new vx(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class _x extends vx{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:32,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,r=4<arguments.length&&void 0!==arguments[4]&&arguments[4],a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:2*Math.PI;super(0,e,t,n,i,r,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:a,thetaLength:o}}static fromJSON(e){return new _x(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class yx extends Ad{constructor(){let n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:n,indices:t,radius:e,detail:i};let r=[],a=[];var P=i,o=new dd,s=new dd,l=new dd;for(let e=0;e<t.length;e+=3){D(t[e+0],o),D(t[e+1],s),D(t[e+2],l);{u=void 0;c=void 0;h=void 0;d=void 0;p=void 0;f=void 0;m=void 0;g=void 0;v=void 0;_=void 0;var u=o;var c=s;var h=l;var d=P;var p=d+1,f=[];for(let t=0;t<=p;t++){f[t]=[];var m=u.clone().lerp(h,t/p),g=c.clone().lerp(h,t/p),v=p-t;for(let e=0;e<=v;e++)0===e&&t===p?f[t][e]=m:f[t][e]=m.clone().lerp(g,e/v)}for(let t=0;t<p;t++)for(let e=0;e<2*(p-t)-1;e++){var _=Math.floor(e/2);e%2==0?(L(f[t][_+1]),L(f[t+1][_]),L(f[t][_])):(L(f[t][_+1]),L(f[t+1][_+1]),L(f[t+1][_]))}}}var U=e,y=new dd;for(let e=0;e<r.length;e+=3)y.x=r[e+0],y.y=r[e+1],y.z=r[e+2],y.normalize().multiplyScalar(U),r[e+0]=y.x,r[e+1]=y.y,r[e+2]=y.z;var E=new dd;for(let e=0;e<r.length;e+=3){E.x=r[e+0],E.y=r[e+1],E.z=r[e+2];var B=G(E)/2/Math.PI+.5,F=(e=>Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z)))(E)/Math.PI+.5;a.push(B,1-F)}var A=new dd,x=new dd,T=new dd,S=new dd,w=new ld,b=new ld,M=new ld;for(let e=0,t=0;e<r.length;e+=9,t+=6){A.set(r[e+0],r[e+1],r[e+2]),x.set(r[e+3],r[e+4],r[e+5]),T.set(r[e+6],r[e+7],r[e+8]),w.set(a[t+0],a[t+1]),b.set(a[t+2],a[t+3]),M.set(a[t+4],a[t+5]),S.copy(A).add(x).add(T).divideScalar(3);var R=G(S);O(w,t+0,A,R),O(b,t+2,x,R),O(M,t+4,T,R)}for(let e=0;e<a.length;e+=6){var N=a[e+0],I=a[e+2],C=a[e+4],z=Math.max(N,I,C),k=Math.min(N,I,C);.9<z&&k<.1&&(N<.2&&(a[e+0]+=1),I<.2&&(a[e+2]+=1),C<.2)&&(a[e+4]+=1)}function L(e){r.push(e.x,e.y,e.z)}function D(e,t){e*=3;t.x=n[0+e],t.y=n[1+e],t.z=n[2+e]}function O(e,t,n,i){i<0&&1===e.x&&(a[t]=e.x-1),0===n.x&&0===n.z&&(a[t]=i/2/Math.PI+.5)}function G(e){return Math.atan2(e.z,-e.x)}this.setAttribute("position",new Ed(r,3)),this.setAttribute("normal",new Ed(r.slice(),3)),this.setAttribute("uv",new Ed(a,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new yx(e.vertices,e.indices,e.radius,e.details)}}class Ex extends yx{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Ex(e.radius,e.detail)}}(class extends Ad{});class Ax extends px{constructor(e){super(e),this.uuid=Od(),this.type="Shape",this.holes=[]}getPointsHoles(n){var i=[];for(let e=0,t=this.holes.length;e<t;e++)i[e]=this.holes[e].getPoints(n);return i}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(n){super.copy(n),this.holes=[];for(let e=0,t=n.holes.length;e<t;e++){var i=n.holes[e];this.holes.push(i.clone())}return this}toJSON(){var n=super.toJSON();n.uuid=this.uuid,n.holes=[];for(let e=0,t=this.holes.length;e<t;e++){var i=this.holes[e];n.holes.push(i.toJSON())}return n}fromJSON(n){super.fromJSON(n),this.uuid=n.uuid,this.holes=[];for(let e=0,t=n.holes.length;e<t;e++){var i=n.holes[e];this.holes.push((new px).fromJSON(i))}return this}}let Fa={triangulate:function(s,l){var u=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2,c=l&&l.length,h=c?l[0]*u:s.length;let d=Yf(s,0,h,u,!0);var p=[];if(d&&d.next!==d.prev){let t,n,i,r,a,o,e;if(c&&(d=((e,t,n,i)=>{let r=[],a,o,s,l,u;for(a=0,o=t.length;a<o;a++)s=t[a]*i,l=a<o-1?t[a+1]*i:e.length,(u=Yf(e,s,l,i,!1))===u.next&&(u.steiner=!0),r.push((e=>{let t=e,n=e;for(;(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),(t=t.next)!==e;);return n})(u));for(r.sort(Zf),a=0;a<r.length;a++)n=((e,t)=>{var n=((e,t)=>{let n=t,i=-1/0,r,a=e.x,o=e.y;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=a&&s>i&&(i=s,r=n.x<n.next.x?n:n.next,s===a))return r}}while((n=n.next)!==t);if(!r)return null;let l=r,u=r.x,c=r.y,h=1/0,d;for(n=r;a>=n.x&&n.x>=u&&a!==n.x&&Jf(o<c?a:i,o,u,c,o<c?i:a,o,n.x,n.y)&&(d=Math.abs(o-n.y)/(a-n.x),im(n,e))&&(d<h||d===h&&(n.x>r.x||n.x===r.x&&((e,t)=>Qf(e.prev,e,t.prev)<0&&Qf(t.next,e,e.next)<0)(r,n)))&&(r=n,h=d),(n=n.next)!==l;);return r})(e,t);return n?(qf(t=rm(n,e),t.next),qf(n,n.next)):t})(r[a],n);return n})(s,l,d,u)),s.length>80*u){t=i=s[0],n=r=s[1];for(let e=u;e<h;e+=u)a=s[e],o=s[e+1],a<t&&(t=a),o<n&&(n=o),a>i&&(i=a),o>r&&(r=o);e=0!==(e=Math.max(i-t,r-n))?32767/e:0}Xf(d,p,u,t,n,e,0)}return p}};function Yf(e,t,n,i,r){let a,o;if(r===0<((n,i,r,a)=>{let o=0;for(let e=i,t=r-a;e<r;e+=a)o+=(n[t]-n[e])*(n[e+1]+n[t+1]),t=e;return o})(e,t,n,i))for(a=t;a<n;a+=i)o=am(a,e[a],e[a+1],o);else for(a=n-i;a>=t;a-=i)o=am(a,e[a],e[a+1],o);return o&&$f(o,o.next)&&(om(o),o=o.next),o}function qf(e,t){if(!e)return e;t=t||e;let n=e,i;do{if(i=!1,n.steiner||!$f(n,n.next)&&0!==Qf(n.prev,n,n.next))n=n.next;else{if(om(n),(n=t=n.prev)===n.next)break;i=!0}}while(i||n!==t);return t}function Xf(i,r,a,o,s,l,u){if(i){if(!u&&l){var c=i,h=o,d=s,p=l;let u=c;for(;0===u.z&&(u.z=Kf(u.x,u.y,h,d,p)),u.prevZ=u.prev,u.nextZ=u.next,(u=u.next)!==c;);u.prevZ.nextZ=null,u.prevZ=null;{var f=u;let e,t,n,i,r,a,o,s,l=1;do{for(t=f,f=null,r=null,a=0;t;){for(a++,n=t,o=0,e=0;e<l&&(o++,n=n.nextZ);e++);for(s=l;0<o||0<s&&n;)0!==o&&(0===s||!n||t.z<=n.z)?(t=(i=t).nextZ,o--):(n=(i=n).nextZ,s--),r?r.nextZ=i:f=i,i.prevZ=r,r=i;t=n}}while(r.nextZ=null,l*=2,1<a)}}let e=i,t,n;for(;i.prev!==i.next;)if(t=i.prev,n=i.next,l?((f,m,g,v)=>{var _=f.prev,y=f,E=f.next;if(!(0<=Qf(_,y,E))){let e=_.x,t=y.x,n=E.x,i=_.y,r=y.y,a=E.y,o=e<t?e<n?e:n:t<n?t:n,s=i<r?i<a?i:a:r<a?r:a,l=e>t?e>n?e:n:t>n?t:n,u=i>r?i>a?i:a:r>a?r:a,c=Kf(o,s,m,g,v),h=Kf(l,u,m,g,v),d=f.prevZ,p=f.nextZ;for(;d&&d.z>=c&&p&&p.z<=h;){if(d.x>=o&&d.x<=l&&d.y>=s&&d.y<=u&&d!==_&&d!==E&&Jf(e,i,t,r,n,a,d.x,d.y)&&0<=Qf(d.prev,d,d.next))return;if(d=d.prevZ,p.x>=o&&p.x<=l&&p.y>=s&&p.y<=u&&p!==_&&p!==E&&Jf(e,i,t,r,n,a,p.x,p.y)&&0<=Qf(p.prev,p,p.next))return;p=p.nextZ}for(;d&&d.z>=c;){if(d.x>=o&&d.x<=l&&d.y>=s&&d.y<=u&&d!==_&&d!==E&&Jf(e,i,t,r,n,a,d.x,d.y)&&0<=Qf(d.prev,d,d.next))return;d=d.prevZ}for(;p&&p.z<=h;){if(p.x>=o&&p.x<=l&&p.y>=s&&p.y<=u&&p!==_&&p!==E&&Jf(e,i,t,r,n,a,p.x,p.y)&&0<=Qf(p.prev,p,p.next))return;p=p.nextZ}return 1}})(i,o,s,l):(h=>{var d=h.prev,p=h,h=h.next;if(!(0<=Qf(d,p,h))){let e=d.x,t=p.x,n=h.x,i=d.y,r=p.y,a=h.y,o=e<t?e<n?e:n:t<n?t:n,s=i<r?i<a?i:a:r<a?r:a,l=e>t?e>n?e:n:t>n?t:n,u=i>r?i>a?i:a:r>a?r:a,c=h.next;for(;c!==d;){if(c.x>=o&&c.x<=l&&c.y>=s&&c.y<=u&&Jf(e,i,t,r,n,a,c.x,c.y)&&0<=Qf(c.prev,c,c.next))return;c=c.next}return 1}})(i))r.push(t.i/a|0),r.push(i.i/a|0),r.push(n.i/a|0),om(i),i=n.next,e=n.next;else if((i=n)===e){u?1===u?Xf(i=((e,t,n)=>{let i=e;do{var r=i.prev,a=i.next.next;!$f(r,a)&&em(r,i,i.next,a)&&im(r,a)&&im(a,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(a.i/n|0),om(i),om(i.next),i=e=a),i=i.next}while(i!==e);return qf(i)})(qf(i),r,a),r,a,o,s,l,2):2===u&&((e,t,n,i,r,a)=>{let o=e;do{let e=o.next.next;for(;e!==o.prev;){var s;if(o.i!==e.i&&((e,t)=>e.next.i!==t.i&&e.prev.i!==t.i&&!((e,t)=>{let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&em(n,n.next,e,t))return 1}while((n=n.next)!==e)})(e,t)&&(im(e,t)&&im(t,e)&&((e,t)=>{let n=e,i=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;for(;n.y>a!=n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),(n=n.next)!==e;);return i})(e,t)&&(Qf(e.prev,e,t.prev)||Qf(e,t.prev,t))||$f(e,t)&&0<Qf(e.prev,e,e.next)&&0<Qf(t.prev,t,t.next)))(o,e))return s=rm(o,e),o=qf(o,o.next),s=qf(s,s.next),Xf(o,t,n,i,r,a,0),Xf(s,t,n,i,r,a,0);e=e.next}}while((o=o.next)!==e)})(i,r,a,o,s,l):Xf(qf(i),r,a,o,s,l,1);break}}}function Zf(e,t){return e.x-t.x}function Kf(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Jf(e,t,n,i,r,a,o,s){return(e-o)*(a-s)<=(r-o)*(t-s)&&(n-o)*(t-s)<=(e-o)*(i-s)&&(r-o)*(i-s)<=(n-o)*(a-s)}function Qf(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function $f(e,t){return e.x===t.x&&e.y===t.y}function em(e,t,n,i){var r=nm(Qf(e,t,n)),a=nm(Qf(e,t,i)),o=nm(Qf(n,i,e)),s=nm(Qf(n,i,t));return r!==a&&o!==s||0===r&&tm(e,n,t)||0===a&&tm(e,i,t)||0===o&&tm(n,e,i)||!(0!==s||!tm(n,t,i))}function tm(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function nm(e){return 0<e?1:e<0?-1:0}function im(e,t){return Qf(e.prev,e,e.next)<0?0<=Qf(e,t,e.next)&&0<=Qf(e,e.prev,t):Qf(e,t,e.prev)<0||Qf(e,e.next,t)<0}function rm(e,t){var n=new sm(e.i,e.x,e.y),i=new sm(t.i,t.x,t.y),r=e.next,a=t.prev;return(e.next=t).prev=e,(n.next=r).prev=n,i.next=n,(a.next=n.prev=i).prev=a,i}function am(e,t,n,i){e=new sm(e,t,n);return i?(e.next=i.next,(e.prev=i).next.prev=e,i.next=e):(e.prev=e).next=e,e}function om(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function sm(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class xx{static area(n){var i=n.length;let r=0;for(let e=i-1,t=0;t<i;e=t++)r+=n[e].x*n[t].y-n[t].x*n[e].y;return.5*r}static isClockWise(e){return xx.area(e)<0}static triangulateShape(e,t){var n=[],i=[],r=[];lm(e),um(n,e);let a=e.length;t.forEach(lm);for(let e=0;e<t.length;e++)i.push(a),a+=t[e].length,um(n,t[e]);var o=Fa.triangulate(n,i);for(let e=0;e<o.length;e+=3)r.push(o.slice(e,e+3));return r}}function lm(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function um(t,n){for(let e=0;e<n.length;e++)t.push(n[e].x),t.push(n[e].y)}class Tx extends Ad{constructor(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Ax([new ld(.5,.5),new ld(-.5,.5),new ld(-.5,-.5),new ld(.5,-.5)]);let ae=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},oe=(super(),this.type="ExtrudeGeometry",this.parameters={shapes:n,options:ae},n=Array.isArray(n)?n:[n],this),se=[],le=[];for(let e=0,t=n.length;e<t;e++)(e=>{let i=[],U=void 0!==ae.curveSegments?ae.curveSegments:12,p=void 0!==ae.steps?ae.steps:1,r=void 0!==ae.depth?ae.depth:1,n=void 0===ae.bevelEnabled||ae.bevelEnabled,t=void 0!==ae.bevelThickness?ae.bevelThickness:.2,a=void 0!==ae.bevelSize?ae.bevelSize:t-.1,o=void 0!==ae.bevelOffset?ae.bevelOffset:0,f=void 0!==ae.bevelSegments?ae.bevelSegments:3,s=ae.extrudePath,B=void 0!==ae.UVGenerator?ae.UVGenerator:za,l,u=!1,c,h,d,m,F=(s&&(l=s.getSpacedPoints(p),u=!0,n=!1,c=s.computeFrenetFrames(p,!1),h=new dd,d=new dd,m=new dd),n||(f=0,t=0,a=0,o=0),e.extractPoints(U)),g=F.shape,v=F.holes,z=!xx.isClockWise(g);if(z){g=g.reverse();for(let e=0,t=v.length;e<t;e++){var k=v[e];xx.isClockWise(k)&&(v[e]=k.reverse())}}let _=xx.triangulateShape(g,v),y=g;for(let e=0,t=v.length;e<t;e++){var G=v[e];g=g.concat(G)}function E(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}let A=g.length,x=_.length;function H(e,t,n){let i,r,a;var o=e.x-t.x,s=e.y-t.y,l=n.x-e.x,u=n.y-e.y,c=o*o+s*s;if(Math.abs(o*u-s*l)>Number.EPSILON){var h=Math.sqrt(c),d=Math.sqrt(l*l+u*u),p=t.x-s/h,t=t.y+o/h,h=((n.x-u/d-p)*u-(n.y+l/d-t)*l)/(o*u-s*l),n=(i=p+o*h-e.x,r=t+s*h-e.y,i*i+r*r);if(n<=2)return new ld(i,r);a=Math.sqrt(n/2)}else{let e=!1;o>Number.EPSILON?l>Number.EPSILON&&(e=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(s)===Math.sign(u)&&(e=!0),a=e?(i=-s,r=o,Math.sqrt(c)):(i=o,r=s,Math.sqrt(c/2))}return new ld(i/a,r/a)}var T=[];for(let e=0,t=y.length,n=t-1,i=e+1;e<t;e++,n++,i++)n===t&&(n=0),i===t&&(i=0),T[e]=H(y[e],y[n],y[i]);let S=[],w,b=T.concat();for(let e=0,t=v.length;e<t;e++){var M=v[e];w=[];for(let e=0,t=M.length,n=t-1,i=e+1;e<t;e++,n++,i++)n===t&&(n=0),i===t&&(i=0),w[e]=H(M[e],M[n],M[i]);S.push(w),b=b.concat(w)}for(let e=0;e<f;e++){var V=e/f,W=t*Math.cos(V*Math.PI/2);let n=a*Math.sin(V*Math.PI/2)+o;for(let e=0,t=y.length;e<t;e++){var j=E(y[e],T[e],n);L(j.x,j.y,-W)}for(let e=0,t=v.length;e<t;e++){var Y=v[e];w=S[e];for(let e=0,t=Y.length;e<t;e++){var q=E(Y[e],w[e],n);L(q.x,q.y,-W)}}}let X=a+o;for(let e=0;e<A;e++){var R=n?E(g[e],b[e],X):g[e];u?(d.copy(c.normals[0]).multiplyScalar(R.x),h.copy(c.binormals[0]).multiplyScalar(R.y),m.copy(l[0]).add(d).add(h),L(m.x,m.y,m.z)):L(R.x,R.y,0)}for(let t=1;t<=p;t++)for(let e=0;e<A;e++){var N=n?E(g[e],b[e],X):g[e];u?(d.copy(c.normals[t]).multiplyScalar(N.x),h.copy(c.binormals[t]).multiplyScalar(N.y),m.copy(l[t]).add(d).add(h),L(m.x,m.y,m.z)):L(N.x,N.y,r/p*t)}for(let e=f-1;0<=e;e--){var Z=e/f,I=t*Math.cos(Z*Math.PI/2);let n=a*Math.sin(Z*Math.PI/2)+o;for(let e=0,t=y.length;e<t;e++){var K=E(y[e],T[e],n);L(K.x,K.y,r+I)}for(let e=0,t=v.length;e<t;e++){var J=v[e];w=S[e];for(let e=0,t=J.length;e<t;e++){var C=E(J[e],w[e],n);u?L(C.x,C.y+l[p-1].y,l[p-1].x+I):L(C.x,C.y,r+I)}}}function Q(e,i){let t=e.length;for(;0<=--t;){var r=t;let n=t-1;n<0&&(n=e.length-1);for(let e=0,t=p+2*f;e<t;e++){var a=A*e,o=A*(e+1),s=i+n+a,l=i+n+o,u=(d=h=c=u=void 0,i+r+a),c=s,h=l,d=i+r+o;O(u),O(c),O(d),O(c),O(h),O(d),u=se.length/3,P((c=B.generateSideWallUV(oe,se,u-6,u-3,u-2,u-1))[0]),P(c[1]),P(c[3]),P(c[1]),P(c[2]),P(c[3])}}}function L(e,t,n){i.push(e),i.push(t),i.push(n)}function D(e,t,n){O(e),O(t),O(n);e=se.length/3,t=B.generateTopUV(oe,se,e-3,e-2,e-1);P(t[0]),P(t[1]),P(t[2])}function O(e){se.push(i[3*e+0]),se.push(i[3*e+1]),se.push(i[3*e+2])}function P(e){le.push(e.x),le.push(e.y)}var $,e=se.length/3;if(n){let t=0*A;for(let e=0;e<x;e++){var ee=_[e];D(ee[2]+t,ee[1]+t,ee[0]+t)}$=p+2*f,t=A*$;for(let e=0;e<x;e++){var te=_[e];D(te[0]+t,te[1]+t,te[2]+t)}}else{for(let e=0;e<x;e++){var ne=_[e];D(ne[2],ne[1],ne[0])}for(let e=0;e<x;e++){var ie=_[e];D(ie[0]+A*p,ie[1]+A*p,ie[2]+A*p)}}oe.addGroup(e,se.length/3-e,0);{e=se.length/3;let n=0;Q(y,n),n+=y.length;for(let e=0,t=v.length;e<t;e++){var re=v[e];Q(re,n),n+=re.length}oe.addGroup(e,se.length/3-e,1)}})(n[e]);this.setAttribute("position",new Ed(se,3)),this.setAttribute("uv",new Ed(le,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){var e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options,i=t,t=n,r=e;if(r.shapes=[],Array.isArray(i))for(let e=0,t=i.length;e<t;e++){var a=i[e];r.shapes.push(a.uuid)}else r.shapes.push(i.uuid);return r.options=Object.assign({},t),void 0!==t.extrudePath&&(r.options.extrudePath=t.extrudePath.toJSON()),r}static fromJSON(n,i){var r=[];for(let e=0,t=n.shapes.length;e<t;e++){var a=i[n.shapes[e]];r.push(a)}var e=n.options.extrudePath;return void 0!==e&&(n.options.extrudePath=(new jf[e.type]).fromJSON(e)),new Tx(r,n.options)}}let za={generateTopUV:function(e,t,n,i,r){var a=t[3*n],n=t[3*n+1],o=t[3*i],i=t[3*i+1],s=t[3*r],t=t[3*r+1];return[new ld(a,n),new ld(o,i),new ld(s,t)]},generateSideWallUV:function(e,t,n,i,r,a){var o=t[3*n],s=t[3*n+1],n=t[3*n+2],l=t[3*i],u=t[3*i+1],i=t[3*i+2],c=t[3*r],h=t[3*r+1],r=t[3*r+2],d=t[3*a],p=t[3*a+1],t=t[3*a+2];return Math.abs(s-u)<Math.abs(o-l)?[new ld(o,1-n),new ld(l,1-i),new ld(c,1-r),new ld(d,1-t)]:[new ld(s,1-n),new ld(u,1-i),new ld(h,1-r),new ld(p,1-t)]}};class Sx extends yx{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Sx(e.radius,e.detail)}}class wx extends yx{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new wx(e.radius,e.detail)}}class bx extends Ad{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:.5,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:32,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:2*Math.PI,o=(super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:a},n=Math.max(3,n),[]),s=[],l=[],u=[];let c=e;var h=(t-e)/(i=Math.max(1,i)),d=new dd,p=new ld;for(let e=0;e<=i;e++){for(let e=0;e<=n;e++){var f=r+e/n*a;d.x=c*Math.cos(f),d.y=c*Math.sin(f),s.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,u.push(p.x,p.y)}c+=h}for(let e=0;e<i;e++){var m=e*(n+1);for(let e=0;e<n;e++){var g=e+m,v=g+n+1,_=g+n+2,y=g+1;o.push(g,v,y),o.push(v,_,y)}}this.setIndex(o),this.setAttribute("position",new Ed(s,3)),this.setAttribute("normal",new Ed(l,3)),this.setAttribute("uv",new Ed(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bx(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Mx extends Ad{constructor(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Ax([new ld(0,.5),new ld(-.5,-.5),new ld(.5,-.5)]);let d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:12,p=(super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:d},[]),f=[],m=[],g=[],n=0,v=0;if(!1===Array.isArray(t))i(t);else for(let e=0;e<t.length;e++)i(t[e]),this.addGroup(n,v,e),n+=v,v=0;function i(e){var n=f.length/3,e=e.extractPoints(d);let i=e.shape;var r=e.holes;!1===xx.isClockWise(i)&&(i=i.reverse());for(let e=0,t=r.length;e<t;e++){var a=r[e];!0===xx.isClockWise(a)&&(r[e]=a.reverse())}var o=xx.triangulateShape(i,r);for(let e=0,t=r.length;e<t;e++){var s=r[e];i=i.concat(s)}for(let e=0,t=i.length;e<t;e++){var l=i[e];f.push(l.x,l.y,0),m.push(0,0,1),g.push(l.x,l.y)}for(let e=0,t=o.length;e<t;e++){var u=o[e],c=u[0]+n,h=u[1]+n,u=u[2]+n;p.push(c,h,u),v+=3}}this.setIndex(p),this.setAttribute("position",new Ed(f,3)),this.setAttribute("normal",new Ed(m,3)),this.setAttribute("uv",new Ed(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){var e=super.toJSON(),n=this.parameters.shapes,i=e;if(i.shapes=[],Array.isArray(n))for(let e=0,t=n.length;e<t;e++){var r=n[e];i.shapes.push(r.uuid)}else i.shapes.push(n.uuid);return i}static fromJSON(n,i){var r=[];for(let e=0,t=n.shapes.length;e<t;e++){var a=i[n.shapes[e]];r.push(a)}return new Mx(r,n.curveSegments)}}class Rx extends Ad{constructor(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:32,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:16,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:2*Math.PI,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:Math.PI,u=(super(),this.type="SphereGeometry",this.parameters={radius:n,widthSegments:i,heightSegments:r,phiStart:a,phiLength:o,thetaStart:s,thetaLength:l},i=Math.max(3,Math.floor(i)),r=Math.max(2,Math.floor(r)),Math.min(s+l,Math.PI));let c=0;var h=[],d=new dd,p=new dd,f=[],m=[],g=[],v=[];for(let e=0;e<=r;e++){var _=[],y=e/r;let t=0;0===e&&0===s?t=.5/i:e===r&&u===Math.PI&&(t=-.5/i);for(let e=0;e<=i;e++){var E=e/i;d.x=-n*Math.cos(a+E*o)*Math.sin(s+y*l),d.y=n*Math.cos(s+y*l),d.z=n*Math.sin(a+E*o)*Math.sin(s+y*l),m.push(d.x,d.y,d.z),p.copy(d).normalize(),g.push(p.x,p.y,p.z),v.push(E+t,1-y),_.push(c++)}h.push(_)}for(let t=0;t<r;t++)for(let e=0;e<i;e++){var A=h[t][e+1],x=h[t][e],T=h[t+1][e],S=h[t+1][e+1];(0!==t||0<s)&&f.push(A,x,S),(t!==r-1||u<Math.PI)&&f.push(x,T,S)}this.setIndex(f),this.setAttribute("position",new Ed(m,3)),this.setAttribute("normal",new Ed(g,3)),this.setAttribute("uv",new Ed(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Rx(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Nx extends yx{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Nx(e.radius,e.detail)}}class Ix extends Ad{constructor(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.4,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:12,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:48,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:2*Math.PI,s=(super(),this.type="TorusGeometry",this.parameters={radius:n,tube:i,radialSegments:r,tubularSegments:a,arc:o},r=Math.floor(r),a=Math.floor(a),[]),l=[],u=[],c=[],h=new dd,d=new dd,p=new dd;for(let t=0;t<=r;t++)for(let e=0;e<=a;e++){var f=e/a*o,m=t/r*Math.PI*2;d.x=(n+i*Math.cos(m))*Math.cos(f),d.y=(n+i*Math.cos(m))*Math.sin(f),d.z=i*Math.sin(m),l.push(d.x,d.y,d.z),h.x=n*Math.cos(f),h.y=n*Math.sin(f),p.subVectors(d,h).normalize(),u.push(p.x,p.y,p.z),c.push(e/a),c.push(t/r)}for(let t=1;t<=r;t++)for(let e=1;e<=a;e++){var g=(a+1)*t+e-1,v=(a+1)*(t-1)+e-1,_=(a+1)*(t-1)+e,y=(a+1)*t+e;s.push(g,v,y),s.push(v,_,y)}this.setIndex(s),this.setAttribute("position",new Ed(l,3)),this.setAttribute("normal",new Ed(u,3)),this.setAttribute("uv",new Ed(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ix(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Cx extends Ad{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.4,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:64,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:2,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:3,s=(super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:n,tubularSegments:i,radialSegments:r,p:a,q:o},i=Math.floor(i),r=Math.floor(r),[]),l=[],u=[],c=[],h=new dd,d=new dd,p=new dd,f=new dd,m=new dd,g=new dd,v=new dd;for(let t=0;t<=i;++t){var _=t/i*a*Math.PI*2;w(_,a,o,e,p),w(.01+_,a,o,e,f),g.subVectors(f,p),v.addVectors(f,p),m.crossVectors(g,v),v.crossVectors(m,g),m.normalize(),v.normalize();for(let e=0;e<=r;++e){var y=e/r*Math.PI*2,E=-n*Math.cos(y),y=n*Math.sin(y);h.x=p.x+(E*v.x+y*m.x),h.y=p.y+(E*v.y+y*m.y),h.z=p.z+(E*v.z+y*m.z),l.push(h.x,h.y,h.z),d.subVectors(h,p).normalize(),u.push(d.x,d.y,d.z),c.push(t/i),c.push(e/r)}}for(let t=1;t<=i;t++)for(let e=1;e<=r;e++){var A=(r+1)*(t-1)+(e-1),x=(r+1)*t+(e-1),T=(r+1)*t+e,S=(r+1)*(t-1)+e;s.push(A,x,S),s.push(x,T,S)}function w(e,t,n,i,r){var a=Math.cos(e),o=Math.sin(e),n=n/t*e,t=Math.cos(n);r.x=i*(2+t)*.5*a,r.y=i*(2+t)*o*.5,r.z=i*Math.sin(n)*.5}this.setIndex(s),this.setAttribute("position",new Ed(l,3)),this.setAttribute("normal",new Ed(u,3)),this.setAttribute("uv",new Ed(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Cx(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Lx extends Ad{constructor(){let a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new cx(new dd(-1,-1,0),new dd(-1,1,0),new dd(1,1,0)),o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:64,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,e=4<arguments.length&&void 0!==arguments[4]&&arguments[4],u=(super(),this.type="TubeGeometry",this.parameters={path:a,tubularSegments:o,radius:s,radialSegments:l,closed:e},a.computeFrenetFrames(o,e)),c=(this.tangents=u.tangents,this.normals=u.normals,this.binormals=u.binormals,new dd),h=new dd,n=new ld,d=new dd,p=[],f=[],i=[],r=[];for(let e=0;e<o;e++)t(e);t(!1===e?o:0);for(let t=0;t<=o;t++)for(let e=0;e<=l;e++)n.x=t/o,n.y=e/l,i.push(n.x,n.y);for(let t=1;t<=o;t++)for(let e=1;e<=l;e++){var m=(l+1)*(t-1)+(e-1),g=(l+1)*t+(e-1),v=(l+1)*t+e,_=(l+1)*(t-1)+e;r.push(m,g,_),r.push(g,v,_)}function t(e){d=a.getPointAt(e/o,d);var t=u.normals[e],n=u.binormals[e];for(let e=0;e<=l;e++){var i=e/l*Math.PI*2,r=Math.sin(i),i=-Math.cos(i);h.x=i*t.x+r*n.x,h.y=i*t.y+r*n.y,h.z=i*t.z+r*n.z,h.normalize(),f.push(h.x,h.y,h.z),c.x=d.x+s*h.x,c.y=d.y+s*h.y,c.z=d.z+s*h.z,p.push(c.x,c.y,c.z)}}this.setIndex(r),this.setAttribute("position",new Ed(p,3)),this.setAttribute("normal",new Ed(f,3)),this.setAttribute("uv",new Ed(i,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){var e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Lx((new jf[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Dx extends Ad{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){var i=[],r=new Set,a=new dd,o=new dd;if(null!==e.index){var s=e.attributes.position,l=e.index;let n=e.groups;for(let e=0,t=(n=0===n.length?[{start:0,count:l.count,materialIndex:0}]:n).length;e<t;++e){var u=n[e],c=u.start;for(let t=c,e=c+u.count;t<e;t+=3)for(let e=0;e<3;e++){var h=l.getX(t+e),d=l.getX(t+(e+1)%3);a.fromBufferAttribute(s,h),o.fromBufferAttribute(s,d),!0===cm(a,o,r)&&(i.push(a.x,a.y,a.z),i.push(o.x,o.y,o.z))}}}else{var n=e.attributes.position;for(let t=0,e=n.count/3;t<e;t++)for(let e=0;e<3;e++){var p=3*t+e,f=3*t+(e+1)%3;a.fromBufferAttribute(n,p),o.fromBufferAttribute(n,f),!0===cm(a,o,r)&&(i.push(a.x,a.y,a.z),i.push(o.x,o.y,o.z))}}this.setAttribute("position",new Ed(i,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function cm(e,t,n){var i=`${e.x},${e.y},${e.z}-${t.x},${t.y},`+t.z,t=t.x+`,${t.y},${t.z}-${e.x},${e.y},`+e.z;return!0!==n.has(i)&&!0!==n.has(t)&&(n.add(i),n.add(t),!0)}dA,mx,gx,_x,vx,Ex,Tx,Sx,fx,wx,EA,yx,bx,Mx,Rx,Nx,Ix,Cx,Lx,Dx,class extends uA{},class extends Td{};class Ox extends uA{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new vd(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new vd(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Xt,this.normalScale=new ld(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new md,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Px extends Ox{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ld(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Pd(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new vd(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new vd(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new vd(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){0<this._anisotropy!=0<e&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){0<this._clearcoat!=0<e&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){0<this._iridescence!=0<e&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){0<this._dispersion!=0<e&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){0<this._sheen!=0<e&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){0<this._transmission!=0<e&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}function hm(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function dm(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function pm(n){var t=n.length,i=new Array(t);for(let e=0;e!==t;++e)i[e]=e;return i.sort(function(e,t){return n[e]-n[t]}),i}function fm(n,i,r){var a=n.length,o=new n.constructor(a);for(let e=0,t=0;t!==a;++e){var s=r[e]*i;for(let e=0;e!==i;++e)o[t++]=n[s+e]}return o}function mm(t,n,i,r){let a=1,o=t[0];for(;void 0!==o&&void 0===o[r];)o=t[a++];if(void 0!==o){let e=o[r];if(void 0!==e)if(Array.isArray(e))for(;void 0!==(e=o[r])&&(n.push(o.time),i.push.apply(i,e)),void 0!==(o=t[a++]););else if(void 0!==e.toArray)for(;void 0!==(e=o[r])&&(n.push(o.time),e.toArray(i,i.length)),void 0!==(o=t[a++]););else for(;void 0!==(e=o[r])&&(n.push(o.time),i.push(e)),void 0!==(o=t[a++]););}}(class extends uA{}),class extends uA{},class extends uA{},class extends uA{},class extends uA{},class extends XA{};class Ux{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){var n=this.parameterPositions;let i=this._cachedIndex,r=n[i],a=n[i-1];e:{t:{let e;n:{i:if(!(t<r)){for(var o=i+2;;){if(void 0===r){if(t<a)break i;return i=n.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===o)break;if(a=r,t<(r=n[++i]))break t}e=n.length;break n}if(t>=a)break e;var s=n[1];t<s&&(i=2,a=s);for(var l=i-2;;){if(void 0===a)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(r=a,t>=(a=n[--i-1]))break t}e=i,i=0}for(;i<e;){var u=i+e>>>1;t<n[u]?e=u:i=1+u}if(r=n[i],void 0===(a=n[i-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return i=n.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,a,r)}return this.interpolate_(i,a,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let e=0;e!==i;++e)t[e]=n[r+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Bx extends Ux{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,n){var i=this.parameterPositions;let r=e-2,a=e+1,o=i[r],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:r=e,o=2*t-n;break;case 2402:r=i.length-2,o=t+i[r]-i[r+1];break;default:r=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:a=e,s=2*n-t;break;case 2402:a=1,s=n+i[1]-i[0];break;default:a=e-1,s=t}var l=.5*(n-t),u=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-n),this._offsetPrev=r*u,this._offsetNext=a*u}interpolate_(e,t,n,i){var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=this._offsetPrev,c=this._offsetNext,e=this._weightPrev,h=this._weightNext,n=(n-t)/(i-t),i=n*n,t=i*n,d=-e*t+2*e*i-e*n,p=(1+e)*t+(-1.5-2*e)*i+(-.5+e)*n+1,f=(-1-h)*t+(1.5+h)*i+.5*n,m=h*t-h*i;for(let e=0;e!==o;++e)r[e]=d*a[u+e]+p*a[l+e]+f*a[s+e]+m*a[c+e];return r}}class Fx extends Ux{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=(n-t)/(i-t),c=1-u;for(let e=0;e!==o;++e)r[e]=a[l+e]*c+a[s+e]*u;return r}}class zx extends Ux{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class kx{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=hm(t,this.TimeBufferType),this.values=hm(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){var t=e.constructor;let n;return t.toJSON!==this.toJSON?n=t.toJSON(e):(n={name:e.name,times:hm(e.times,Array),values:hm(e.values,Array)},(t=e.getInterpolation())!==e.DefaultInterpolation&&(n.interpolation=t)),n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new zx(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Fx(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Bx(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}console.warn("THREE.KeyframeTrack:",n)}else this.createInterpolant=t;return this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(n){if(0!==n){var i=this.times;for(let e=0,t=i.length;e!==t;++e)i[e]+=n}return this}scale(n){if(1!==n){var i=this.times;for(let e=0,t=i.length;e!==t;++e)i[e]*=n}return this}trim(e,t){var n,i=this.times,r=i.length;let a=0,o=r-1;for(;a!==r&&i[a]<e;)++a;for(;-1!==o&&i[o]>t;)--o;return++o,0===a&&o===r||(a>=o&&(o=Math.max(o,1),a=o-1),n=this.getValueSize(),this.times=i.slice(a,o),this.values=this.values.slice(a*n,o*n)),this}validate(){let n=!0;var e=this.getValueSize(),t=(e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),n=!1),this.times),i=this.values,r=t.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),n=!1);let a=null;for(let e=0;e!==r;e++){var o=t[e];if("number"==typeof o&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,o),n=!1;break}if(null!==a&&a>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,o,a),n=!1;break}a=o}if(void 0!==i&&dm(i))for(let e=0,t=i.length;e!==t;++e){var s=i[e];if(isNaN(s)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,s),n=!1;break}}return n}optimize(){var n=this.times.slice(),i=this.values.slice(),r=this.getValueSize(),a=2302===this.getInterpolation(),o=n.length-1;let s=1;for(let e=1;e<o;++e){let t=!1;var l=n[e];if(l!==n[e+1]&&(1!==e||l!==n[0]))if(a)t=!0;else{var u=e*r,c=u-r,h=u+r;for(let e=0;e!==r;++e){var d=i[u+e];if(d!==i[c+e]||d!==i[h+e]){t=!0;break}}}if(t){if(e!==s){n[s]=n[e];var p=e*r,f=s*r;for(let e=0;e!==r;++e)i[f+e]=i[p+e]}++s}}if(0<o){n[s]=n[o];for(let e=o*r,t=s*r,n=0;n!==r;++n)i[t+n]=i[e+n];++s}return s!==n.length?(this.times=n.slice(0,s),this.values=i.slice(0,s*r)):(this.times=n,this.values=i),this}clone(){var e=this.times.slice(),t=this.values.slice(),e=new this.constructor(this.name,e,t);return e.createInterpolant=this.createInterpolant,e}}kx.prototype.TimeBufferType=Float32Array,kx.prototype.ValueBufferType=Float32Array,kx.prototype.DefaultInterpolation=2301;class Gx extends kx{constructor(e,t,n){super(e,t,n)}}Gx.prototype.ValueTypeName="bool",Gx.prototype.ValueBufferType=Array,Gx.prototype.DefaultInterpolation=2300,Gx.prototype.InterpolantFactoryMethodLinear=void 0,Gx.prototype.InterpolantFactoryMethodSmooth=void 0;class Hx extends kx{}Hx.prototype.ValueTypeName="color";class Vx extends kx{}Vx.prototype.ValueTypeName="number";class Wx extends Ux{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(i-t);let l=e*o;for(var u=l+o;l!==u;l+=4)hd.slerpFlat(r,0,a,l-o,a,l,s);return r}}class jx extends kx{InterpolantFactoryMethodLinear(e){return new Wx(this.times,this.values,this.getValueSize(),e)}}jx.prototype.ValueTypeName="quaternion",jx.prototype.InterpolantFactoryMethodSmooth=void 0;class Yx extends kx{constructor(e,t,n){super(e,t,n)}}Yx.prototype.ValueTypeName="string",Yx.prototype.ValueBufferType=Array,Yx.prototype.DefaultInterpolation=2300,Yx.prototype.InterpolantFactoryMethodLinear=void 0,Yx.prototype.InterpolantFactoryMethodSmooth=void 0;class qx extends kx{}class Xx{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:2500;this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Od(),this.duration<0&&this.resetDuration()}static parse(e){var n=[],i=e.tracks,r=1/(e.fps||1);for(let e=0,t=i.length;e!==t;++e)n.push((e=>{if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t,n,i=(e=>{switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Vx;case"vector":case"vector2":case"vector3":case"vector4":return qx;case"color":return Hx;case"quaternion":return jx;case"bool":case"boolean":return Gx;case"string":return Yx}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)})(e.type);return void 0===e.times&&(mm(e.keys,t=[],n=[],"value"),e.times=t,e.values=n),void 0!==i.parse?i.parse(e):new i(e.name,e.times,e.values,e.interpolation)})(i[e]).scale(r));var t=new this(e.name,e.duration,n,e.blendMode);return t.uuid=e.uuid,t}static toJSON(e){var n=[],i=e.tracks,e={name:e.name,duration:e.duration,tracks:n,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,t=i.length;e!==t;++e)n.push(kx.toJSON(i[e]));return e}static CreateFromMorphTargetSequence(e,i,r,a){var o=i.length,s=[];for(let n=0;n<o;n++){let e=[],t=[];e.push((n+o-1)%o,n,(n+1)%o),t.push(0,1,0);var l=pm(e);e=fm(e,1,l),t=fm(t,1,l),a||0!==e[0]||(e.push(o),t.push(t[0])),s.push(new Vx(".morphTargetInfluences["+i[n].name+"]",e,t).scale(1/r))}return new this(e,-1,s)}static findByName(e,t){let n=e;Array.isArray(e)||(n=e.geometry&&e.geometry.animations||e.animations);for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(n,e,t){var i={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,t=n.length;e<t;e++){var a=n[e],o=a.name.match(r);if(o&&1<o.length){o=o[1];let e=i[o];e||(i[o]=e=[]),e.push(a)}}var s,l=[];for(s in i)l.push(this.CreateFromMorphTargetSequence(s,i[s],e,t));return l}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;function n(e,t,n,i,r){var a;0!==n.length&&(mm(n,n=[],a=[],i),0!==n.length)&&r.push(new e(t,n,a))}var i=[],r=e.name||"default",a=e.fps||30,o=e.blendMode;let s=e.length||-1;var l=e.hierarchy||[];for(let e=0;e<l.length;e++){var u=l[e].keys;if(u&&0!==u.length)if(u[0].morphTargets){var c,h={};let t;for(t=0;t<u.length;t++)if(u[t].morphTargets)for(let e=0;e<u[t].morphTargets.length;e++)h[u[t].morphTargets[e]]=-1;for(c in h){var d=[],p=[];for(let e=0;e!==u[t].morphTargets.length;++e){var f=u[t];d.push(f.time),p.push(f.morphTarget===c?1:0)}i.push(new Vx(".morphTargetInfluence["+c+"]",d,p))}s=h.length*a}else{var m=".bones["+t[e].name+"]";n(qx,m+".position",u,"pos",i),n(jx,m+".quaternion",u,"rot",i),n(qx,m+".scale",u,"scl",i)}}return 0===i.length?null:new this(r,s,i,o)}resetDuration(){let n=0;for(let e=0,t=this.tracks.length;e!==t;++e){var i=this.tracks[e];n=Math.max(n,i.times[i.times.length-1])}return this.duration=n,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){var t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}let ka={enabled:!(qx.prototype.ValueTypeName="vector"),files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Zx{constructor(e,t,n){let i=this,r=!1,a=0,o=0,s=void 0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===r&&void 0!==i.onStart&&i.onStart(e,a,o),r=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,o),a===o&&(r=!1,void 0!==i.onLoad)&&i.onLoad()},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){e=l.indexOf(e);return-1!==e&&l.splice(e,2),this},this.getHandler=function(n){for(let e=0,t=l.length;e<t;e+=2){var i=l[e],r=l[e+1];if(i.global&&(i.lastIndex=0),i.test(n))return r}return null}}}let Ga=new Zx;class Kx{constructor(e){this.manager=void 0!==e?e:Ga,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(n,i){let r=this;return new Promise(function(e,t){r.load(n,e,i,t)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Kx.DEFAULT_MATERIAL_NAME="__DEFAULT";let Ha={};class Jx extends Error{constructor(e,t){super(e),this.response=t}}class Qx extends Kx{constructor(e){super(e)}load(a,e,n,r){void 0===a&&(a=""),void 0!==this.path&&(a=this.path+a),a=this.manager.resolveURL(a);let t=ka.get(a);if(void 0!==t)return this.manager.itemStart(a),setTimeout(()=>{e&&e(t),this.manager.itemEnd(a)},0),t;if(void 0!==Ha[a])Ha[a].push({onLoad:e,onProgress:n,onError:r});else{Ha[a]=[],Ha[a].push({onLoad:e,onProgress:n,onError:r});n=new Request(a,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});let i=this.mimeType,t=this.responseType;fetch(n).then(t=>{if(200!==t.status&&0!==t.status)throw new Jx(`fetch for "${t.url}" responded with ${t.status}: `+t.statusText,t);{if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;let o=Ha[a],e=t.body.getReader();t=t.headers.get("X-File-Size")||t.headers.get("Content-Length");let s=t?parseInt(t):0,l=0!==s,u=0;t=new ReadableStream({start(a){!function r(){e.read().then(e=>{let{done:t,value:i}=e;if(t)a.close();else{u+=i.byteLength;let n=new ProgressEvent("progress",{lengthComputable:l,loaded:u,total:s});for(let t=0,e=o.length;t<e;t++){let e=o[t];e.onProgress&&e.onProgress(n)}a.enqueue(i),r()}},e=>{a.error(e)})}()}});return new Response(t)}}).then(e=>{switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>(new DOMParser).parseFromString(e,i));case"json":return e.json();default:if(void 0===i)return e.text();{var n=/charset="?([^;"\s]*)"?/i.exec(i),n=n&&n[1]?n[1].toLowerCase():void 0;let t=new TextDecoder(n);return e.arrayBuffer().then(e=>t.decode(e))}}}).then(n=>{ka.add(a,n);var i=Ha[a];delete Ha[a];for(let e=0,t=i.length;e<t;e++){var r=i[e];r.onLoad&&r.onLoad(n)}}).catch(n=>{var i=Ha[a];if(void 0===i)throw this.manager.itemError(a),n;delete Ha[a];for(let e=0,t=i.length;e<t;e++){var r=i[e];r.onError&&r.onError(n)}this.manager.itemError(a)}).finally(()=>{this.manager.itemEnd(a)}),this.manager.itemStart(a)}}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}(class extends Kx{}),class extends Kx{};class $x extends Kx{constructor(e){super(e)}load(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);let r=this,a=ka.get(t);if(void 0!==a)return r.manager.itemStart(t),setTimeout(function(){e&&e(a),r.manager.itemEnd(t)},0),a;let o=kd("img");function s(){u(),ka.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){u(),i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}function u(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(t),o.src=t,o}}(class extends Kx{}),class extends Kx{};class wd extends Kx{constructor(e){super(e)}load(e,t,n,i){let r=new eA;var a=new $x(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)},n,i),r}}class eT extends gd{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new vd(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){e=super.toJSON(e);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(e.object.target=this.target.uuid),e}}let Va=new fd,Wa=new dd,ja=new dd;class tT{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ld(512,512),this.map=null,this.mapPass=null,this.matrix=new fd,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new yA,this._frameExtents=new ld(1,1),this._viewportCount=1,this._viewports=[new cd(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){var t=this.camera,n=this.matrix;Wa.setFromMatrixPosition(e.matrixWorld),t.position.copy(Wa),ja.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(ja),t.updateMatrixWorld(),Va.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Va),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Va)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){var e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class nT extends tT{constructor(){super(new fA(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){var t=this.camera,n=2*pn*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class iT extends eT{constructor(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:Math.PI/3,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:2;super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(gd.DEFAULT_UP),this.updateMatrix(),this.target=new gd,this.distance=n,this.angle=i,this.penumbra=r,this.decay=a,this.map=null,this.shadow=new nT}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}let Ya=new fd,qa=new dd,Xa=new dd;class rT extends tT{constructor(){super(new fA(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ld(4,2),this._viewportCount=6,this._viewports=[new cd(2,1,1,1),new cd(0,1,1,1),new cd(3,1,1,1),new cd(1,1,1,1),new cd(3,0,1,1),new cd(1,0,1,1)],this._cubeDirections=[new dd(1,0,0),new dd(-1,0,0),new dd(0,0,1),new dd(0,0,-1),new dd(0,1,0),new dd(0,-1,0)],this._cubeUps=[new dd(0,1,0),new dd(0,1,0),new dd(0,1,0),new dd(0,1,0),new dd(0,0,1),new dd(0,0,-1)]}updateMatrices(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),qa.setFromMatrixPosition(e.matrixWorld),n.position.copy(qa),Xa.copy(n.position),Xa.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Xa),n.updateMatrixWorld(),i.makeTranslation(-qa.x,-qa.y,-qa.z),Ya.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ya)}}class aT extends eT{constructor(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:2;super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new rT}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class oT extends tT{constructor(){super(new AA(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class sT extends eT{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(gd.DEFAULT_UP),this.updateMatrix(),this.target=new gd,this.shadow=new oT}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class lT extends eT{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}(class extends Kx{});class uT{static decodeText(n){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),"undefined"!=typeof TextDecoder)return(new TextDecoder).decode(n);let i="";for(let e=0,t=n.length;e<t;e++)i+=String.fromCharCode(n[e]);try{return decodeURIComponent(escape(i))}catch(e){return i}}static extractUrlBase(e){var t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}(class extends Ad{}),class extends Kx{},class extends Kx{},G,De,E,A,Oe,H,Pe,Ue,V,e,Be,W,Fe,Ve;class cT extends Kx{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(t,n,e,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);let r=this,a=ka.get(t);if(void 0!==a)return r.manager.itemStart(t),a.then?void a.then(e=>{n&&n(e),r.manager.itemEnd(t)}).catch(e=>{i&&i(e)}):(setTimeout(function(){n&&n(a),r.manager.itemEnd(t)},0),a);var o={},o=(o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(e){return ka.add(t,e),n&&n(e),r.manager.itemEnd(t),e}).catch(function(e){i&&i(e),ka.remove(t),r.manager.itemError(t),r.manager.itemEnd(t)}));ka.add(t,o),r.manager.itemStart(t)}}let Za;class hT{static getContext(){return Za=void 0===Za?new(window.AudioContext||window.webkitAudioContext):Za}static setContext(e){Za=e}}(class extends Kx{});class dT{constructor(){this.autoStart=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=gm(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;var t;return this.autoStart&&!this.running?(this.start(),0):(this.running&&(t=gm(),e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e),e)}}function gm(){return("undefined"==typeof performance?Date:performance).now()}let Ka=new dd,Ja=new hd,Qa=new dd,$a=new dd;class pT extends gd{constructor(){super(),this.type="AudioListener",this.context=hT.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new dT}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return(null!==this.filter?(this.gain.disconnect(this.filter),this.filter):this.gain).disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);var t,e=this.context.listener,n=this.up;this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Ka,Ja,Qa),$a.set(0,0,-1).applyQuaternion(Ja),e.positionX?(t=this.context.currentTime+this.timeDelta,e.positionX.linearRampToValueAtTime(Ka.x,t),e.positionY.linearRampToValueAtTime(Ka.y,t),e.positionZ.linearRampToValueAtTime(Ka.z,t),e.forwardX.linearRampToValueAtTime($a.x,t),e.forwardY.linearRampToValueAtTime($a.y,t),e.forwardZ.linearRampToValueAtTime($a.z,t),e.upX.linearRampToValueAtTime(n.x,t),e.upY.linearRampToValueAtTime(n.y,t),e.upZ.linearRampToValueAtTime(n.z,t)):(e.setPosition(Ka.x,Ka.y,Ka.z),e.setOrientation($a.x,$a.y,$a.z,n.x,n.y,n.z))}}class fT extends gd{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else{if(!1!==this.hasPlaybackControl)return this._startedAt=this.context.currentTime+e,(e=this.context.createBufferSource()).buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect();console.warn("THREE.Audio: this Audio has no playback control.")}}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e=e||[],!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}let eo=new dd,to=new hd,no=new dd,io=new dd;class mT extends fT{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){var t;super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying||(this.matrixWorld.decompose(eo,to,no),io.set(0,0,1).applyQuaternion(to),(e=this.panner).positionX?(t=this.context.currentTime+this.listener.timeDelta,e.positionX.linearRampToValueAtTime(eo.x,t),e.positionY.linearRampToValueAtTime(eo.y,t),e.positionZ.linearRampToValueAtTime(eo.z,t),e.orientationX.linearRampToValueAtTime(io.x,t),e.orientationY.linearRampToValueAtTime(io.y,t),e.orientationZ.linearRampToValueAtTime(io.z,t)):(e.setPosition(eo.x,eo.y,eo.z),e.setOrientation(io.x,io.y,io.z)))}}class gT{constructor(e,t,n){this.binding=e,this.valueSize=n;let i,r,a;switch(t){case"quaternion":i=this._slerp,r=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){var n=this.buffer,i=this.valueSize,r=e*i+i;let a=this.cumulativeWeight;if(0===a){for(let e=0;e!==i;++e)n[r+e]=n[e];a=t}else{e=t/(a+=t);this._mixBufferRegion(n,r,0,e,i)}this.cumulativeWeight=a}accumulateAdditive(e){var t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){var t,n=this.valueSize,i=this.buffer,r=e*n+n,e=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,e<1&&(t=n*this._origIndex,this._mixBufferRegion(i,r,t,1-e,n)),0<a&&this._mixBufferRegionAdditive(i,r,this._addIndex*n,1,n);for(let e=n,t=n+n;e!==t;++e)if(i[e]!==i[e+n]){o.setValue(i,r);break}}saveOriginalState(){var e=this.binding,n=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(n,r);for(let e=i,t=r;e!==t;++e)n[e]=n[r+e%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){var t=this._addIndex*this.valueSize,n=t+this.valueSize;for(let e=t;e<n;e++)this.buffer[e]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){var t=this._origIndex*this.valueSize,n=this._addIndex*this.valueSize;for(let e=0;e<this.valueSize;e++)this.buffer[n+e]=this.buffer[t+e]}_select(t,n,i,e,r){if(.5<=e)for(let e=0;e!==r;++e)t[n+e]=t[i+e]}_slerp(e,t,n,i){hd.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){r=this._workIndex*r;hd.multiplyQuaternionsFlat(e,r,e,t,e,n),hd.slerpFlat(e,t,e,t,e,r,i)}_lerp(t,n,i,r,a){var o=1-r;for(let e=0;e!==a;++e){var s=n+e;t[s]=t[s]*o+t[i+e]*r}}_lerpAdditive(t,n,i,r,a){for(let e=0;e!==a;++e){var o=n+e;t[o]=t[o]+t[i+e]*r}}}Qh="\\[\\]\\.:\\/";let ro=new RegExp("["+Qh+"]","g"),ao=($h="[^"+Qh+"]",Qh="[^"+Qh.replace("\\.","")+"]",new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",$h)+/(WCOD+)?/.source.replace("WCOD",Qh)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",$h)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",$h)+"$")),oo=["material","materials","bones","map"];class bd{constructor(e,t,n){this.path=t,this.parsedPath=n||bd.parseTrackName(t),this.node=bd.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return new(e&&e.isAnimationObjectGroup?bd.Composite:bd)(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(ro,"")}static parseTrackName(e){var t=ao.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n,t={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=t.nodeName&&t.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i&&(n=t.nodeName.substring(i+1),-1!==oo.indexOf(n))&&(t.nodeName=t.nodeName.substring(0,i),t.objectName=n),null===t.propertyName||0===t.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return t}static findNode(e,r){if(void 0===r||""===r||"."===r||-1===r||r===e.name||r===e.uuid)return e;if(e.skeleton){var t=e.skeleton.getBoneByName(r);if(void 0!==t)return t}if(e.children){let i=function(t){for(let e=0;e<t.length;e++){var n=t[e];if(n.name===r||n.uuid===r)return n;n=i(n.children);if(n)return n}return null};t=i(e.children);if(t)return t}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(n,i){var r=this.resolvedProperty;for(let e=0,t=r.length;e!==t;++e)n[i++]=r[e]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(n,i){var r=this.resolvedProperty;for(let e=0,t=r.length;e!==t;++e)r[e]=n[i++]}_setValue_array_setNeedsUpdate(n,i){var r=this.resolvedProperty;for(let e=0,t=r.length;e!==t;++e)r[e]=n[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(n,i){var r=this.resolvedProperty;for(let e=0,t=r.length;e!==t;++e)r[e]=n[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let n=this.node;var e=this.parsedPath,i=e.objectName,r=e.propertyName;let a=e.propertyIndex;if(n||(n=bd.findNode(this.rootNode,e.nodeName),this.node=n),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,n){if(i){let t=e.objectIndex;switch(i){case"materials":if(!n.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!n.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);n=n.material.materials;break;case"bones":if(!n.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);n=n.skeleton.bones;for(let e=0;e<n.length;e++)if(n[e].name===t){t=e;break}break;case"map":if("map"in n)n=n.map;else{if(!n.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!n.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);n=n.material.map}break;default:if(void 0===n[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);n=n[i]}if(void 0!==t){if(void 0===n[t])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,n);n=n[t]}}var o=n[r];if(void 0===o)e=e.nodeName,console.error("THREE.PropertyBinding: Trying to update property for track: "+e+"."+r+" but it wasn't found.",n);else{let e=this.Versioning.None,t=(void 0!==(this.targetObject=n).needsUpdate?e=this.Versioning.NeedsUpdate:void 0!==n.matrixWorldNeedsUpdate&&(e=this.Versioning.MatrixWorldNeedsUpdate),this.BindingType.Direct);if(void 0!==a){if("morphTargetInfluences"===r){if(!n.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!n.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==n.morphTargetDictionary[a]&&(a=n.morphTargetDictionary[a])}t=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=a}else void 0!==o.fromArray&&void 0!==o.toArray?(t=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(t=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[t],this.setValue=this.SetterByBindingTypeAndVersioning[t][e]}}else console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".")}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}bd.Composite=class{constructor(e,t,n){n=n||bd.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,n=this._bindings[n];void 0!==n&&n.getValue(e,t)}setValue(n,i){var r=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=r.length;e!==t;++e)r[e].setValue(n,i)}bind(){var n=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=n.length;e!==t;++e)n[e].bind()}unbind(){var n=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=n.length;e!==t;++e)n[e].unbind()}},bd.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},bd.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},bd.prototype.GetterByBindingType=[bd.prototype._getValue_direct,bd.prototype._getValue_array,bd.prototype._getValue_arrayElement,bd.prototype._getValue_toArray],bd.prototype.SetterByBindingTypeAndVersioning=[[bd.prototype._setValue_direct,bd.prototype._setValue_direct_setNeedsUpdate,bd.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[bd.prototype._setValue_array,bd.prototype._setValue_array_setNeedsUpdate,bd.prototype._setValue_array_setMatrixWorldNeedsUpdate],[bd.prototype._setValue_arrayElement,bd.prototype._setValue_arrayElement_setNeedsUpdate,bd.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[bd.prototype._setValue_fromArray,bd.prototype._setValue_fromArray_setNeedsUpdate,bd.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class vT{constructor(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:t.blendMode,r=(this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i,t.tracks),a=r.length,o=new Array(a),s={endingStart:2400,endingEnd:2400};for(let e=0;e!==a;++e){var l=r[e].createInterpolant(null);(o[e]=l).settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){var i,r;return e.fadeOut(t),this.fadeIn(t),n&&(r=(n=this._clip.duration)/(i=e._clip.duration),e.warp(1,i/n,t),this.warp(r,1,t)),this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){var i=this._mixer,r=i.time,a=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);var i=o.parameterPositions,s=o.sampleValues;return i[0]=r,i[1]=r+n,s[0]=e/a,s[1]=t/a,this}stopWarping(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(this.enabled){var r=this._startTime,a=(null!==r&&(t=(r=(e-r)*n)<0||0===n?0:(this._startTime=null,n*r)),t*=this._updateTimeScale(e),this._updateTime(t)),o=this._updateWeight(e);if(0<o){var s=this._interpolants,l=this._propertyBindings;if(2501===this.blendMode)for(let e=0,t=s.length;e!==t;++e)s[e].evaluate(a),l[e].accumulateAdditive(o);else for(let e=0,t=s.length;e!==t;++e)s[e].evaluate(a),l[e].accumulate(i,o)}}else this._updateWeight(e)}_updateWeight(e){let t=0;var n,i;return this.enabled&&(t=this.weight,null!==(n=this._weightInterpolant))&&(i=n.evaluate(e)[0],t*=i,e>n.parameterPositions[1])&&(this.stopFading(),0===i)&&(this.enabled=!1),this._effectiveWeight=t}_updateTimeScale(e){let t=0;var n,i;return this.paused||(t=this.timeScale,null!==(n=this._timeScaleInterpolant)&&(i=n.evaluate(e)[0],t*=i,e>n.parameterPositions[1])&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)),this._effectiveTimeScale=t}_updateTime(e){var t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;var a,o=2202===n;if(0===e)return-1!==r&&o&&1==(1&r)?t-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else if(-1===r&&(0<=e?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),i>=t||i<0?(n=Math.floor(i/t),i-=t*n,r+=Math.abs(n),(a=this.repetitions-r)<=0?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=0<e?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1})):(1==a?this._setEndings(a=e<0,!a,o):this._setEndings(!1,!1,o),this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n}))):this.time=i,o&&1==(1&r))return t-i;return i}_setEndings(e,t,n){var i=this._interpolantSettings;n?(i.endingStart=2401,i.endingEnd=2401):(i.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,i.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)}_scheduleFading(e,t,n){var i=this._mixer,r=i.time;let a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);var i=a.parameterPositions,o=a.sampleValues;return i[0]=r,o[0]=t,i[1]=r+e,o[1]=n,this}}let so=new Float32Array(1);class _T extends J1{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,n){var i=e._localRoot||this._root,r=e._clip.tracks,a=r.length,o=e._propertyBindings,s=e._interpolants,l=i.uuid,e=this._bindingsByRootAndName;let u=e[l];void 0===u&&(u={},e[l]=u);for(let t=0;t!==a;++t){var c=r[t],h=c.name;let e=u[h];if(void 0!==e)++e.referenceCount;else{if(void 0!==(e=o[t])){null===e._cacheIndex&&(++e.referenceCount,this._addInactiveBinding(e,l,h));continue}var d=n&&n._propertyBindings[t].binding.parsedPath;++(e=new gT(bd.create(i,h,d),c.ValueTypeName,c.getValueSize())).referenceCount,this._addInactiveBinding(e,l,h)}o[t]=e,s[t].resultBuffer=e.buffer}}_activateAction(e){if(!this._isActiveAction(e)){null===e._cacheIndex&&(t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n],this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t));var t,n,i,r=e._propertyBindings;for(let e=0,t=r.length;e!==t;++e){var a=r[e];0==a.useCount++&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){var n=e._propertyBindings;for(let e=0,t=n.length;e!==t;++e){var i=n[e];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){e=e._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(e,t,n){var i=this._actions,r=this._actionsByClip;let a=r[t];void 0===a?(a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=a):(r=a.knownActions,e._byClipCacheIndex=r.length,r.push(e)),e._cacheIndex=i.length,i.push(e),a.actionByRoot[n]=e}_removeInactiveAction(e){var t=this._actions,n=t[t.length-1],i=e._cacheIndex,i=(t[n._cacheIndex=i]=n,t.pop(),e._cacheIndex=null,e._clip.uuid),n=this._actionsByClip,t=n[i],r=t.knownActions,a=r[r.length-1],o=e._byClipCacheIndex;r[a._byClipCacheIndex=o]=a,r.pop(),e._byClipCacheIndex=null,delete t.actionByRoot[(e._localRoot||this._root).uuid],0===r.length&&delete n[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){var n=e._propertyBindings;for(let e=0,t=n.length;e!==t;++e){var i=n[e];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(e){var t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];t[e._cacheIndex=i]=e,t[r._cacheIndex=n]=r}_takeBackAction(e){var t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];t[e._cacheIndex=i]=e,t[r._cacheIndex=n]=r}_addInactiveBinding(e,t,n){var i=this._bindingsByRootAndName,r=this._bindings;let a=i[t];void 0===a&&(a={},i[t]=a),(a[n]=e)._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){var t=this._bindings,n=e.binding,i=n.rootNode.uuid,n=n.path,r=this._bindingsByRootAndName,a=r[i],o=t[t.length-1],e=e._cacheIndex;t[o._cacheIndex=e]=o,t.pop(),delete a[n],0===Object.keys(a).length&&delete r[i]}_lendBinding(e){var t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];t[e._cacheIndex=i]=e,t[r._cacheIndex=n]=r}_takeBackBinding(e){var t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];t[e._cacheIndex=i]=e,t[r._cacheIndex=n]=r}_lendControlInterpolant(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(e[(n=new Fx(new Float32Array(2),new Float32Array(2),1,so)).__cacheIndex=t]=n),n}_takeBackControlInterpolant(e){var t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];t[e.__cacheIndex=i]=e,t[r.__cacheIndex=n]=r}clipAction(e,t,n){var i=t||this._root,r=i.uuid;let a="string"==typeof e?Xx.findByName(i,e):e;i=null!==a?a.uuid:e,e=this._actionsByClip[i];let o=null;if(void 0===n&&(n=null!==a?a.blendMode:2500),void 0!==e){var s=e.actionByRoot[r];if(void 0!==s&&s.blendMode===n)return s;o=e.knownActions[0],null===a&&(a=o._clip)}return null===a?null:(s=new vT(this,a,t,n),this._bindAction(s,o),this._addInactiveAction(s,i,r),s)}existingAction(e,t){var t=t||this._root,n=t.uuid,t="string"==typeof e?Xx.findByName(t,e):e,t=t?t.uuid:e,e=this._actionsByClip[t];return void 0!==e&&e.actionByRoot[n]||null}stopAllAction(){var t=this._actions;for(let e=this._nActiveActions-1;0<=e;--e)t[e].stop();return this}update(t){t*=this.timeScale;var n=this._actions,i=this._nActiveActions,r=this.time+=t,a=Math.sign(t),o=this._accuIndex^=1;for(let e=0;e!==i;++e)n[e]._update(r,t,a,o);var s=this._bindings,l=this._nActiveBindings;for(let e=0;e!==l;++e)s[e].apply(o);return this}setTime(e){for(let e=this.time=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){var n=this._actions,e=e.uuid,t=this._actionsByClip,i=t[e];if(void 0!==i){var r=i.knownActions;for(let e=0,t=r.length;e!==t;++e){var a=r[e],o=(this._deactivateAction(a),a._cacheIndex),s=n[n.length-1];a._cacheIndex=null,a._byClipCacheIndex=null,n[s._cacheIndex=o]=s,n.pop(),this._removeInactiveBindingsForAction(a)}delete t[e]}}uncacheRoot(e){var t,n=e.uuid,i=this._actionsByClip;for(t in i){var r=i[t].actionByRoot[n];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var a=this._bindingsByRootAndName[n];if(void 0!==a)for(var o in a){o=a[o];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,t){e=this.existingAction(e,t);null!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}}class Md{constructor(e){this.value=e}clone(){return new Md(void 0===this.value.clone?this.value:this.value.clone())}}(class extends J1{}),FA;let lo=new fd;class yT{constructor(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new oA(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new sA,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return lo.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(lo),this}intersectObject(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return _m(e,this,n,t),n.sort(vm),n}intersectObjects(n){var i=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];for(let e=0,t=n.length;e<t;e++)_m(n[e],this,r,i);return r.sort(vm),r}}function vm(e,t){return e.distance-t.distance}function _m(e,n,i,t){let r=!0;if(!0===(r=e.layers.test(n.layers)&&!1===e.raycast(n,i)?!1:r)&&!0===t){var a=e.children;for(let e=0,t=a.length;e<t;e++)_m(a[e],n,i,!0)}}class ET{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Pd(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}let uo=new dd,co=new dd;class AT{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new dd,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new dd;this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){uo.subVectors(e,this.start),co.subVectors(this.end,this.start);e=co.dot(co);let n=co.dot(uo)/e;return n=t?Pd(n,0,1):n}closestPointToPoint(e,t,n){e=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(e).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}(class extends gd{}),KA,class extends xd{},class extends gd{},KA,KA,class extends gd{},KA,KA,KA,class extends ZA{};let ho=new dd,po,fo;class xT extends gd{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new dd(0,0,1),t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new dd(0,0,0),n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:16776960,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.2*n,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:.2*r;super(),this.type="ArrowHelper",void 0===po&&((po=new Ad).setAttribute("position",new Ed([0,0,0,0,1,0],3)),(fo=new vx(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new ZA(po,new XA({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new xd(fo,new _d({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,a)}setDirection(e){.99999<e.y?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(ho.set(e.z,0,-e.x).normalize(),e=Math.acos(e.y),this.quaternion.setFromAxisAngle(ho,e))}setLength(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.2*e,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.2*t;this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}KA,class extends nA{},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:l}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=l);var ed=Kh(489),ym=Kh.n(ed);let mo={type:"change"},go={type:"start"},vo={type:"end"},_o=new oA,yo=new _A,Eo=Math.cos(70*fn.DEG2RAD);class TT extends J1{constructor(d,e){super(),this.object=d,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new dd,this.cursor=new dd,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ee.ROTATE,MIDDLE:ee.DOLLY,RIGHT:ee.PAN},this.touches={ONE:te.ROTATE,TWO:te.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return v.phi},this.getAzimuthalAngle=function(){return v.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",t),this._domElementKeyEvents=e},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",t),this._domElementKeyEvents=null},this.saveState=function(){p.target0.copy(p.target),p.position0.copy(p.object.position),p.zoom0=p.object.zoom},this.reset=function(){p.target.copy(p.target0),p.object.position.copy(p.position0),p.object.zoom=p.zoom0,p.object.updateProjectionMatrix(),p.dispatchEvent(mo),p.update(),m=f.NONE},this.update=(()=>{let a=new dd,o=(new hd).setFromUnitVectors(d.up,new dd(0,1,0)),s=o.clone().invert(),l=new dd,u=new hd,c=new dd,h=2*Math.PI;return function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=p.object.position;a.copy(n).sub(p.target),a.applyQuaternion(o),v.setFromVector3(a),p.autoRotate&&m===f.NONE&&R(null!==(t=t)?2*Math.PI/60*p.autoRotateSpeed*t:2*Math.PI/60/60*p.autoRotateSpeed),p.enableDamping?(v.theta+=_.theta*p.dampingFactor,v.phi+=_.phi*p.dampingFactor):(v.theta+=_.theta,v.phi+=_.phi);let e=p.minAzimuthAngle,i=p.maxAzimuthAngle,r=(isFinite(e)&&isFinite(i)&&(e<-Math.PI?e+=h:e>Math.PI&&(e-=h),i<-Math.PI?i+=h:i>Math.PI&&(i-=h),e<=i?v.theta=Math.max(e,Math.min(i,v.theta)):v.theta=v.theta>(e+i)/2?Math.max(e,v.theta):Math.min(i,v.theta)),v.phi=Math.max(p.minPolarAngle,Math.min(p.maxPolarAngle,v.phi)),v.makeSafe(),!0===p.enableDamping?p.target.addScaledVector(E,p.dampingFactor):p.target.add(E),p.target.sub(p.cursor),p.target.clampLength(p.minTargetRadius,p.maxTargetRadius),p.target.add(p.cursor),!1);if(p.zoomToCursor&&T||p.object.isOrthographicCamera?v.radius=O(v.radius):(t=v.radius,v.radius=O(v.radius*y),r=t!=v.radius),a.setFromSpherical(v),a.applyQuaternion(s),n.copy(p.target).add(a),p.object.lookAt(p.target),!0===p.enableDamping?(_.theta*=1-p.dampingFactor,_.phi*=1-p.dampingFactor,E.multiplyScalar(1-p.dampingFactor)):(_.set(0,0,0),E.set(0,0,0)),p.zoomToCursor&&T){let e=null;p.object.isPerspectiveCamera?(n=(t=a.length())-(e=O(t*y)),p.object.position.addScaledVector(A,n),p.object.updateMatrixWorld(),r=!!n):p.object.isOrthographicCamera?((t=new dd(x.x,x.y,0)).unproject(p.object),n=p.object.zoom,p.object.zoom=Math.max(p.minZoom,Math.min(p.maxZoom,p.object.zoom/y)),p.object.updateProjectionMatrix(),r=n!==p.object.zoom,(n=new dd(x.x,x.y,0)).unproject(p.object),p.object.position.sub(n).add(t),p.object.updateMatrixWorld(),e=a.length()):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),p.zoomToCursor=!1),null!==e&&(this.screenSpacePanning?p.target.set(0,0,-1).transformDirection(p.object.matrix).multiplyScalar(e).add(p.object.position):(_o.origin.copy(p.object.position),_o.direction.set(0,0,-1).transformDirection(p.object.matrix),Math.abs(p.object.up.dot(_o.direction))<Eo?d.lookAt(p.target):(yo.setFromNormalAndCoplanarPoint(p.object.up,p.target),_o.intersectPlane(yo,p.target))))}else p.object.isOrthographicCamera&&(n=p.object.zoom,p.object.zoom=Math.max(p.minZoom,Math.min(p.maxZoom,p.object.zoom/y)),n!==p.object.zoom)&&(p.object.updateProjectionMatrix(),r=!0);return y=1,T=!1,!!(r||l.distanceToSquared(p.object.position)>g||8*(1-u.dot(p.object.quaternion))>g||c.distanceToSquared(p.target)>g)&&(p.dispatchEvent(mo),l.copy(p.object.position),u.copy(p.object.quaternion),c.copy(p.target),!0)}})(),this.dispose=function(){p.domElement.removeEventListener("contextmenu",Q),p.domElement.removeEventListener("pointerdown",q),p.domElement.removeEventListener("pointercancel",U),p.domElement.removeEventListener("wheel",X),p.domElement.removeEventListener("pointermove",P),p.domElement.removeEventListener("pointerup",U),p.domElement.getRootNode().removeEventListener("keydown",Z,{capture:!0}),null!==p._domElementKeyEvents&&(p._domElementKeyEvents.removeEventListener("keydown",t),p._domElementKeyEvents=null)};let p=this,f={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},m=f.NONE,g=1e-6,v=new ET,_=new ET,y=1,E=new dd,i=new ld,r=new ld,a=new ld,o=new ld,s=new ld,l=new ld,u=new ld,c=new ld,h=new ld,A=new dd,x=new ld,T=!1,S=[],w={},b=!1;function M(e){e=Math.abs(.01*e);return Math.pow(.95,p.zoomSpeed*e)}function R(e){_.theta-=e}function N(e){_.phi-=e}let I=(()=>{let n=new dd;return function(e,t){n.setFromMatrixColumn(t,0),n.multiplyScalar(-e),E.add(n)}})(),F=(()=>{let n=new dd;return function(e,t){!0===p.screenSpacePanning?n.setFromMatrixColumn(t,1):(n.setFromMatrixColumn(t,0),n.crossVectors(p.object.up,n)),n.multiplyScalar(e),E.add(n)}})(),C=(()=>{let r=new dd;return function(e,t){var n,i=p.domElement;p.object.isPerspectiveCamera?(n=p.object.position,r.copy(n).sub(p.target),n=r.length(),n*=Math.tan(p.object.fov/2*Math.PI/180),I(2*e*n/i.clientHeight,p.object.matrix),F(2*t*n/i.clientHeight,p.object.matrix)):p.object.isOrthographicCamera?(I(e*(p.object.right-p.object.left)/p.object.zoom/i.clientWidth,p.object.matrix),F(t*(p.object.top-p.object.bottom)/p.object.zoom/i.clientHeight,p.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),p.enablePan=!1)}})();function L(e){p.object.isPerspectiveCamera||p.object.isOrthographicCamera?y/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),p.enableZoom=!1)}function z(e){p.object.isPerspectiveCamera||p.object.isOrthographicCamera?y*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),p.enableZoom=!1)}function D(e,t){var n,i;p.zoomToCursor&&(T=!0,n=e-(e=p.domElement.getBoundingClientRect()).left,t=t-e.top,i=e.width,e=e.height,x.x=n/i*2-1,x.y=-t/e*2+1,A.set(x.x,x.y,1).unproject(p.object).sub(p.object.position).normalize())}function O(e){return Math.max(p.minDistance,Math.min(p.maxDistance,e))}function k(e){i.set(e.clientX,e.clientY)}function G(e){o.set(e.clientX,e.clientY)}function n(e){var t,n;1===S.length?i.set(e.pageX,e.pageY):(t=B(e),n=.5*(e.pageX+t.x),e=.5*(e.pageY+t.y),i.set(n,e))}function H(e){var t,n;1===S.length?o.set(e.pageX,e.pageY):(t=B(e),n=.5*(e.pageX+t.x),e=.5*(e.pageY+t.y),o.set(n,e))}function V(e){var t=B(e),n=e.pageX-t.x,e=e.pageY-t.y,t=Math.sqrt(n*n+e*e);u.set(0,t)}function W(e){1==S.length?r.set(e.pageX,e.pageY):(n=B(e),t=.5*(e.pageX+n.x),e=.5*(e.pageY+n.y),r.set(t,e)),a.subVectors(r,i).multiplyScalar(p.rotateSpeed);var t,n=p.domElement;R(2*Math.PI*a.x/n.clientHeight),N(2*Math.PI*a.y/n.clientHeight),i.copy(r)}function j(e){var t,n;1===S.length?s.set(e.pageX,e.pageY):(t=B(e),n=.5*(e.pageX+t.x),e=.5*(e.pageY+t.y),s.set(n,e)),l.subVectors(s,o).multiplyScalar(p.panSpeed),C(l.x,l.y),o.copy(s)}function Y(e){var t=B(e),n=e.pageX-t.x,i=e.pageY-t.y,n=Math.sqrt(n*n+i*i),i=(c.set(0,n),h.set(0,Math.pow(c.y/u.y,p.zoomSpeed)),L(h.y),u.copy(c),.5*(e.pageX+t.x));D(i,.5*(e.pageY+t.y))}function q(t){var e;if(!1!==p.enabled&&(0===S.length&&(p.domElement.setPointerCapture(t.pointerId),p.domElement.addEventListener("pointermove",P),p.domElement.addEventListener("pointerup",U)),!(t=>{for(let e=0;e<S.length;e++)if(S[e]==t.pointerId)return 1})(t)))if(e=t,S.push(e.pointerId),"touch"!==t.pointerType){var n=t;let e;switch(n.button){case 0:e=p.mouseButtons.LEFT;break;case 1:e=p.mouseButtons.MIDDLE;break;case 2:e=p.mouseButtons.RIGHT;break;default:e=-1}switch(e){case ee.DOLLY:if(!1===p.enableZoom)return;(e=>{D(e.clientX,e.clientX),u.set(e.clientX,e.clientY)})(n),m=f.DOLLY;break;case ee.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(!1===p.enablePan)return;G(n),m=f.PAN}else{if(!1===p.enableRotate)return;k(n),m=f.ROTATE}break;case ee.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(!1===p.enableRotate)return;k(n),m=f.ROTATE}else{if(!1===p.enablePan)return;G(n),m=f.PAN}break;default:m=f.NONE}m!==f.NONE&&p.dispatchEvent(go)}else J(t)}function P(e){if(!1!==p.enabled)if("touch"===e.pointerType){var t=e;switch($(t),m){case f.TOUCH_ROTATE:!1!==p.enableRotate&&(W(t),p.update());break;case f.TOUCH_PAN:!1!==p.enablePan&&(j(t),p.update());break;case f.TOUCH_DOLLY_PAN:!1===p.enableZoom&&!1===p.enablePan||((e=>{p.enableZoom&&Y(e),p.enablePan&&j(e)})(t),p.update());break;case f.TOUCH_DOLLY_ROTATE:!1===p.enableZoom&&!1===p.enableRotate||((e=>{p.enableZoom&&Y(e),p.enableRotate&&W(e)})(t),p.update());break;default:m=f.NONE}}else{var n=e;switch(m){case f.ROTATE:!1!==p.enableRotate&&(e=>{r.set(e.clientX,e.clientY),a.subVectors(r,i).multiplyScalar(p.rotateSpeed),e=p.domElement,R(2*Math.PI*a.x/e.clientHeight),N(2*Math.PI*a.y/e.clientHeight),i.copy(r),p.update()})(n);break;case f.DOLLY:!1!==p.enableZoom&&(e=>{c.set(e.clientX,e.clientY),h.subVectors(c,u),0<h.y?L(M(h.y)):h.y<0&&z(M(h.y)),u.copy(c),p.update()})(n);break;case f.PAN:!1!==p.enablePan&&(e=>{s.set(e.clientX,e.clientY),l.subVectors(s,o).multiplyScalar(p.panSpeed),C(l.x,l.y),o.copy(s),p.update()})(n)}}}function U(e){switch((t=>{delete w[t.pointerId];for(let e=0;e<S.length;e++)if(S[e]==t.pointerId)return S.splice(e,1)})(e),S.length){case 0:p.domElement.releasePointerCapture(e.pointerId),p.domElement.removeEventListener("pointermove",P),p.domElement.removeEventListener("pointerup",U),p.dispatchEvent(vo),m=f.NONE;break;case 1:var t=S[0],n=w[t];J({pointerId:t,pageX:n.x,pageY:n.y})}}function X(e){!1!==p.enabled&&!1!==p.enableZoom&&m===f.NONE&&(e.preventDefault(),p.dispatchEvent(go),D((e=(e=>{var t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}return e.ctrlKey&&!b&&(n.deltaY*=10),n})(e)).clientX,e.clientY),e.deltaY<0?z(M(e.deltaY)):0<e.deltaY&&L(M(e.deltaY)),p.update(),p.dispatchEvent(vo))}function Z(e){"Control"===e.key&&(b=!0,p.domElement.getRootNode().addEventListener("keyup",K,{passive:!0,capture:!0}))}function K(e){"Control"===e.key&&(b=!1,p.domElement.getRootNode().removeEventListener("keyup",K,{passive:!0,capture:!0}))}function t(t){if(!1!==p.enabled&&!1!==p.enablePan){var n=t;let e=!1;switch(n.code){case p.keys.UP:n.ctrlKey||n.metaKey||n.shiftKey?N(2*Math.PI*p.rotateSpeed/p.domElement.clientHeight):C(0,p.keyPanSpeed),e=!0;break;case p.keys.BOTTOM:n.ctrlKey||n.metaKey||n.shiftKey?N(-2*Math.PI*p.rotateSpeed/p.domElement.clientHeight):C(0,-p.keyPanSpeed),e=!0;break;case p.keys.LEFT:n.ctrlKey||n.metaKey||n.shiftKey?R(2*Math.PI*p.rotateSpeed/p.domElement.clientHeight):C(p.keyPanSpeed,0),e=!0;break;case p.keys.RIGHT:n.ctrlKey||n.metaKey||n.shiftKey?R(-2*Math.PI*p.rotateSpeed/p.domElement.clientHeight):C(-p.keyPanSpeed,0),e=!0}e&&(n.preventDefault(),p.update())}}function J(e){switch($(e),S.length){case 1:switch(p.touches.ONE){case te.ROTATE:if(!1===p.enableRotate)return;n(e),m=f.TOUCH_ROTATE;break;case te.PAN:if(!1===p.enablePan)return;H(e),m=f.TOUCH_PAN;break;default:m=f.NONE}break;case 2:switch(p.touches.TWO){case te.DOLLY_PAN:if(!1===p.enableZoom&&!1===p.enablePan)return;t=e,p.enableZoom&&V(t),p.enablePan&&H(t),m=f.TOUCH_DOLLY_PAN;break;case te.DOLLY_ROTATE:if(!1===p.enableZoom&&!1===p.enableRotate)return;t=e,p.enableZoom&&V(t),p.enableRotate&&n(t),m=f.TOUCH_DOLLY_ROTATE;break;default:m=f.NONE}break;default:m=f.NONE}var t;m!==f.NONE&&p.dispatchEvent(go)}function Q(e){!1!==p.enabled&&e.preventDefault()}function $(e){let t=w[e.pointerId];void 0===t&&(t=new ld,w[e.pointerId]=t),t.set(e.pageX,e.pageY)}function B(e){e=e.pointerId===S[0]?S[1]:S[0];return w[e]}p.domElement.addEventListener("contextmenu",Q),p.domElement.addEventListener("pointerdown",q),p.domElement.addEventListener("pointercancel",U),p.domElement.addEventListener("wheel",X,{passive:!1}),p.domElement.getRootNode().addEventListener("keydown",Z,{passive:!0,capture:!0}),this.update()}}function Em(e,t,n){return null===e?null:(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(n.ray.origin),e.object=t,e)}let Ao=0,xo=1,To=2,So=2,wo=1.25,bo=1,Mo=32,Ro=65535,No=Math.pow(2,-24),Io=Symbol("SKIP_GENERATION");function Am(e){return((e=e).index||e.attributes.position).count/3}function xm(e,t){if(!e.index){var n=e.attributes.position.count,i=function(e,t){return t=1<arguments.length&&void 0!==t?t:ArrayBuffer,65535<e?new Uint32Array(new t(4*e)):new Uint16Array(new t(2*e))}(n,t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);e.setIndex(new yd(i,1));for(let e=0;e<n;e++)i[e]=e}}function Tm(e,t){var n=Am(e),t=t||e.drawRange,e=t.start/3,t=(t.start+t.count)/3,e=Math.max(0,e),n=Math.min(n,t)-e;return[{offset:Math.floor(e),count:Math.floor(n)}]}function Sm(e,t){if(!e.groups||!e.groups.length)return Tm(e,t);var n,i=[],r=new Set,t=t||e.drawRange,a=t.start/3,o=(t.start+t.count)/3;for(n of e.groups){var s=n.start/3,l=(n.start+n.count)/3;r.add(Math.max(a,s)),r.add(Math.min(o,l))}var u=Array.from(r.values()).sort((e,t)=>e-t);for(let e=0;e<u.length-1;e++){var c=u[e],h=u[e+1];i.push({offset:Math.floor(c),count:Math.floor(h-c)})}return i}function wm(n,i,r,e,t){let a=1/0,o=1/0,s=1/0,l=-1/0,u=-1/0,c=-1/0,h=1/0,d=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0;for(let e=6*i,t=6*(i+r);e<t;e+=6){var v=n[e+0],_=n[e+1],y=v-_,_=v+_,y=(y<a&&(a=y),_>l&&(l=_),v<h&&(h=v),v>f&&(f=v),n[e+2]),_=n[e+3],v=y-_,_=y+_,v=(v<o&&(o=v),_>u&&(u=_),y<d&&(d=y),y>m&&(m=y),n[e+4]),_=n[e+5],y=v-_,_=v+_;y<s&&(s=y),_>c&&(c=_),v<p&&(p=v),v>g&&(g=v)}e[0]=a,e[1]=o,e[2]=s,e[3]=l,e[4]=u,e[5]=c,t[0]=h,t[1]=d,t[2]=p,t[3]=f,t[4]=m,t[5]=g}function bm(e,t,n){n.min.x=t[e],n.min.y=t[e+1],n.min.z=t[e+2],n.max.x=t[e+3],n.max.y=t[e+4],n.max.z=t[e+5]}function Mm(t){let n=-1,i=-1/0;for(let e=0;e<3;e++){var r=t[e+3]-t[e];r>i&&(i=r,n=e)}return n}function Rm(e,t){t.set(e)}function Nm(t,n,i){for(let e=0;e<3;e++){var r=e+3,a=t[e],o=n[e];i[e]=a<o?a:o,i[r]=(o=n[r])<(a=t[r])?a:o}}function Im(t,n,i){for(let e=0;e<3;e++){var r=n[t+2*e],a=n[t+2*e+1],o=r-a,r=r+a;o<i[e]&&(i[e]=o),r>i[e+3]&&(i[e+3]=r)}}function Cm(e){var t=e[3]-e[0],n=e[4]-e[1],e=e[5]-e[2];return 2*(t*n+n*e+e*t)}let Co=32,Lo=(e,t)=>e.candidate-t.candidate,Do=new Array(Co).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Oo=new Float32Array(6);function Lm(e,t,o,n,s,i){let l=-1,u=0;if(i===Ao)-1!==(l=Mm(t))&&(u=(t[l]+t[l+3])/2);else if(i===xo)-1!==(l=Mm(e))&&(u=((n,i,r,a)=>{let o=0;for(let e=i,t=i+r;e<t;e++)o+=n[6*e+2*a];return o/r})(o,n,s,l));else if(i===To){var c=Cm(e);let a=wo*s;var h=6*n,d=6*(n+s);for(let r=0;r<3;r++){var p=t[r],f=(t[r+3]-p)/Co;if(s<Co/4){var m=[...Do];m.length=s;let t=0;for(let e=h;e<d;e+=6,t++){var g=m[t],{bounds:v,leftCacheBounds:_,rightCacheBounds:y}=(g.candidate=o[e+2*r],g.count=0,g);for(let e=0;e<3;e++)y[e]=1/0,y[e+3]=-1/0,_[e]=1/0,_[e+3]=-1/0,v[e]=1/0,v[e+3]=-1/0;Im(e,o,v)}m.sort(Lo);let n=s;for(let e=0;e<n;e++)for(var E=m[e];e+1<n&&m[e+1].candidate===E.candidate;)m.splice(e+1,1),n--;for(let t=h;t<d;t+=6){var A=o[t+2*r];for(let e=0;e<n;e++){var x=m[e];A>=x.candidate?Im(t,o,x.rightCacheBounds):(Im(t,o,x.leftCacheBounds),x.count++)}}for(let i=0;i<n;i++){var T=m[i],S=T.count,w=s-T.count;let e=T.leftCacheBounds,t=0,n=(0!==S&&(t=Cm(e)/c),0);0!=w&&(n=Cm(T.rightCacheBounds)/c);S=bo+wo*(t*S+n*w);S<a&&(l=r,a=S,u=T.candidate)}}else{for(let e=0;e<Co;e++){var b=Do[e],M=(b.count=0,b.candidate=p+f+e*f,b.bounds);for(let e=0;e<3;e++)M[e]=1/0,M[e+3]=-1/0}for(let t=h;t<d;t+=6){let e=~~((o[t+2*r]-p)/f);e>=Co&&(e=Co-1);var R=Do[e];R.count++,Im(t,o,R.bounds)}var N=Do[Co-1];Rm(N.bounds,N.rightCacheBounds);for(let e=Co-2;0<=e;e--){var I=Do[e],C=Do[e+1];Nm(I.bounds,C.rightCacheBounds,I.rightCacheBounds)}let i=0;for(let n=0;n<Co-1;n++){var L=Do[n],D=L.count,O=L.bounds,P=Do[n+1].rightCacheBounds;0!==D&&(0===i?Rm(O,Oo):Nm(O,Oo,Oo));let e=0,t=0;0!==(i+=D)&&(e=Cm(Oo)/c);O=s-i,D=(0!=O&&(t=Cm(P)/c),bo+wo*(e*i+t*O));D<a&&(l=r,a=D,u=L.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${i} used.`);return{axis:l,pos:u}}class ST{constructor(){this.boundingData=new Float32Array(6)}}function Dm(e,t,n,i,r,a){let o=i,s=i+r-1;for(var l=a.pos,u=2*a.axis;;){for(;o<=s&&n[6*o+u]<l;)o++;for(;o<=s&&n[6*s+u]>=l;)s--;if(!(o<s))return o;for(let e=0;e<3;e++){var c=t[3*o+e];t[3*o+e]=t[3*s+e],t[3*s+e]=c}for(let e=0;e<6;e++){var h=n[6*o+e];n[6*o+e]=n[6*s+e],n[6*s+e]=h}o++,s--}}function Om(e,t,n,i,r,a){let o=i,s=i+r-1;for(var l=a.pos,u=2*a.axis;;){for(;o<=s&&n[6*o+u]<l;)o++;for(;o<=s&&n[6*s+u]>=l;)s--;if(!(o<s))return o;var c=e[o];e[o]=e[s],e[s]=c;for(let e=0;e<6;e++){var h=n[6*o+e];n[6*o+e]=n[6*s+e],n[6*s+e]=h}o++,s--}}function Pm(e,t){return 65535===t[e+15]}function Um(e,t){return t[e+6]}function Bm(e,t){return t[e+14]}function Fm(e,t){return t[e+6]}function zm(e,t){return t[e+7]}let Po,Uo,Bo,Fo,zo=Math.pow(2,32);function km(e,t,n){Po=new Float32Array(n),Uo=new Uint32Array(n),Bo=new Uint16Array(n),Fo=new Uint8Array(n),function r(a,o){let s=a/4;let n=a/2;let e="count"in o;let t=o.boundingData;for(let e=0;e<6;e++)Po[s+e]=t[e];{if(e){if(o.buffer){let n=o.buffer;Fo.set(new Uint8Array(n),a);for(let t=a,e=a+n.byteLength;t<e;t+=Mo){let e=t/2;Pm(e,Bo)||(Uo[t/4+6]+=s)}return a+n.byteLength}{let e=o.offset,t=o.count;return Uo[6+s]=e,Bo[14+n]=t,Bo[15+n]=Ro,a+Mo}}{let e=o.left,t=o.right,n=o.splitAxis,i;if((i=r(a+Mo,e))/4>zo)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return Uo[6+s]=i/4,i=r(i,t),Uo[7+s]=n,i}}}(e,t)}function Gm(e,p,t,n,i){let{maxDepth:r,verbose:a,maxLeafTris:f,strategy:m,onProgress:o,indirect:s}=i,g=e._indirectBuffer,v=e.geometry,_=v.index?v.index.array:null,y=s?Om:Dm,l=Am(v),E=new Float32Array(6),A=!1;i=new ST;return wm(p,t,n,i.boundingData,E),function o(s,l,u){let e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;let c=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;!A&&c>=r&&(A=!0,a)&&(console.warn(`MeshBVH: Max depth of ${r} reached when generating BVH. Consider increasing maxDepth.`),console.warn(v));if(u<=f||c>=r)return x(l+u),s.offset=l,s.count=u,s;let h=Lm(s.boundingData,e,p,l,u,m);if(-1===h.axis)return x(l+u),s.offset=l,s.count=u,s;let d=y(g,_,p,l,u,h);if(d===l||d===l+u)x(l+u),s.offset=l,s.count=u;else{s.splitAxis=h.axis;let e=new ST,t=l,n=d-l,i=(s.left=e,wm(p,t,n,e.boundingData,E),o(e,t,n,E,c+1),new ST),r=d,a=u-n;s.right=i,wm(p,r,a,i.boundingData,E),o(i,r,a,E,c+1)}return s}(i,t,n,E),i;function x(e){o&&o(e/l)}}function Hm(n,i){var e=n.geometry;i.indirect&&(n._indirectBuffer=((e,t)=>{var n=65536<(e=(e.index||e.attributes.position).count/3),i=n?4:2,t=new(t?SharedArrayBuffer:ArrayBuffer)(e*i),r=new(n?Uint32Array:Uint16Array)(t);for(let e=0,t=r.length;e<t;e++)r[e]=e;return r})(e,i.useSharedArrayBuffer),((e,t)=>{var n=Am(e),e=Sm(e,t).sort((e,t)=>e.offset-t.offset);(t=e[e.length-1]).count=Math.min(n-t.offset,t.count);let i=0;return e.forEach(e=>{e=e.count;return i+=e}),n!==i})(e,i.range))&&!i.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.'),n._indirectBuffer||xm(e,i);let r=i.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,a=function(e,t,n,i){t=1<arguments.length&&void 0!==t?t:null;let r=2<arguments.length&&void 0!==n?n:null,a=3<arguments.length&&void 0!==i?i:null;var u=e.attributes.position,c=e.index?e.index.array:null,n=Am(e),h=u.normalized;let d;a=null===t?(d=new Float32Array(6*n*4),r=0,n):(d=t,r=r||0,a||n);var p=u.array,f=u.offset||0;let m=3;u.isInterleavedBufferAttribute&&(m=u.data.stride);var g=["getX","getY","getZ"];for(let e=r;e<r+a;e++){var v=3*e,_=6*e;let o=0+v,s=1+v,l=2+v;c&&(o=c[o],s=c[s],l=c[l]),h||(o=o*m+f,s=s*m+f,l=l*m+f);for(let a=0;a<3;a++){let e,t,n,i=(n=h?(e=u[g[a]](o),t=u[g[a]](s),u[g[a]](l)):(e=p[o+a],t=p[s+a],p[l+a]),e),r=(t<i&&(i=t),n<i&&(i=n),e);t>r&&(r=t);var y=((r=n>r?n:r)-i)/2,E=2*a;d[_+E]=i+y,d[_+E+1]=y+(Math.abs(i)+y)*No}}return d}(e);e=(i.indirect?Tm:Sm)(e,i.range);n._roots=e.map(e=>{var e=Gm(n,a,e.offset,e.count,i),t=function e(t){return"count"in t?1:1+e(t.left)+e(t.right)}(e),t=new r(Mo*t);return km(0,e,t),t})}class wT{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(n,i){let r=1/0,a=-1/0;for(let e=0,t=n.length;e<t;e++){var o=n[e][i];r=o<r?o:r,a=o>a?o:a}this.min=r,this.max=a}setFromPoints(n,i){let r=1/0,a=-1/0;for(let e=0,t=i.length;e<t;e++){var o=i[e],o=n.dot(o);r=o<r?o:r,a=o>a?o:a}this.min=r,this.max=a}isSeparated(e){return this.min>e.max||e.min>this.max}}wT.prototype.setFromBox=(()=>{let u=new dd;return function(i,e){var r=e.min,a=e.max;let o=1/0,s=-1/0;for(let n=0;n<=1;n++)for(let t=0;t<=1;t++)for(let e=0;e<=1;e++){u.x=r.x*n+a.x*(1-n),u.y=r.y*t+a.y*(1-t),u.z=r.z*e+a.z*(1-e);var l=i.dot(u);o=Math.min(l,o),s=Math.max(l,s)}this.min=o,this.max=s}})();{let e=new wT}let ko=(()=>{let u=new dd,c=new dd,h=new dd;return function(e,t,n){var i=e.start,r=u,a=t.start,o=c,i=(h.subVectors(i,a),u.subVectors(e.end,e.start),c.subVectors(t.end,t.start),h.dot(o)),a=o.dot(r),e=o.dot(o),t=h.dot(r),o=r.dot(r)*e-a*a;let s,l;l=(i+(s=0!=o?(i*a-t*e)/o:0)*a)/e,n.x=s,n.y=l}})(),Go=(()=>{let e=new ld,l=new dd,u=new dd;return function(n,i,r,a){ko(n,i,e);var o=e.x,s=e.y;if(0<=o&&o<=1&&0<=s&&s<=1)n.at(o,r),i.at(s,a);else if(0<=o&&o<=1)s<0?i.at(0,a):i.at(1,a),n.closestPointToPoint(a,!0,r);else if(0<=s&&s<=1)o<0?n.at(0,r):n.at(1,r),i.closestPointToPoint(r,!0,a);else{let e;e=o<0?n.start:n.end;let t;t=s<0?i.start:i.end;o=l,s=u;n.closestPointToPoint(t,!0,l),i.closestPointToPoint(e,!0,u),o.distanceToSquared(t)<=s.distanceToSquared(e)?(r.copy(o),a.copy(t)):(r.copy(e),a.copy(s))}}})(),Ho=(()=>{let o=new dd,s=new dd,l=new _A,u=new AT;return function(e,t){var{radius:e,center:n}=e,{a:i,b:r,c:a}=t;if(u.start=i,u.end=r,u.closestPointToPoint(n,!0,o).distanceTo(n)<=e)return!0;if(u.start=i,u.end=a,u.closestPointToPoint(n,!0,o).distanceTo(n)<=e)return!0;if(u.start=r,u.end=a,u.closestPointToPoint(n,!0,o).distanceTo(n)<=e)return!0;i=t.getPlane(l);if(Math.abs(i.distanceToPoint(n))<=e){r=i.projectPoint(n,s);if(t.containsPoint(r))return!0}return!1}})(),Vo=1e-15;function Vm(e){return Math.abs(e)<Vo}class bT extends lA{constructor(){super(...arguments),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new dd),this.satBounds=new Array(4).fill().map(()=>new wT),this.points=[this.a,this.b,this.c],this.sphere=new aA,this.plane=new _A,this.needsUpdate=!0}intersectsSphere(e){return Ho(e,this)}update(){var e=this.a,t=this.b,n=this.c,i=this.points,r=this.satAxes,a=this.satBounds,o=r[0],s=a[0],s=(this.getNormal(o),s.setFromPoints(o,i),r[1]),l=a[1],l=(s.subVectors(e,t),l.setFromPoints(s,i),r[2]),s=a[2],t=(l.subVectors(t,n),s.setFromPoints(l,i),r[3]),s=a[3];t.subVectors(n,e),s.setFromPoints(t,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}bT.prototype.closestPointToSegment=(()=>{let u=new dd,c=new dd,h=new AT;return function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,{start:e,end:r}=t,a=this.points;let o,s=1/0;for(let e=0;e<3;e++){var l=(e+1)%3;h.start.copy(a[e]),h.end.copy(a[l]),Go(h,t,u,c),(o=u.distanceToSquared(c))<s&&(s=o,n&&n.copy(u),i)&&i.copy(c)}return this.closestPointToPoint(e,u),(o=e.distanceToSquared(u))<s&&(s=o,n&&n.copy(u),i)&&i.copy(e),this.closestPointToPoint(r,u),(o=r.distanceToSquared(u))<s&&(s=o,n&&n.copy(u),i)&&i.copy(r),Math.sqrt(s)}})(),bT.prototype.intersectsTriangle=(()=>{let m=new bT,g=new Array(3),v=new Array(3),_=new wT,y=new wT,E=new dd,c=new dd,A=new dd,x=new dd,T=new dd,h=new AT,S=new AT,w=new AT,d=new dd;function b(e,t,n){var i=e.points;let r=0,a=-1;for(let e=0;e<3;e++){var{start:o,end:s}=h,l=(o.copy(i[e]),s.copy(i[(e+1)%3]),h.delta(c),Vm(t.distanceToPoint(o)));if(Vm(t.normal.dot(c))&&l){n.copy(h),r=2;break}var u=t.intersectLine(h,d);if(!u&&l&&d.copy(o),(u||l)&&!Vm(d.distanceTo(s))){if(r<=1)(1===r?n.start:n.end).copy(d),l&&(a=r);else if(2<=r){(1===a?n.start:n.end).copy(d),r=2;break}if(2===++r&&-1===a)break}}return r}return function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=(this.needsUpdate&&this.update(),e.isExtendedTriangle?e.needsUpdate&&e.update():(m.copy(e),m.update(),e=m),this.plane),r=e.plane;if(Math.abs(i.normal.dot(r.normal))>1-1e-10){var a=this.satBounds,o=this.satAxes;v[0]=e.a,v[1]=e.b,v[2]=e.c;for(let e=0;e<4;e++){var s=a[e],l=o[e];if(_.setFromPoints(l,v),s.isSeparated(_))return!1}var u=e.satBounds,c=e.satAxes;g[0]=this.a,g[1]=this.b,g[2]=this.c;for(let e=0;e<4;e++){var h=u[e],d=c[e];if(_.setFromPoints(d,g),h.isSeparated(_))return!1}for(let e=0;e<4;e++){var p=o[e];for(let e=0;e<4;e++){var f=c[e];if(E.crossVectors(p,f),_.setFromPoints(E,g),y.setFromPoints(E,v),_.isSeparated(y))return!1}}t&&(n||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),t.start.set(0,0,0),t.end.set(0,0,0))}else{n=b(this,r,S);if(1===n&&e.containsPoint(S.end))t&&(t.start.copy(S.end),t.end.copy(S.end));else{if(2!==n)return!1;r=b(e,i,w);if(1===r&&this.containsPoint(w.end))t&&(t.start.copy(w.end),t.end.copy(w.end));else{if(2!==r)return!1;S.delta(A),w.delta(x),A.dot(x)<0&&(n=w.start,w.start=w.end,w.end=n);e=S.start.dot(A),i=S.end.dot(A),r=w.start.dot(A),n=w.end.dot(A);if(e!==n&&r!==i&&i<r==e<n)return!1;t&&(T.subVectors(S.start,w.start),0<T.dot(A)?t.start.copy(S.start):t.start.copy(w.start),T.subVectors(S.end,w.end),T.dot(A)<0?t.end.copy(S.end):t.end.copy(w.end))}}}return!0}})(),bT.prototype.distanceToPoint=(()=>{let t=new dd;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}})(),bT.prototype.distanceToTriangle=(()=>{let d=new dd,p=new dd,f=["a","b","c"],m=new AT,g=new AT;return function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,e=n||i?m:null;if(this.intersectsTriangle(t,e))return(n||i)&&(n&&e.getCenter(n),i)&&e.getCenter(i),0;let r=1/0;for(let e=0;e<3;e++){var a,o=f[e],s=t[o],s=(this.closestPointToPoint(s,d),(a=s.distanceToSquared(d))<r&&(r=a,n&&n.copy(d),i)&&i.copy(s),this[o]);t.closestPointToPoint(s,d),(a=s.distanceToSquared(d))<r&&(r=a,n&&n.copy(s),i)&&i.copy(d)}for(let e=0;e<3;e++){var l=f[e],u=f[(e+1)%3];m.set(this[l],this[u]);for(let e=0;e<3;e++){var c=f[e],h=f[(e+1)%3],c=(g.set(t[c],t[h]),Go(m,g,d,p),d.distanceToSquared(p));c<r&&(r=c,n&&n.copy(d),i)&&i.copy(p)}}return Math.sqrt(r)}})();class MT{constructor(e,t,n){this.isOrientedBox=!0,this.min=new dd,this.max=new dd,this.matrix=new fd,this.invMatrix=new fd,this.points=new Array(8).fill().map(()=>new dd),this.satAxes=new Array(3).fill().map(()=>new dd),this.satBounds=new Array(3).fill().map(()=>new wT),this.alignedSatBounds=new Array(3).fill().map(()=>new wT),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),n&&this.matrix.copy(n)}set(e,t,n){this.min.copy(e),this.max.copy(t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}MT.prototype.update=function(){var i=this.matrix,r=this.min,a=this.max,o=this.points;for(let n=0;n<=1;n++)for(let t=0;t<=1;t++)for(let e=0;e<=1;e++){var s=o[+n|2*t|4*e];s.x=(n?a:r).x,s.y=(t?a:r).y,s.z=(e?a:r).z,s.applyMatrix4(i)}var t=this.satBounds,n=this.satAxes,l=o[0];for(let e=0;e<3;e++){var u=n[e],c=t[e],h=o[1<<e];u.subVectors(l,h),c.setFromPoints(u,o)}var e=this.alignedSatBounds;e[0].setFromPointsField(o,"x"),e[1].setFromPointsField(o,"y"),e[2].setFromPointsField(o,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},MT.prototype.intersectsBox=(()=>{let l=new wT;return function(t){this.needsUpdate&&this.update();var e=t.min,n=t.max,i=this.satBounds,r=this.satAxes,a=this.alignedSatBounds;if(l.min=e.x,l.max=n.x,a[0].isSeparated(l))return!1;if(l.min=e.y,l.max=n.y,a[1].isSeparated(l))return!1;if(l.min=e.z,l.max=n.z,a[2].isSeparated(l))return!1;for(let e=0;e<3;e++){var o=r[e],s=i[e];if(l.setFromBox(o,t),s.isSeparated(l))return!1}return!0}})(),MT.prototype.intersectsTriangle=(()=>{let d=new bT,p=new Array(3),f=new wT,m=new wT,g=new dd;return function(e){this.needsUpdate&&this.update(),e.isExtendedTriangle?e.needsUpdate&&e.update():(d.copy(e),d.update(),e=d);var t=this.satBounds,n=this.satAxes;p[0]=e.a,p[1]=e.b,p[2]=e.c;for(let e=0;e<3;e++){var i=t[e],r=n[e];if(f.setFromPoints(r,p),i.isSeparated(f))return!1}var a=e.satBounds,o=e.satAxes,s=this.points;for(let e=0;e<3;e++){var l=a[e],u=o[e];if(f.setFromPoints(u,s),l.isSeparated(f))return!1}for(let e=0;e<3;e++){var c=n[e];for(let e=0;e<4;e++){var h=o[e];if(g.crossVectors(c,h),f.setFromPoints(g,p),m.setFromPoints(g,s),f.isSeparated(m))return!1}}return!0}})(),MT.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},MT.prototype.distanceToPoint=(()=>{let t=new dd;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}})(),MT.prototype.distanceToBox=(()=>{let E=["x","y","z"],A=new Array(12).fill().map(()=>new AT),x=new Array(12).fill().map(()=>new AT),T=new dd,S=new dd;return function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;if(this.needsUpdate&&this.update(),this.intersectsBox(e))return(i||r)&&(e.getCenter(S),this.closestPointToPoint(S,T),e.closestPointToPoint(T,S),i&&i.copy(T),r)&&r.copy(S),0;var a=t*t,o=e.min,s=e.max,l=this.points;let u=1/0;for(let e=0;e<8;e++){var n=l[e],c=(S.copy(n).clamp(o,s),n.distanceToSquared(S));if(c<u&&(u=c,i&&i.copy(n),r&&r.copy(S),c<a))return Math.sqrt(c)}let h=0;for(let n=0;n<3;n++)for(let t=0;t<=1;t++)for(let e=0;e<=1;e++){var d=(n+1)%3,p=(n+2)%3,f=t<<d|e<<p,m=1<<n|t<<d|e<<p,f=l[f],m=l[m],f=(A[h].set(f,m),E[n]),m=E[d],d=E[p],p=x[h],g=p.start,p=p.end;g[f]=o[f],g[m]=(t?o:s)[m],g[d]=e?o[d]:s[m],p[f]=s[f],p[m]=(t?o:s)[m],p[d]=e?o[d]:s[m],h++}for(let n=0;n<=1;n++)for(let t=0;t<=1;t++)for(let e=0;e<=1;e++){S.x=(n?s:o).x,S.y=(t?s:o).y,S.z=(e?s:o).z,this.closestPointToPoint(S,T);var v=S.distanceToSquared(T);if(v<u&&(u=v,i&&i.copy(T),r&&r.copy(S),v<a))return Math.sqrt(v)}for(let e=0;e<12;e++){var _=A[e];for(let e=0;e<12;e++){var y=x[e],y=(Go(_,y,T,S),T.distanceToSquared(S));if(y<u&&(u=y,i&&i.copy(T),r&&r.copy(S),y<a))return Math.sqrt(y)}}return Math.sqrt(u)}})();class RT{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){var e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class NT extends RT{constructor(){super(()=>new bT)}}let w=new NT,M=new class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;let t=[],n=null;this.setBuffer=e=>{n&&t.push(n),n=e,this.float32Array=new Float32Array(e),this.uint16Array=new Uint16Array(e),this.uint32Array=new Uint32Array(e)},this.clearBuffer=()=>{n=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==t.length&&this.setBuffer(t.pop())}}},Wo,jo,Yo=[],qo=new RT(()=>new pd);function Wm(e,t,n,i,r,a){Wo=qo.getPrimitive(),jo=qo.getPrimitive(),Yo.push(Wo,jo),M.setBuffer(e._roots[t]);t=function f(m,g,v,_){let y=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;let E=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0;let A=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0;let{float32Array:x,uint16Array:T,uint32Array:S}=M;let n=2*m;let e=Pm(n,T);{if(e){let e=Um(m,S),t=Bm(n,T);return bm(m,x,Wo),_(e,t,!1,A,E+m,Wo)}{let t=m+8,n=Fm(m,S),i=t,r=n,a,o,s,l;if(y&&(s=Wo,l=jo,bm(i,x,s),bm(r,x,l),a=y(s),(o=y(l))<a)){i=n,r=t;let e=a;a=o,o=e,s=l}s||(s=Wo,bm(i,x,s));let e=Pm(2*i,T),u=v(s,e,a,A+1,E+i),c;if(u===So){let e=w(i),t=b(i),n=t-e;c=_(e,n,!0,A+1,E+i,s)}else c=u&&f(i,g,v,_,y,E,A+1);if(c)return!0;l=jo,bm(r,x,l);let h=Pm(2*r,T),d=v(l,h,o,A+1,E+r),p;if(d===So){let e=w(r),t=b(r),n=t-e;p=_(e,n,!0,A+1,E+r,l)}else p=d&&f(r,g,v,_,y,E,A+1);return p?!0:!1;function w(e){let{uint16Array:t,uint32Array:n}=M,i=2*e;for(;!Pm(i,t);)e+=8,i=2*e;return Um(e,n)}function b(e){let{uint16Array:t,uint32Array:n}=M,i=2*e;for(;!Pm(i,t);)e=Fm(e,n),i=2*e;return Um(e,n)+Bm(i,t)}}}}(0,e.geometry,n,i,r,a),M.clearBuffer(),qo.releasePrimitive(Wo),qo.releasePrimitive(jo),Yo.pop(),Yo.pop(),e=Yo.length;return 0<e&&(jo=Yo[e-1],Wo=Yo[e-2]),t}let Xo=new dd,Zo=new dd,Ko=new dd,Jo=new dd,Qo=new dd,$o=new ld,es=new ld,ts=new ld,ns=new dd,is=new dd,rs=new dd,as=new dd;function jm(e,t,n,i,r,a,o,s,l,u,c){Ko.fromBufferAttribute(t,a),Jo.fromBufferAttribute(t,o),Qo.fromBufferAttribute(t,s);t=((e,t,n,i,r,a,o,s)=>{let l;return null===(l=a===Ge?e.intersectTriangle(i,n,t,!0,r):e.intersectTriangle(t,n,i,a!==He,r))||(t=e.origin.distanceTo(r))<o||s<t?null:{distance:t,point:r.clone()}})(e,Ko,Jo,Qo,as,l,u,c);return t&&(i&&($o.fromBufferAttribute(i,a),es.fromBufferAttribute(i,o),ts.fromBufferAttribute(i,s),t.uv=lA.getInterpolation(as,Ko,Jo,Qo,$o,es,ts,new ld)),r&&($o.fromBufferAttribute(r,a),es.fromBufferAttribute(r,o),ts.fromBufferAttribute(r,s),t.uv1=lA.getInterpolation(as,Ko,Jo,Qo,$o,es,ts,new ld)),n&&(ns.fromBufferAttribute(n,a),is.fromBufferAttribute(n,o),rs.fromBufferAttribute(n,s),t.normal=lA.getInterpolation(as,Ko,Jo,Qo,ns,is,rs,new dd),0<t.normal.dot(e.direction))&&t.normal.multiplyScalar(-1),l={a:a,b:o,c:s,normal:new dd,materialIndex:0},lA.getNormal(Ko,Jo,Qo,l.normal),t.face=l,t.faceIndex=a),t}function Ym(e,t,n,i,r,a,o){var s=3*i;let l=0+s,u=1+s,c=2+s;var s=e.index,{position:s,normal:e,uv:h,uv1:d}=(e.index&&(l=s.getX(l),u=s.getX(u),c=s.getX(c)),e.attributes),n=jm(n,s,e,h,d,l,u,c,t,a,o);return n?(n.faceIndex=i,r&&r.push(n),n):null}function qm(e,t,n,i){var r=e.a,a=e.b,e=e.c;let o=t,s=t+1,l=t+2;n&&(o=n.getX(o),s=n.getX(s),l=n.getX(l)),r.x=i.getX(o),r.y=i.getY(o),r.z=i.getZ(o),a.x=i.getX(s),a.y=i.getY(s),a.z=i.getZ(s),e.x=i.getX(l),e.y=i.getY(l),e.z=i.getZ(l)}function Xm(e,n,i,r,a,o,s,l){var u=e.geometry;for(let e=r,t=r+a;e<t;e++)Ym(u,n,i,e,o,s,l)}function Zm(e,n,i,r,a,o,s){var l=e.geometry;let u=1/0,c=null;for(let e=r,t=r+a;e<t;e++){var h=Ym(l,n,i,e,null,o,s);h&&h.distance<u&&(c=h,u=h.distance)}return c}function Km(n,i,e,r,a,o,s){var e=e.geometry,l=e.index,u=e.attributes.position;for(let e=n,t=i+n;e<t;e++){var c=e;if(qm(s,3*c,l,u),s.needsUpdate=!0,r(s,c,a,o))return!0}return!1}function Jm(e){let g=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;g&&Array.isArray(g)&&(g=new Set(g));var t=e.geometry;let h=t.index?t.index.array:null,v=t.attributes.position,n,_,i,y,r=0;var a=e._roots;for(let e=0,t=a.length;e<t;e++)n=a[e],_=new Uint32Array(n),i=new Uint16Array(n),y=new Float32Array(n),function d(p,f){let m=2<arguments.length&&void 0!==arguments[2]&&arguments[2];let e=2*p;let t=i[15+e]===Ro;{if(t){let t=_[p+6],n=i[14+e],a=1/0,o=1/0,s=1/0,l=-1/0,u=-1/0,c=-1/0;for(let r=3*t,e=3*(t+n);r<e;r++){let e=h[r],t=v.getX(e),n=v.getY(e),i=v.getZ(e);t<a&&(a=t),t>l&&(l=t),n<o&&(o=n),n>u&&(u=n),i<s&&(s=i),i>c&&(c=i)}return(y[p+0]!==a||y[p+1]!==o||y[p+2]!==s||y[p+3]!==l||y[p+4]!==u||y[p+5]!==c)&&(y[p+0]=a,y[p+1]=o,y[p+2]=s,y[p+3]=l,y[p+4]=u,y[p+5]=c,!0)}{let s=p+8,l=_[p+6],e=s+f,t=l+f,n=m,i=!1,r=!1,a=(g?n||(i=g.has(e),r=g.has(t),n=!i&&!r):(i=!0,r=!0),n||i),o=n||r,u=!1,c=(a&&(u=d(s,f,n)),!1),h=(o&&(c=d(l,f,n)),u||c);if(h)for(let o=0;o<3;o++){let e=s+o,t=l+o,n=y[e],i=y[e+3],r=y[t],a=y[t+3];y[p+o]=n<r?n:r,y[p+o+3]=i>a?i:a}return h}}}(0,r),r+=n.byteLength}function Qm(e,t,n,i,r){let a,o,s,l,u,c;var h=1/n.direction.x,d=1/n.direction.y,p=1/n.direction.z,f=n.origin.x,m=n.origin.y,n=n.origin.z,g=t[e],v=t[e+3],_=t[e+1],y=t[e+3+1],E=t[e+2],t=t[e+3+2];return o=0<=h?(a=(g-f)*h,(v-f)*h):(a=(v-f)*h,(g-f)*h),l=0<=d?(s=(_-m)*d,(y-m)*d):(s=(y-m)*d,(_-m)*d),!(a>l||s>o)&&((s>a||isNaN(a))&&(a=s),(l<o||isNaN(o))&&(o=l),c=0<=p?(u=(E-n)*p,(t-n)*p):(u=(t-n)*p,(E-n)*p),!(a>c||u>o))&&((u>a||a!=a)&&(a=u),(c<o||o!=o)&&(o=c),a<=r)&&o>=i}function $m(e,t,n,i,r,a,o){M.setBuffer(e._roots[t]),function n(i,r,a,o,s,l,u){let{float32Array:c,uint16Array:h,uint32Array:d}=M;let p=2*i;let e=Pm(p,h);if(e){let e=Um(i,d),t=Bm(p,h);Xm(r,a,o,e,t,s,l,u)}else{let e=i+8,t=(Qm(e,c,o,l,u)&&n(e,r,a,o,s,l,u),Fm(i,d));Qm(t,c,o,l,u)&&n(t,r,a,o,s,l,u)}}(0,e,n,i,r,a,o),M.clearBuffer()}let os=["x","y","z"];function eg(e,t,n,i,r,a){M.setBuffer(e._roots[t]);t=function c(h,d,p,f,m,g){let{float32Array:v,uint16Array:n,uint32Array:_}=M;let i=2*h;let e=Pm(i,n);{if(e){let e=Um(h,_),t=Bm(i,n);return Zm(d,p,f,e,t,m,g)}{let n=zm(h,_),i=os[n],e=f.direction[i],r=0<=e,t,a,o=(a=r?(t=h+8,Fm(h,_)):(t=Fm(h,_),h+8),Qm(t,v,f,m,g)),s=o?c(t,d,p,f,m,g):null;if(s){let e=s.point[i],t=r?e<=v[a+n]:e>=v[a+n+3];if(t)return s}let l=Qm(a,v,f,m,g),u=l?c(a,d,p,f,m,g):null;return s&&u?s.distance<=u.distance?s:u:s||u||null}}}(0,e,n,i,r,a);return M.clearBuffer(),t}let ss=new pd,ls=new bT,us=new bT,cs=new fd,hs=new MT,ds=new MT;function tg(e,t,n,i){M.setBuffer(e._roots[t]);t=function r(l,u,c,h){let a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;let{float32Array:d,uint16Array:t,uint32Array:p}=M;let f=2*l;null===a&&(c.boundingBox||c.computeBoundingBox(),hs.set(c.boundingBox.min,c.boundingBox.max,h),a=hs);let e=Pm(f,t);{if(!e){let e=l+8,t=p[l+6],n=(bm(e,d,ss),a.intersectsBox(ss)&&r(e,u,c,h,a));if(n)return!0;bm(t,d,ss);let i=a.intersectsBox(ss)&&r(t,u,c,h,a);return i?!0:!1}{let e=u.geometry,i=e.index,r=e.attributes.position,n=c.index,a=c.attributes.position,o=Um(l,p),s=Bm(f,t);if(cs.copy(h).invert(),c.boundsTree){bm(l,d,ds),ds.matrix.copy(cs),ds.needsUpdate=!0;let e=c.boundsTree.shapecast({intersectsBounds:e=>ds.intersectsBox(e),intersectsTriangle:n=>{n.a.applyMatrix4(h),n.b.applyMatrix4(h),n.c.applyMatrix4(h),n.needsUpdate=!0;for(let e=3*o,t=3*(s+o);e<t;e+=3)if(qm(us,e,i,r),us.needsUpdate=!0,n.intersectsTriangle(us))return!0;return!1}});return e}for(let e=3*o,t=3*(s+o);e<t;e+=3){qm(ls,e,i,r),ls.a.applyMatrix4(cs),ls.b.applyMatrix4(cs),ls.c.applyMatrix4(cs),ls.needsUpdate=!0;for(let e=0,t=n.count;e<t;e+=3)if(qm(us,e,n,a),us.needsUpdate=!0,ls.intersectsTriangle(us))return!0}}}}(0,e,n,i);return M.clearBuffer(),t}let ps=new fd,fs=new MT,ms=new MT,gs=new dd,vs=new dd,_s=new dd,ys=new dd;function ng(e,t,s){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};let l=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,r=6<arguments.length&&void 0!==arguments[6]?arguments[6]:1/0;t.boundingBox||t.computeBoundingBox(),fs.set(t.boundingBox.min,t.boundingBox.max,s),fs.needsUpdate=!0;var a=e.geometry;let u=a.attributes.position,c=a.index,h=t.attributes.position,d=t.index,p=w.getPrimitive(),f=w.getPrimitive(),m=gs,g=vs,v=null,_=null,y=(i&&(v=_s,_=ys),1/0),E=null,A=null;return ps.copy(s).invert(),ms.matrix.copy(ps),e.shapecast({boundsTraverseOrder:e=>fs.distanceToBox(e),intersectsBounds:(e,t,n)=>n<y&&n<r&&(t&&(ms.min.copy(e.min),ms.max.copy(e.max),ms.needsUpdate=!0),!0),intersectsRange:(a,o)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:e=>ms.distanceToBox(e),intersectsBounds:(e,t,n)=>n<y&&n<r,intersectsRange:(t,i)=>{for(let n=t,e=t+i;n<e;n++){qm(f,3*n,d,h),f.a.applyMatrix4(s),f.b.applyMatrix4(s),f.c.applyMatrix4(s),f.needsUpdate=!0;for(let e=a,t=a+o;e<t;e++){qm(p,3*e,c,u),p.needsUpdate=!0;var r=p.distanceToTriangle(f,m,v);if(r<y&&(g.copy(m),_&&_.copy(v),y=r,E=e,A=n),r<l)return!0}}}});for(let n=0,e=Am(t);n<e;n++){qm(f,3*n,d,h),f.a.applyMatrix4(s),f.b.applyMatrix4(s),f.c.applyMatrix4(s),f.needsUpdate=!0;for(let e=a,t=a+o;e<t;e++){qm(p,3*e,c,u),p.needsUpdate=!0;var i=p.distanceToTriangle(f,m,v);if(i<y&&(g.copy(m),_&&_.copy(v),y=i,E=e,A=n),i<l)return!0}}}}),w.releasePrimitive(p),w.releasePrimitive(f),y===1/0?null:(n.point?n.point.copy(g):n.point=g.clone(),n.distance=y,n.faceIndex=E,i&&(i.point?i.point.copy(_):i.point=_.clone(),i.point.applyMatrix4(ps),g.applyMatrix4(ps),i.distance=g.sub(i.point).length(),i.faceIndex=A),n)}function ig(e,n,i,r,a,o,s,l){var{geometry:u,_indirectBuffer:c}=e;for(let e=r,t=r+a;e<t;e++)Ym(u,n,i,c?c[e]:e,o,s,l)}function rg(e,n,i,r,a,o,s){var{geometry:l,_indirectBuffer:u}=e;let c=1/0,h=null;for(let e=r,t=r+a;e<t;e++){var d=Ym(l,n,i,u?u[e]:e,null,o,s);d&&d.distance<c&&(h=d,c=d.distance)}return h}function ag(n,i,r,a,o,s,l){var e=r.geometry,u=e.index,c=e.attributes.position;for(let e=n,t=i+n;e<t;e++){var h=r.resolveTriangleIndex(e);if(qm(l,3*h,u,c),l.needsUpdate=!0,a(l,h,o,s))return!0}return!1}function og(r){let g=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;g&&Array.isArray(g)&&(g=new Set(g));var e=r.geometry;let v=e.index?e.index.array:null,_=e.attributes.position,n,y,a,E,i=0;var o=r._roots;for(let e=0,t=o.length;e<t;e++)n=o[e],y=new Uint32Array(n),a=new Uint16Array(n),E=new Float32Array(n),function d(p,f){let m=2<arguments.length&&void 0!==arguments[2]&&arguments[2];let e=2*p;let t=a[15+e]===Ro;{if(t){let n=y[p+6],i=a[14+e],o=1/0,s=1/0,l=1/0,u=-1/0,c=-1/0,h=-1/0;for(let e=n,t=n+i;e<t;e++){let a=3*r.resolveTriangleIndex(e);for(let r=0;r<3;r++){let e=a+r,t=(e=v?v[e]:e,_.getX(e)),n=_.getY(e),i=_.getZ(e);t<o&&(o=t),t>u&&(u=t),n<s&&(s=n),n>c&&(c=n),i<l&&(l=i),i>h&&(h=i)}}return(E[p+0]!==o||E[p+1]!==s||E[p+2]!==l||E[p+3]!==u||E[p+4]!==c||E[p+5]!==h)&&(E[p+0]=o,E[p+1]=s,E[p+2]=l,E[p+3]=u,E[p+4]=c,E[p+5]=h,!0)}{let s=p+8,l=y[p+6],e=s+f,t=l+f,n=m,i=!1,r=!1,a=(g?n||(i=g.has(e),r=g.has(t),n=!i&&!r):(i=!0,r=!0),n||i),o=n||r,u=!1,c=(a&&(u=d(s,f,n)),!1),h=(o&&(c=d(l,f,n)),u||c);if(h)for(let o=0;o<3;o++){let e=s+o,t=l+o,n=E[e],i=E[e+3],r=E[t],a=E[t+3];E[p+o]=n<r?n:r,E[p+o+3]=i>a?i:a}return h}}}(0,i),i+=n.byteLength}function sg(e,t,n,i,r,a,o){M.setBuffer(e._roots[t]),function n(i,r,a,o,s,l,u){let{float32Array:c,uint16Array:h,uint32Array:d}=M;let p=2*i;let e=Pm(p,h);if(e){let e=Um(i,d),t=Bm(p,h);ig(r,a,o,e,t,s,l,u)}else{let e=i+8,t=(Qm(e,c,o,l,u)&&n(e,r,a,o,s,l,u),Fm(i,d));Qm(t,c,o,l,u)&&n(t,r,a,o,s,l,u)}}(0,e,n,i,r,a,o),M.clearBuffer()}let Es=["x","y","z"];function lg(e,t,n,i,r,a){M.setBuffer(e._roots[t]);t=function c(h,d,p,f,m,g){let{float32Array:v,uint16Array:n,uint32Array:_}=M;let i=2*h;let e=Pm(i,n);{if(e){let e=Um(h,_),t=Bm(i,n);return rg(d,p,f,e,t,m,g)}{let n=zm(h,_),i=Es[n],e=f.direction[i],r=0<=e,t,a,o=(a=r?(t=h+8,Fm(h,_)):(t=Fm(h,_),h+8),Qm(t,v,f,m,g)),s=o?c(t,d,p,f,m,g):null;if(s){let e=s.point[i],t=r?e<=v[a+n]:e>=v[a+n+3];if(t)return s}let l=Qm(a,v,f,m,g),u=l?c(a,d,p,f,m,g):null;return s&&u?s.distance<=u.distance?s:u:s||u||null}}}(0,e,n,i,r,a);return M.clearBuffer(),t}let As=new pd,xs=new bT,Ts=new bT,Ss=new fd,ws=new MT,bs=new MT;function ug(e,t,n,i){M.setBuffer(e._roots[t]);t=function r(l,u,c,h){let a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;let{float32Array:d,uint16Array:t,uint32Array:p}=M;let f=2*l;null===a&&(c.boundingBox||c.computeBoundingBox(),ws.set(c.boundingBox.min,c.boundingBox.max,h),a=ws);let e=Pm(f,t);{if(!e){let e=l+8,t=p[l+6],n=(bm(e,d,As),a.intersectsBox(As)&&r(e,u,c,h,a));if(n)return!0;bm(t,d,As);let i=a.intersectsBox(As)&&r(t,u,c,h,a);return i?!0:!1}{let e=u.geometry,i=e.index,r=e.attributes.position,n=c.index,a=c.attributes.position,o=Um(l,p),s=Bm(f,t);if(Ss.copy(h).invert(),c.boundsTree){bm(l,d,bs),bs.matrix.copy(Ss),bs.needsUpdate=!0;let e=c.boundsTree.shapecast({intersectsBounds:e=>bs.intersectsBox(e),intersectsTriangle:n=>{n.a.applyMatrix4(h),n.b.applyMatrix4(h),n.c.applyMatrix4(h),n.needsUpdate=!0;for(let e=o,t=s+o;e<t;e++)if(qm(Ts,3*u.resolveTriangleIndex(e),i,r),Ts.needsUpdate=!0,n.intersectsTriangle(Ts))return!0;return!1}});return e}for(let t=o,e=s+o;t<e;t++){let e=u.resolveTriangleIndex(t);qm(xs,3*e,i,r),xs.a.applyMatrix4(Ss),xs.b.applyMatrix4(Ss),xs.c.applyMatrix4(Ss),xs.needsUpdate=!0;for(let e=0,t=n.count;e<t;e+=3)if(qm(Ts,e,n,a),Ts.needsUpdate=!0,xs.intersectsTriangle(Ts))return!0}}}}(0,e,n,i);return M.clearBuffer(),t}let Ms=new fd,Rs=new MT,Ns=new MT,Is=new dd,Cs=new dd,Ls=new dd,Ds=new dd;function cg(u,t,c){var e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};let h=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,r=6<arguments.length&&void 0!==arguments[6]?arguments[6]:1/0;t.boundingBox||t.computeBoundingBox(),Rs.set(t.boundingBox.min,t.boundingBox.max,c),Rs.needsUpdate=!0;var i=u.geometry;let d=i.attributes.position,p=i.index,f=t.attributes.position,m=t.index,g=w.getPrimitive(),v=w.getPrimitive(),_=Is,y=Cs,E=null,A=null,x=(n&&(E=Ls,A=Ds),1/0),T=null,S=null;return Ms.copy(c).invert(),Ns.matrix.copy(Ms),u.shapecast({boundsTraverseOrder:e=>Rs.distanceToBox(e),intersectsBounds:(e,t,n)=>n<x&&n<r&&(t&&(Ns.min.copy(e.min),Ns.max.copy(e.max),Ns.needsUpdate=!0),!0),intersectsRange:(s,l)=>{if(t.boundsTree){let o=t.boundsTree;return o.shapecast({boundsTraverseOrder:e=>Ns.distanceToBox(e),intersectsBounds:(e,t,n)=>n<x&&n<r,intersectsRange:(t,i)=>{for(let n=t,e=t+i;n<e;n++){var r=o.resolveTriangleIndex(n);qm(v,3*r,m,f),v.a.applyMatrix4(c),v.b.applyMatrix4(c),v.c.applyMatrix4(c),v.needsUpdate=!0;for(let e=s,t=s+l;e<t;e++){var a=u.resolveTriangleIndex(e),a=(qm(g,3*a,p,d),g.needsUpdate=!0,g.distanceToTriangle(v,_,E));if(a<x&&(y.copy(_),A&&A.copy(E),x=a,T=e,S=n),a<h)return!0}}}})}for(let n=0,e=Am(t);n<e;n++){qm(v,3*n,m,f),v.a.applyMatrix4(c),v.b.applyMatrix4(c),v.c.applyMatrix4(c),v.needsUpdate=!0;for(let e=s,t=s+l;e<t;e++){var i=u.resolveTriangleIndex(e),i=(qm(g,3*i,p,d),g.needsUpdate=!0,g.distanceToTriangle(v,_,E));if(i<x&&(y.copy(_),A&&A.copy(E),x=i,T=e,S=n),i<h)return!0}}}}),w.releasePrimitive(g),w.releasePrimitive(v),x===1/0?null:(e.point?e.point.copy(y):e.point=y.clone(),e.distance=x,e.faceIndex=T,n&&(n.point?n.point.copy(A):n.point=A.clone(),n.point.applyMatrix4(Ms),y.applyMatrix4(Ms),n.distance=y.sub(n.point).length(),n.faceIndex=S),e)}let Os=new M.constructor,Ps=new M.constructor,Us=new RT(()=>new pd),Bs=new pd,Fs=new pd,zs=new pd,ks=new pd,Gs=!1;function hg(e,t,n,i){if(Gs)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Gs=!0;var r=e._roots,a=t._roots;let o,s=0,l=0;var u=(new fd).copy(n).invert();for(let e=0,t=r.length;e<t;e++){Os.setBuffer(r[e]),l=0;var c=Us.getPrimitive();bm(0,Os.float32Array,c),c.applyMatrix4(u);for(let e=0,t=a.length;e<t&&(Ps.setBuffer(a[e]),o=function s(l,u,c,h,d){let p=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0;let f=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0;let m=7<arguments.length&&void 0!==arguments[7]?arguments[7]:0;let g=8<arguments.length&&void 0!==arguments[8]?arguments[8]:0;let n=9<arguments.length&&void 0!==arguments[9]?arguments[9]:null;let v=10<arguments.length&&void 0!==arguments[10]&&arguments[10];let e,t;t=v?(e=Ps,Os):(e=Os,Ps);let _=e.float32Array,y=e.uint32Array,i=e.uint16Array,E=t.float32Array,r=t.uint32Array,a=t.uint16Array;let o=2*l;let A=2*u;let x=Pm(o,i);let T=Pm(A,a);let S=!1;if(T&&x)S=v?d(Um(u,r),Bm(2*u,a),Um(l,y),Bm(2*l,i),g,f+u,m,p+l):d(Um(l,y),Bm(2*l,i),Um(u,r),Bm(2*u,a),m,p+l,g,f+u);else if(T){let e=Us.getPrimitive(),t=(bm(u,E,e),e.applyMatrix4(c),l+8),n=Fm(l,y),i=(bm(t,_,Bs),bm(n,_,Fs),e.intersectsBox(Bs)),r=e.intersectsBox(Fs);S=i&&s(u,t,h,c,d,f,p,g,m+1,e,!v)||r&&s(u,n,h,c,d,f,p,g,m+1,e,!v),Us.releasePrimitive(e)}else{let a=u+8,o=Fm(u,r),e=(bm(a,E,zs),bm(o,E,ks),n.intersectsBox(zs)),t=n.intersectsBox(ks);if(e&&t)S=s(l,a,c,h,d,p,f,m,g+1,n,v)||s(l,o,c,h,d,p,f,m,g+1,n,v);else if(e)if(x)S=s(l,a,c,h,d,p,f,m,g+1,n,v);else{let e=Us.getPrimitive(),t=(e.copy(zs).applyMatrix4(c),l+8),n=Fm(l,y),i=(bm(t,_,Bs),bm(n,_,Fs),e.intersectsBox(Bs)),r=e.intersectsBox(Fs);S=i&&s(a,t,h,c,d,f,p,g,m+1,e,!v)||r&&s(a,n,h,c,d,f,p,g,m+1,e,!v),Us.releasePrimitive(e)}else if(t)if(x)S=s(l,o,c,h,d,p,f,m,g+1,n,v);else{let e=Us.getPrimitive(),t=(e.copy(ks).applyMatrix4(c),l+8),n=Fm(l,y),i=(bm(t,_,Bs),bm(n,_,Fs),e.intersectsBox(Bs)),r=e.intersectsBox(Fs);S=i&&s(o,t,h,c,d,f,p,g,m+1,e,!v)||r&&s(o,n,h,c,d,f,p,g,m+1,e,!v),Us.releasePrimitive(e)}}return S}(0,0,n,u,i,s,l,0,0,c),Ps.clearBuffer(),l+=a[e].length,!o);e++);if(Us.releasePrimitive(c),Os.clearBuffer(),s+=r[e].length,o)break}return Gs=!1,o}let Hs=new MT,Vs=new pd,Ws={strategy:Ao,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class IT{static serialize(e){var t={cloneBuffers:!0,...1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}},n=e.geometry,i=e._roots,e=e._indirectBuffer,n=n.getIndex();let r;return r=t.cloneBuffers?{roots:i.map(e=>e.slice()),index:n?n.array.slice():null,indirectBuffer:e?e.slice():null}:{roots:i,index:n?n.array:null,indirectBuffer:e}}static deserialize(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n={setIndex:!0,indirect:Boolean(e.indirectBuffer),...n},{index:i,roots:r,indirectBuffer:a}=e,o=new IT(t,{...n,[Io]:!0});return o._roots=r,o._indirectBuffer=a||null,n.setIndex&&(null===(r=t.getIndex())?(a=new yd(e.index,1,!1),t.setIndex(a)):r.array!==i&&(r.array.set(i),r.needsUpdate=!0)),o}get indirect(){return!!this._indirectBuffer}constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({...Ws,[Io]:!1},t)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[Io]||(Hm(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new pd))),this.resolveTriangleIndex=t.indirect?e=>this._indirectBuffer[e]:e=>e}refit(){return(this.indirect?og:Jm)(this,0<arguments.length&&void 0!==arguments[0]?arguments[0]:null)}traverse(l){let u=this._roots[1<arguments.length&&void 0!==arguments[1]?arguments[1]:0],c=new Uint32Array(u),i=new Uint16Array(u);!function r(a){let o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;let n=2*a;let s=i[15+n]===Ro;if(s){let e=c[a+6],t=i[14+n];l(o,s,new Float32Array(u,4*a,6),e,t)}else{let e=a+Mo/4,t=c[a+6],n=c[a+7],i=l(o,s,new Float32Array(u,4*a,6),n);i||(r(e,o+1),r(t,o+1))}}(0)}raycast(n){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:ke,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1/0,o=this._roots,e=this.geometry,s=[],t=i.isMaterial,l=Array.isArray(i),u=e.groups,c=t?i.side:i,h=this.indirect?sg:$m;for(let e=0,t=o.length;e<t;e++){var d=l?i[u[e].materialIndex].side:c,p=s.length;if(h(this,e,d,n,s,r,a),l){var f=u[e].materialIndex;for(let e=p,t=s.length;e<t;e++)s[e].face.materialIndex=f}}return s}raycastFirst(n){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:ke,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1/0,o=this._roots,e=this.geometry,t=i.isMaterial,s=Array.isArray(i);let l=null;var u=e.groups,c=t?i.side:i,h=this.indirect?lg:eg;for(let e=0,t=o.length;e<t;e++){var d=s?i[u[e].materialIndex].side:c,d=h(this,e,d,n,r,a);null!=d&&(null==l||d.distance<l.distance)&&(l=d,s)&&(d.face.materialIndex=u[e].materialIndex)}return l}intersectsGeometry(n,i){let r=!1;var a=this._roots,o=this.indirect?ug:tg;for(let e=0,t=a.length;e<t&&!(r=o(this,e,n,i));e++);return r}shapecast(e){let o=w.getPrimitive(),s=this.indirect?ag:Km,{boundsTraverseOrder:n,intersectsBounds:i,intersectsRange:r,intersectsTriangle:l}=e;if(r&&l){let a=r;r=(e,t,n,i,r)=>!!a(e,t,n,i,r)||s(e,t,this,l,n,i,o)}else r=r||(l?(e,t,n,i)=>s(e,t,this,l,n,i,o):(e,t,n)=>n);let a=!1,u=0;var c=this._roots;for(let e=0,t=c.length;e<t;e++){var h=c[e];if(a=Wm(this,e,i,r,n,u))break;u+=h.byteLength}return w.releasePrimitive(o),a}bvhcast(t,c,e){let{intersectsRanges:n,intersectsTriangles:h}=e,d=w.getPrimitive(),i=this.geometry.index,r=this.geometry.attributes.position,p=this.indirect?e=>{e=this.resolveTriangleIndex(e);qm(d,3*e,i,r)}:e=>{qm(d,3*e,i,r)},f=w.getPrimitive(),a=t.geometry.index,o=t.geometry.attributes.position,m=t.indirect?e=>{e=t.resolveTriangleIndex(e);qm(f,3*e,a,o)}:e=>{qm(f,3*e,a,o)};if(h){let u=(i,r,t,a,o,s,l,u)=>{for(let n=t,e=t+a;n<e;n++){m(n),f.a.applyMatrix4(c),f.b.applyMatrix4(c),f.c.applyMatrix4(c),f.needsUpdate=!0;for(let e=i,t=i+r;e<t;e++)if(p(e),d.needsUpdate=!0,h(d,f,e,n,o,s,l,u))return!0}return!1};if(n){let l=n;n=function(e,t,n,i,r,a,o,s){return!!l(e,t,n,i,r,a,o,s)||u(e,t,n,i,r,a,o,s)}}else n=u}return hg(this,t,c,n)}intersectsBox(e,t){return Hs.set(e.min,e.max,t),Hs.needsUpdate=!0,this.shapecast({intersectsBounds:e=>Hs.intersectsBox(e),intersectsTriangle:e=>Hs.intersectsTriangle(e)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(e,t){return(this.indirect?cg:ng)(this,e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,5<arguments.length&&void 0!==arguments[5]?arguments[5]:1/0)}closestPointToPoint(e){return function(e,n,t,i,r){var t=2<arguments.length&&void 0!==t?t:{},i=3<arguments.length&&void 0!==i?i:0,r=4<arguments.length&&void 0!==r?r:1/0;let a=i*i,o=r*r,s=1/0,l=null;return e.shapecast({boundsTraverseOrder:e=>(Xo.copy(n).clamp(e.min,e.max),Xo.distanceToSquared(n)),intersectsBounds:(e,t,n)=>n<s&&n<o,intersectsTriangle:(e,t)=>{e.closestPointToPoint(n,Xo);e=n.distanceToSquared(Xo);return e<s&&(Zo.copy(Xo),s=e,l=t),e<a}}),s===1/0?null:(i=Math.sqrt(s),t.point?t.point.copy(Zo):t.point=Zo.clone(),t.distance=i,t.faceIndex=l,t)}(this,e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,3<arguments.length&&void 0!==arguments[3]?arguments[3]:1/0)}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(e=>{bm(0,new Float32Array(e),Vs),t.union(Vs)}),t}}Qh=qA||null,parseInt(l);let js=new oA,Ys=new dd,qs=new fd,Xs=xd.prototype.raycast,Zs=null!==Qh?Qh.prototype.raycast:null,Ks=new dd,p=new xd,Js=[];var $h=Kh(613),td=Kh.n($h),Qh,$h,dg,$h,$h,pg;function fg(){return{cube:{count:0,max:10,instanced:!0,interactive:!0,roughness:.2,envIntensity:.5,wall:!1,ground:!1,ceiling:!0,trigger:!1},cube_2:{count:0,max:10,instanced:!0,interactive:!0,roughness:.2,envIntensity:.5,wall:!1,ground:!1,ceiling:!0,trigger:!1},scale_cube:{count:0,max:10,instanced:!0,interactive:!0,roughness:.2,envIntensity:.5,wall:!1,ground:!1,ceiling:!0,trigger:!1},door:{count:0,max:5},door:{count:0,max:5},sphere:{count:0,max:10,instanced:!0,interactive:!0,roughness:.2,envIntensity:.5,wall:!1,ground:!1,ceiling:!0,trigger:!1},gel_gun_blue:{count:0,max:10},gel_gun_orange:{count:0,max:10},gel_gun_white:{count:0,max:10},pedestal_button:{count:0,max:10,instanced:!0,interactive:!0,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!0},radio:{count:0,max:1,instanced:!0,interactive:!0,roughness:.2,envIntensity:.5,wall:!1,ground:!0,ceiling:!1,trigger:!1},button_weight:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},button_box:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!0},button_sphere:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!0},dispenser:{count:0,max:100,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!1,ground:!1,ceiling:!0,trigger:!1},ramp:{count:0,max:10},ramp_half:{count:0,max:10},ramp_half2:{count:0,max:10},stairs:{count:0,max:10},light_bridge:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},tractor_beam:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},laser_emitter:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},laser_receiver:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},laser_relay:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},pellet_launcher:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},pellet_catcher:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},laser_cube:{count:0,max:10,instanced:!0,interactive:!0,roughness:.2,envIntensity:.5,wall:!1,ground:!1,ceiling:!0,trigger:!1},faith_plate:{count:0,max:10,instanced:!1,interactive:!1,roughness:.2,envIntensity:.5,wall:!1,ground:!0,ceiling:!1,trigger:!1},light:{count:0,max:20,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},lightEmissive:{count:0,max:10,instanced:!1,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},stripe:{count:0,max:10},gel_blue:{count:0,max:10},gel_recharger:{count:0,max:10},gel_reflection:{count:0,max:10},gel_clear:{count:0,max:10},gel_white:{count:0,max:10},angled_panel:{count:0,max:10,instanced:!1,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},gel_orange:{count:0,max:10},gel_purple:{count:0,max:10},camera:{count:0,max:5,instanced:!1,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!1,ceiling:!1,trigger:!1},bed:{count:0,max:5,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!1,ground:!0,ceiling:!1,trigger:!1},incinerator:{count:0,max:5,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!1,ground:!0,ceiling:!1,trigger:!0},trash:{count:0,max:5,instanced:!0,interactive:!0,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},toilet:{count:0,max:5,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!1,ground:!0,ceiling:!1,trigger:!1},desk:{count:0,max:20,instanced:!0,interactive:!1,roughness:.2,envIntensity:.8,wall:!1,ground:!0,ceiling:!1,trigger:!1},step:{count:0,max:20,instanced:!0,interactive:!1,roughness:.2,envIntensity:.8,wall:!1,ground:!0,ceiling:!1,trigger:!1},cabinet:{count:0,max:5,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!1,ground:!0,ceiling:!1,trigger:!1},sign:{count:0,max:5,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!1,ground:!0,ceiling:!1,trigger:!1},portal_0:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},portal_1:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},laser_field:{count:0,max:20,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},fizzler:{count:0,max:20,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},observation_room:{count:0,max:10},glass:{count:0,max:20},portal_gun:{count:0,max:1,instanced:!1,interactive:!1,roughness:.2,envIntensity:.5,wall:!1,ground:!0,ceiling:!1,trigger:!1},paint_gun:{count:0,max:1},trigger_area:{count:0,max:10},trigger_voice:{count:0,max:10},trigger_audio:{count:0,max:10},trigger_save:{count:0,max:10},portal:{count:0,max:10},spawn:{count:0,max:1},piston_platforms:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!1,trigger:!0},track_platforms:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!1,trigger:!0}}}Ad.prototype.computeBoundsTree=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this.boundsTree=new IT(this,e),this.boundsTree},Ad.prototype.disposeBoundsTree=function(){this.boundsTree=null},xd.prototype.raycast=function(e,t){(this.isBatchedMesh?function(t,i){if(this.boundsTrees){var r=this.boundsTrees,a=this._drawInfo,o=this._drawRanges,s=this.matrixWorld,e=(p.material=this.material,p.geometry=this.geometry,p.geometry.boundsTree),n=p.geometry.drawRange;null===p.geometry.boundingSphere&&(p.geometry.boundingSphere=new aA);for(let n=0,e=a.length;n<e;n++)if(this.getVisibleAt(n)){var l=a[n].geometryIndex;p.geometry.boundsTree=r[l],this.getMatrixAt(n,p.matrixWorld).premultiply(s),p.geometry.boundsTree||(this.getBoundingBoxAt(l,p.geometry.boundingBox),this.getBoundingSphereAt(l,p.geometry.boundingSphere),l=o[l],p.geometry.setDrawRange(l.start,l.count)),p.raycast(t,Js);for(let e=0,t=Js.length;e<t;e++){var u=Js[e];u.object=this,u.batchId=n,i.push(u)}Js.length=0}p.geometry.boundsTree=e,p.geometry.drawRange=n,p.material=null,p.geometry=null}else Zs.call(this,t,i)}:function(n,i){if(this.geometry.boundsTree){if(void 0!==this.material){qs.copy(this.matrixWorld).invert(),js.copy(n.ray).applyMatrix4(qs),Ks.setFromMatrixScale(this.matrixWorld),Ys.copy(js.direction).multiply(Ks);var e=Ys.length(),t=n.near/e,e=n.far/e,r=this.geometry.boundsTree;if(!0===n.firstHitOnly){var a=Em(r.raycastFirst(js,this.material,t,e),this,n);a&&i.push(a)}else{var o=r.raycast(js,this.material,t,e);for(let e=0,t=o.length;e<t;e++){var s=Em(o[e],this,n);s&&i.push(s)}}}}else Xs.call(this,n,i)}).call(this,e,t)},/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(wv=!0,vg=!(id=.5),Gv=1,pg=!(dg=63),document.getElementById("next-map").style.transform="scale(0.5)",td()(".desktop").css("display","none")):(vg=!(wv=!(id=.5)),Gv=2,dg=63,pg="true"==localStorage.getItem("antialising")),window.canvasWidth=window.innerWidth,window.canvasHeight=window.innerHeight,window.canvasWidth=Math.min(window.canvasWidth,1920),window.canvasHeight=Math.min(window.canvasHeight,1080),(Qh=new fA(dg,window.canvasWidth/window.canvasHeight,.1,1e3)).rotation.order="YXZ",Qh.position.set(0,0,30),window.fov=dg,($h=new gd).name="listener",Qh.add($h),Math.atan(Math.tan(Qh.fov*Math.PI/180/2)*Qh.aspect),Math.PI,(dg=Qh.clone()).layers.mask=2,dg.near=1e-5,dg.updateProjectionMatrix(),($h=new gd).position.z=-1.25,$h.name="cubeHolder",window.cubeHolder=$h,Qh.add($h),($h=new UA({alpha:!0,powerPreference:"high-performance",antialias:pg})).setPixelRatio(window.devicePixelRatio),$h.setSize(window.canvasWidth,window.canvasHeight),$h.outputColorSpace=je,$h.toneMapping=B,$h.toneMappingExposure=1,$h.shadowMap.enabled=vg,$h.shadowMap.type=b,$h.shadowMap.needsUpdate=!0,$h.localClippingEnabled=!0,$h.physicallyCorrectLights=!0,$h.domElement.id="viewer-3d",$h.shadowMap.autoUpdate=!0,(pg=new TT(Qh,$h.domElement)).minDistance=0;var nd={LASERS:new Sd,STATS_UI:{time:0,portals:0,steps:0},BOUNDING_BOX:[],PLATFORM_BODIES:[],FINISHED:!1,PIXEL_RATIO:id,DEBUGGER_GROUP:new Sd,SCENE:new BA,SCENE_CHILDREN:new Sd,MAIN_CAMERA:Qh,MAIN_CAMERA_GROUP:new Sd,PIVOT:null,PORTAL_GUN_CAMERA:dg,CONTROLS:pg,POINTER_CONTROLS:null,RENDERER:$h,COMPOSER:null,COMPOSER2:null,ITEM_HOLDED_NAME:null,FPS_MODE:!1,MOBILE:wv,PAUSED:!1,CONNECTING:!1,STOP_TIME:!1,FPS_UNLOCKED:!0,HOLDING_ITEM:!1,ALLOW_PLACE_PORTALS:!0,GEL_ORANGE:!1,LOADED_LEVEL:!1,ITEMS_ADDED:new Sd,ROOM:new Sd,ITEMS:new Sd,CUBES:new Sd,PLANE_USER_DATA:[],PLANE_LEVEL_INSTANCED:null,BUDGET:3e3,PORTALS:[null,null],PORTAL_RECURSION_LEVELS:Gv,PORTAL_TARGETS:[new nA(+window.canvasWidth,+window.canvasHeight),new nA(+window.canvasWidth,+window.canvasHeight)],PORTAL_TMP_TARGETS:[new nA(+window.canvasWidth,+window.canvasHeight),new nA(+window.canvasWidth,+window.canvasHeight)],PORTAL_WIDTH:.9,PORTAL_DEPTH:1.8,PORTAL_EPS:.01,PORTAL_COLORS:[57855,16762368],PORTAL_CDBB_HEIGHT:3,PORTAL_HEIGHT:.2,PORTAL_RING_THICKNESS:.3,PORTAL_SHADER:[],PORTAL_BOX:[],PORTAL_INNER_BOX:[],CANNON_WORLD:null,CGROUP_ENVIRONMENT:1,CGROUP_PORTAL_HOST_CDISABLE:[2,4],CGROUP_DYNAMIC:8,CGROUP_ALL:255,PHYSICS_UPDATEPERSEC_LIMIT:75,PHYSICS_MATERIAL:new ed.Material({friction:.01,restitution:.1}),PLAYER:null,PLAYER_MODEL:null,PLAYER_MODEL_CLONE:null,PLAYER_ANIMATIONS:null,MIXERS:null,MIXERS_CLONE:null,BOX_BODY:[],SPHERE_BODY:[],TRIGGER:{button_weight:[],button_box:[],button_sphere:[],pedestal_button:[]},DYMANIC_ITEMS:{cube:[],cube_2:[],scale_cube:[],sphere:[],gel_gun_blue:[],gel_gun_orange:[],gel_gun_white:[],pedestal_button:[],radio:[],button_weight:[],button_box:[],button_sphere:[],dispenser:[],ramp:[],ramp_half:[],ramp_half2:[],stairs:[],light_bridge:[],tractor_beam:[],laser_emitter:[],laser_receiver:[],laser_relay:[],laser_cube:[],faith_plate:[],door:[],light:[],lightEmissive:[],stripe:[],gel_blue:[],gel_recharger:[],gel_reflection:[],gel_clear:[],gel_orange:[],gel_purple:[],gel_white:[],camera:[],portal_0:[],portal_1:[],laser_field:[],fizzler:[],glass:[],portal_gun:[],trigger_area:[],trigger_save:[],trigger_voice:[],trigger_audio:[],pellet_launcher:[],pellet_catcher:[],angled_panel:[],paint_gun:[],spawn:[],bed:[],trash:[],toilet:[],desk:[],cabinet:[],sign:[],piston_platforms:[],track_platforms:[],incinerator:[],step:[]},TRIGGER_BOXES:[],INTERACTIVE:[],ITEM_CUBE:null,DYNAMIC_OBJECTS:[],SELECTED_ID:[],SELECTED_ID_ORANGE:[],SELECTED_SIDE:null,SELECTED_COLOR:[],SELECTED:null,SELECTING:!1,SELECTED_FOR_CONNECTION:null,GELS:[],CURRENT_ITEM:null,CURRENT_ITEM_ID:null,GUN:null,GUN_CLONE:null,GUN_CLONE2:null,GUN_MODE:"portal",ENV_MAP:null,STATS:null,INK_MATERIAL:null,CORRIDOR_ENTER:null,ENTER_DOOR:null,EXIT_DOOR:null,LASER_EMITTER:[],LASER_EMITTER_OBJ:[],LASER_EMITTER_LENGTH:0,LASER_EMITTER_BOUNDING_BOX:[],LASER_EMITTER_RAYCASTER:[],LASER_CUBE:null,TRACTOR_BEAM:[],TRACTOR_BEAM_BOUNDING_BOX:[],TRACTOR_BEAM_RAYCASTER:[],TRACTOR_BEAM_LENGTH:0,LIGHT_BRIDGE_RAYCASTER:[],LIGHT_BRIDGE_CLONE:[],LIGHT_BRIDGE_COLLIDER_CLONE:[],LIGHT_BRIDGE_TRIGGER:"Middle Horizontal",GLASS_TRIGGER:"Middle Vertical",LASER_FIELD_TRIGGER:"Middle Vertical",FIZZLER_TRIGGER:"Middle Vertical",LASER_FIELD_RAYCASTER:[],FIZZLER_RAYCASTER:[],GLASS_RAYCASTER:[],LIGHT_GROUP:null,INTERVAL:1/60,CURRENT_INSTANCED:null,CAMERA_OBJ_HORIZONTAL:[],CAMERA_OBJ_VERTICAL:[],MATERIAL_PORTAL_EDITOR:null,MATERIAL_NON_PORTAL_EDITOR:null,OBSERVATION_ROOM:null,OBSERVATION_ROOM_IMG:null,OBSERVATION_ROOM_HALF:null,IMG_CHECK:null,IMG_CLOSE:null,SMOOTHNESS:.1,GOO_PLANES:[],GOO_BOXES:[],FAITH_PLATE_TO_ROTATE:[],FAITH_PLATE_CONTACT_BOX:[],UNIFORMS_GEL:null,UNIFORMS_LIGHT_BRIDGE:null,UNIFORMS_TRACTOR_BEAM:null,UNIFORMS_TRACTOR_BEAM_ORANGE:null,UNIFORMS_PORTAL_GUN_ENERGY:null,UNIFORMS_FIZZLER:null,UNIFORMS_DISSOLVER:null,MATERIAL_DISSOLVER:null,LIGHTNIN_STRIKE_1:null,LIGHTNIN_STRIKE_2:null,LIGHTNIN_STRIKE_3:null,TARGET_ROTATION_X:0,TARGET_ROTATION_Y:0,SPOTLIGHT:null,DOORS:[],MATERIAL_FLOOR_PORTAL:null,MATERIAL_FLOOR_NON_PORTAL:null,MATERIAL_WALL_PORTAL:null,MATERIAL_WALL_PORTAL2:null,MATERIAL_WALL_PORTAL3:null,MATERIAL_WALL_PORTAL4:null,MATERIAL_WALL_NON_PORTAL:null,MATERIAL_WALL_NON_PORTAL2:null,MATERIAL_GUN:null,MATERIAL_MAIN_MENU:null,MATERIAL_SUB_MENU:null,TEXTURE_MENU_GRID:null,MATERIAL_TRACTOR_BEAM:null,MATERIAL_TRACTOR_BEAM_REVERSE:null,MATERIAL_LIGHT_BRIDGERS:null,MATERIAL_LASER_FIELD:null,MATERIAL_FIZZLER:null,UNIFORMS_LASER_FIELD:null,ELEVATOR:null,ELEVATOR_DOOR_LEFT:null,ELEVATOR_DOOR_RIGHT:null,ELEVATOR_TRIGGER:null,WALL_CORRIDOR_ENTER:null,BODY_ELEVATOR:null,WALL_CORRIDOR_BACK:null,CORRIDOR_COLLIDERS:[],PLANE_EXIT_DOOR:null,PORTAL_GUN_CLONE_STATE:!0,PLAYER_CLONE_STATE:!0,FLASH:null,FLASH_CLONE:null,PORTAL_GUN_FLASH:null,PORTAL_RENDER_LEVEL:0,LIGHT_PORTAL_0:null,LIGHT_PORTAL_1:null,RADIO_MUSIC:[],CAMERAS:[],ITEMS_COUNT:fg(),SCENE_FPS:null,LISTENER:new pT,CANNON_BODIES:[],CANNON_BODIES_CONTINUOUS:[],LEVEL_ENTERED:!1,DOOR_OPEN_STATE:!1,AMBIENT_AUDIO:null,PORTAL_AUDIO:[],DRAGGING:!1,DRAGGED_ITEM_ELEMENT:null,CURRENT_LINE:null,CONNECTIONS:[],POSITIONAL_AUDIO_GROUP:null,PORTAL_AUDIO:[new gd,new gd],SELECTED_FOR_BLOOM:null,PLAYER_MOVING:!1,GLASS_PANELS:[],RESIZING_GLASS_PANEL:!1,BLOCK_PORTAL:[],MATERIAL_GLASS:null,MATERIAL_GRID:null,GRID_STATE:!1,LOADED_CONNECTIONS:[],PORTAL_GUN_INITIATE:"all",PORTAL_GUN_INITIATE_HOLDER:null,TELEPORTING_TARGET_QUATERNION:null,PORTAL_GUN_BOX:[],WALL_BODIES:[],ACTIVATED:[],SOUNDS_FPS:[],MATERIAL_TRIGGER_ONCE:null,MATERIAL_TRIGGER_MULT:null,BATCHED_ORANGE:null,BATCHED_BLUE:null,BATCHED_GLASS:null,BATCHED_GRID:null,LASER_EMITTER_PORTAL_CLONES:[],DYNAMIC_BODIES:[],LASER_EMITTER_TRIGGER:"Bottom",LASER_RECEIVER_TRIGGER:"Bottom",LASER_TRIGGERS:[],MATERIAL_CONE:null,BLOCK_PLAYER_MOVE:!1,FAITH_PLATE_TARGET:null,GROUP_LINE_TRAGECTORY:new Sd,GOO_REFLECTIONS:!1,CUSTOM_GRAVITY:[],SPEED:1,HEAD_BOB_SPEED:6,ANGLED_PANELS:[],INSTANCED_WHITE_GEL:[],GEL_TRIGGER:[],PAINTING_GUN_MODE:[],PAINT_GUN:null,GUN_GROUP:new Sd,LINES:new Sd};function mg(e,t,n,i,r,a,o,s,l,u,c,h,d){var p;e.roughness=s,e.metalness=l,t&&((p=(new wd).load("./assets/textures/"+t)).colorSpace=je,e.map=p,h)&&gg(p,h,d),n&&(p=(new wd).load("./assets/textures/"+n),e.normalMap=p,h)&&gg(p,h,d),i&&(p=(new wd).load("./assets/textures/"+i),e.aoMap=p,h)&&gg(p,h,d),r&&(p=(new wd).load("./assets/textures/"+r),e.roughnessMap=p,h)&&gg(p,h,d),a&&(p=(new wd).load("./assets/textures/"+a),e.metalnessMap=p,h)&&gg(p,h,d),o&&(p=(new wd).load("./assets/textures/"+o),e.alphaMap=p,h)&&gg(p,h,d),e.envMap=nd.ENV_MAP,e.alphaTest=c,nd.MOBILE||"epic"!=localStorage.getItem("quality-select")&&"high"!=localStorage.getItem("quality-select")?e.envMapIntensity=.5:e.envMapIntensity=1.5*u}function gg(e,t,n){e.wrapS=e.wrapT=H,e.repeat.set(t,n),e.needsUpdate=!0}nd.SCENE.add(nd.SCENE_CHILDREN);var vg=new wd,id,Qh=((id=vg.load("./assets/textures/decal/base2.png")).colorSpace=je,vg.load("./assets/textures/decal/normal.webp")),dg=(nd.INK_MATERIAL=new Ox({normalMap:Qh,normalScale:new ld(1,1),transparent:!0,depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-4,wireframe:!1,roughness:0}),(new wd).load("./assets/textures/tilePortal.jpg")),dg=(id.colorSpace=je,nd.MATERIAL_PORTAL_EDITOR=new Ox({map:dg,transparent:!0}),(new wd).load("./assets/textures/tileNonPortal.jpg"));function _g(e,t,n){e.material=t.clone();n*=5;t=e.material.map.clone(),(e.material.map=t).repeat.set(5,n),t.needsUpdate=!0,t=e.material.normalMap.clone();(e.material.normalMap=t).repeat.set(5,n),t.needsUpdate=!0,e.material.metalnessMap&&(t=e.material.metalnessMap.clone(),(e.material.metalnessMap=t).repeat.set(5,n),t.needsUpdate=!0),e.material.alphaMap&&(t=e.material.alphaMap.clone(),(e.material.alphaMap=t).repeat.set(5,n),t.needsUpdate=!0),e.material.roughnessMap&&(t=e.material.roughnessMap.clone(),(e.material.roughnessMap=t).repeat.set(5,n),t.needsUpdate=!0)}id.colorSpace=je,nd.MATERIAL_NON_PORTAL_EDITOR=new Ox({map:dg,transparent:!0}),nd.IMG_CHECK=(new wd).load("./assets/check.png"),nd.IMG_CLOSE=(new wd).load("./assets/close.png");var yg,dg=(new wd).load("./assets/textures/trigger_once.jpg"),dg=(id.colorSpace=je,nd.MATERIAL_TRIGGER_ONCE=new _d({map:dg}),(new wd).load("./assets/textures/trigger_mult.jpg")),dg=(id.colorSpace=je,nd.MATERIAL_TRIGGER_MULT=new _d({map:dg}),(new wd).load("./assets/textures/cone.png"));function Eg(e){e.link&&!e.played&&(window.previousAudio&&(window.previousAudio.currentTime=0,window.previousAudio.pause()),e.played=!0,e.voice.currentTime=0,e.voice.play(),window.previousAudio=e.voice)}function Ag(e){0<e.currentTime&&!e.paused&&!e.ended&&e.readyState>e.HAVE_CURRENT_DATA||(e.volume=e.getAttribute("volume"),void 0!==(e=e.play())&&e.then(e=>{}).catch(e=>{}))}function xg(e,t,n,i,r,a,o){window.listernAdded||(window.listernAdded=!0,(yg=new pT).name="listener",nd.MAIN_CAMERA.add(yg)),yg.context.resume();var s=new mT(yg),e=document.getElementById(e).cloneNode(!0);e.id="",s.setMediaElementSource(e),s.setRefDistance(1),s.setMaxDistance(a),s.setDistanceModel("linear"),s.setVolume(.5),s.volume=.5,s.audio=e,s.audio.loop=i,!n||0<(a=s.audio).currentTime&&!a.paused&&!a.ended&&a.readyState>a.HAVE_CURRENT_DATA||a.play(),t[o]=s,nd.SCENE_FPS.add(s),r&&s.position.copy(t.position),nd.SOUNDS_FPS.push(s)}function Tg(e,t){for(var n=0;n<e.length;n++)0!=e[n].length&&(xg(t,e[n],!0,!0,!0,2),"audio-fizzler"!=t&&"audio-laser-beam"!=t||xg(t,e[n].cloneLaserField,!0,!0,!0,2))}function Sg(e){let t=e;.1<e.volume?(e.volume-=.1,e.timeout=setTimeout(()=>{Sg(t)},100)):(e.pause(),e.volume=1)}id.colorSpace=je,nd.MATERIAL_CONE=new Ox({map:dg,transparent:!0,opacity:.05,emissive:new vd(2,2,0),side:2}),window.listernAdded=!1;var rd={AMBIENT:document.getElementById("AUDIO-AMBIENT"),EDITOR:document.getElementById("AUDIO-EDITOR"),PORTAL_GUN_BLUE:document.getElementById("AUDIO-PORTAL_GUN_BLUE"),PORTAL_GUN_ORANGE:document.getElementById("AUDIO-PORTAL_GUN_ORANGE"),PORTAL_ENTER:document.getElementById("AUDIO-PORTAL_ENTER"),PORTAL_EXIT:document.getElementById("AUDIO-PORTAL_EXIT"),PORTAL_GUN_LOOP:document.getElementById("AUDIO-PORTAL_GUN_LOOP"),PORTAL_INVALID:document.getElementById("AUDIO-PORTAL_INVALID"),FALLING:document.getElementById("AUDIO-FALLING"),PICK_FAIL:document.getElementById("AUDIO-PICK_FAIL"),PICK_SUCESS:document.getElementById("AUDIO-PICK_SUCESS"),HOLD:document.getElementById("AUDIO-HOLD"),PLAYER_INSIDE_TRACTOR_BEAM:document.getElementById("AUDIO-PLAYER_INSIDE_TRACTOR_BEAM"),DEATH:document.getElementById("AUDIO-DEATH"),WALK:document.getElementById("AUDIO-WALK"),JUMP:document.getElementById("AUDIO-JUMP"),AERIAL:document.getElementById("AUDIO-AERIAL"),POSITIVE:document.getElementById("AUDIO-POSITIVE"),PROPULSION:document.getElementById("AUDIO-PROPULSION")},wg=(rd.AMBIENT.value=1,nd.MOBILE||td()(".mobile").css("display","none"),td()("body").on("click","#close-warning",function(){td()("#initial-warning").css("display","none")}),td()("body").on("click",".settings-audio",function(){td()("#options-audio").css("display","block"),td()("#options-settings").css("display","none"),td()(".settings-menu").css("width","50%"),td()("#settings-menu-title").text("AUDIO"),td()("#done").css("display","block")}),td()("body").on("click",".settings-video",function(){td()("#options-video").css("display","block"),td()("#options-settings").css("display","none"),td()(".settings-menu").css("width","50%"),td()("#settings-menu-title").text("GRAPHICS"),td()("#done").css("display","block")}),td()("body").on("click",".settings-controls",function(){td()("#options-controls").css("display","block"),td()("#options-settings").css("display","none"),td()(".settings-menu").css("width","50%"),td()("#settings-menu-title").text("CONTROLS"),td()("#done").css("display","block")}),td()("body").on("click","#done",function(){td()("#options-video").css("display","none"),td()("#options-controls").css("display","none"),td()("#options-audio").css("display","none"),td()("#options-settings").css("display","block"),td()(".settings-menu").css("width","25%"),td()("#settings-menu-title").text("OPTIONS"),td()("#done").css("display","none")}),td()("body").on("click",".optionQuality",function(){alert("You need to reload the page to apply!")}),td()("#quality-select").on("change",function(){localStorage.setItem("quality-select",td()(this).val()),nd.RENDERER.shadowMap.enabled=!1,"potato"==td()(this).val()?(td()("#recursive-select").val(2).change(),td()("#recursive-render-select").val(0).change(),td()("#resolution-select").val(.5).change(),td()("#shadows-resolution-select").val(512).change(),localStorage.setItem("antialising",!1)):"very_low"==td()(this).val()?(td()("#recursive-select").val(2).change(),td()("#recursive-render-select").val(0).change(),td()("#resolution-select").val(.5).change(),td()("#shadows-resolution-select").val(256).change(),localStorage.setItem("antialising",!1)):"low"==td()(this).val()?(td()("#recursive-select").val(2).change(),td()("#recursive-render-select").val(0).change(),td()("#resolution-select").val(.8).change(),td()("#shadows-resolution-select").val(1024).change(),localStorage.setItem("antialising",!1)):"medium"==td()(this).val()?(td()("#recursive-select").val(2).change(),td()("#recursive-render-select").val(0).change(),td()("#resolution-select").val(1).change(),td()("#shadows-resolution-select").val(1024).change(),localStorage.setItem("antialising",!0)):"high"!=td()(this).val()&&"epic"!=td()(this).val()||(nd.RENDERER.shadowMap.enabled=!0,td()("#recursive-select").val(2).change(),td()("#recursive-render-select").val(1).change(),td()("#resolution-select").val(1).change(),td()("#shadows-resolution-select").val(2048).change(),localStorage.setItem("antialising",!0),nd.RENDERER.shadowMap.autoUpdate=!0),bg()}),td()("#recursive-select").on("change",function(){nd.PORTAL_RECURSION_LEVELS=td()(this).val(),bg()}),td()("#recursive-render-select").on("change",function(){nd.PORTAL_RENDER_LEVEL=td()(this).val(),bg()}),td()("#resolution-select").on("change",function(){nd.PIXEL_RATIO=td()(this).val(),wg&&(nd.RENDERER.setPixelRatio(window.devicePixelRatio*td()(this).val()),bg())}),td()("#shadows-resolution-select").on("change",function(){wg&&(nd.SPOTLIGHT.shadow.mapSize.width=td()(this).val(),nd.SPOTLIGHT.shadow.mapSize.height=td()(this).val()),nd.RENDERER.shadowMap.autoUpdate=!0,nd.RENDERER.shadowMap.autoUpdate=!1,bg()}),td()("body").on("input","#option-stats",function(){localStorage.setItem("option-stats",this.checked),this.checked?td()("#main-container").css("display","block"):td()("#main-container").css("display","none"),bg()}),td()("#vol-val-range").on("input",function(){localStorage.setItem("vol-val-range",td()(this).val()),td()("#vol-val-number").val(td()(this).val()),td()(this).val()}),td()("#fov-val-range").on("input",function(){}),td()("#mouse-val-range").on("input",function(){localStorage.setItem("mouse-val-range",td()(this).val()),td()("#mouse-val-number").val(td()(this).val()),nd.MOBILE||(nd.POINTER_CONTROLS.pointerSpeed=td()(this).val()),bg()}),td()("#reset-control").on("click",function(){td()("#fov-val-range").val(60).trigger("input"),td()("#mouse-val-range").val(.5).trigger("input")}),td()("body").on("input","#opacity-val-range",function(){td()("#opacity-val-number").val(td()(this).val()),td()("#mobile-controls").css("opacity",td()(this).val())}),td()("#arrow-menu").click(function(){"0px"==td()("#side-bar-left").css("left")?(td()("#side-bar-left").css("left","-350px"),td()("#arrow-menu i").addClass("fa-chevron-right"),td()("#arrow-menu i").removeClass("fa-chevron-left")):(td()("#side-bar-left").css("left","0px"),td()("#arrow-menu i").removeClass("fa-chevron-right"),td()("#arrow-menu i").addClass("fa-chevron-left"))}),td()(".item").mouseenter(function(){td()("#info-box").css("opacity",1),td()("#info-title").text(td()(this).data("title")),td()("#info-content").text(td()(this).data("content"))}),td()(".item").mouseleave(function(){td()("#info-box").css("opacity",0)}),!1);function bg(){wg&&(nd.PAUSED=!1,setTimeout(()=>{nd.PAUSED=!0},100),localStorage.setItem("saved",!0))}function Mg(){0==Math.abs(window.orientation)?td()("#mobile-warning").css("display","flex"):td()("#mobile-warning").css("display","none")}localStorage.getItem("saved")||(td()("#recursive-select").val(nd.PORTAL_RECURSION_LEVELS).change(),td()("#resolution-select").val(.5).change(),td()("#shadows-resolution-select").val(512).change()),localStorage.getItem("vol-val-range")&&td()("#vol-val-range").val(localStorage.getItem("vol-val-range")).trigger("input"),wg=!0,td()("#social-youtube").on("click",function(){window.open("https://www.youtube.com/@Rafa_dante")}),td()("#social-twitter").on("click",function(){window.open("https://x.com/RafaTecXR")}),td()("#social-discord").on("click",function(){window.open("https://discord.com/invite/dNj7TPBy2R")}),td()("#option-download").on("click",function(){window.open("https://drive.google.com/drive/folders/1V4JBopiETzoDdxIogca9_7XqLjbSaHTd?usp=sharing","_blank")}),window.addEventListener("orientationchange",e=>{nd.MOBILE&&Mg()}),Mg(),td()("body").on("input","#option-player",function(){localStorage.setItem("option-player",this.checked),this.checked?(window.playerState=!0,nd.SCENE_CHILDREN.add(nd.PLAYER_MODEL),nd.SCENE_FPS.add(nd.GUN_CLONE),nd.SCENE_FPS.add(nd.GUN_CLONE2)):(window.playerState=!1,nd.SCENE_CHILDREN.remove(nd.PLAYER_MODEL),nd.SCENE_CHILDREN.remove(nd.PLAYER_MODEL_CLONE),nd.SCENE_FPS.remove(nd.GUN_CLONE),nd.SCENE_FPS.remove(nd.GUN_CLONE2)),bg()}),"true"==localStorage.getItem("option-player")&&(td()("#option-player").prop("checked",!0),window.playerState=!0);class CT{constructor(e){this.elements=e=void 0===e?[0,0,0,0,0,0,0,0,0]:e}identity(){var e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){var e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){var t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){void 0===e&&(e=new Rd);var t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){void 0===t&&(t=new Rd);var n=this.elements,i=e.x,r=e.y,e=e.z;return t.x=n[0]*i+n[1]*r+n[2]*e,t.y=n[3]*i+n[4]*r+n[5]*e,t.z=n[6]*i+n[7]*r+n[8]*e,t}smult(t){for(let e=0;e<this.elements.length;e++)this.elements[e]*=t}mmult(e,t){void 0===t&&(t=new CT);var n=this.elements,e=e.elements,i=t.elements,r=n[0],a=n[1],o=n[2],s=n[3],l=n[4],u=n[5],c=n[6],h=n[7],n=n[8],d=e[0],p=e[1],f=e[2],m=e[3],g=e[4],v=e[5],_=e[6],y=e[7],e=e[8];return i[0]=r*d+a*m+o*_,i[1]=r*p+a*g+o*y,i[2]=r*f+a*v+o*e,i[3]=s*d+l*m+u*_,i[4]=s*p+l*g+u*y,i[5]=s*f+l*v+u*e,i[6]=c*d+h*m+n*_,i[7]=c*p+h*g+n*y,i[8]=c*f+h*v+n*e,t}scale(t,e){void 0===e&&(e=new CT);var n=this.elements,i=e.elements;for(let e=0;3!==e;e++)i[3*e+0]=t.x*n[3*e+0],i[3*e+1]=t.y*n[3*e+1],i[3*e+2]=t.z*n[3*e+2];return e}solve(e,t){void 0===t&&(t=new Rd);var n=[];let i,r;for(i=0;i<12;i++)n.push(0);for(i=0;i<3;i++)for(r=0;r<3;r++)n[i+4*r]=this.elements[i+3*r];n[3]=e.x,n[7]=e.y,n[11]=e.z;let a=3;var o=a;let s;let l;do{if(0===n[(i=o-a)+4*i])for(r=i+1;r<o;r++)if(0!==n[i+4*r]){for(s=4;n[(l=4-s)+4*i]+=n[l+4*r],--s;);break}if(0!==n[i+4*i])for(r=i+1;r<o;r++){var u=n[i+4*r]/n[i+4*i];for(s=4;n[(l=4-s)+4*r]=l<=i?0:n[l+4*r]-n[l+4*i]*u,--s;);}}while(--a);if(t.z=n[11]/n[10],t.y=(n[7]-n[6]*t.z)/n[5],t.x=(n[3]-n[2]*t.z-n[1]*t.y)/n[0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(void 0===n)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(t){for(let e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this}toString(){let t="";for(let e=0;e<9;e++)t+=this.elements[e]+",";return t}reverse(e){void 0===e&&(e=new CT);var t=Qs;let n,i;for(n=0;n<3;n++)for(i=0;i<3;i++)t[n+6*i]=this.elements[n+3*i];t[3]=1,t[9]=0,t[15]=0,t[4]=0,t[10]=1,t[16]=0,t[5]=0,t[11]=0,t[17]=1;let r=3;var a=r;let o;let s;do{if(0===t[(n=a-r)+6*n])for(i=n+1;i<a;i++)if(0!==t[n+6*i]){for(o=6;t[(s=6-o)+6*n]+=t[s+6*i],--o;);break}if(0!==t[n+6*n])for(i=n+1;i<a;i++){var l=t[n+6*i]/t[n+6*n];for(o=6;t[(s=6-o)+6*i]=s<=n?0:t[s+6*i]-t[s+6*n]*l,--o;);}}while(--r);n=2;do{i=n-1;do{var u=t[n+6*i]/t[n+6*n];for(o=6;t[(s=6-o)+6*i]=t[s+6*i]-t[s+6*n]*u,--o;);}while(i--)}while(--n);n=2;do{var c=1/t[n+6*n];for(o=6;t[(s=6-o)+6*n]=t[s+6*n]*c,--o;);}while(n--);n=2;do{i=2;do{if(s=t[3+i+6*n],isNaN(s)||s===1/0)throw`Could not reverse! A=[${this.toString()}]`}while(e.e(n,i,s),i--)}while(n--);return e}setRotationFromQuaternion(e){var t=e.x,n=e.y,i=e.z,e=e.w,r=t+t,a=n+n,o=i+i,s=t*r,l=t*a,t=t*o,u=n*a,n=n*o,i=i*o,r=e*r,a=e*a,e=e*o,o=this.elements;return o[0]=1-(u+i),o[1]=l-e,o[2]=t+a,o[3]=l+e,o[4]=1-(s+i),o[5]=n-r,o[6]=t-a,o[7]=n+r,o[8]=1-(s+u),this}transpose(e){void 0===e&&(e=new CT);var t,n=this.elements,i=e.elements;return i[0]=n[0],i[4]=n[4],i[8]=n[8],t=n[1],i[1]=n[3],i[3]=t,t=n[2],i[2]=n[6],i[6]=t,t=n[5],i[5]=n[7],i[7]=t,e}}let Qs=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class Rd{constructor(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0),this.x=e=void 0===e?0:e,this.y=t,this.z=n}cross(e,t){void 0===t&&(t=new Rd);var n=e.x,i=e.y,e=e.z,r=this.x,a=this.y,o=this.z;return t.x=a*e-o*i,t.y=o*n-r*e,t.z=r*i-a*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(!t)return new Rd(this.x+e.x,this.y+e.y,this.z+e.z);t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z}vsub(e,t){if(!t)return new Rd(this.x-e.x,this.y-e.y,this.z-e.z);t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z}crossmat(){return new CT([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){var e=this.x,t=this.y,n=this.z,e=Math.sqrt(e*e+t*t+n*n);return 0<e?(this.x*=t=1/e,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),e}unit(e){void 0===e&&(e=new Rd);var t=this.x,n=this.y,i=this.z,r=Math.sqrt(t*t+n*n+i*i);return 0<r?(e.x=t*(r=1/r),e.y=n*r,e.z=i*r):(e.x=1,e.y=0,e.z=0),e}length(){var e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,e=e.z;return Math.sqrt((r-t)*(r-t)+(a-n)*(a-n)+(e-i)*(e-i))}distanceSquared(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,e=e.z;return(r-t)*(r-t)+(a-n)*(a-n)+(e-i)*(e-i)}scale(e,t){void 0===t&&(t=new Rd);var n=this.x,i=this.y,r=this.z;return t.x=e*n,t.y=e*i,t.z=e*r,t}vmul(e,t){return(t=void 0===t?new Rd:t).x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return(n=void 0===n?new Rd:n).x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return 0===this.x&&0===this.y&&0===this.z}negate(e){return(e=void 0===e?new Rd:e).x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){var n,i=this.length();0<i?((n=$s).set(this.x*(i=1/i),this.y*i,this.z*i),i=el,Math.abs(n.x)<.9?i.set(1,0,0):i.set(0,1,0),n.cross(i,e),n.cross(e,t)):(e.set(1,0,0),t.set(0,1,0))}toString(){return`${this.x},${this.y},`+this.z}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){var i=this.x,r=this.y,a=this.z;n.x=i+(e.x-i)*t,n.y=r+(e.y-r)*t,n.z=a+(e.z-a)*t}almostEquals(e,t){return void 0===t&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return void 0===e&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(tl),tl.almostEquals(e,t)}clone(){return new Rd(this.x,this.y,this.z)}}Rd.ZERO=new Rd(0,0,0),Rd.UNIT_X=new Rd(1,0,0),Rd.UNIT_Y=new Rd(0,1,0),Rd.UNIT_Z=new Rd(0,0,1);let $s=new Rd,el=new Rd,tl=new Rd;class LT{constructor(e){void 0===e&&(e={}),this.lowerBound=new Rd,this.upperBound=new Rd,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(n,e,t,i){var r=this.lowerBound,a=this.upperBound,o=t;r.copy(n[0]),o&&o.vmult(r,r),a.copy(r);for(let t=1;t<n.length;t++){let e=n[t];o&&(o.vmult(e,nl),e=nl),e.x>a.x&&(a.x=e.x),e.x<r.x&&(r.x=e.x),e.y>a.y&&(a.y=e.y),e.y<r.y&&(r.y=e.y),e.z>a.z&&(a.z=e.z),e.z<r.z&&(r.z=e.z)}return e&&(e.vadd(r,r),e.vadd(a,a)),i&&(r.x-=i,r.y-=i,r.z-=i,a.x+=i,a.y+=i,a.z+=i),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return(new LT).copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){var t=this.lowerBound,n=this.upperBound,i=e.lowerBound,e=e.upperBound,r=i.x<=n.x&&n.x<=e.x||t.x<=e.x&&e.x<=n.x,a=i.y<=n.y&&n.y<=e.y||t.y<=e.y&&e.y<=n.y,i=i.z<=n.z&&n.z<=e.z||t.z<=e.z&&e.z<=n.z;return r&&a&&i}volume(){var e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){var t=this.lowerBound,n=this.upperBound,i=e.lowerBound,e=e.upperBound;return t.x<=i.x&&n.x>=e.x&&t.y<=i.y&&n.y>=e.y&&t.z<=i.z&&n.z>=e.z}getCorners(e,t,n,i,r,a,o,s){var l=this.lowerBound,u=this.upperBound;e.copy(l),t.set(u.x,l.y,l.z),n.set(u.x,u.y,l.z),i.set(l.x,u.y,u.z),r.set(u.x,l.y,u.z),a.set(l.x,u.y,l.z),o.set(l.x,l.y,u.z),s.copy(u)}toLocalFrame(t,e){var n=il,i=n[0];this.getCorners(i,n[1],n[2],n[3],n[4],n[5],n[6],n[7]);for(let e=0;8!==e;e++){var r=n[e];t.pointToLocal(r,r)}return e.setFromPoints(n)}toWorldFrame(t,e){var n=il,i=n[0];this.getCorners(i,n[1],n[2],n[3],n[4],n[5],n[6],n[7]);for(let e=0;8!==e;e++){var r=n[e];t.pointToWorld(r,r)}return e.setFromPoints(n)}overlapsRay(e){var{direction:e,from:t}=e,n=1/e.x,i=1/e.y,e=1/e.z,r=(this.lowerBound.x-t.x)*n,n=(this.upperBound.x-t.x)*n,a=(this.lowerBound.y-t.y)*i,i=(this.upperBound.y-t.y)*i,o=(this.lowerBound.z-t.z)*e,t=(this.upperBound.z-t.z)*e,e=Math.max(Math.max(Math.min(r,n),Math.min(a,i)),Math.min(o,t)),r=Math.min(Math.min(Math.max(r,n),Math.max(a,i)),Math.max(o,t));return!(r<0||r<e)}}let nl=new Rd,il=[new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd];class DT{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;return void 0===n[e]&&(n[e]=[]),n[e].includes(t)||n[e].push(t),this}hasEventListener(e,t){var n;return void 0!==this._listeners&&!(void 0===(n=this._listeners)[e]||!n[e].includes(t))}hasAnyEventListener(e){return void 0!==this._listeners&&void 0!==this._listeners[e]}removeEventListener(e,t){var n,i;return void 0!==this._listeners&&(void 0!==(n=this._listeners)[e]&&-1!==(i=n[e].indexOf(t)))&&n[e].splice(i,1),this}dispatchEvent(n){if(void 0!==this._listeners){var i=this._listeners[n.type];if(void 0!==i){n.target=this;for(let e=0,t=i.length;e<t;e++)i[e].call(this,n)}}return this}}class OT{constructor(e,t,n,i){void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),this.x=e=void 0===e?0:e,this.y=t,this.z=n,this.w=i}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}toString(){return`${this.x},${this.y},${this.z},`+this.w}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){var n=Math.sin(.5*t);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(.5*t),this}toAxisAngle(e){void 0===e&&(e=new Rd),this.normalize();var t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){var n,i;return e.isAntiparallelTo(t)?(n=rl,i=al,e.tangents(n,i),this.setFromAxisAngle(n,Math.PI)):(i=e.cross(t),this.x=i.x,this.y=i.y,this.z=i.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()),this}mult(e,t){void 0===t&&(t=new OT);var n=this.x,i=this.y,r=this.z,a=this.w,o=e.x,s=e.y,l=e.z,e=e.w;return t.x=n*e+a*o+i*l-r*s,t.y=i*e+a*s+r*o-n*l,t.z=r*e+a*l+n*s-i*o,t.w=a*e-n*o-i*s-r*l,t}inverse(e){void 0===e&&(e=new OT);var t=this.x,n=this.y,i=this.z,r=this.w,t=(this.conjugate(e),1/(t*t+n*n+i*i+r*r));return e.x*=t,e.y*=t,e.z*=t,e.w*=t,e}conjugate(e){return(e=void 0===e?new OT:e).x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e=1/e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){var e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0==e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){void 0===t&&(t=new Rd);var n=e.x,i=e.y,e=e.z,r=this.x,a=this.y,o=this.z,s=this.w,l=s*n+a*e-o*i,u=s*i+o*n-r*e,c=s*e+r*i-a*n,n=-r*n-a*i-o*e;return t.x=l*s+n*-r+u*-o-c*-a,t.y=u*s+n*-a+c*-r-l*-o,t.z=c*s+n*-o+l*-a-u*-r,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){void 0===t&&(t="YZX");let n,i,r;var a=this.x,o=this.y,s=this.z,l=this.w;if("YZX"!==t)throw new Error(`Euler order ${t} not supported yet.`);var u,c,t=a*o+s*l;.499<t&&(n=2*Math.atan2(a,l),i=Math.PI/2,r=0),t<-.499&&(n=-2*Math.atan2(a,l),i=-Math.PI/2,r=0),void 0===n&&(u=a*a,c=s*s,n=Math.atan2(2*o*l-2*a*s,1-2*(o*o)-2*c),i=Math.asin(2*t),r=Math.atan2(2*a*l-2*o*s,1-2*u-2*c)),e.y=n,e.z=i,e.x=r}setFromEuler(e,t,n,i){void 0===i&&(i="XYZ");var r=Math.cos(e/2),a=Math.cos(t/2),o=Math.cos(n/2),e=Math.sin(e/2),t=Math.sin(t/2),n=Math.sin(n/2);return"XYZ"===i?(this.x=e*a*o+r*t*n,this.y=r*t*o-e*a*n,this.z=r*a*n+e*t*o,this.w=r*a*o-e*t*n):"YXZ"===i?(this.x=e*a*o+r*t*n,this.y=r*t*o-e*a*n,this.z=r*a*n-e*t*o,this.w=r*a*o+e*t*n):"ZXY"===i?(this.x=e*a*o-r*t*n,this.y=r*t*o+e*a*n,this.z=r*a*n+e*t*o,this.w=r*a*o-e*t*n):"ZYX"===i?(this.x=e*a*o-r*t*n,this.y=r*t*o+e*a*n,this.z=r*a*n-e*t*o,this.w=r*a*o+e*t*n):"YZX"===i?(this.x=e*a*o+r*t*n,this.y=r*t*o+e*a*n,this.z=r*a*n-e*t*o,this.w=r*a*o-e*t*n):"XZY"===i&&(this.x=e*a*o-r*t*n,this.y=r*t*o-e*a*n,this.z=r*a*n+e*t*o,this.w=r*a*o+e*t*n),this}clone(){return new OT(this.x,this.y,this.z,this.w)}slerp(e,t,n){void 0===n&&(n=new OT);var i,r=this.x,a=this.y,o=this.z,s=this.w;let l=e.x,u=e.y,c=e.z,h=e.w,d,p,f;return(d=r*l+a*u+o*c+s*h)<0&&(d=-d,l=-l,u=-u,c=-c,h=-h),f=1e-6<1-d?(e=Math.acos(d),i=Math.sin(e),p=Math.sin((1-t)*e)/i,Math.sin(t*e)/i):(p=1-t,t),n.x=p*r+f*l,n.y=p*a+f*u,n.z=p*o+f*c,n.w=p*s+f*h,n}integrate(e,t,n,i){void 0===i&&(i=new OT);var r=e.x*n.x,a=e.y*n.y,e=e.z*n.z,n=this.x,o=this.y,s=this.z,l=this.w,t=.5*t;return i.x+=t*(r*l+a*s-e*o),i.y+=t*(a*l+e*n-r*s),i.z+=t*(e*l+r*o-a*n),i.w+=t*(-r*n-a*o-e*s),i}}let rl=new Rd,al=new Rd;class Nd{constructor(e){void 0===e&&(e={}),this.id=Nd.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse||!0,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.material=e.material||null,this.body=null}updateBoundingSphereRadius(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type}volume(){throw"volume() not implemented for shape type "+this.type}calculateLocalInertia(e,t){throw"calculateLocalInertia() not implemented for shape type "+this.type}calculateWorldAABB(e,t,n,i){throw"calculateWorldAABB() not implemented for shape type "+this.type}}Nd.idCounter=0,Nd.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class PT{constructor(e){void 0===e&&(e={}),this.position=new Rd,this.quaternion=new OT,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return PT.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return PT.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return void 0===t&&(t=new Rd),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,i){return void 0===i&&(i=new Rd),n.vsub(e,i),t.conjugate(ol),ol.vmult(i,i),i}static pointToWorldFrame(e,t,n,i){return void 0===i&&(i=new Rd),t.vmult(n,i),i.vadd(e,i),i}static vectorToWorldFrame(e,t,n){return void 0===n&&(n=new Rd),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,i){return void 0===i&&(i=new Rd),t.w*=-1,t.vmult(n,i),t.w*=-1,i}}let ol=new OT;class UT extends Nd{constructor(e){var{vertices:e=[],faces:t=[],normals:n=[],axes:i,boundingSphereRadius:r}=e=void 0===e?{}:e;super({type:Nd.types.CONVEXPOLYHEDRON}),this.vertices=e,this.faces=t,this.faceNormals=n,0===this.faceNormals.length&&this.computeNormals(),r?this.boundingSphereRadius=r:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=i?i.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){var t=this.faces,n=this.vertices,i=this.uniqueEdges,r=(i.length=0,new Rd);for(let e=0;e!==t.length;e++){var a=t[e],o=a.length;for(let e=0;e!==o;e++){var s=(e+1)%o;n[a[e]].vsub(n[a[s]],r),r.normalize();let t=!1;for(let e=0;e!==i.length;e++)if(i[e].almostEquals(r)||i[e].almostEquals(r)){t=!0;break}t||i.push(r.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let t=0;t<this.faces.length;t++){for(let e=0;e<this.faces[t].length;e++)if(!this.vertices[this.faces[t][e]])throw new Error(`Vertex ${this.faces[t][e]} not found!`);var e=this.faceNormals[t]||new Rd,n=(this.getFaceNormal(t,e),e.negate(e),this.faceNormals[t]=e,this.vertices[this.faces[t][0]]);if(e.dot(n)<0){console.error(`.faceNormals[${t}] = Vec3(${e.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let e=0;e<this.faces[t].length;e++)console.warn(`.vertices[${this.faces[t][e]}] = Vec3(${this.vertices[this.faces[t][e]].toString()})`)}}}getFaceNormal(e,t){var e=this.faces[e],n=this.vertices[e[0]],i=this.vertices[e[1]],e=this.vertices[e[2]];UT.computeNormal(n,i,e,t)}static computeNormal(e,t,n,i){var r=new Rd,a=new Rd;t.vsub(e,a),n.vsub(t,r),r.cross(a,i),i.isZero()||i.normalize()}clipAgainstHull(e,t,n,i,r,a,o,s,l){var u=new Rd;let c=-1,h=-Number.MAX_VALUE;for(let e=0;e<n.faces.length;e++){u.copy(n.faceNormals[e]),r.vmult(u,u);var d=u.dot(a);d>h&&(h=d,c=e)}var p=[];for(let e=0;e<n.faces[c].length;e++){var f=n.vertices[n.faces[c][e]],m=new Rd;m.copy(f),r.vmult(m,m),i.vadd(m,m),p.push(m)}0<=c&&this.clipFaceAgainstHull(a,e,t,p,o,s,l)}findSeparatingAxis(t,n,i,r,a,o,s,l){var u=new Rd,c=new Rd,e=new Rd,h=new Rd,d=new Rd,p=new Rd;let f=Number.MAX_VALUE;var m=this;if(m.uniqueAxes)for(let e=0;e!==m.uniqueAxes.length;e++){i.vmult(m.uniqueAxes[e],u);var g=m.testSepAxis(u,t,n,i,r,a);if(!1===g)return!1;g<f&&(f=g,o.copy(u))}else{var v=(s||m.faces).length;for(let e=0;e<v;e++){var _=s?s[e]:e,_=(u.copy(m.faceNormals[_]),i.vmult(u,u),m.testSepAxis(u,t,n,i,r,a));if(!1===_)return!1;_<f&&(f=_,o.copy(u))}}if(t.uniqueAxes)for(let e=0;e!==t.uniqueAxes.length;e++){a.vmult(t.uniqueAxes[e],c);var y=m.testSepAxis(c,t,n,i,r,a);if(!1===y)return!1;y<f&&(f=y,o.copy(c))}else{var E=(l||t.faces).length;for(let e=0;e<E;e++){var A=l?l[e]:e,A=(c.copy(t.faceNormals[A]),a.vmult(c,c),m.testSepAxis(c,t,n,i,r,a));if(!1===A)return!1;A<f&&(f=A,o.copy(c))}}for(let e=0;e!==m.uniqueEdges.length;e++){i.vmult(m.uniqueEdges[e],h);for(let e=0;e!==t.uniqueEdges.length;e++)if(a.vmult(t.uniqueEdges[e],d),h.cross(d,p),!p.almostZero()){p.normalize();var x=m.testSepAxis(p,t,n,i,r,a);if(!1===x)return!1;x<f&&(f=x,o.copy(p))}}return r.vsub(n,e),0<e.dot(o)&&o.negate(o),!0}testSepAxis(e,t,n,i,r,a){UT.project(this,e,n,i,sl),UT.project(t,e,r,a,ll);n=sl[0],i=sl[1],t=ll[0],e=ll[1];return!(n<e||t<i)&&((r=n-e)<(a=t-i)?r:a)}calculateLocalInertia(e,t){var n=new Rd,i=new Rd,r=(this.computeLocalAABB(i,n),n.x-i.x),a=n.y-i.y,n=n.z-i.z;t.x=1/12*e*(2*a*2*a+2*n*2*n),t.y=1/12*e*(2*r*2*r+2*n*2*n),t.z=1/12*e*(2*a*2*a+2*r*2*r)}getPlaneConstantOfFace(e){var t=this.faces[e],e=this.faceNormals[e],t=this.vertices[t[0]];return-e.dot(t)}clipFaceAgainstHull(t,i,r,e,a,o,s){var n=new Rd,l=new Rd,u=new Rd,c=new Rd,h=new Rd,d=new Rd,p=new Rd,f=new Rd,m=e,g=[];let v=-1,_=Number.MAX_VALUE;for(let e=0;e<this.faces.length;e++){n.copy(this.faceNormals[e]),r.vmult(n,n);var y=n.dot(t);y<_&&(_=y,v=e)}if(!(v<0)){var E=this.faces[v];E.connectedFaces=[];for(let t=0;t<this.faces.length;t++)for(let e=0;e<this.faces[t].length;e++)-1!==E.indexOf(this.faces[t][e])&&t!==v&&-1===E.connectedFaces.indexOf(t)&&E.connectedFaces.push(t);var A,x=E.length;for(let n=0;n<x;n++){var T=this.vertices[E[n]],S=this.vertices[E[(n+1)%x]],S=(T.vsub(S,l),u.copy(l),r.vmult(u,u),i.vadd(u,u),c.copy(this.faceNormals[v]),r.vmult(c,c),i.vadd(c,c),u.cross(c,h),h.negate(h),d.copy(T),r.vmult(d,d),i.vadd(d,d),E.connectedFaces[n]);p.copy(this.faceNormals[S]);let e=this.getPlaneConstantOfFace(S),t=(f.copy(p),r.vmult(f,f),e-f.dot(i));for(this.clipFaceAgainstPlane(m,g,f,t);m.length;)m.shift();for(;g.length;)m.push(g.shift())}p.copy(this.faceNormals[v]);let e=this.getPlaneConstantOfFace(v),n=(f.copy(p),r.vmult(f,f),e-f.dot(i));for(let t=0;t<m.length;t++){let e=f.dot(m[t])+n;e<=a&&(console.log(`clamped: depth=${e} to minDist=`+a),e=a),e<=o&&(A=m[t],e<=1e-6)&&(A={point:A,normal:f,depth:e},s.push(A))}}}clipFaceAgainstPlane(n,i,r,a){let o;var s=n.length;if(!(s<2)){let t=n[n.length-1];o=r.dot(t)+a;for(let e=0;e<s;e++){var l,u,c=n[e],h=r.dot(c)+a;o<0?h<0?((l=new Rd).copy(c),i.push(l)):(l=new Rd,t.lerp(c,o/(o-h),l),i.push(l)):h<0&&(u=new Rd,t.lerp(c,o/(o-h),u),i.push(u),i.push(c)),t=c,o=h}}return i}computeWorldVertices(t,n){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new Rd);var i=this.vertices,r=this.worldVertices;for(let e=0;e!==this.vertices.length;e++)n.vmult(i[e],r[e]),t.vadd(r[e],r[e]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(t,n){var i=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let e=0;e<this.vertices.length;e++){var r=i[e];r.x<t.x?t.x=r.x:r.x>n.x&&(n.x=r.x),r.y<t.y?t.y=r.y:r.y>n.y&&(n.y=r.y),r.z<t.z?t.z=r.z:r.z>n.z&&(n.z=r.z)}}computeWorldFaceNormals(t){for(var n=this.faceNormals.length;this.worldFaceNormals.length<n;)this.worldFaceNormals.push(new Rd);var i=this.faceNormals,r=this.worldFaceNormals;for(let e=0;e!==n;e++)t.vmult(i[e],r[e]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let t=0;var n=this.vertices;for(let e=0;e!==n.length;e++){var i=n[e].lengthSquared();i>t&&(t=i)}this.boundingSphereRadius=Math.sqrt(t)}calculateWorldAABB(t,n,e,i){var r=this.vertices;let a,o,s,l,u,c;var h=new Rd;for(let e=0;e<r.length;e++)h.copy(r[e]),n.vmult(h,h),t.vadd(h,h),(void 0===a||h.x<a)&&(a=h.x),(void 0===l||h.x>l)&&(l=h.x),(void 0===o||h.y<o)&&(o=h.y),(void 0===u||h.y>u)&&(u=h.y),(void 0===s||h.z<s)&&(s=h.z),(void 0===c||h.z>c)&&(c=h.z);e.set(a,o,s),i.set(l,u,c)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(t){void 0===t&&(t=new Rd);var n=this.vertices;for(let e=0;e<n.length;e++)t.vadd(n[e],t);return t.scale(1/n.length,t),t}transformAllPoints(t,n){var i=this.vertices.length,r=this.vertices;if(n){for(let e=0;e<i;e++){var a=r[e];n.vmult(a,a)}for(let e=0;e<this.faceNormals.length;e++){var o=this.faceNormals[e];n.vmult(o,o)}}if(t)for(let e=0;e<i;e++){var s=r[e];s.vadd(t,s)}}pointIsInside(t){var n=this.vertices,i=this.faces,r=this.faceNormals,a=new Rd;this.getAveragePointLocal(a);for(let e=0;e<this.faces.length;e++){var o=r[e],s=n[i[e][0]],l=new Rd,l=(t.vsub(s,l),o.dot(l)),u=new Rd,s=(a.vsub(s,u),o.dot(u));if(l<0&&0<s||0<l&&s<0)return!1}return-1}static project(e,t,n,i,r){var a=e.vertices.length,o=(ul,cl);let s=0,l=0;var u=hl,c=e.vertices,e=(u.setZero(),PT.vectorToLocalFrame(n,i,t,o),PT.pointToLocalFrame(n,i,u,u),u.dot(o));l=s=c[0].dot(o);for(let e=1;e<a;e++){var h=c[e].dot(o);h>s&&(s=h),h<l&&(l=h)}l-=e,s-=e,l>s&&(t=l,l=s,s=t),r[0]=s,r[1]=l}}let sl=[],ll=[],ul=new Rd,cl=new Rd,hl=new Rd;class BT extends Nd{constructor(e){super({type:Nd.types.BOX}),this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){var e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,i=Rd,e=[new i(-e,-t,-n),new i(e,-t,-n),new i(e,t,-n),new i(-e,t,-n),new i(-e,-t,n),new i(e,-t,n),new i(e,t,n),new i(-e,t,n)],t=[new i(0,0,1),new i(0,1,0),new i(1,0,0)],n=new UT({vertices:e,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:t});(this.convexPolyhedronRepresentation=n).material=this.material}calculateLocalInertia(e,t){return void 0===t&&(t=new Rd),BT.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,n){n.x=1/12*t*(2*e.y*2*e.y+2*e.z*2*e.z),n.y=1/12*t*(2*e.x*2*e.x+2*e.z*2*e.z),n.z=1/12*t*(2*e.y*2*e.y+2*e.x*2*e.x)}getSideNormals(e,t){var n=e,e=this.halfExtents;if(n[0].set(e.x,0,0),n[1].set(0,e.y,0),n[2].set(0,0,e.z),n[3].set(-e.x,0,0),n[4].set(0,-e.y,0),n[5].set(0,0,-e.z),void 0!==t)for(let e=0;e!==n.length;e++)t.vmult(n[e],n[e]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(t,n,i){var e=this.halfExtents,r=[[e.x,e.y,e.z],[-e.x,e.y,e.z],[-e.x,-e.y,e.z],[-e.x,-e.y,-e.z],[e.x,-e.y,-e.z],[e.x,e.y,-e.z],[-e.x,e.y,-e.z],[e.x,-e.y,e.z]];for(let e=0;e<r.length;e++)dl.set(r[e][0],r[e][1],r[e][2]),n.vmult(dl,dl),t.vadd(dl,dl),i(dl.x,dl.y,dl.z)}calculateWorldAABB(n,i,r,a){var e=this.halfExtents;pl[0].set(e.x,e.y,e.z),pl[1].set(-e.x,e.y,e.z),pl[2].set(-e.x,-e.y,e.z),pl[3].set(-e.x,-e.y,-e.z),pl[4].set(e.x,-e.y,-e.z),pl[5].set(e.x,e.y,-e.z),pl[6].set(-e.x,e.y,-e.z),pl[7].set(e.x,-e.y,e.z);let t=pl[0];i.vmult(t,t),n.vadd(t,t),a.copy(t),r.copy(t);for(let t=1;t<8;t++){let e=pl[t];i.vmult(e,e),n.vadd(e,e);var o=e.x,s=e.y,l=e.z;o>a.x&&(a.x=o),a.y<s&&(a.y=s),a.z<l&&(a.z=l),o<r.x&&(r.x=o),s<r.y&&(r.y=s),l<r.z&&(r.z=l)}}}let dl=new Rd,pl=[new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd];const FT=1,zT=2,kT=4,GT=0,HT=1,VT=2;class Id extends DT{constructor(e){void 0===e&&(e={}),super(),this.id=Id.idCounter++,this.index=-1,this.world=null,this.vlambda=new Rd,this.collisionFilterGroup="number"==typeof e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionResponse="boolean"!=typeof e.collisionResponse||e.collisionResponse,this.position=new Rd,this.previousPosition=new Rd,this.interpolatedPosition=new Rd,this.initPosition=new Rd,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new Rd,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new Rd,this.force=new Rd;var t="number"==typeof e.mass?e.mass:0;this.mass=t,this.invMass=0<t?1/t:0,this.material=e.material||null,this.linearDamping="number"==typeof e.linearDamping?e.linearDamping:.01,this.type=t<=0?Id.STATIC:Id.DYNAMIC,typeof e.type==typeof Id.STATIC&&(this.type=e.type),this.allowSleep=void 0===e.allowSleep||e.allowSleep,this.sleepState=Id.AWAKE,this.sleepSpeedLimit=void 0!==e.sleepSpeedLimit?e.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==e.sleepTimeLimit?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new Rd,this.quaternion=new OT,this.initQuaternion=new OT,this.previousQuaternion=new OT,this.interpolatedQuaternion=new OT,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new Rd,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new Rd,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new Rd,this.invInertia=new Rd,this.invInertiaWorld=new CT,this.invMassSolve=0,this.invInertiaSolve=new Rd,this.invInertiaWorldSolve=new CT,this.fixedRotation=void 0!==e.fixedRotation&&e.fixedRotation,this.angularDamping=void 0!==e.angularDamping?e.angularDamping:.01,this.linearFactor=new Rd(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new Rd(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new LT,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new Rd,this.isTrigger=Boolean(e.isTrigger),e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){var e=this.sleepState;this.sleepState=Id.AWAKE,this.wakeUpAfterNarrowphase=!1,e===Id.SLEEPING&&this.dispatchEvent(Id.wakeupEvent)}sleep(){this.sleepState=Id.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){var t,n,i;this.allowSleep&&(t=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),i=this.sleepSpeedLimit**2,t===Id.AWAKE&&n<i?(this.sleepState=Id.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(Id.sleepyEvent)):t===Id.SLEEPY&&i<n?this.wakeUp():t===Id.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(Id.sleepEvent)))}updateSolveMassProperties(){this.sleepState===Id.SLEEPING||this.type===Id.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t){return void 0===t&&(t=new Rd),e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t){return void 0===t&&(t=new Rd),this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t){return void 0===t&&(t=new Rd),this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t){return void 0===t&&(t=new Rd),this.quaternion.vmult(e,t),t}addShape(e,t,n){var i=new Rd,r=new OT;return t&&i.copy(t),n&&r.copy(n),this.shapes.push(e),this.shapeOffsets.push(i),this.shapeOrientations.push(r),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this}removeShape(e){var t=this.shapes.indexOf(e);return-1===t?console.warn("Shape does not belong to the body"):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null),this}updateBoundingRadius(){var t=this.shapes,n=this.shapeOffsets,i=t.length;let r=0;for(let e=0;e!==i;e++){var a=t[e],o=(a.updateBoundingSphereRadius(),n[e].length()),a=a.boundingSphereRadius;o+a>r&&(r=o+a)}this.boundingRadius=r}updateAABB(){var t=this.shapes,n=this.shapeOffsets,i=this.shapeOrientations,r=t.length,a=fl,o=ml,s=this.quaternion,l=this.aabb,u=gl;for(let e=0;e!==r;e++){var c=t[e];s.vmult(n[e],a),a.vadd(this.position,a),s.mult(i[e],o),c.calculateWorldAABB(a,o,u.lowerBound,u.upperBound),0===e?l.copy(u):l.extend(u)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){var t,n=this.invInertia;n.x===n.y&&n.y===n.z&&!e||(e=vl,t=_l,yl,e.setRotationFromQuaternion(this.quaternion),e.transpose(t),e.scale(n,e),e.mmult(t,this.invInertiaWorld))}applyForce(e,t){var n;void 0===t&&(t=new Rd),this.type===Id.DYNAMIC&&(this.sleepState===Id.SLEEPING&&this.wakeUp(),n=El,t.cross(e,n),this.force.vadd(e,this.force),this.torque.vadd(n,this.torque))}applyLocalForce(e,t){var n,i;void 0===t&&(t=new Rd),this.type===Id.DYNAMIC&&(n=Al,i=xl,this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyForce(n,i))}applyTorque(e){this.type===Id.DYNAMIC&&(this.sleepState===Id.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t){var n;void 0===t&&(t=new Rd),this.type===Id.DYNAMIC&&(this.sleepState===Id.SLEEPING&&this.wakeUp(),t=t,(n=Tl).copy(e),n.scale(this.invMass,n),this.velocity.vadd(n,this.velocity),n=Sl,t.cross(e,n),this.invInertiaWorld.vmult(n,n),this.angularVelocity.vadd(n,this.angularVelocity))}applyLocalImpulse(e,t){var n,i;void 0===t&&(t=new Rd),this.type===Id.DYNAMIC&&(n=wl,i=bl,this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyImpulse(n,i))}updateMassProperties(){var e=Ml,t=(this.invMass=0<this.mass?1/this.mass:0,this.inertia),n=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),BT.calculateInertia(e,this.mass,t),this.invInertia.set(0<t.x&&!n?1/t.x:0,0<t.y&&!n?1/t.y:0,0<t.z&&!n?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){var n=new Rd;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}integrate(e,t,n){var i,r,a,o,s,l,u,c,h;this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==Id.DYNAMIC&&this.type!==Id.KINEMATIC||this.sleepState===Id.SLEEPING||(i=this.velocity,r=this.angularVelocity,a=this.position,s=this.force,h=this.torque,o=this.quaternion,l=this.invMass,c=this.invInertiaWorld,u=this.linearFactor,i.x+=s.x*(l=l*e)*u.x,i.y+=s.y*l*u.y,i.z+=s.z*l*u.z,s=c.elements,l=this.angularFactor,u=h.x*l.x,r.x+=e*(s[0]*u+s[1]*(c=h.y*l.y)+s[2]*(h=h.z*l.z)),r.y+=e*(s[3]*u+s[4]*c+s[5]*h),r.z+=e*(s[6]*u+s[7]*c+s[8]*h),a.x+=i.x*e,a.y+=i.y*e,a.z+=i.z*e,o.integrate(this.angularVelocity,e,this.angularFactor,o),t&&(n?o.normalizeFast():o.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld())}}Id.idCounter=0,Id.COLLIDE_EVENT_NAME="collide",Id.DYNAMIC=FT,Id.STATIC=zT,Id.KINEMATIC=kT,Id.AWAKE=GT,Id.SLEEPY=HT,Id.SLEEPING=VT,Id.wakeupEvent={type:"wakeup"},Id.sleepyEvent={type:"sleepy"},Id.sleepEvent={type:"sleep"};let fl=new Rd,ml=new OT,gl=new LT,vl=new CT,_l=new CT,yl=new CT,El=new Rd,Al=new Rd,xl=new Rd,Tl=new Rd,Sl=new Rd,wl=new Rd,bl=new Rd,Ml=new Rd;new Rd,new Rd,new OT,new Rd,new Rd,new Rd,new Rd;class WT{constructor(){this.rayFromWorld=new Rd,this.rayToWorld=new Rd,this.hitNormalWorld=new Rd,this.hitPointWorld=new Rd,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,i,r,a,o){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=r,this.body=a,this.distance=o}}const jT=1,YT=2,qT=4;pg=Nd.types.SPHERE,$h=Nd.types.PLANE,wv=Nd.types.BOX,Gv=Nd.types.CYLINDER,vg=Nd.types.CONVEXPOLYHEDRON,Qh=Nd.types.HEIGHTFIELD,id=Nd.types.TRIMESH;class XT{get[pg](){return this._intersectSphere}get[$h](){return this._intersectPlane}get[wv](){return this._intersectBox}get[Gv](){return this._intersectConvex}get[vg](){return this._intersectConvex}get[Qh](){return this._intersectHeightfield}get[id](){return this._intersectTrimesh}constructor(e,t){void 0===e&&(e=new Rd),void 0===t&&(t=new Rd),this.from=e.clone(),this.to=t.clone(),this.direction=new Rd,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=XT.ANY,this.result=new WT,this.hasHit=!1,this.callback=e=>{}}intersectWorld(e,t){return this.mode=t.mode||XT.ANY,this.result=t.result||new WT,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:-1,this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(Rl),Nl.length=0,e.broadphase.aabbQuery(e,Rl,Nl),this.intersectBodies(Nl),this.hasHit}intersectBody(n,e){e&&(this.result=e,this.updateDirection());var i=this.checkCollisionResponse;if((!i||n.collisionResponse)&&0!=(this.collisionFilterGroup&n.collisionFilterMask)&&0!=(n.collisionFilterGroup&this.collisionFilterMask)){var r=Ll,a=Dl;for(let e=0,t=n.shapes.length;e<t;e++){var o=n.shapes[e];if((!i||o.collisionResponse)&&(n.quaternion.mult(n.shapeOrientations[e],a),n.quaternion.vmult(n.shapeOffsets[e],r),r.vadd(n.position,r),this.intersectShape(o,a,r,n),this.result.shouldStop))break}}}intersectBodies(n,e){e&&(this.result=e,this.updateDirection());for(let e=0,t=n.length;!this.result.shouldStop&&e<t;e++)this.intersectBody(n[e])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,i){var r,a,o,s=this.from;s=s,r=this.direction,(a=n).vsub(s,tu),o=tu.dot(r),r.scale(o,nu),nu.vadd(s,nu),r=a.distanceTo(nu);r>e.boundingSphereRadius||(o=this[e.type])&&o.call(this,e,t,n,i,e)}_intersectBox(e,t,n,i,r){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,i,r)}_intersectPlane(e,t,n,i,r){var a,o=this.from,s=this.to,l=this.direction,u=new Rd(0,0,1),t=(t.vmult(u,u),new Rd),c=(o.vsub(n,t),t.dot(u)),t=(s.vsub(n,t),t.dot(u));0<c*t||o.distanceTo(s)<c||(t=u.dot(l),Math.abs(t)<this.precision)||(s=new Rd,c=new Rd,a=new Rd,o.vsub(n,s),n=-u.dot(s)/t,l.scale(n,c),o.vadd(c,a),this.reportIntersection(u,a,r,i,-1))}getAABB(e){var{lowerBound:e,upperBound:t}=e,n=this.to,i=this.from;e.x=Math.min(n.x,i.x),e.y=Math.min(n.y,i.y),e.z=Math.min(n.z,i.z),t.x=Math.max(n.x,i.x),t.y=Math.max(n.y,i.y),t.z=Math.max(n.z,i.z)}_intersectHeightfield(n,i,r,a,o){n.data;var s,l,e,u=zl,t=(u.from.copy(this.from),u.to.copy(this.to),PT.pointToLocalFrame(r,i,u.from,u.from),PT.pointToLocalFrame(r,i,u.to,u.to),u.updateDirection(),kl),c=l=n.data.length-1,h=new LT;u.getAABB(h),n.getIndexOfPosition(h.lowerBound.x,h.lowerBound.y,t,!0),e=Math.max(0,t[0]),s=Math.max(0,t[1]),n.getIndexOfPosition(h.upperBound.x,h.upperBound.y,t,!0),c=Math.min(c,t[0]+1),l=Math.min(l,t[1]+1);for(let t=e;t<c;t++)for(let e=s;e<l;e++){if(this.result.shouldStop)return;if(n.getAabbAtIndex(t,e,h),h.overlapsRay(u)){if(n.getConvexTrianglePillar(t,e,!1),PT.pointToWorldFrame(r,i,n.pillarOffset,Fl),this._intersectConvex(n.pillarConvex,i,Fl,a,o,Bl),this.result.shouldStop)return;n.getConvexTrianglePillar(t,e,!0),PT.pointToWorldFrame(r,i,n.pillarOffset,Fl),this._intersectConvex(n.pillarConvex,i,Fl,a,o,Bl)}}}_intersectSphere(e,t,n,i,r){var a,o=this.from,s=this.to,e=e.radius,l=(s.x-o.x)**2+(s.y-o.y)**2+(s.z-o.z)**2,u=2*((s.x-o.x)*(o.x-n.x)+(s.y-o.y)*(o.y-n.y)+(s.z-o.z)*(o.z-n.z)),e=u**2-4*l*((o.x-n.x)**2+(o.y-n.y)**2+(o.z-n.z)**2-e**2),c=Gl,h=Hl;e<0||(0==e?(o.lerp(s,e,c),c.vsub(n,h),h.normalize(),this.reportIntersection(h,c,r,i,-1)):(a=(-u-Math.sqrt(e))/(2*l),u=(-u+Math.sqrt(e))/(2*l),0<=a&&a<=1&&(o.lerp(s,a,c),c.vsub(n,h),h.normalize(),this.reportIntersection(h,c,r,i,-1)),this.result.shouldStop||0<=u&&u<=1&&(o.lerp(s,u,c),c.vsub(n,h),h.normalize(),this.reportIntersection(h,c,r,i,-1))))}_intersectConvex(e,t,n,i,r,a){Wl;var o=Vl,s=Yl,l=(jl,a&&a.faceList||null),u=e.faces,c=e.vertices,h=e.faceNormals,d=this.direction,p=this.from,a=this.to,f=p.distanceTo(a),m=(l||u).length,g=this.result;for(let e=0;!g.shouldStop&&e<m;e++){var v=l?l[e]:e,_=u[v],y=h[v],E=t,A=n,y=(s.copy(c[_[0]]),E.vmult(s,s),s.vadd(A,s),s.vsub(p,s),E.vmult(y,o),d.dot(o));if(!(Math.abs(y)<this.precision)){y=o.dot(s)/y;if(!(y<0)){d.scale(y,T),T.vadd(p,T),Ol.copy(c[_[0]]),E.vmult(Ol,Ol),A.vadd(Ol,Ol);for(let e=1;!g.shouldStop&&e<_.length-1;e++){Pl.copy(c[_[e]]),Ul.copy(c[_[e+1]]),E.vmult(Pl,Pl),E.vmult(Ul,Ul),A.vadd(Pl,Pl),A.vadd(Ul,Ul);var x=T.distanceTo(p);!XT.pointInTriangle(T,Ol,Pl,Ul)&&!XT.pointInTriangle(T,Pl,Ol,Ul)||f<x||this.reportIntersection(o,T,r,i,v)}}}}}_intersectTrimesh(n,i,r,a,o,e){var s=ql,l=$l,t=eu,u=Yl,c=Xl,h=Zl,d=Kl,p=Ql,f=Jl,m=n.indices,g=this.from,v=this.to,_=this.direction,y=(t.position.copy(r),t.quaternion.copy(i),PT.vectorToLocalFrame(r,i,_,c),PT.pointToLocalFrame(r,i,g,h),PT.pointToLocalFrame(r,i,v,d),d.x*=n.scale.x,d.y*=n.scale.y,d.z*=n.scale.z,h.x*=n.scale.x,h.y*=n.scale.y,h.z*=n.scale.z,d.vsub(h,c),c.normalize(),h.distanceSquared(d));n.tree.rayQuery(this,t,l);for(let e=0,t=l.length;!this.result.shouldStop&&e!==t;e++){var E=l[e],A=(n.getNormal(E,s),n.getVertex(m[3*E],Ol),Ol.vsub(h,u),c.dot(s)),A=s.dot(u)/A;A<0||(c.scale(A,T),T.vadd(h,T),n.getVertex(m[3*E+1],Pl),n.getVertex(m[3*E+2],Ul),A=T.distanceSquared(h),!XT.pointInTriangle(T,Pl,Ol,Ul)&&!XT.pointInTriangle(T,Ol,Pl,Ul))||y<A||(PT.vectorToWorldFrame(i,s,f),PT.pointToWorldFrame(r,i,T,p),this.reportIntersection(f,p,o,a,E))}l.length=0}reportIntersection(e,t,n,i,r){var a=this.from,o=this.to,s=a.distanceTo(t),l=this.result;if(!(this.skipBackfaces&&0<e.dot(this.direction)))switch(l.hitFaceIndex=void 0!==r?r:-1,this.mode){case XT.ALL:this.hasHit=!0,l.set(a,o,e,t,n,i,s),l.hasHit=!0,this.callback(l);break;case XT.CLOSEST:(s<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(a,o,e,t,n,i,s));break;case XT.ANY:this.hasHit=!0,l.hasHit=!0,l.set(a,o,e,t,n,i,s),l.shouldStop=!0}}static pointInTriangle(e,t,n,i){i.vsub(t,tu),n.vsub(t,Il),e.vsub(t,Cl);var r,i=tu.dot(tu),n=tu.dot(Il),e=tu.dot(Cl),t=Il.dot(Il),a=Il.dot(Cl);let o;return 0<=(r=t*e-n*a)&&0<=(o=i*a-n*e)&&r+o<i*t-n*n}}XT.CLOSEST=jT,XT.ANY=YT,XT.ALL=qT;let Rl=new LT,Nl=[],Il=new Rd,Cl=new Rd,Ll=new Rd,Dl=new OT,T=new Rd,Ol=new Rd,Pl=new Rd,Ul=new Rd,Bl=(new Rd,new WT,{faceList:[0]}),Fl=new Rd,zl=new XT,kl=[],Gl=new Rd,Hl=new Rd,Vl=new Rd,Wl=new Rd,jl=new Rd,Yl=new Rd,ql=new Rd,Xl=new Rd,Zl=new Rd,Kl=new Rd,Jl=new Rd,Ql=new Rd,$l=(new LT,[]),eu=new PT,tu=new Rd,nu=new Rd;class ZT{static defaults(e,t){for(var n in void 0===e&&(e={}),t)n in e||(e[n]=t[n]);return e}}class KT{constructor(e,t,n){void 0===n&&(n={}),n=ZT.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.id=KT.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(e&&e.wakeUp(),t)&&t.wakeUp()}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){var t=this.equations;for(let e=0;e<t.length;e++)t[e].enabled=!0}disable(){var t=this.equations;for(let e=0;e<t.length;e++)t[e].enabled=!1}}KT.idCounter=0;class JT{constructor(){this.spatial=new Rd,this.rotational=new Rd}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}class QT{constructor(e,t,n,i){void 0===n&&(n=-1e6),void 0===i&&(i=1e6),this.id=QT.idCounter++,this.minForce=n,this.maxForce=i,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new JT,this.jacobianElementB=new JT,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,t,n){this.a=4/(n*(1+4*t)),this.b=4*t/(1+4*t),this.eps=4/(n*n*e*(1+4*t))}computeB(e,t,n){var i=this.computeGW();return-this.computeGq()*e-i*t-this.computeGiMf()*n}computeGq(){var e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,n=n.position,i=i.position;return e.spatial.dot(n)+t.spatial.dot(i)}computeGW(){var e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.velocity,a=i.velocity,i=i.angularVelocity;return e.multiplyVectors(r,n.angularVelocity)+t.multiplyVectors(a,i)}computeGWlambda(){var e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.vlambda,a=i.vlambda,i=i.wlambda;return e.multiplyVectors(r,n.wlambda)+t.multiplyVectors(a,i)}computeGiMf(){var e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.force,a=n.torque,o=i.force,s=i.torque,l=i.invMassSolve;return r.scale(n.invMassSolve,iu),o.scale(l,ru),n.invInertiaWorldSolve.vmult(a,au),i.invInertiaWorldSolve.vmult(s,ou),e.multiplyVectors(iu,au)+t.multiplyVectors(ru,ou)}computeGiMGt(){var e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.invMassSolve,a=i.invMassSolve,n=n.invInertiaWorldSolve,i=i.invInertiaWorldSolve,r=r+a;return n.vmult(e.rotational,su),r+=su.dot(e.rotational),i.vmult(t.rotational,su),r+=su.dot(t.rotational)}addToWlambda(e){var t=this.jacobianElementA,n=this.jacobianElementB,i=this.bi,r=this.bj,a=lu;i.vlambda.addScaledVector(i.invMassSolve*e,t.spatial,i.vlambda),r.vlambda.addScaledVector(r.invMassSolve*e,n.spatial,r.vlambda),i.invInertiaWorldSolve.vmult(t.rotational,a),i.wlambda.addScaledVector(e,a,i.wlambda),r.invInertiaWorldSolve.vmult(n.rotational,a),r.wlambda.addScaledVector(e,a,r.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}QT.idCounter=0;let iu=new Rd,ru=new Rd,au=new Rd,ou=new Rd,su=new Rd,lu=new Rd;(class extends QT{}),new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,class extends KT{},class extends QT{},new Rd,new Rd,class extends QT{},new Rd,new Rd,new Rd,new Rd,class extends KT{},new Rd,new Rd,class extends QT{},new Rd,new Rd,class extends QT{},new Rd,new Rd;class $T{constructor(e,t,n){n=ZT.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=$T.idCounter++,this.materials=[e,t],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}}$T.idCounter=0;class eS{constructor(e){let t="";"string"==typeof(e=void 0===e?{}:e)&&(t=e,e={}),this.name=t,this.id=eS.idCounter++,this.friction=void 0!==e.friction?e.friction:-1,this.restitution=void 0!==e.restitution?e.restitution:-1}}eS.idCounter=0,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new XT,new Rd,new Rd,new Rd,new Rd(1,0,0),new Rd(0,1,0),new Rd(0,0,1),new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd;class tS extends Nd{constructor(e){if(super({type:Nd.types.SPHERE}),this.radius=void 0!==e?e:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,t){void 0===t&&(t=new Rd);e=2*e*this.radius*this.radius/5;return t.x=e,t.y=e,t.z=e,t}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(t,e,n,i){var r=this.radius,a=["x","y","z"];for(let e=0;e<a.length;e++){var o=a[e];n[o]=t[o]-r,i[o]=t[o]+r}}}new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd;class nS extends UT{constructor(t,n,i,e){if(void 0===n&&(n=1),void 0===i&&(i=1),void 0===e&&(e=8),(t=void 0===t?1:t)<0)throw new Error("The cylinder radiusTop cannot be negative.");if(n<0)throw new Error("The cylinder radiusBottom cannot be negative.");var r=e,a=[],o=[],s=[],l=[],u=[],c=Math.cos,h=Math.sin;a.push(new Rd(-n*h(0),.5*-i,n*c(0))),l.push(0),a.push(new Rd(-t*h(0),.5*i,t*c(0))),u.push(1);for(let e=0;e<r;e++){var d=2*Math.PI/r*(e+1),p=2*Math.PI/r*(e+.5);e<r-1?(a.push(new Rd(-n*h(d),.5*-i,n*c(d))),l.push(2*e+2),a.push(new Rd(-t*h(d),.5*i,t*c(d))),u.push(2*e+3),s.push([2*e,2*e+1,2*e+3,2*e+2])):s.push([2*e,2*e+1,1,0]),(r%2==1||e<r/2)&&o.push(new Rd(-h(p),0,c(p)))}s.push(l),o.push(new Rd(0,1,0));var f=[];for(let e=0;e<u.length;e++)f.push(u[u.length-e-1]);s.push(f),super({vertices:a,faces:s,axes:o}),this.type=Nd.types.CYLINDER,this.radiusTop=t,this.radiusBottom=n,this.height=i,this.numSegments=e}}(class extends Nd{}),class extends Nd{},new Rd,class extends Nd{},new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd;class iS{constructor(e){this.root=(e=void 0===e?{}:e).root||null,this.aabb=e.aabb?e.aabb.clone():new LT,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(t,n,i){void 0===i&&(i=0);var e=this.data;if(!this.aabb.contains(t))return!1;var r=this.children;if(i<(this.maxDepth||this.root.maxDepth)){let e=!1;r.length||(this.subdivide(),e=!0);for(let e=0;8!==e;e++)if(r[e].insert(t,n,i+1))return!0;e&&(r.length=0)}return e.push(n),!0}subdivide(){var e=this.aabb,t=e.lowerBound,e=e.upperBound,n=this.children,i=(n.push(new iS({aabb:new LT({lowerBound:new Rd(0,0,0)})}),new iS({aabb:new LT({lowerBound:new Rd(1,0,0)})}),new iS({aabb:new LT({lowerBound:new Rd(1,1,0)})}),new iS({aabb:new LT({lowerBound:new Rd(1,1,1)})}),new iS({aabb:new LT({lowerBound:new Rd(0,1,1)})}),new iS({aabb:new LT({lowerBound:new Rd(0,0,1)})}),new iS({aabb:new LT({lowerBound:new Rd(1,0,1)})}),new iS({aabb:new LT({lowerBound:new Rd(0,1,0)})})),e.vsub(t,uu),uu.scale(.5,uu),this.root||this);for(let e=0;8!==e;e++){var r=n[e],a=(r.root=i,r.aabb.lowerBound);a.x*=uu.x,a.y*=uu.y,a.z*=uu.z,a.vadd(t,a),a.vadd(uu,r.aabb.upperBound)}}aabbQuery(e,t){this.data,this.children;for(var n=[this];n.length;){var i=n.pop();i.aabb.overlaps(e)&&Array.prototype.push.apply(t,i.data),Array.prototype.push.apply(n,i.children)}return t}rayQuery(e,t,n){return e.getAABB(cu),cu.toLocalFrame(t,cu),this.aabbQuery(cu,n),n}removeEmptyNodes(){for(let e=this.children.length-1;0<=e;e--)this.children[e].removeEmptyNodes(),this.children[e].children.length||this.children[e].data.length||this.children.splice(e,1)}}class rS extends iS{constructor(e,t){void 0===t&&(t={}),super({root:null,aabb:e}),this.maxDepth=void 0!==t.maxDepth?t.maxDepth:8}}let uu=new Rd,cu=new LT;class aS extends Nd{constructor(e,t){super({type:Nd.types.TRIMESH}),this.vertices=new Float32Array(e),this.indices=new Int16Array(t),this.normals=new Float32Array(t.length),this.aabb=new LT,this.edges=null,this.scale=new Rd(1,1,1),this.tree=new rS,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){var t=this.tree,e=(t.reset(),t.aabb.copy(this.aabb),this.scale),n=(t.aabb.lowerBound.x*=1/e.x,t.aabb.lowerBound.y*=1/e.y,t.aabb.lowerBound.z*=1/e.z,t.aabb.upperBound.x*=1/e.x,t.aabb.upperBound.y*=1/e.y,t.aabb.upperBound.z*=1/e.z,new LT),i=new Rd,r=new Rd,a=new Rd,o=[i,r,a];for(let e=0;e<this.indices.length/3;e++){var s=3*e;this._getUnscaledVertex(this.indices[s],i),this._getUnscaledVertex(this.indices[1+s],r),this._getUnscaledVertex(this.indices[2+s],a),n.setFromPoints(o),t.insert(n,e)}t.removeEmptyNodes()}getTrianglesInAABB(e,t){du.copy(e);var e=this.scale,n=e.x,i=e.y,e=e.z,r=du.lowerBound,a=du.upperBound;return r.x/=n,r.y/=i,r.z/=e,a.x/=n,a.y/=i,a.z/=e,this.tree.aabbQuery(du,t)}setScale(e){var t=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,n=e.x===e.y&&e.y===e.z;t&&n||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){var t=hu,n=this.normals;for(let e=0;e<this.indices.length/3;e++){var i=3*e,r=this.indices[i],a=this.indices[1+i],o=this.indices[2+i];this.getVertex(r,vu),this.getVertex(a,_u),this.getVertex(o,yu),aS.computeNormal(_u,vu,yu,t),n[i]=t.x,n[1+i]=t.y,n[2+i]=t.z}}updateEdges(){let n={};var t=(e,t)=>{t=e<t?e+"_"+t:t+"_"+e;n[t]=!0};for(let e=0;e<this.indices.length/3;e++){var i=3*e,r=this.indices[i],a=this.indices[1+i],i=this.indices[2+i];t(r,a),t(a,i),t(i,r)}var o=Object.keys(n);this.edges=new Int16Array(2*o.length);for(let e=0;e<o.length;e++){var s=o[e].split("_");this.edges[2*e]=parseInt(s[0],10),this.edges[2*e+1]=parseInt(s[1],10)}}getEdgeVertex(e,t,n){e=this.edges[2*e+(t?1:0)];this.getVertex(e,n)}getEdgeVector(e,t){var n=pu,i=fu;this.getEdgeVertex(e,0,n),this.getEdgeVertex(e,1,i),i.vsub(n,t)}static computeNormal(e,t,n,i){t.vsub(e,gu),n.vsub(t,mu),mu.cross(gu,i),i.isZero()||i.normalize()}getVertex(e,t){var n=this.scale;return this._getUnscaledVertex(e,t),t.x*=n.x,t.y*=n.y,t.z*=n.z,t}_getUnscaledVertex(e,t){var e=3*e,n=this.vertices;return t.set(n[e],n[1+e],n[2+e])}getWorldVertex(e,t,n,i){return this.getVertex(e,i),PT.pointToWorldFrame(t,n,i,i),i}getTriangleVertices(e,t,n,i){e*=3;this.getVertex(this.indices[e],t),this.getVertex(this.indices[1+e],n),this.getVertex(this.indices[2+e],i)}getNormal(e,t){e*=3;return t.set(this.normals[e],this.normals[1+e],this.normals[2+e])}calculateLocalInertia(e,t){this.computeLocalAABB(Eu);var n=Eu.upperBound.x-Eu.lowerBound.x,i=Eu.upperBound.y-Eu.lowerBound.y,r=Eu.upperBound.z-Eu.lowerBound.z;return t.set(1/12*e*(2*i*2*i+2*r*2*r),1/12*e*(2*n*2*n+2*r*2*r),1/12*e*(2*i*2*i+2*n*2*n))}computeLocalAABB(e){var t=e.lowerBound,n=e.upperBound,i=this.vertices.length,r=(this.vertices,Au);this.getVertex(0,r),t.copy(r),n.copy(r);for(let e=0;e!==i;e++)this.getVertex(e,r),r.x<t.x?t.x=r.x:r.x>n.x&&(n.x=r.x),r.y<t.y?t.y=r.y:r.y>n.y&&(n.y=r.y),r.z<t.z?t.z=r.z:r.z>n.z&&(n.z=r.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let n=0;var i=this.vertices,r=new Rd;for(let e=0,t=i.length/3;e!==t;e++){this.getVertex(e,r);var a=r.lengthSquared();a>n&&(n=a)}this.boundingSphereRadius=Math.sqrt(n)}calculateWorldAABB(e,t,n,i){var r=xu,a=Tu;r.position=e,r.quaternion=t,this.aabb.toWorldFrame(r,a),n.copy(a.lowerBound),i.copy(a.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(n,i,r,a,o){void 0===n&&(n=1),void 0===i&&(i=.5),void 0===r&&(r=8),void 0===a&&(a=6),void 0===o&&(o=2*Math.PI);var s=[],l=[];for(let t=0;t<=r;t++)for(let e=0;e<=a;e++){var u=e/a*o,c=t/r*Math.PI*2,h=(n+i*Math.cos(c))*Math.cos(u),u=(n+i*Math.cos(c))*Math.sin(u),c=i*Math.sin(c);s.push(h,u,c)}for(let t=1;t<=r;t++)for(let e=1;e<=a;e++){var d=(a+1)*t+e-1,p=(a+1)*(t-1)+e-1,f=(a+1)*(t-1)+e,m=(a+1)*t+e;l.push(d,p,m),l.push(p,f,m)}return new aS(s,l)}}let hu=new Rd,du=new LT,pu=new Rd,fu=new Rd,mu=new Rd,gu=new Rd,vu=new Rd,_u=new Rd,yu=new Rd,Eu=new LT,Au=new Rd,xu=new PT,Tu=new LT;Id;const oS=Nd.types.SPHERE,sS=Nd.types.SPHERE|Nd.types.PLANE,lS=Nd.types.BOX|Nd.types.BOX,uS=Nd.types.SPHERE|Nd.types.BOX,cS=Nd.types.PLANE|Nd.types.BOX,hS=Nd.types.CONVEXPOLYHEDRON,dS=Nd.types.SPHERE|Nd.types.CONVEXPOLYHEDRON,pS=Nd.types.PLANE|Nd.types.CONVEXPOLYHEDRON,fS=Nd.types.BOX|Nd.types.CONVEXPOLYHEDRON,mS=Nd.types.SPHERE|Nd.types.HEIGHTFIELD,gS=Nd.types.BOX|Nd.types.HEIGHTFIELD,vS=Nd.types.CONVEXPOLYHEDRON|Nd.types.HEIGHTFIELD,_S=Nd.types.PARTICLE|Nd.types.SPHERE,yS=Nd.types.PLANE|Nd.types.PARTICLE,ES=Nd.types.BOX|Nd.types.PARTICLE,AS=Nd.types.PARTICLE|Nd.types.CONVEXPOLYHEDRON,xS=Nd.types.CYLINDER,TS=Nd.types.SPHERE|Nd.types.CYLINDER,SS=Nd.types.PLANE|Nd.types.CYLINDER,wS=Nd.types.BOX|Nd.types.CYLINDER,bS=Nd.types.CONVEXPOLYHEDRON|Nd.types.CYLINDER,MS=Nd.types.HEIGHTFIELD|Nd.types.CYLINDER,RS=Nd.types.PARTICLE|Nd.types.CYLINDER,NS=Nd.types.SPHERE|Nd.types.TRIMESH,IS=Nd.types.PLANE|Nd.types.TRIMESH;oS,sS,lS,uS,cS,hS,dS,pS,fS,mS,gS,vS,_S,yS,ES,AS,xS,TS,SS,wS,bS,MS,RS,NS,IS,new Rd,new Rd,new Rd,new Rd,new Rd,new OT,new OT,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new LT,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new OT,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,new Rd,class extends DT{},new LT,new XT;let Su=globalThis.performance||{};if(!Su.now){let e=Date.now();Su.timing&&Su.timing.navigationStart&&(e=Su.timing.navigationStart),Su.now=()=>Date.now()-e}new Rd,Id,Lg=new dd,Object.assign(Pg.prototype,{toJSON:function(){var t=this.faces.map(e=>e.toArray()),n=Array.from(new Set(t.flat())).sort(),i=[];for(let e=0;e<n.length;e++)i.push(this.vertices[n[e]].point.x,this.vertices[n[e]].point.y,this.vertices[n[e]].point.z);var r=new Map;for(let e=0;e<n.length;e++)r.set(n[e],e);var a=[];for(let e=0;e<t.length;e++)a.push([r.get(t[e][0]),r.get(t[e][1]),r.get(t[e][2])]);return[i,a]},setFromPoints:function(e){!0!==Array.isArray(e)&&console.error("THREE.ConvexHull: Points parameter is not an array."),e.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.vertices.push(new Fg(e[t],t));return this.compute(),this},setFromObject:function(e){var o=[];return e.updateMatrixWorld(!0),e.traverse(function(e){var t,n,i,r=e.geometry;if(void 0!==r&&(r=r.isGeometry?r.toBufferGeometry?r.toBufferGeometry():(new BufferGeometry).fromGeometry(r):r).isBufferGeometry){var a=r.attributes.position;if(void 0!==a)for(t=0,n=a.count;t<n;t++)(i=new dd).fromBufferAttribute(a,t).applyMatrix4(e.matrixWorld),o.push(i)}}),this.setFromPoints(o)},containsPoint:function(e){for(var t=this.faces,n=0,i=t.length;n<i;n++)if(t[n].distanceToPoint(e)>this.tolerance)return!1;return!0},intersectRay:function(e,t){for(var n=this.faces,i=-1/0,r=1/0,a=0,o=n.length;a<o;a++){var s=n[a],l=s.distanceToPoint(e.origin),s=s.normal.dot(e.direction);if(0<l&&0<=s)return null;l=0!==s?-l/s:0;if(!(l<=0)&&(0<s?r=Math.min(l,r):i=Math.max(l,i),r<i))return null}return i!==-1/0?e.at(i,t):e.at(r,t),t},intersectsRay:function(e){return null!==this.intersectRay(e,Lg)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(e,t){return null===(e.face=t).outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this},removeVertexFromFace:function(e,t){return e===t.outside&&(null!==e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this},removeAllVerticesFromFace:function(e){if(null!==e.outside){for(var t=e.outside,n=e.outside;null!==n.next&&n.next.face===e;)n=n.next;return this.assigned.removeSubList(t,n),t.prev=n.next=null,e.outside=null,t}},deleteFaceVertices:function(e,t){e=this.removeAllVerticesFromFace(e);if(void 0!==e)if(void 0===t)this.unassigned.appendChain(e);else{var n=e;do{var i=n.next}while(t.distanceToPoint(n.point)>this.tolerance?this.addVertexToFace(n,t):this.unassigned.append(n),null!==(n=i))}return this},resolveUnassignedPoints:function(e){if(!1===this.unassigned.isEmpty()){var t=this.unassigned.first();do{for(var n=t.next,i=this.tolerance,r=null,a=0;a<e.length;a++){var o=e[a];if(0===o.mark){var s=o.distanceToPoint(t.point);if(i<s&&(i=s,r=o),i>1e3*this.tolerance)break}}}while(null!==r&&this.addVertexToFace(t,r),null!==(t=n))}return this},computeExtremes:function(){for(var e,t=new dd,n=new dd,i=[],r=[],a=0;a<3;a++)i[a]=r[a]=this.vertices[0];for(t.copy(this.vertices[0].point),n.copy(this.vertices[0].point),a=0,e=this.vertices.length;a<e;a++){for(var o=this.vertices[a],s=o.point,l=0;l<3;l++)s.getComponent(l)<t.getComponent(l)&&(t.setComponent(l,s.getComponent(l)),i[l]=o);for(l=0;l<3;l++)s.getComponent(l)>n.getComponent(l)&&(n.setComponent(l,s.getComponent(l)),r[l]=o)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(t.x),Math.abs(n.x))+Math.max(Math.abs(t.y),Math.abs(n.y))+Math.max(Math.abs(t.z),Math.abs(n.z))),{min:i,max:r}},computeInitialHull:function(){void 0===Rg&&(Rg=new AT,Ng=new _A,Ig=new dd);for(var e,t,n,i,r,a,o,s=this.vertices,l=this.computeExtremes(),u=l.min,c=l.max,h=0,d=0,p=0;p<3;p++)h<(o=c[p].point.getComponent(p)-u[p].point.getComponent(p))&&(h=o,d=p);for(t=u[d],n=c[d],h=0,Rg.set(t.point,n.point),p=0,a=this.vertices.length;p<a;p++)(e=s[p])!==t&&e!==n&&(Rg.closestPointToPoint(e.point,!0,Ig),h<(o=Ig.distanceToSquared(e.point)))&&(h=o,i=e);for(h=-1,Ng.setFromCoplanarPoints(t.point,n.point,i.point),p=0,a=this.vertices.length;p<a;p++)(e=s[p])!==t&&e!==n&&e!==i&&h<(o=Math.abs(Ng.distanceToPoint(e.point)))&&(h=o,r=e);var f=[];if(Ng.distanceToPoint(r.point)<0)for(f.push(Ug.create(t,n,i),Ug.create(r,n,t),Ug.create(r,i,n),Ug.create(r,t,i)),p=0;p<3;p++)g=(p+1)%3,f[p+1].getEdge(2).setTwin(f[0].getEdge(g)),f[p+1].getEdge(1).setTwin(f[g+1].getEdge(0));else for(f.push(Ug.create(t,i,n),Ug.create(r,t,n),Ug.create(r,n,i),Ug.create(r,i,t)),p=0;p<3;p++)g=(p+1)%3,f[p+1].getEdge(2).setTwin(f[0].getEdge((3-p)%3)),f[p+1].getEdge(0).setTwin(f[g+1].getEdge(1));for(p=0;p<4;p++)this.faces.push(f[p]);for(p=0,a=s.length;p<a;p++)if((e=s[p])!==t&&e!==n&&e!==i&&e!==r){for(var h=this.tolerance,m=null,g=0;g<4;g++)h<(o=this.faces[g].distanceToPoint(e.point))&&(h=o,m=this.faces[g]);null!==m&&this.addVertexToFace(e,m)}return this},reindexFaces:function(){for(var e=[],t=0;t<this.faces.length;t++){var n=this.faces[t];0===n.mark&&e.push(n)}return this.faces=e,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var e,t=0,n=this.assigned.first().face,i=n.outside;do{var r=n.distanceToPoint(i.point)}while(t<r&&(t=r,e=i),null!==(i=i.next)&&i.face===n);return e}},computeHorizon:function(e,t,n,i){var r;this.deleteFaceVertices(n),n.mark=1,r=null===t?t=n.getEdge(0):t.next;do{var a=r.twin,o=a.face}while(0===o.mark&&(o.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,a,o,i):i.push(r)),(r=r.next)!==t);return this},addAdjoiningFace:function(e,t){e=Ug.create(e,t.tail(),t.head());return this.faces.push(e),e.getEdge(-1).setTwin(t.twin),e.getEdge(0)},addNewFaces:function(e,t){this.newFaces=[];for(var n=null,i=null,r=0;r<t.length;r++){var a=this.addAdjoiningFace(e,t[r]);null===n?n=a:a.next.setTwin(i),this.newFaces.push(a.face),i=a}return n.next.setTwin(i),this},addVertexToHull:function(e){var t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var e;for(this.computeInitialHull();void 0!==(e=this.nextVertexToAdd());)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(Ug,{create:function(e,t,n){var i=new Ug,e=new Bg(e,i),t=new Bg(t,i),n=new Bg(n,i);return((e.next=n.prev=t).next=e.prev=n).next=t.prev=e,i.edge=e,i.compute()}}),Object.assign(Ug.prototype,{toArray:function(){var e=[];let t=this.edge;for(;e.push(t.head().index),(t=t.next)!==this.edge;);return e},getEdge:function(e){for(var t=this.edge;0<e;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t},compute:function(){void 0===Cg&&(Cg=new lA);var e=this.edge.tail(),t=this.edge.head(),n=this.edge.next.head();return Cg.set(e.point,t.point,n.point),Cg.getNormal(this.normal),Cg.getMidpoint(this.midpoint),this.area=Cg.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(e){return this.normal.dot(e)-this.constant}}),Object.assign(Bg.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceTo(e.point):-1},lengthSquared:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceToSquared(e.point):-1},setTwin:function(e){return(this.twin=e).twin=this}}),Object.assign(zg.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this},insertAfter:function(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this},append:function(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this},appendChain:function(e){for(null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;null!==e.next;)e=e.next;return this.tail=e,this},remove:function(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this},removeSubList:function(e,t){return null===e.prev?this.head=t.next:e.prev.next=t.next,null===t.next?this.tail=e.prev:t.next.prev=e.prev,this},isEmpty:function(){return null===this.head}});var Rg,Ng,Ig,Cg,Lg,Dg,Og=Pg;function Pg(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new zg,this.unassigned=new zg,this.vertices=[]}function Ug(){this.normal=new dd,this.midpoint=new dd,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}function Bg(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}function Fg(e,t){this.point=e,this.index=t,this.prev=null,this.next=null,this.face=null}function zg(){this.head=null,this.tail=null}let wu=new dd,bu=new dd,Mu=new hd;function kg(e){var t,n=(e=>{let t=[];return e.traverse(function(e){e.isMesh&&t.push(e)}),t})(e);if(0===n.length)return null;if(1===n.length)return Gg(n[0]);for(var r=[];t=n.pop();)r.push(function(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e-4,n=(t=Math.max(t,Number.EPSILON),{}),i=e.getIndex(),r=e.getAttribute("position"),a=(i||r).count,o=0,s=[],l=[],u=Math.log10(1/t),c=Math.pow(10,u);for(let e=0;e<a;e++){var h=i?i.getX(e):e,d="";(d=(d=(d+=~~(r.getX(h)*c)+",")+(~~(r.getY(h)*c)+","))+(~~(r.getZ(h)*c)+","))in n?s.push(n[d]):(l.push(r.getX(h)),l.push(r.getY(h)),l.push(r.getZ(h)),n[d]=o,s.push(o),o++)}var e=new yd(new Float32Array(l),r.itemSize,r.normalized),p=new Ad;return p.setAttribute("position",e),p.setIndex(s),p}(Gg(t)));{var a=r;let t=0;for(let e=0;e<a.length;e++){var o=a[e].attributes.position;o&&3===o.itemSize&&(t+=o.count)}let n=new Float32Array(3*t),i=0;for(let e=0;e<a.length;e++){var s=a[e].attributes.position;if(s&&3===s.itemSize)for(let e=0;e<s.count;e++)n[i++]=s.getX(e),n[i++]=s.getY(e),n[i++]=s.getZ(e)}return(new Ad).setAttribute("position",new yd(n,3))}}function Gg(e){let t=e.geometry;return t=t.toBufferGeometry?t.toBufferGeometry():t.clone(),e.updateMatrixWorld(),e.matrixWorld.decompose(wu,Mu,bu),t.scale(bu.x,bu.y,bu.z),t}function Hg(e){var t=e.attributes.position,n=new Float32Array(3*t.count);for(let e=0;e<t.count;e++)n[3*e]=t.getX(e),n[3*e+1]=t.getY(e),n[3*e+2]=t.getZ(e);return n}function Vg(e,t){switch(t){case"x":return e.x;case"y":return e.y;case"z":return e.z}throw new Error("Unexpected component "+t)}let Ru=Math.PI/2,Nu=((dg=Dg=Dg||{}).BOX="Box",dg.CYLINDER="Cylinder",dg.SPHERE="Sphere",dg.HULL="ConvexPolyhedron",dg.MESH="Trimesh",function(e){var t,n,i,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};let a;if(r.type===Dg.BOX)return jg(e);if(r.type===Dg.CYLINDER)return t=e,o=["x","y","z"],l=(l=r).cylinderAxis||"y",o=o.splice(o.indexOf(l),1)&&o,t=(new pd).setFromObject(t),isFinite(t.min.lengthSq())?(n=t.max[l]-t.min[l],t=.5*Math.max(Vg(t.max,o[0])-Vg(t.min,o[0]),Vg(t.max,o[1])-Vg(t.min,o[1])),o="y"===l?Ru:0,l="z"===l?Ru:0,{type:Dg.CYLINDER,params:{radiusTop:t,radiusBottom:t,height:n,segments:12},orientation:(new OT).setFromEuler(o,l,0,"XYZ").normalize()}):null;if(r.type===Dg.SPHERE)return t=e,(n=r).sphereRadius?{type:Dg.SPHERE,params:{radius:n.sphereRadius}}:(n=kg(t))?(n.computeBoundingSphere(),{type:Dg.SPHERE,params:{radius:n.boundingSphere.radius}}):null;if(r.type===Dg.HULL){var o=e,s=kg(o);if(!s)return null;for(let e=0;e<s.attributes.position.count;e++)s.attributes.position.setXYZ(e,s.attributes.position.getX(e)+1e-4*(Math.random()-.5),s.attributes.position.getY(e)+1e-4*(Math.random()-.5),s.attributes.position.getZ(e)+1e-4*(Math.random()-.5));var[o,l]=(new Og).setFromObject(new xd(s)).toJSON();return{type:Dg.HULL,params:{vertices:new Float32Array(o),faces:l}}}if(r.type===Dg.MESH)if(a=kg(e)){var u=a,c=Hg(u);if(!c.length)return null;var h=new Uint32Array(c.length);for(let e=0;e<c.length;e++)h[e]=e;return{type:Dg.MESH,params:{vertices:c,indices:h}}}else return null;if(r.type)throw new Error(`[CANNON.getShapeParameters] Invalid type "${r.type}".`);if(!(a=kg(e)))return null;switch(a.type){case"BoxGeometry":case"BoxBufferGeometry":return Wg(a);case"CylinderGeometry":case"CylinderBufferGeometry":var d=a;return d=d.parameters,{type:Dg.CYLINDER,params:{radiusTop:d.radiusTop,radiusBottom:d.radiusBottom,height:d.height,segments:d.radialSegments},orientation:(new OT).setFromEuler(fn.degToRad(-90),0,0,"XYZ").normalize()};case"PlaneGeometry":case"PlaneBufferGeometry":d=a;return d.computeBoundingBox(),d=d.boundingBox,{type:Dg.BOX,params:{x:(d.max.x-d.min.x)/2||.1,y:(d.max.y-d.min.y)/2||.1,z:(d.max.z-d.min.z)/2||.1}};case"SphereGeometry":case"SphereBufferGeometry":return i=a,{type:Dg.SPHERE,params:{radius:i.parameters.radius}};case"TubeGeometry":case"BufferGeometry":return jg(e);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',a.type),Wg(a)}}),Iu=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=Nu(e,t);if(!e)return null;var{type:t,params:e,offset:n,orientation:i}=e;let r;return{shape:r=(t===Dg.BOX?e=>{var{x:e,y:t,z:n}=e;return e=new BT(new Rd(e,t,n))}:t===Dg.CYLINDER?e=>{var{radiusTop:e,radiusBottom:t,height:n,segments:i}=e;return(e=new nS(e,t,n,i)).radiusTop=t,e.radiusBottom=t,e.height=n,e.numSegments=i,e}:t===Dg.SPHERE?e=>e=new tS(e.radius):t===Dg.HULL?e=>{var{faces:e,vertices:t}=e,n=[];for(let e=0;e<t.length;e+=3)n.push(new Rd(t[e],t[e+1],t[e+2]));return e=new UT({faces:e,vertices:n})}:e=>{var{vertices:e,indices:t}=e;return e=new aS(e,t)})(e),offset:n,orientation:i}};function Wg(e){if(!Hg(e).length)return null;e.computeBoundingBox();e=e.boundingBox;return{type:Dg.BOX,params:{x:(e.max.x-e.min.x)/2,y:(e.max.y-e.min.y)/2,z:(e.max.z-e.min.z)/2}}}function jg(e){var e=e.clone(),t=(e.quaternion.set(0,0,0,1),e.updateMatrixWorld(),(new pd).setFromObject(e));return isFinite(t.min.lengthSq())?(e=t.translate(e.position.negate()).getCenter(new dd),{type:Dg.BOX,params:{x:(t.max.x-t.min.x)/2,y:(t.max.y-t.min.y)/2,z:(t.max.z-t.min.z)/2},offset:e.lengthSq()?new Rd(e.x,e.y,e.z):void 0}):null}var Yg,qg,Xg=Xg||(Yg=[],{getAll:function(){return Yg},removeAll:function(){Yg=[]},add:function(e){Yg.push(e)},remove:function(e){e=Yg.indexOf(e);-1!==e&&Yg.splice(e,1)},update:function(e,t){if(0===Yg.length)return!1;var n=0;for(e=void 0!==e?e:Xg.now();n<Yg.length;)Yg[n].update(e)||t?n++:Yg.splice(n,1);return!0}});function Zg(t){return nd.PLANE_USER_DATA.filter(function(e){return e.name==t})}function Kg(e){td()("#warning span").text(e),td()("#warning").css("opacity",1),setTimeout(()=>{td()("#warning").css("opacity",0)},2e3)}function Jg(t,e){let n=100/t.length;var i=e.map((e,t)=>[t,Math.floor(e/n),e%n]).sort((e,t)=>t[2]-e[2]),r=t.length-i.reduce((e,t)=>e+t[1],0);for(let e=0;e<r;e++)i[e][1]++;let a=0;return i.sort((e,t)=>e[0]-t[0]).map(e=>t.slice(a,a+=e[1]))}function Qg(e){let t=(e=e.slice(0)).length;for(;0!=t;){var n=Math.floor(Math.random()*t);t--,[e[t],e[n]]=[e[n],e[t]]}return e}function $g(e,t,n){new Xg.Tween(t).to(n,e).start()}function ev(e,t,n){e.traverse(e=>{e.material&&(e.material.transparent=t,e.material.opacity=n,e.material.colorWrite=!t,e.material.depthWrite=!t)})}function tv(e){return(new dd).copy(e)}function nv(e){return new cd(e.x,e.y,e.z,1)}function iv(e){return new dd(e.x,e.y,e.z).multiplyScalar(1/e.w)}"undefined"==typeof window&&"undefined"!=typeof process?Xg.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?Xg.now=window.performance.now.bind(window.performance):void 0!==Date.now?Xg.now=Date.now:Xg.now=function(){return(new Date).getTime()},Xg.Tween=function(e){var u,c=e,h={},d={},p={},f=1e3,m=0,g=!1,n=!1,v=0,_=null,y=Xg.Easing.Linear.None,E=Xg.Interpolation.Linear,A=[],x=null,T=!1,S=null,w=null,t=null;this.to=function(e,t){return d=e,void 0!==t&&(f=t),this},this.start=function(e){for(var t in Xg.add(this),T=!(n=!0),_=void 0!==e?e:Xg.now(),_+=v,d){if(d[t]instanceof Array){if(0===d[t].length)continue;d[t]=[c[t]].concat(d[t])}void 0!==c[t]&&(h[t]=c[t],h[t]instanceof Array==!1&&(h[t]*=1),p[t]=h[t]||0)}return this},this.stop=function(){return n&&(Xg.remove(this),n=!1,null!==t&&t.call(c,c),this.stopChainedTweens()),this},this.end=function(){return this.update(_+f),this},this.stopChainedTweens=function(){for(var e=0,t=A.length;e<t;e++)A[e].stop()},this.delay=function(e){return v=e,this},this.repeat=function(e){return m=e,this},this.repeatDelay=function(e){return u=e,this},this.yoyo=function(e){return g=e,this},this.easing=function(e){return y=e,this},this.interpolation=function(e){return E=e,this},this.chain=function(){return A=arguments,this},this.onStart=function(e){return x=e,this},this.onUpdate=function(e){return S=e,this},this.onComplete=function(e){return w=e,this},this.onStop=function(e){return t=e,this},this.update=function(e){var t,n,i,r,a,o;if(e<_)return!0;for(t in!1===T&&(null!==x&&x.call(c,c),T=!0),i=y(n=1<(n=(e-_)/f)?1:n),d)void 0!==h[t]&&(r=h[t]||0,(a=d[t])instanceof Array?c[t]=E(a,i):"number"==typeof(a="string"==typeof a?"+"===a.charAt(0)||"-"===a.charAt(0)?r+parseFloat(a):parseFloat(a):a)&&(c[t]=r+(a-r)*i));if(null!==S&&S.call(c,i),1!=n)return!0;if(0<m){for(t in isFinite(m)&&m--,p)"string"==typeof d[t]&&(p[t]=p[t]+parseFloat(d[t])),g&&(o=p[t],p[t]=d[t],d[t]=o),h[t]=p[t];return g&&0,_=void 0!==u?e+u:e+v,!0}null!==w&&w.call(c,c);for(var s=0,l=A.length;s<l;s++)A[s].start(_+f);return!1}},Xg.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((1+t)*e-t)*.5:.5*((e-=2)*e*((1+t)*e+t)+2)}},Bounce:{In:function(e){return 1-Xg.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*Xg.Easing.Bounce.In(2*e):.5*Xg.Easing.Bounce.Out(2*e-1)+.5}}},Xg.Interpolation={Linear:function(e,t){var n=e.length-1,i=n*t,r=Math.floor(i),a=Xg.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],i):1<t?a(e[n],e[n-1],n-i):a(e[r],e[n<r+1?n:r+1],i-r)},Bezier:function(e,t){for(var n=0,i=e.length-1,r=Math.pow,a=Xg.Interpolation.Utils.Bernstein,o=0;o<=i;o++)n+=r(1-t,i-o)*r(t,o)*e[o]*a(i,o);return n},CatmullRom:function(e,t){var n=e.length-1,i=n*t,r=Math.floor(i),a=Xg.Interpolation.Utils.CatmullRom;return e[0]===e[n]?a(e[((r=t<0?Math.floor(i=n*(1+t)):r)-1+n)%n],e[r],e[(r+1)%n],e[(r+2)%n],i-r):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-i)-e[0]):1<t?e[n]-(a(e[n],e[n],e[n-1],e[n-1],i-n)-e[n]):a(e[r?r-1:0],e[r],e[n<r+1?n:r+1],e[n<r+2?n:r+2],i-r)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=Xg.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:(qg=[1],function(e){var t=1;if(qg[e])return qg[e];for(var n=e;1<n;n--)t*=n;return qg[e]=t}),CatmullRom:function(e,t,n,i,r){var e=.5*(n-e),i=.5*(i-t),a=r*r;return(2*t-2*n+e+i)*(r*a)+(-3*t+3*n-2*e-i)*a+e*r+t}}};let Cu=e=>({r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16)});class CS{constructor(e,t,n,i,r){var a=new dd(e,t,n).multiplyScalar(.5),a=(this.baseBB=new pd(a.clone().negate(),a.clone()),this.t=i.clone(),this.inverse_t=this.t.clone(),this.inverse_t.invert(),new dA(e,t,n)),i=new Dx(a),e=new KA(i,new XA({color:r,opacity:.5,transparent:!1}));e.applyMatrix4(this.t),this.helper=e}containsPoint(e){e=e;var e=new cd(e.x,e.y,e.z,1),e=(e.applyMatrix4(this.inverse_t),e=e,new dd(e.x,e.y,e.z).multiplyScalar(1/e.w));return this.baseBB.containsPoint(e)}intersectsBox(e){e=new pd(e.min.clone().applyMatrix4(this.inverse_t),e.max.clone().applyMatrix4(this.inverse_t));return this.baseBB.intersectsBox(e)}}function rv(e,t){e.tractor==t&&(e.mass="player"==e.name?50:5,nd.TRACTOR_BEAM[t].inTractor=e.inTractor=!1,e.tractor=null,e.tractorID=null,"player"==e.name?(document.getElementById("panel-top").style.opacity=0,rd.PLAYER_INSIDE_TRACTOR_BEAM.pause()):e.allowSleep=!0)}function av(e,t,n){n[0]=(e[0]>t[0]?t:e)[0],n[1]=(e[1]<t[1]?t:e)[1],n[2]=(t[2]<e[2]?t:e)[2],n[3]=(e[3]<t[3]?t:e)[3],n[4]=(t[4]<e[4]?t:e)[4],n[5]=(e[5]<t[5]?t:e)[5]}function ov(e,t){e[0]-=t,e[1]+=t,e[2]-=t,e[3]+=t,e[4]-=t,e[5]+=t}function sv(e){var t=e[1]-e[0],n=e[3]-e[2],e=e[5]-e[4];return 2*(t*n+n*e+e*t)}function lv(e,t){var n=(e[0]>t[0]?t:e)[0],i=(e[1]<t[1]?t:e)[1],r=(t[2]<e[2]?t:e)[2],a=(e[3]<t[3]?t:e)[3],o=(t[4]<e[4]?t:e)[4],i=i-n,n=a-r,a=(e[5]<t[5]?t:e)[5]-o;return 2*(i*n+n*a+a*i)}function uv(e,t){var n=e[0]-t[0],i=t[0]-e[1];let r=i<n?n:i;r<0&&(r=0);n=e[2]-t[1],i=t[1]-e[3];let a=i<n?n:i;a<0&&(a=0);n=e[4]-t[2],i=t[2]-e[5];let o=i<n?n:i;return o<0&&(o=0),r*r+a*a+o*o}function cv(e,t){let n,i,r,a,o,s;var l=e[0]-t[0],u=t[0]-e[1],u=(i=u<l?(n=l,u):(n=u,l),n<0&&(n=0),e[2]-t[1]),l=t[1]-e[3],l=(a=l<u?(r=u,l):(r=l,u),r<0&&(r=0),e[4]-t[2]),u=t[2]-e[5];return s=u<l?(o=l,u):(o=u,l),o<0&&(o=0),{min:n*n+r*r+o*o,max:i*i+a*a+s*s}}class LS{constructor(){this.array=[]}clear(){this.array=[]}push(e){var t=this.array,n=e.inheritedCost,i=6<t.length?t.length-6:0;let r;for(r=t.length-1;r>=i&&!(n<=t[r].inheritedCost);r--);r>t.length-7&&t.splice(r+1,0,e)}pop(){return this.array.pop()}}class DS{constructor(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.root=null,this._sortedList=new LS,this.count=0,this.highPrecision=e,this._typeArray=e?Float64Array:Float32Array}createFromArray(s,c,l){let h=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,e=c.length,d=this._typeArray,p=(d!==(4===c[0].BYTES_PER_ELEMENT?Float32Array:Float64Array)&&console.warn("Different precision."),new d(6)),o,u;function f(t,e){var n=new d(6),i=t+e;n[0]=1/0,n[1]=-1/0,n[2]=1/0,n[3]=-1/0,n[4]=1/0,n[5]=-1/0,p[0]=1/0,p[1]=-1/0,p[2]=1/0,p[3]=-1/0,p[4]=1/0,p[5]=-1/0;for(let e=t;e<i;e++){var r=c[e],a=r[0],o=r[1],s=r[2],l=r[3],u=r[4],r=r[5],o=(n[0]>a&&(n[0]=a),n[1]<o&&(n[1]=o),n[2]>s&&(n[2]=s),n[3]<l&&(n[3]=l),n[4]>u&&(n[4]=u),n[5]<r&&(n[5]=r),.5*(o+a)),a=.5*(l+s),l=.5*(r+u);p[0]>o&&(p[0]=o),p[1]<o&&(p[1]=o),p[2]>a&&(p[2]=a),p[3]<a&&(p[3]=a),p[4]>l&&(p[4]=l),p[5]<l&&(p[5]=l)}return n[0]-=h,n[1]+=h,n[2]-=h,n[3]+=h,n[4]-=h,n[5]+=h,n}function m(){var e,t,n;o=2*(e=p,t=e[1]-e[0],n=e[3]-e[2],e=e[5]-e[4],n<t?e<t?0:2:e<n?1:2),u=.5*(p[o]+p[o+1])}function g(e,t){let n=e,i=e+t-1;for(;n<=i;){var r=c[n];if(.5*(r[o+1]+r[o])>=u)for(;;){var a=c[i];if(.5*(a[o+1]+a[o])<u){a=s[n],a=(s[n]=s[i],s[i]=a,c[n]);c[n]=c[i],c[i]=a,i--;break}if(--i<=n)return n}n++}return n}this.root=function e(n,t,i){if(1===t){let e=c[n],t=(0<h&&ov(e,h),{box:e,object:s[n],parent:i});return l&&l(t),t}let r=f(n,t);m();let a=g(n,t);a!==n&&a!==n+t||(a=n+(t>>1));let o={box:r,parent:i};return o.left=e(n,a-n,o),o.right=e(a,t-a+n,o),o}(0,e,null)}insert(e,t,n){0<n&&ov(t,n);n=this.createLeafNode(e,t);return null===this.root?this.root=n:this.insertLeaf(n),this.count++,n}insertRange(t,n,i,r){console.warn("Method not optimized yet. It just calls 'insert' N times.");var a=t.length,o=0<i?i:i?null:0;for(let e=0;e<a;e++){var s=this.insert(t[e],n[e],o??i[e]);r&&r(s)}}move(e,t){var n,i;e.parent&&(n=e.box,(i=e.parent.box)[0]>n[0]||i[1]<n[1]||i[2]>n[2]||i[3]<n[3]||i[4]>n[4]||i[5]<n[5])?(0<t&&ov(e.box,t),i=this.delete(e),this.insertLeaf(e,i),this.count++):0<t&&ov(e.box,t)}delete(e){var t,n,i=e.parent;return null===i?this.root=null:(t=i.parent,(n=i.left===e?i.right:i.left).parent=t,(e.parent=null)===t?this.root=n:(t.left===i?t.left=n:t.right=n,this.refit(t),this.count--),i)}clear(){this.root=null}insertLeaf(e,t){var n=this.findBestSibling(e.box),i=n.parent;void 0===t?t=this.createInternalNode(i,n,e):(t.parent=i,t.left=n,t.right=e),n.parent=t,e.parent=t,null===i?this.root=t:i.left===n?i.left=t:i.right=t,this.refitAndRotate(e,n)}createLeafNode(e,t){return{box:t,object:e,parent:null}}createInternalNode(e,t,n){return{parent:e,left:t,right:n,box:new this._typeArray(6)}}findBestSibling(e){var t=this.root;let n=t,i=lv(e,t.box);var r=sv(e);if(void 0!==t.object)return t;var a=this._sortedList;a.clear();let o={node:t,inheritedCost:i-sv(t.box)};do{var{node:s,inheritedCost:l}=o;if(r+l>=i)break;var u=s.left,s=s.right,c=lv(e,u.box)+l,h=c-sv(u.box),l=lv(e,s.box)+l,d=l-sv(s.box);l<c?i>l&&(n=s,i=l):i>c&&(n=u,i=c),h<d?r+h>=i||(void 0===u.object&&a.push({node:u,inheritedCost:h}),r+d>=i)||void 0===s.object&&a.push({node:s,inheritedCost:d}):r+d>=i||(void 0===s.object&&a.push({node:s,inheritedCost:d}),r+h>=i)||void 0===u.object&&a.push({node:u,inheritedCost:h})}while(o=a.pop());return n}refit(e){for(av(e.left.box,e.right.box,e.box);e=e.parent;)if(!((e,t,n)=>{let i=!1;var r=(e[0]>t[0]?t:e)[0],a=(e[1]<t[1]?t:e)[1],o=(t[2]<e[2]?t:e)[2],s=(e[3]<t[3]?t:e)[3],l=(t[4]<e[4]?t:e)[4],t=(e[5]<t[5]?t:e)[5];return n[0]>r&&(n[0]=r,i=!0),n[1]<a&&(n[1]=a,i=!0),o<n[2]&&(n[2]=o,i=!0),n[3]<s&&(n[3]=s,i=!0),l<n[4]&&(n[4]=l,i=!0),n[5]<t&&(n[5]=t,i=!0),i})(e.left.box,e.right.box,e.box))return}refitAndRotate(i,e){var r=i.box,t=(i=i.parent).box;for(av(r,e.box,t);i=i.parent;){if(!((e,t)=>{let n=!1;return t[0]>e[0]&&(t[0]=e[0],n=!0),t[1]<e[1]&&(t[1]=e[1],n=!0),e[2]<t[2]&&(t[2]=e[2],n=!0),t[3]<e[3]&&(t[3]=e[3],n=!0),e[4]<t[4]&&(t[4]=e[4],n=!0),t[5]<e[5]&&(t[5]=e[5],n=!0),n})(r,i.box))return;var a,o,s,l,u=i.left,c=i.right,h=u.box,d=c.box;let e=null,t=null,n=0;void 0===c.object&&(s=c.left,a=c.right,o=(l=sv(c.box))-lv(h,s.box),(l=l-lv(h,a.box))<o?0<o&&(e=u,t=a,n=o):0<l&&(e=u,t=s,n=l)),void 0===u.object&&(h=u.left,a=u.right,s=(o=sv(u.box))-lv(d,h.box),(l=o-lv(d,a.box))<s?s>n&&(e=c,t=a):l>n&&(e=c,t=h)),null!==e&&this.swap(e,t)}}swap(e,t){var n=e.parent,i=t.parent,r=i.box;n.left===e?n.left=t:n.right=t,i.left===t?i.left=e:i.right=e,e.parent=i,t.parent=n,av(i.left.box,i.right.box,r)}}class OS{constructor(e,t){this.coordinateSystem=t,this.array=new(e?Float64Array:Float32Array)(24)}setFromProjectionMatrix(e){if(this.updatePlane(0,e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),this.updatePlane(1,e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),this.updatePlane(2,e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),this.updatePlane(3,e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),this.updatePlane(4,e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14]),0===this.coordinateSystem)this.updatePlane(5,e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]);else{if(1!==this.coordinateSystem)throw new Error("Invalid coordinate system: "+this.coordinateSystem);this.updatePlane(5,e[2],e[6],e[10],e[14])}return this}updatePlane(e,t,n,i,r){var a=this.array,e=4*e,o=Math.sqrt(t*t+n*n+i*i);a[0+e]=t/o,a[1+e]=n/o,a[2+e]=i/o,a[3+e]=r/o}intersectsBoxMask(t,n){var i=this.array;let r,a,o,s,l,u;for(let e=0;e<6;e++)if(n&32>>e){var c=4*e,h=i[0+c],d=i[1+c],p=i[2+c],c=i[3+c];if(s=0<h?(r=t[1],t[0]):(r=t[0],t[1]),l=0<d?(a=t[3],t[2]):(a=t[2],t[3]),u=0<p?(o=t[5],t[4]):(o=t[4],t[5]),h*r+d*a+p*o<-c)return-1;h*s+d*l+p*u>-c&&(n^=32>>e)}return n}isIntersected(t,n){var i=this.array;for(let e=0;e<6;e++)if(n&32>>e){var r=4*e,a=i[0+r],o=i[1+r],s=i[2+r],r=i[3+r];if(a*(0<a?t[1]:t[0])+o*(0<o?t[3]:t[2])+s*(0<s?t[5]:t[4])<-r)return!1}return!0}isIntersectedMargin(t,n,i){if(0!==n){var r=this.array;for(let e=0;e<6;e++)if(n&32>>e){var a=4*e,o=r[0+a],s=r[1+a],l=r[2+a],a=r[3+a];if(o*(0<o?t[1]-i:t[0]+i)+s*(0<s?t[3]-i:t[2]+i)+l*(0<l?t[5]-i:t[4]+i)<-a)return!1}}return!0}}function hv(e,t,n,i,r,a){let o=i[0],s=t[0],l=n[0],u=(e[o]-s)*l,c=(e[1^o]-s)*l,h=0<u?u:0,d=c<1/0?c:1/0;return o=i[1],s=t[1],l=n[1],!((u=(e[o+2]-s)*l)>d||(c=(e[3^o]-s)*l,h>c)||(h=u>h?u:h,d=c<d?c:d,o=i[2],s=t[2],l=n[2],(u=(e[o+4]-s)*l)>d)||(c=(e[5^o]-s)*l,h>c))&&(h=u>h?u:h,d=c<d?c:d,h<=a)&&d>=r}function dv(e,t){return e[1]>=t[0]&&t[1]>=e[0]&&e[3]>=t[2]&&t[3]>=e[2]&&e[5]>=t[4]&&t[5]>=e[4]}function pv(e,t,n){return uv(n,e)<=t*t}class PS{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,e=(this._sign=new Uint8Array(3),(this.builder=e).highPrecision);this.frustum=new OS(e,t),this._dirInv=new(e?Float64Array:Float32Array)(3)}get root(){return this.builder.root}createFromArray(e,t,n,i){0<(null==e?void 0:e.length)&&this.builder.createFromArray(e,t,n,i)}insert(e,t,n){return this.builder.insert(e,t,n)}insertRange(e,t,n,i){0<(null==e?void 0:e.length)&&this.builder.insertRange(e,t,n,i)}move(e,t){this.builder.move(e,t)}delete(e){return this.builder.delete(e)}clear(){this.builder.clear()}traverse(i){!function e(t,n){if(void 0!==t.object)return void i(t,n);i(t,n)||(e(t.left,n+1),e(t.right,n+1))}(this.root,0)}intersectsRay(e,n,i){let r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1/0,o=this._dirInv,s=this._sign;return o[0]=1/e[0],o[1]=1/e[1],o[2]=1/e[2],s[0]=o[0]<0?1:0,s[1]=o[1]<0?1:0,s[2]=o[2]<0?1:0,function e(t){return!!hv(t.box,n,o,s,r,a)&&(void 0!==t.object?i(t.object):e(t.left)||e(t.right))}(this.root)}intersectsBox(n,i){return function e(t){return!!dv(n,t.box)&&(void 0!==t.object?i(t.object):e(t.left)||e(t.right))}(this.root)}intersectsSphere(n,i,r){return function e(t){return!!pv(n,i,t.box)&&(void 0!==t.object?r(t.object):e(t.left)||e(t.right))}(this.root)}isNodeIntersected(e,n){let i=e.box;for(var t;t=e.parent;){if(function e(t){return!!dv(i,t.box)&&(void 0!==t.object?n(t.object):e(t.left)||e(t.right))}(t.left===e?t.right:t.left))return!0;e=t}return!1}rayIntersections(e,n,i){let r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1/0,o=this._dirInv,s=this._sign;o[0]=1/e[0],o[1]=1/e[1],o[2]=1/e[2],s[0]=o[0]<0?1:0,s[1]=o[1]<0?1:0,s[2]=o[2]<0?1:0,function e(t){hv(t.box,n,o,s,r,a)&&(void 0!==t.object?i(t.object):(e(t.left),e(t.right)))}(this.root)}frustumCulling(e,i){let r=this.frustum.setFromProjectionMatrix(e);function a(e){void 0!==e.object?i(e,r,0):(a(e.left),a(e.right))}!function e(t,n){if(void 0!==t.object)return void(r.isIntersected(t.box,n)&&i(t,r,n));(n=r.intersectsBoxMask(t.box,n))<0||(0===n?(a(t.left),a(t.right)):(e(t.left,n),e(t.right,n)))}(this.root,63)}frustumCullingLOD(e,i,r,a){let o=this.frustum.setFromProjectionMatrix(e);function s(e,t){null===t&&(t=l(e.box)),void 0!==e.object?a(e,t,o,0):(s(e.left,t),s(e.right,t))}function l(e){var{min:t,max:n}=cv(e,i);for(let e=r.length-1;0<e;e--)if(n>=r[e])return t>=r[e]?e:null;return 0}!function e(t,n,i){let r=t.box;if(null===i&&(i=l(r)),void 0!==t.object)return void(o.isIntersected(r,n)&&a(t,i,o,n));(n=o.intersectsBoxMask(r,n))<0||(0===n?(s(t.left,i),s(t.right,i)):(e(t.left,n,i),e(t.right,n,i)))}(this.root,63,null)}closestPointToPoint(r,a){let o=1/0;return function e(t){if(void 0!==t.object){if(a){let e=a(t.object)??uv(t.box,r);e<o&&(o=e)}else o=uv(t.box,r);return}let n=uv(t.left.box,r),i=uv(t.right.box,r);n<i?n<o&&(e(t.left),i<o)&&e(t.right):i<o&&(e(t.right),n<o)&&e(t.left)}(this.root),Math.sqrt(o)}}function fv(e,t){t[0]=e.x,t[1]=e.y,t[2]=e.z}function mv(e,t){var n=e.min,e=e.max;t[0]=n.x,t[1]=e.x,t[2]=n.y,t[3]=e.y,t[4]=n.z,t[5]=e.z}let Lu=3,Du=1<<(pg=1<<Lu),Ou=Du-1,Pu=32/pg,Uu=new Array(Pu);var gv=new ArrayBuffer((Pu+1)*Du*4);let Bu=0;for(let e=0;e<Pu+1;e++)Uu[e]=new Uint32Array(gv,Bu,Du),Bu+=4*Du;let Fu=e=>e,zu=(e,t)=>{var n=e.length,t=t||{},i=t.aux||new e.constructor(n);let l=t.get||Fu,u=[e,i],s,c,h,d=(h=t.reversed?(s=(e,t)=>e<t,c=t=>{for(let e=Du-2;0<=e;e--)t[e]+=t[e+1]},(t,n,i)=>{let r=0;for(let e=Ou;0<=e;e--){var a=t[e],o=a-r;0!=o&&((32<o?p:d)(n+1,i+r,o),r=a)}}):(s=(e,t)=>t<e,c=t=>{for(let e=1;e<Du;e++)t[e]+=t[e-1]},(t,n,i)=>{let r=0;for(let e=0;e<Du;e++){var a=t[e],o=a-r;0!=o&&((32<o?p:d)(n+1,i+r,o),r=a)}}),(e,n,i)=>{var r=u[1&e],t=u[e+1&1];for(let t=n+1;t<n+i;t++){var a=r[t],o=l(a)>>>0;let e=t;for(;e>n&&s(l(r[e-1])>>>0,o);)r[e]=r[--e];r[e]=a}if(1==(1&e))for(let e=n;e<n+i;e++)t[e]=r[e]}),p=(e,t,n)=>{var i=u[1&e],r=u[e+1&1],a=3-e<<Lu,o=t+n,n=Uu[e],s=Uu[e+1];s.fill(0);for(let e=t;e<o;e++)s[l(i[e])>>>a&Ou]++;c(s),n.set(s);for(let e=o-1;e>=t;e--)r[t+--s[l(i[e])>>>a&Ou]]=i[e];e!=Pu-1&&h(n,e,t)};p(0,0,n)};class US{constructor(e,t,n){this.isInstanceEntity=!0,this.position=new dd,this.scale=new dd(1,1,1),this.id=t,this.owner=e;let i=this.quaternion=new hd;if(n){let e=this.rotation=new md;e._onChange(()=>i.setFromEuler(e,!1)),i._onChange(()=>e.setFromQuaternion(i,void 0,!1))}}get visible(){return this.owner.getVisibilityAt(this.id)}set visible(e){this.owner.setVisibilityAt(this.id,e)}get color(){return this.owner.getColorAt(this.id)}set color(e){this.owner.setColorAt(this.id,e)}get opacity(){return this.owner.getOpacityAt(this.id)}set opacity(e){this.owner.setOpacityAt(this.id,e)}get morph(){return this.owner.getMorphAt(this.id)}set morph(e){this.owner.setMorphAt(this.id,e)}get matrix(){return this.owner.getMatrixAt(this.id)}get matrixWorld(){return this.matrix.premultiply(this.owner.matrixWorld)}updateMatrix(){var e=this.owner,t=this.position,n=this.quaternion,i=this.scale,r=e.matricesTexture._data,a=this.id,o=16*a,s=n._x,l=n._y,u=n._z,n=n._w,c=s+s,h=l+l,d=u+u,p=s*c,f=s*h,s=s*d,m=l*h,l=l*d,u=u*d,c=n*c,h=n*h,n=n*d,d=i.x,g=i.y,i=i.z;r[0+o]=(1-(m+u))*d,r[1+o]=(f+n)*d,r[2+o]=(s-h)*d,r[3+o]=0,r[4+o]=(f-n)*g,r[5+o]=(1-(p+u))*g,r[6+o]=(l+c)*g,r[7+o]=0,r[8+o]=(s+h)*i,r[9+o]=(l-c)*i,r[10+o]=(1-(p+m))*i,r[11+o]=0,r[12+o]=t.x,r[13+o]=t.y,r[14+o]=t.z,r[15+o]=1,e.matricesTexture.enqueueUpdate(a),null!=(d=e.bvh)&&d.move(a)}updateMatrixPosition(){var e=this.owner,t=this.position,n=e.matricesTexture._data,i=this.id,r=16*i;n[12+r]=t.x,n[13+r]=t.y,n[14+r]=t.z,e.matricesTexture.enqueueUpdate(i),null!=(n=e.bvh)&&n.move(i)}getUniform(e,t){return this.owner.getUniformAt(this.id,e,t)}setUniform(e,t){this.owner.setUniformAt(this.id,e,t)}copyTo(e){e.position.copy(this.position),e.scale.copy(this.scale),e.quaternion.copy(this.quaternion),this.rotation&&e.rotation.copy(this.rotation)}applyMatrix4(e){return this.matrix.premultiply(e).decompose(this.position,this.quaternion,this.scale),this}applyQuaternion(e){return this.quaternion.premultiply(e),this}rotateOnAxis(e,t){return ku.setFromAxisAngle(e,t),this.quaternion.multiply(ku),this}rotateOnWorldAxis(e,t){return ku.setFromAxisAngle(e,t),this.quaternion.premultiply(ku),this}rotateX(e){return this.rotateOnAxis(Hu,e)}rotateY(e){return this.rotateOnAxis(Vu,e)}rotateZ(e){return this.rotateOnAxis(Wu,e)}translateOnAxis(e,t){return Gu.copy(e).applyQuaternion(this.quaternion),this.position.add(Gu.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Hu,e)}translateY(e){return this.translateOnAxis(Vu,e)}translateZ(e){return this.translateOnAxis(Wu,e)}}let ku=new hd,Gu=new dd,Hu=new dd(1,0,0),Vu=new dd(0,1,0),Wu=new dd(0,0,1);class BS{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;let n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];var i=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],i=(this.nodesMap=new Map,this.LODsMap=new Map,this._geoBoundingSphere=null,this._sphereTarget=null,this.target=e,this.accurateCulling=i,this._margin=t,e._geometry);i.boundingBox||i.computeBoundingBox(),this.geoBoundingBox=i.boundingBox,n&&(i.boundingSphere||i.computeBoundingSphere(),0===(t=i.boundingSphere.center).x&&0===t.y&&0===t.z?(this._geoBoundingSphere=i.boundingSphere,this._sphereTarget={centerX:0,centerY:0,centerZ:0,maxScale:0}):(console.warn('"getBoxFromSphere" is ignored because geometry is not centered.'),n=!1)),this.bvh=new PS(new DS,0),this._origin=new Float32Array(3),this._dir=new Float32Array(3),this._cameraPos=new Float32Array(3),this._getBoxFromSphere=n}create(){var t=this.target._instancesCount,n=new Array(t),i=new Uint32Array(t);this.clear();for(let e=0;e<t;e++)n[e]=this.getBox(e,new Float32Array(6)),i[e]=e;this.bvh.createFromArray(i,n,e=>{this.nodesMap.set(e.object,e)},this._margin)}insert(e){var t=this.bvh.insert(e,this.getBox(e,new Float32Array(6)),this._margin);this.nodesMap.set(e,t)}insertRange(t){var n=t.length,i=new Array(n);for(let e=0;e<n;e++)i[e]=this.getBox(t[e],new Float32Array(6));this.bvh.insertRange(t,i,this._margin,e=>{this.nodesMap.set(e.object,e)})}move(e){var t=this.nodesMap.get(e);t&&(this.getBox(e,t.box),this.bvh.move(t,this._margin))}delete(e){var t=this.nodesMap.get(e);t&&(this.bvh.delete(t),this.nodesMap.delete(e))}clear(){this.bvh.clear(),this.nodesMap=new Map}frustumCulling(e,i){0<this._margin&&this.accurateCulling?this.bvh.frustumCulling(e.elements,(e,t,n)=>{t.isIntersectedMargin(e.box,n,this._margin)&&i(e)}):this.bvh.frustumCulling(e.elements,i)}frustumCullingLOD(e,t,n,r){this.LODsMap.has(n)||this.LODsMap.set(n,new Float32Array(n.length));var i=this.LODsMap.get(n);for(let e=0;e<n.length;e++)i[e]=n[e].distance;var a=this._cameraPos;a[0]=t.x,a[1]=t.y,a[2]=t.z,0<this._margin&&this.accurateCulling?this.bvh.frustumCullingLOD(e.elements,a,i,(e,t,n,i)=>{n.isIntersectedMargin(e.box,i,this._margin)&&r(e,t)}):this.bvh.frustumCullingLOD(e.elements,a,i,r)}raycast(e,t){var n=e.ray,i=this._origin,r=this._dir;fv(n.origin,i),fv(n.direction,r),this.bvh.rayIntersections(r,i,t,e.near,e.far)}intersectBox(e,t){this._boxArray||(this._boxArray=new Float32Array(6));var n=this._boxArray;return mv(e,n),this.bvh.intersectsBox(n,t)}getBox(e,t){var n,i,r,a;return this._getBoxFromSphere?(n=this.target.matricesTexture._data,{centerX:n,centerY:i,centerZ:r,maxScale:a}=this.getSphereFromMatrix_centeredGeometry(e,n,this._sphereTarget),a=this._geoBoundingSphere.radius*a,t[0]=n-a,t[1]=n+a,t[2]=i-a,t[3]=i+a,t[4]=r-a,t[5]=r+a):(ju.copy(this.geoBoundingBox).applyMatrix4(this.target.getMatrixAt(e)),mv(ju,t)),t}getSphereFromMatrix_centeredGeometry(e,t,n){var e=16*e,i=t[0+e],r=t[1+e],a=t[2+e],o=t[4+e],s=t[5+e],l=t[6+e],u=t[8+e],c=t[9+e],h=t[10+e];return n.maxScale=Math.sqrt(Math.max(i*i+r*r+a*a,o*o+s*s+l*l,u*u+c*c+h*h)),n.centerX=t[12+e],n.centerY=t[13+e],n.centerZ=t[14+e],n}}let ju=new pd;class FS extends class{constructor(e,t,n,i,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}{constructor(e,t,n,i,r){var a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:1,o=e.createBuffer();super(o,t,n,i,r.length/n),this.isGLInstancedBufferAttribute=!0,this._needsUpdate=!1,this.isInstancedBufferAttribute=!0,this.meshPerAttribute=a,this.array=r,this._cacheArray=r,e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,r,e.DYNAMIC_DRAW)}update(e,t){this._needsUpdate&&0!==t&&((e=e.getContext()).bindBuffer(e.ARRAY_BUFFER,this.buffer),this.array===this._cacheArray?e.bufferSubData(e.ARRAY_BUFFER,0,this.array,0,t):(e.bufferData(e.ARRAY_BUFFER,this.array,e.DYNAMIC_DRAW),this._cacheArray=this.array),this._needsUpdate=!1)}clone(){return this}}function vv(e,t){return Math.max(t,Math.ceil(Math.sqrt(e/t))*t)}class zS extends HA{constructor(e,t,n,i,r){var{array:e,format:i,size:a,type:o}=((e,t,n,i)=>{3===t&&(console.warn('"channels" cannot be 3. Set to 4. More info: https://github.com/mrdoob/three.js/pull/23228'),t=4);var i=vv(i,n),n=new e(i*i*t),r=e.name.includes("Float"),e=e.name.includes("Uint"),e=r?j:e?Je:Ke;let a;switch(t){case 1:a=r?ut:ct;break;case 2:a=r?ht:dt;break;case 4:a=r?q:pt}return{array:n,size:i,type:e,format:a}})(e,t,n,i);super(e,a,a,i,o),this.partialUpdate=!0,this.maxUpdateCalls=100,this._renderer=null,this._gl=null,this._utils=null,this._data=e,this._channels=t,this._pixelsPerInstance=n,this._stride=n*t,this._rowToUpdate=new Array(a),this._uniformMap=r,this.needsUpdate=!0}resize(e){var t,n,i,r,e=vv(e,this._pixelsPerInstance);e!==this.image.width&&(t=this._data,i=this._channels,this._rowToUpdate.length=e,i=new(n=t.constructor)(e*e*i),r=Math.min(t.length,i.length),i.set(new n(t.buffer,0,r)),this.dispose(),this.image={data:i,height:e,width:e},this._data=i)}enqueueUpdate(e){var t;this.partialUpdate?(t=this.image.width/this._pixelsPerInstance,e=Math.floor(e/t),this._rowToUpdate[e]=!0):this.needsUpdate=!0}update(e){var t;this.partialUpdate&&0!==(t=this.getUpdateRowsInfo()).length&&(t.length>this.maxUpdateCalls?this.needsUpdate=!0:(this.initRendererInfo(e),this.updateRows(t)),this._rowToUpdate.fill(!1))}getUpdateRowsInfo(){var n=this._rowToUpdate,i=[];for(let e=0,t=n.length;e<t;e++)if(n[e]){for(var r=e;e<t&&n[e];e++);i.push({row:r,count:e-r})}return i}initRendererInfo(e){this._renderer||(this._renderer=e),this._gl||(this._gl=e.getContext()),this._utils||(this._utils=new Of(this._gl,e.extensions))}updateRows(e){var t=this._renderer.state,n=this._gl,i=this._utils.convert(this.format),r=this._utils.convert(this.type),{data:a,height:o,width:s}=this.image,l=this._renderer.properties.get(this);if(l.__webglTexture){t.bindTexture(n.TEXTURE_2D,l.__webglTexture),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,this.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,this.unpackAlignment);var u,c,l=n.getParameter(n.UNPACK_ROW_LENGTH),h=n.getParameter(n.UNPACK_IMAGE_HEIGHT),d=n.getParameter(n.UNPACK_SKIP_PIXELS),p=n.getParameter(n.UNPACK_SKIP_ROWS),f=n.getParameter(n.UNPACK_SKIP_IMAGES);n.pixelStorei(n.UNPACK_ROW_LENGTH,s),n.pixelStorei(n.UNPACK_IMAGE_HEIGHT,o),n.pixelStorei(n.UNPACK_SKIP_PIXELS,0),n.pixelStorei(n.UNPACK_SKIP_IMAGES,0);for({count:u,row:c}of e)n.pixelStorei(n.UNPACK_SKIP_ROWS,c),n.texSubImage2D(n.TEXTURE_2D,0,0,c,s,u,i,r,a);n.pixelStorei(n.UNPACK_ROW_LENGTH,l),n.pixelStorei(n.UNPACK_IMAGE_HEIGHT,h),n.pixelStorei(n.UNPACK_SKIP_PIXELS,d),n.pixelStorei(n.UNPACK_SKIP_ROWS,p),n.pixelStorei(n.UNPACK_SKIP_IMAGES,f),t.unbindTexture()}}setUniformAt(e,t,n){var{offset:t,size:i}=this._uniformMap.get(t),r=this._stride;1===i?this._data[e*r+t]=n:n.toArray(this._data,e*r+t)}getUniformAt(e,t,n){var{offset:t,size:i}=this._uniformMap.get(t),r=this._stride;return 1===i?this._data[e*r+t]:n.fromArray(this._data,e*r+t)}getUniformsFragmentGLSL(t,e){var n,i,r,a,o=this._pixelsPerInstance,s=this._uniformMap;let l=`
      int size = textureSize(${t}, 0).x;
      int j = int(${e}) * ${o};
      int x = j % size;
      int y = j / size;
    `;for(let e=0;e<this._pixelsPerInstance;e++)l+=`vec4 _texel${e} = texelFetch(${t}, ivec2(x + ${e}, y), 0);
`;let u="";for([n,{type:i,offset:r,size:a}]of s){var c,h=Math.floor(r/this._channels);"mat3"===i?u+=`mat3 ${n} = mat3(texel${h}.rgb, vec3(texel${h}.a, texel${h+1}.rg), vec3(texel${h+1}.ba, texel${h+2}.r));
`:"mat4"===i?u+=`mat4 ${n} = mat4(texel${h}, texel${h+1}, texel${h+2}, texel${h+3});
`:(c=this.getUniformComponents(r,a),u+=`${i} ${n} = _texel${h}.${c};
`)}return`
      uniform highp sampler2D ${t};  

      void main() {
        ${l}
        `+u}getUniformComponents(e,t){var n=e%this._channels;let i="";for(let e=0;e<t;e++)i+=Yu[n+e];return i}}let Yu=["r","g","b","a"];class Cd extends xd{constructor(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0;if(!e)throw new Error('"geometry" is mandatory.');if(!t)throw new Error('"material" is mandatory.');var{allowsEuler:r,renderer:a,createInstances:o}=n,n=(super(e,null),this.type="InstancedMesh2",this.isInstancedMesh2=!0,this.instances=null,this.colorsTexture=null,this.morphTexture=null,this.uniformsTexture=null,this.boundingBox=null,this.boundingSphere=null,this.bvh=null,this.customSort=null,this.raycastOnlyFrustum=!1,this.LODinfo=null,this._renderer=null,this._instancesCount=0,this._count=0,this._perObjectFrustumCulled=!0,this._sortObjects=!1,this._indexArrayNeedsUpdate=!1,this._useOpacity=!1,this.customDepthMaterial=new IA({depthPacking:qt}),this.customDistanceMaterial=new CA,this.isInstancedMesh=!0,this.instanceMatrix=new WA(new Float32Array(0),16),this.instanceColor=null,0<n.capacity?n.capacity:qu);this._renderer=a,this._capacity=n,this._parentLOD=i,this._geometry=e,this.material=t,this._allowsEuler=r??!1,this._tempInstance=new US(this,-1,r),this.visibilityArray=(null==i?void 0:i.visibilityArray)??new Array(n).fill(!0),this.initIndexAttribute(),this.initMatricesTexture(),this.patchMaterial(this.customDepthMaterial),this.patchMaterial(this.customDistanceMaterial),o&&this.createInstances()}get capacity(){return this._capacity}get count(){return this._count}get instancesCount(){return this._instancesCount}set instancesCount(e){this.setInstancesCount(e)}get perObjectFrustumCulled(){return this._perObjectFrustumCulled}set perObjectFrustumCulled(e){this._perObjectFrustumCulled=e,this._indexArrayNeedsUpdate=!0}get sortObjects(){return this._sortObjects}set sortObjects(e){this._sortObjects=e,this._indexArrayNeedsUpdate=!0}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.patchGeometry(e)}get material(){return this._material}set material(e){this._material=e,this.patchMaterials(e)}onBeforeShadow(e,t,n,i,r,a,o){!this.instanceIndex||o&&!this.isFirstGroup(o.materialIndex)||(this.matricesTexture.update(e),null!=(o=this.colorsTexture)&&o.update(e),null!=(o=this.uniformsTexture)&&o.update(e),this.performFrustumCulling(i,n))}onBeforeRender(e,t,n,i,r,a){this.instanceIndex?a&&!this.isFirstGroup(a.materialIndex)||(this.matricesTexture.update(e),null!=(a=this.colorsTexture)&&a.update(e),null!=(a=this.uniformsTexture)&&a.update(e),this.performFrustumCulling(n)):this._renderer=e}onAfterRender(e,t,n,i,r,a){this.instanceIndex||a&&!this.isLastGroup(a.materialIndex)||this.initIndexAttribute()}isFirstGroup(t){var n=this.material;for(let e=0;e<=t;e++)if(n[e].visible)return e===t}isLastGroup(t){var n=this.material;for(let e=n.length-1;e>=t;e--)if(n[e].visible)return e===t}initIndexAttribute(){if(this._renderer){var e=this._renderer.getContext(),t=this._capacity,n=new Uint32Array(t);for(let e=0;e<t;e++)n[e]=e;this.instanceIndex=new FS(e,e.UNSIGNED_INT,1,4,n),this._geometry.setAttribute("instanceIndex",this.instanceIndex)}else this._count=0}initMatricesTexture(){this._parentLOD?this.matricesTexture=this._parentLOD.matricesTexture:this.matricesTexture=new zS(Float32Array,4,4,this._capacity)}initColorsTexture(){this.colorsTexture=new zS(Float32Array,4,1,this._capacity),this.colorsTexture.colorSpace=qe.workingColorSpace,this.colorsTexture._data.fill(1)}patchGeometry(e){e.hasAttribute("instanceIndex")&&(console.warn("The geometry has been cloned because it was already used."),(e=e.clone()).deleteAttribute("instanceIndex")),this.instanceIndex&&e.setAttribute("instanceIndex",this.instanceIndex)}patchMaterials(e){if(e)if(e.isMaterial)this.patchMaterial(e);else for(var t of e)this.patchMaterial(t)}patchMaterial(e){e.isInstancedMesh2Patched&&!this.isMaterialUsedByLOD(e)&&(console.warn("The material has been cloned because it was already used."),(e=e.clone()).isInstancedMesh2Patched=!1);let n=e.onBeforeCompile.bind(e);e.onBeforeCompile=(e,t)=>{n&&n(e,t),e.instancing&&(e.instancing=!1,e.instancingColor=!1,e.uniforms.matricesTexture={value:this.matricesTexture},e.defines||(e.defines={}),e.defines.USE_INSTANCING_INDIRECT="",this.uniformsTexture&&(e.vertexShader.includes("varying uint vInstanceIndex")||(e.vertexShader=e.vertexShader.replace("void main() {",`flat varying uint vInstanceIndex;
 void main() {
 vInstanceIndex = instanceIndex;`),e.fragmentShader=e.fragmentShader.replace("void main() {",`flat varying uint vInstanceIndex;
 void main() {`)),e.uniforms.uniformsTexture={value:this.uniformsTexture},t=this.uniformsTexture.getUniformsFragmentGLSL("uniformsTexture","vInstanceIndex"),e.fragmentShader=e.fragmentShader.replace("void main() {",t)),this.colorsTexture)&&e.fragmentShader.includes("#include <color_pars_fragment>")&&(e.uniforms.colorsTexture={value:this.colorsTexture},e.vertexShader=e.vertexShader.replace("<color_vertex>","<instanced_color_vertex>"),e.defines.USE_INSTANCING_COLOR_INDIRECT="",e.vertexColors&&(e.defines.USE_VERTEX_COLOR=""),this._useOpacity?e.defines.USE_COLOR_ALPHA="":e.defines.USE_COLOR="")},e.isInstancedMesh2Patched=!0}isMaterialUsedByLOD(e){if(this._parentLOD)for(var t of this._parentLOD.LODinfo.objects)if(t.material===e)return!0}computeBVH(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.bvh||(this.bvh=new BS(this,e.margin,e.getBBoxFromBSphere,e.accurateCulling)),this.bvh.clear(),this.bvh.create()}disposeBVH(){this.bvh=null}setMatrixAt(e,t){var n;t.toArray(this.matricesTexture._data,16*e),this.instances&&(n=this.instances[e],t.decompose(n.position,n.quaternion,n.scale)),this.matricesTexture.enqueueUpdate(e),null!=(t=this.bvh)&&t.move(e)}getMatrixAt(e){return(1<arguments.length&&void 0!==arguments[1]?arguments[1]:Ku).fromArray(this.matricesTexture._data,16*e)}getPositionAt(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:$u,e=16*e,n=this.matricesTexture._data;return t.x=n[12+e],t.y=n[13+e],t.z=n[14+e],t}getMaxScaleOnAxisAt(e){var e=16*e,t=this.matricesTexture._data,n=t[0+e],i=t[1+e],r=t[2+e],a=t[4+e],o=t[5+e],s=t[6+e],l=t[8+e],u=t[9+e],t=t[10+e];return Math.sqrt(Math.max(n*n+i*i+r*r,a*a+o*o+s*s,l*l+u*u+t*t))}setVisibilityAt(e,t){this.visibilityArray[e]=t,this._indexArrayNeedsUpdate=!0}getVisibilityAt(e){return this.visibilityArray[e]}setColorAt(e,t){null===this.colorsTexture&&this.initColorsTexture(),(t.isColor?t:Ju.set(t)).toArray(this.colorsTexture._data,4*e),this.colorsTexture.enqueueUpdate(e)}getColorAt(e){return(1<arguments.length&&void 0!==arguments[1]?arguments[1]:Ju).fromArray(this.colorsTexture._data,4*e)}setOpacityAt(e,t){null===this.colorsTexture&&this.initColorsTexture(),this._useOpacity=!0,this.colorsTexture._data[4*e+3]=t,this.colorsTexture.enqueueUpdate(e)}getOpacityAt(e){return this.colorsTexture._data[4*e+3]}getMorphAt(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Qu,n=t.morphTargetInfluences,i=this.morphTexture.source.data.data,r=e*(n.length+1)+1;for(let e=0;e<n.length;e++)n[e]=i[r+e];return t}setMorphAt(e,t){var n,t=t.morphTargetInfluences,i=t.length+1,r=(null===this.morphTexture&&(this.morphTexture=new HA(new Float32Array(i*this._capacity),i,this._capacity,ut,j)),this.morphTexture.source.data.data);let a=0;for(n of t)a+=n;var o=this._geometry.morphTargetsRelative?1:1-a,i=i*e;r[i]=o,r.set(t,1+i),this.morphTexture.needsUpdate=!0}copyTo(e,t){this.getMatrixAt(e,t.matrix).decompose(t.position,t.quaternion,t.scale)}computeBoundingBox(){var e=this._geometry,t=this._instancesCount,n=(null===this.boundingBox&&(this.boundingBox=new pd),null===e.boundingBox&&e.computeBoundingBox(),e.boundingBox),i=this.boundingBox;i.makeEmpty();for(let e=0;e<t;e++)Xu.copy(n).applyMatrix4(this.getMatrixAt(e)),i.union(Xu)}computeBoundingSphere(){var e=this._geometry,t=this._instancesCount,n=(null===this.boundingSphere&&(this.boundingSphere=new aA),null===e.boundingSphere&&e.computeBoundingSphere(),e.boundingSphere),i=this.boundingSphere;i.makeEmpty();for(let e=0;e<t;e++)Zu.copy(n).applyMatrix4(this.getMatrixAt(e)),i.union(Zu)}copy(e,t){return super.copy(e,t),this.matricesTexture=e.matricesTexture.clone(),null!==e.colorsTexture&&(this.colorsTexture=e.colorsTexture.clone()),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),this._instancesCount=e._instancesCount,this._count=e._capacity,this._capacity=e._capacity,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}dispose(){var e;this.dispatchEvent({type:"dispose"}),this.matricesTexture.dispose(),null!=(e=this.colorsTexture)&&e.dispose(),null!=(e=this.morphTexture)&&e.dispose(),null!=(e=this.uniformsTexture)&&e.dispose()}}let qu=1e3,Xu=new pd,Zu=new aA,Ku=new fd,Ju=new vd,Qu=new xd,$u=new dd;function _v(e,t){return e.depth-t.depth}function yv(e,t){return t.depth-e.depth}function Ev(e,t){return e.distance-t.distance}Cd.prototype.resizeBuffers=function(e){var t,n=this._capacity,i=(this._capacity=e,Math.min(e,n));if(this.instanceIndex&&((t=new Uint32Array(e)).set(new Uint32Array(this.instanceIndex.array.buffer,0,i)),this.instanceIndex.array=t),this.LODinfo)for(var r of this.LODinfo.objects){var a=new Uint32Array(e);r.instanceIndex.array=a}return n<(this.visibilityArray.length=e)&&this.visibilityArray.fill(!0,n),this.matricesTexture.resize(e),this.colorsTexture&&(this.colorsTexture.resize(e),n<e)&&this.colorsTexture._data.fill(1,4*n),this.morphTexture&&(t=(i=this.morphTexture.image.data).length/n,this.morphTexture.dispose(),this.morphTexture=new HA(new Float32Array(t*e),t,e,ut,j),this.morphTexture.image.data.set(i)),null!=(n=this.uniformsTexture)&&n.resize(e),this},Cd.prototype.setInstancesCount=function(t){if(t>this._capacity){let e=this._capacity+(this._capacity>>1)+512;for(;e<t;)e+=512+(e>>1);this.resizeBuffers(e)}this._instancesCount=t,this.instances&&this.createInstances()};let ec=new yA,tc=new class{constructor(){this.array=[],this.pool=[]}push(e,t){var n=this.pool,i=this.array,r=i.length,n=(r>=n.length&&n.push({depth:null,index:null,depthSort:null}),n[r]);n.depth=e,n.index=t,i.push(n)}reset(){this.array.length=0}},nc=new fd,ic=new fd,rc=new dd,ac=new dd,oc=new dd,sc=new dd,f=new aA,lc=(Cd.prototype.performFrustumCulling=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:e,n=this.LODinfo;let i;if(n){i=e!==t?n.shadowRender??n.render:n.render;for(var r of n.objects)r===this?r._count=0:r.visible=!1}0<(null==i?void 0:i.levels.length)?this.frustumCullingLOD(i,n.objects,e,t):this._parentLOD||this.frustumCulling(e),this.instanceIndex.update(this._renderer,this._count)},Cd.prototype.frustumCulling=function(e){var t=this._sortObjects,n=this._perObjectFrustumCulled,i=this.instanceIndex.array;if(this.instanceIndex._needsUpdate=!0,n||t){if(t&&(ic.copy(this.matrixWorld).invert(),ac.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ic),rc.set(0,0,-1).transformDirection(e.matrixWorld).transformDirection(ic)),n?(nc.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse).multiply(this.matrixWorld),this.bvh?this.BVHCulling():this.linearCulling()):this.updateRenderList(),t){var n=this.customSort,r=(null===n?tc.array.sort(null!=(e=this._material)&&e.transparent?yv:_v):n(tc.array),tc.array),a=r.length;for(let e=0;e<a;e++)i[e]=r[e].index;this._count=a,tc.reset()}}else this.updateIndexArray()},Cd.prototype.updateIndexArray=function(){if(this._indexArrayNeedsUpdate){var n=this.instanceIndex.array,i=this._instancesCount;let t=0;for(let e=0;e<i;e++)this.getVisibilityAt(e)&&(n[t++]=e);this._count=t,this._indexArrayNeedsUpdate=!1}},Cd.prototype.updateRenderList=function(){var t,n=this._instancesCount;for(let e=0;e<n;e++)this.getVisibilityAt(e)&&(t=this.getMatrixAt(e),t=sc.setFromMatrixPosition(t).sub(ac).dot(rc),tc.push(t,e))},Cd.prototype.BVHCulling=function(){let n=this.instanceIndex.array,i=this._instancesCount,r=this._sortObjects,a=0;this.bvh.frustumCulling(nc,e=>{var t,e=e.object;e<i&&this.getVisibilityAt(e)&&(r?(this.getPositionAt(e,sc),t=sc.sub(ac).dot(rc),tc.push(t,e)):n[a++]=e)}),this._count=a},Cd.prototype.linearCulling=function(){var t,n=this.instanceIndex.array,e=this._geometry.boundingSphere,i=e.radius,r=e.center,a=this._instancesCount,o=0===r.x&&0===r.y&&0===r.z,s=this._sortObjects;let l=0;ec.setFromProjectionMatrix(nc);for(let e=0;e<a;e++)this.getVisibilityAt(e)&&(o?(this.getPositionAt(e,f.center),f.radius=i*this.getMaxScaleOnAxisAt(e)):(t=this.getMatrixAt(e),f.center.copy(r).applyMatrix4(t),f.radius=i*t.getMaxScaleOnAxis()),ec.intersectsSphere(f))&&(s?(t=sc.subVectors(f.center,ac).dot(rc),tc.push(t,e)):n[l++]=e);this._count=l},Cd.prototype.frustumCullingLOD=function(e,t,r,a){var o,{count:s,levels:l}=e,n=!(r!==a)&&this._sortObjects;for(let e=0;e<l.length;e++)s[e]=0,l[e].object.instanceIndex&&(l[e].object.instanceIndex._needsUpdate=!0);nc.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),ic.copy(this.matrixWorld).invert(),ac.setFromMatrixPosition(r.matrixWorld).applyMatrix4(ic),oc.setFromMatrixPosition(a.matrixWorld).applyMatrix4(ic);var u=e.levels.map(e=>e.object.instanceIndex.array);if(this.bvh?this.BVHCullingLOD(e,u,n):this.linearCullingLOD(e,u,n),n){var r=this.customSort,c=tc.array;let n=0,i=l[1].distance;null===r?c.sort(null!=(a=l[0].object._material)&&a.transparent?yv:_v):r(c);for(let e=0,t=c.length;e<t;e++){var h=c[e];h.depth>i&&(n++,i=(null==(o=l[n+1])?void 0:o.distance)??1/0),u[n][s[n]++]=h.index}tc.reset()}for(let e=0;e<l.length;e++){var i=l[e].object;i.visible=i===this||0<s[e],i._count=s[e]}},Cd.prototype.BVHCullingLOD=function(e,i,t){let{count:r,levels:a}=e,o=this._instancesCount,s=this.visibilityArray;t?this.bvh.frustumCulling(nc,e=>{var t,e=e.object;e<o&&s[e]&&(t=this.getPositionAt(e).distanceToSquared(oc),tc.push(t,e))}):this.bvh.frustumCullingLOD(nc,oc,a,(e,t)=>{var n,e=e.object;e<o&&s[e]&&(null===t&&(n=this.getPositionAt(e).distanceToSquared(oc),t=this.getObjectLODIndexForDistance(a,n)),i[t][r[t]++]=e)})},Cd.prototype.linearCullingLOD=function(e,t,n){var i,r,{count:a,levels:o}=e,e=this._geometry.boundingSphere,s=e.radius,l=e.center,u=this._instancesCount,c=0===l.x&&0===l.y&&0===l.z;ec.setFromProjectionMatrix(nc);for(let e=0;e<u;e++)this.visibilityArray[e]&&(c?(this.getPositionAt(e,f.center),f.radius=s*this.getMaxScaleOnAxisAt(e)):(i=this.getMatrixAt(e),f.center.copy(l).applyMatrix4(i),f.radius=s*i.getMaxScaleOnAxis()),ec.intersectsSphere(f))&&(i=f.center.distanceToSquared(oc),n?tc.push(i,e):t[r=this.getObjectLODIndexForDistance(o,i)][a[r]++]=e)},Cd.prototype.clearInstance=function(e,t){return e.id=t,e.position.set(0,0,0),e.scale.set(1,1,1),e.quaternion.set(0,0,0,1),null!=(t=e.rotation)&&t.set(0,0,0),e},Cd.prototype.updateInstances=function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=n+(2<arguments.length&&void 0!==arguments[2]?arguments[2]:this._instancesCount),r=this.instances,a=this._tempInstance;for(let e=n;e<i;e++){var o=r?r[e]:this.clearInstance(a,e);t(o,e),o.updateMatrix()}return this},Cd.prototype.updateInstancesPosition=function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=n+(2<arguments.length&&void 0!==arguments[2]?arguments[2]:this._instancesCount),r=this.instances,a=this._tempInstance;for(let e=n;e<i;e++){var o=r?r[e]:this.clearInstance(a,e);t(o,e),o.updateMatrixPosition()}return this},Cd.prototype.createInstances=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._instancesCount,n=t+e,i=(this.instances?this.instances.length=n:this.instances=new Array(e),this.instances);for(let e=t;e<n;e++){var r=new US(this,e,this._allowsEuler);i[e]=r}return this},Cd.prototype.addInstances=function(e,t){var n=this._instancesCount,i=n+e,r=this.bvh;if(this.setInstancesCount(this._instancesCount+e),t)for(let e=n;e<i;e++){var a=this.instances?this.instances[e]:this.clearInstance(this._tempInstance,e);t(a,e),a.updateMatrix(),null!=r&&r.insert(e)}return this},Cd.prototype.getObjectLODIndexForDistance=function(t,n){for(let e=t.length-1;0<e;e--){var i=t[e];if(i.distance-i.distance*i.hysteresis<=n)return e}return 0},Cd.prototype.setFirstLODDistance=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(!this._parentLOD)return this.LODinfo||(this.LODinfo={render:null,shadowRender:null,objects:[this]}),this.LODinfo.render||(this.LODinfo.render={levels:[{distance:e,hysteresis:t,object:this}],count:[0]}),this;console.error("Cannot create LOD for this InstancedMesh2.")},Cd.prototype.addLOD=function(e,t){var n,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;if(this._parentLOD)console.error("Cannot create LOD for this InstancedMesh2.");else{if(null!=(n=this.LODinfo)&&n.render||0!==i)return this.setFirstLODDistance(0,r),this.addLevel(this.LODinfo.render,e,t,i,r),this;console.error('Cannot set distance to 0 for the first LOD. Use "setFirstLODDistance" before use "addLOD".')}},Cd.prototype.addShadowLOD=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(!this._parentLOD)return this.LODinfo||(this.LODinfo={render:null,shadowRender:null,objects:[this]}),this.LODinfo.shadowRender||(this.LODinfo.shadowRender={levels:[],count:[]}),this.addLevel(this.LODinfo.shadowRender,e,null,t,n).castShadow=!0,this.castShadow=!0,this;console.error("Cannot create LOD for this InstancedMesh2.")},Cd.prototype.addLevel=function(e,t,n,i,r){var a=this.LODinfo.objects,o=e.levels;let s,l;i=i**2;var u,c=a.findIndex(e=>e.geometry===t);for(-1===c?(u={capacity:this._capacity,renderer:this._renderer},(l=new Cd(t,n??new Td,u,this)).frustumCulled=!1,a.push(l),this.add(l)):(l=a[c],n&&(l.material=n)),s=0;s<o.length&&!(i<o[s].distance);s++);return o.splice(s,0,{distance:i,hysteresis:r,object:l}),e.count.push(0),l},[]),uc=new xd,cc=new oA,hc=new dd,dc=new dd,pc=new fd,fc=new aA;function Av(e){return e.replace("#ifdef USE_INSTANCING","#if defined USE_INSTANCING || defined USE_INSTANCING_INDIRECT")}Cd.prototype.raycast=function(t,n){if(void 0!==this._material){var e=this.raycastOnlyFrustum&&this._perObjectFrustumCulled&&!this.bvh,i=(uc.geometry=this._geometry,uc.material=this._material,t.ray),r=t.near,a=t.far,o=(pc.copy(this.matrixWorld).invert(),dc.setFromMatrixScale(this.matrixWorld),hc.copy(t.ray.direction).multiply(dc),hc.length());if(t.ray=cc.copy(t.ray).applyMatrix4(pc),t.near/=o,t.far/=o,this.bvh)this.bvh.raycast(t,e=>this.checkObjectIntersection(t,e,n));else{if(null===this.boundingSphere&&this.computeBoundingSphere(),fc.copy(this.boundingSphere),!t.ray.intersectsSphere(fc))return;var s=this.instanceIndex.array,l=e?this._count:this._instancesCount;for(let e=0;e<l;e++)this.checkObjectIntersection(t,s[e],n)}n.sort(Ev),t.ray=i,t.near=r,t.far=a}},Cd.prototype.checkObjectIntersection=function(e,t,n){if(!(t>this._instancesCount)&&this.getVisibilityAt(t)){this.getMatrixAt(t,uc.matrixWorld),uc.raycast(e,lc);for(var i of lc)i.instanceId=t,i.object=this,n.push(i);lc.length=0}},Cd.prototype.getUniformAt=function(e,t,n){if(this.uniformsTexture)return this.uniformsTexture.getUniformAt(e,t,n);throw new Error(`Before get/set uniform, it's necessary to use "initUniformPerInstance".`)},Cd.prototype.setUniformAt=function(e,t,n){if(!this.uniformsTexture)throw new Error(`Before get/set uniform, it's necessary to use "initUniformPerInstance".`);this.uniformsTexture.setUniformAt(e,t,n),this.uniformsTexture.enqueueUpdate(e)},Cd.prototype.initUniformsPerInstance=function(e){var{channels:e,pixelsPerInstance:t,uniformMap:n}=this.getUniforSchemaResult(e);this.uniformsTexture=new zS(Float32Array,e,t,this._capacity,n)},Cd.prototype.getUniforSchemaResult=function(e){let t=0;var n,i=new Map,r=[];for(n in e){var a=e[n],o=this.getUniformSize(a);t+=o,r.push({name:n,type:a,size:o})}r.sort((e,t)=>t.size-e.size);var s,l,u,c=[];for({name:s,size:l,type:u}of r){var h=this.getUniformOffset(l,c);i.set(s,{offset:h,size:l,type:u})}var d=Math.ceil(t/4);return{channels:Math.min(t,4),pixelsPerInstance:d,uniformMap:i}},Cd.prototype.getUniformOffset=function(t,n){if(t<4)for(let e=0;e<n.length;e++){var i;if(n[e]+t<=4)return i=4*e+n[e],n[e]+=t,i}for(var e=4*n.length;0<t;t-=4)n.push(t);return e},Cd.prototype.getUniformSize=function(e){switch(e){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;case"mat3":return 9;case"mat4":return 16;default:throw new Error("Invalid uniform type: "+e)}},S.instanced_pars_vertex=`
#ifdef USE_INSTANCING_INDIRECT
  attribute uint instanceIndex;
  uniform highp sampler2D matricesTexture;  

  mat4 getInstancedMatrix() {
    int size = textureSize( matricesTexture, 0 ).x;
    int j = int( instanceIndex ) * 4;
    int x = j % size;
    int y = j / size;
    vec4 v1 = texelFetch( matricesTexture, ivec2( x, y ), 0 );
    vec4 v2 = texelFetch( matricesTexture, ivec2( x + 1, y ), 0 );
    vec4 v3 = texelFetch( matricesTexture, ivec2( x + 2, y ), 0 );
    vec4 v4 = texelFetch( matricesTexture, ivec2( x + 3, y ), 0 );
    return mat4( v1, v2, v3, v4 );
  }
#endif
`,S.instanced_color_pars_vertex=`
#ifdef USE_INSTANCING_COLOR_INDIRECT
  uniform highp sampler2D colorsTexture;

  #ifdef USE_COLOR_ALPHA
    vec4 getColorTexture() {
      int size = textureSize( colorsTexture, 0 ).x;
      int j = int( instanceIndex );
      int x = j % size;
      int y = j / size;
      return texelFetch( colorsTexture, ivec2( x, y ), 0 );
    }
  #else
    vec3 getColorTexture() {
      int size = textureSize( colorsTexture, 0 ).x;
      int j = int( instanceIndex );
      int x = j % size;
      int y = j / size;
      return texelFetch( colorsTexture, ivec2( x, y ), 0 ).rgb;
    }
  #endif
#endif
`,S.instanced_vertex=`
#ifdef USE_INSTANCING_INDIRECT
  mat4 instanceMatrix = getInstancedMatrix();

  #ifdef USE_INSTANCING_COLOR_INDIRECT
    vColor *= getColorTexture();
  #endif
#endif
`,S.instanced_color_vertex=`
#ifdef USE_INSTANCING_COLOR_INDIRECT
  #ifdef USE_VERTEX_COLOR
    vColor = color;
  #else
    #ifdef USE_COLOR_ALPHA
      vColor = vec4( 1.0 );
    #else
      vColor = vec3( 1.0 );
    #endif
  #endif
#endif
`,S.project_vertex=Av(S.project_vertex),S.worldpos_vertex=Av(S.worldpos_vertex),S.defaultnormal_vertex=Av(S.defaultnormal_vertex),S.batching_pars_vertex=S.batching_pars_vertex.concat(`
#include <instanced_pars_vertex>`),S.color_pars_vertex=S.color_pars_vertex.concat(`
#include <instanced_color_pars_vertex>`),S.batching_vertex=S.batching_vertex.concat(`
#include <instanced_vertex>`),S.morphinstance_vertex=S.morphinstance_vertex.replaceAll("gl_InstanceID","instanceIndex"),window.pellets=[];var xv=new yT;function Tv(e){var t=new vd(0,5,0),n=(e.userData.pedestalInfinity||(t=new vd(5,0,0)),new gd),i=(n.position.copy(e.position),n.quaternion.copy(e.quaternion),n.translateY(1),new Rx(.1,8,4)),r=new Ox({emissive:t,envMap:nd.envMap}),i=new xd(i,r),r=(i.position.copy(n.position),i.rotation.copy(n.rotation),i.origin=n,i.time=e.userData.pedestalValue,i.infinity=e.userData.pedestalInfinity,i.active=!0,nd.SCENE_FPS.add(i),new aT(t,.5,3),i.clone()),n=(r.visible=!1,new ed.Sphere(.1)),t=new ed.Body({shape:n,mass:1,material:new ed.Material}),n=(nd.CANNON_BODIES.push(t),t.position.copy(i.position),t.quaternion.copy(i.quaternion),t.collisionFilterGroup=nd.CGROUP_DYNAMIC,t.collisionFilterMask=nd.CGROUP_ALL,nd.CANNON_BODIES.push(t),nd.CANNON_WORLD.addBody(t),i.body=t,i.item=e,new dd(0,1,0).applyQuaternion(t.quaternion));t.direction=n,t.originaldirection=n,t.clone=r,t.name="pellet",t.pellet=i,t.previousDirection=n,t.addEventListener("collide",function(e){var t,n,i;e.target.started&&0!=e.body.collisionResponse&&e.target.pellet.active&&"fizzler"!=e.body.name&&(Ag(e.target.sound.audio),"wall"==e.body.name&&(t=tv(e.target.position),n=e.body.wallRotation,i=e.target.direction,m.parent||nd.SCENE_FPS.add(m),xv.set(t,i),0<xv.intersectObject(m).length||((i=new gd).scale.set(1,1,1),i.position.copy(t),i.rotation.set(n.x,n.y,n.z),i.translateY(-.01),i.updateMatrix(),m.setMatrixAt(m.current,i.matrix),m.setVisibilityAt(m.current,!0),m.instanceMatrix.needsUpdate=!0,m.computeBoundingSphere(),m.current<=1e3?m.current+=1:m.current=0)),"player"==e.body.name?(clearTimeout(e.target.pellet.timeout),Sv(e.target.pellet,!0),$0(nd.PLAYER),e.target.direction=e.target.originaldirection):"pellet_catcher"!=e.body.name||e.body.active?(t=e.contact.ni,n=new dd(t.x,t.y,t.z).negate(),i=e.target.direction,n.equals(e.target.previousDirection.round())?e.target.direction=n.negate():e.target.direction=n,"panel"==e.body.name&&(Math.abs(i.x)>Math.abs(i.z)?e.target.direction.x=0:Math.abs(i.x)<Math.abs(i.z)&&(e.target.direction.z=0)),e.target.previousDirection=e.target.direction):(e.body.active=!0,e.body.item.cone.visible=!1,Dv(e.body.item,!0,!0),clearTimeout(e.target.pellet.timeout),e.target.pellet.infinity?Sv(e.target.pellet,!0):(e.target.pellet.active=!1,e.target.pellet.position.set(1e5,1e4,1e4),setTimeout(()=>{e.target.removeEventListener("collide"),nd.CANNON_WORLD.removeBody(e.target)},10)),e.target.direction=e.target.originaldirection,Eg(e.body.item.userData)))}),nd.DYNAMIC_OBJECTS.push(t),window.pellets.push(i),xg("pelletHit",t,!1,!1,!1,10,"sound")}function Sv(e,t){nd.FPS_MODE&&(t&&(Ag(e.body.sound.audio),e.visible=!1,e.active=!1,e.position.copy(e.origin.position),e.rotation.copy(e.origin.rotation),e.body.direction=e.body.originaldirection,setTimeout(()=>{e.visible=!0,e.active=!0},1e3)),e.infinity||(e.timeout=setTimeout(()=>{Sv(e,!0)},1e3*e.time)))}td()("body").on("input","#state-pellet-infinity",function(){this.checked?td()("#pellet-timer").addClass("disabled"):td()("#pellet-timer").removeClass("disabled"),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.pedestalInfinity=this.checked}),td()("body").on("input","#pellet-timer-value",function(){nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.pedestalValue=parseInt(this.value)});var $h=new dA(.6,.01,.6),wv=(new wd).load("./assets/textures/burn01a.webp");let m=new Cd($h,new _d({side:0,map:wv,transparent:!0,opacity:1,color:new vd(0,0,0),polygonOffset:!0,polygonOffsetFactor:-10}),{createInstances:!0});m.current=0,m.addInstances(1e3,(e,t)=>{e.visible=!1,e.position.set(1e5,1e5,1e5)}),m.raycastOnlyFrustum=!0,m.computeBVH(),m.instanceMatrix.needsUpdate=!0;var bv=null,Mv=new dd,Rv=new yT;function Nv(){Rv.setFromCamera(Mv,nd.MAIN_CAMERA);var e=Rv.intersectObjects(window.glass),t=Rv.intersectObjects(nd.INTERACTIVE);if(nd.HOLDING_ITEM)rd.HOLD.pause(),$g(250,nd.GUN.children[0].children[0].position,new dd(.007,-.01,-.0095)),nd.HOLDING_ITEM=!1,bv&&(bv.gelJumping=!1,bv.sleeping=!1),nd.CURRENT_ITEM.body.sideContact=null,nd.CURRENT_ITEM.body.contactID=null,nd.CURRENT_ITEM.body.holding=!1,nd.CURRENT_ITEM.body.angularDamping=0,nd.CURRENT_ITEM.body.allowSleep=!0,nd.CURRENT_ITEM=null,nd.CURRENT_ITEM_ID=null,bv=null,y0();else if(0<t.length){if(0<e.length&&e[0].distance<t[0].distance)return rd.PICK_FAIL.pause(),rd.PICK_FAIL.currentTime=0,void Ag(rd.PICK_FAIL);if("pedestal_button"==t[0].object.name){if(t[0].distance<1)for(var e=nd.DYMANIC_ITEMS[t[0].object.name][t[0].instanceId],n=nd.PLANE_USER_DATA[e.userData.planeInstancedId],i=0;i<nd.CONNECTIONS.length;i++)if(nd.CONNECTIONS[i].from.instancedName.includes("pedestal")&&n==nd.CONNECTIONS[i].from&&!nd.CONNECTIONS[i].line.active&&(nd.CONNECTIONS[i].to.item.userData.buttons+=1,Ov(nd.CONNECTIONS[i],"no",!0,new vd(2,1.3,0)),rd.POSITIVE.play(),nd.CONNECTIONS[i].to.itemName.includes("door")||nd.CONNECTIONS[i].to.itemName.includes("exitDoor")?nd.CONNECTIONS[i].to.item.userData.connections==nd.CONNECTIONS[i].to.item.userData.buttons&&Y0(0,!0,!1,nd.CONNECTIONS[i].to.item):nd.CONNECTIONS[i].to.itemName.includes("cube")||nd.CONNECTIONS[i].to.itemName.includes("sphere")?nd.CONNECTIONS[i].to.item.userData.connections==nd.CONNECTIONS[i].to.item.userData.buttons&&Q0(nd.CONNECTIONS[i].to.item):nd.CONNECTIONS[i].to.itemName.includes("tractor")?nd.CONNECTIONS[i].to.item.userData.connections==nd.CONNECTIONS[i].to.item.userData.buttons&&J0(nd.CONNECTIONS[i].to):nd.CONNECTIONS[i].to.itemName.includes("light_bridge")?nd.CONNECTIONS[i].to.item.userData.connections==nd.CONNECTIONS[i].to.item.userData.buttons&&K0(nd.CONNECTIONS[i].to):nd.CONNECTIONS[i].to.itemName.includes("laser_field")||nd.CONNECTIONS[i].to.itemName.includes("fizzler")?nd.CONNECTIONS[i].to.item.userData.connections==nd.CONNECTIONS[i].to.item.userData.buttons&&Z0(nd.CONNECTIONS[i].to):(nd.CONNECTIONS[i].to.itemName.includes("portal_0")||nd.CONNECTIONS[i].to.itemName.includes("portal_1"))&&(nd.CONNECTIONS[i].to.item.active=!0,nd.CONNECTIONS[i].to.itemName.includes("portal_0")?L0(0,nd.CONNECTIONS[i].to.item,nd.MAIN_CAMERA):nd.CONNECTIONS[i].to.itemName.includes("portal_1")&&L0(2,nd.CONNECTIONS[i].to.item,nd.MAIN_CAMERA)),!nd.CONNECTIONS[i].from.item.userData.pedestalInfinity)){if(!nd.CONNECTIONS[i].to.itemName.includes("portal_0")&&!nd.CONNECTIONS[i].to.itemName.includes("portal_1")){let e=document.getElementById("tiktok").cloneNode(!0);e.play(),setTimeout(()=>{e.pause()},1e3*nd.CONNECTIONS[i].from.item.userData.pedestalValue)}setTimeout(Iv,1e3*nd.CONNECTIONS[i].from.item.userData.pedestalValue,nd.CONNECTIONS[i])}}else if(t[0].distance<1.5){var e=t[0].instanceId,r=t[0].object.name;if("camera"!=t[0].object.name&&0==nd.DYMANIC_ITEMS[r][e].body.mass)return;("camera"!=t[0].object.name?nd.DYMANIC_ITEMS[r][e]:t[0].object).body.mass,nd.HOLDING_ITEM=!0,$g(250,nd.GUN.children[0].children[0].position,new dd(.007,-.01,-.004)),"camera"!=t[0].object.name?(nd.CURRENT_ITEM=nd.DYMANIC_ITEMS[r][e],nd.CURRENT_INSTANCED=nd.ITEMS_ADDED.getObjectByName(r),nd.CURRENT_ITEM_ID=e,bv=nd.DYMANIC_ITEMS[r][e].body):nd.CURRENT_ITEM=t[0].object,nd.CURRENT_ITEM.body.angularDamping=1,nd.CURRENT_ITEM.body.allowSleep=!1,nd.CURRENT_ITEM.body.holding=!0,nd.CURRENT_ITEM.body.collisionResponse=1,nd.CURRENT_ITEM.body.wakeUp(),"none"!=nd.PORTAL_GUN_INITIATE&&(rd.PICK_SUCESS.pause(),rd.PICK_SUCESS.currentTime=0,Ag(rd.PICK_SUCESS),Ag(rd.HOLD)),nd.CURRENT_ITEM.body.impactVelocity=null,nd.CURRENT_ITEM.body.customGravity=null,nd.CURRENT_ITEM.body.side=null,nd.CURRENT_ITEM.body.impactSide=null;r=nd.CUSTOM_GRAVITY.indexOf(nd.CURRENT_ITEM.body);-1<r&&nd.CUSTOM_GRAVITY.splice(r,1)}else rd.PICK_FAIL.pause(),rd.PICK_FAIL.currentTime=0,Ag(rd.PICK_FAIL)}else rd.PICK_FAIL.pause(),rd.PICK_FAIL.currentTime=0,Ag(rd.PICK_FAIL);nd.LIGHTNIN_STRIKE_1.visible=nd.HOLDING_ITEM,nd.LIGHTNIN_STRIKE_2.visible=nd.HOLDING_ITEM,nd.LIGHTNIN_STRIKE_3.visible=nd.HOLDING_ITEM}function Iv(e){var t=!1;e.to.item.userData.buttons==e.to.item.userData.connections&&(t=!0),--e.to.item.userData.buttons,Ov(e,"no",!1,new vd(0,2,5)),t&&(e.to.itemName.includes("door")||e.to.itemName.includes("exitDoor")?e.to.item.userData.buttons<e.to.item.userData.connections&&Y0(0,!1,!1,e.to.item):e.to.itemName.includes("tractor")?e.to.item.userData.buttons<e.to.item.userData.connections&&J0(e.to):e.to.itemName.includes("light_bridge")?e.to.item.userData.buttons<e.to.item.userData.connections&&K0(e.to):e.to.itemName.includes("laser_field")||e.to.itemName.includes("fizzler")?e.to.item.userData.buttons<e.to.item.userData.connections&&Z0(e.to):(e.to.itemName.includes("portal_0")||e.to.itemName.includes("portal_1"))&&(e.to.item.active=!1))}let mc=new dT,gc=0,vc=1/60;function Cv(){if(nd.ITEMS_ADDED.getObjectByName("spawn")||e_(!1),(gc+=mc.getDelta())>vc){for(var e of nd.DYNAMIC_OBJECTS){var t=new dd(e.position.x,e.position.y-1,e.position.z);if(!e.holding){t.y+=1;for(var n,i,r=0;r<nd.TRACTOR_BEAM.length;r++)nd.TRACTOR_BEAM_BOUNDING_BOX[r]?nd.TRACTOR_BEAM[r].item.userData.state?e.inTractor&&e.tractor!=r||(nd.TRACTOR_BEAM[r].item.userData.opened?nd.TRACTOR_BEAM_BOUNDING_BOX[r].containsPoint(t)?(n=nd.TRACTOR_BEAM[r].dir,e.tractorID!=nd.TRACTOR_BEAM[r].id?("player"==e.name&&(rd.PLAYER_INSIDE_TRACTOR_BEAM.currentTime=0,Ag(rd.PLAYER_INSIDE_TRACTOR_BEAM),nd.TRACTOR_BEAM[r].item.userData.reversed?document.getElementById("panel-top").style.backgroundColor="#ff80004a":document.getElementById("panel-top").style.backgroundColor="#0035ff4a"),e.inTractorPositionY=e.position.clone().y,e.inTractor=!0,e.tractor=r,e.tractorID=nd.TRACTOR_BEAM[r].id,nd.TRACTOR_BEAM[r].inTractor=!0,(nd.TRACTOR_BEAM[r].body=e).mass=0,e.velocity.setZero(),e.initVelocity.setZero(),e.angularVelocity.setZero(),e.initAngularVelocity.setZero(),e.force.setZero(),e.torque.setZero(),e.allowSleep=!1,e.wakeUp(),e.inArea||(i=new dd(Math.abs(Math.abs(n.x)-1)*nd.TRACTOR_BEAM[r].position.x+e.position.x*Math.abs(n.x),Math.abs(Math.abs(n.y)-1)*nd.TRACTOR_BEAM[r].position.y+e.position.y*Math.abs(n.y),Math.abs(Math.abs(n.z)-1)*nd.TRACTOR_BEAM[r].position.z+e.position.z*Math.abs(n.z)),$g(500,e.position,i))):(i=.03,nd.TRACTOR_BEAM[r].item.userData.reversed&&(i=-.03),t.add(n.clone().multiplyScalar(i)),e.position.copy(t),e.angularVelocity.setZero(),e.velocity.setZero())):e.inTractor&&e.tractor==r&&rv(e,r):e.inTractor&&rv(e,r)):e.inTractor&&rv(e,r):e.inTractor&&e.tractor==r&&rv(e,r)}}if(nd.LEVEL_ENTERED)for(var a=0;a<window.pellets.length;a++)!window.pellets[a].item.userData.isActive||window.pellets[a].body.inTractor||(window.pellets[a].body.started||Sv(window.pellets[a],!0),window.pellets[a].active&&(window.pellets[a].position.add(window.pellets[a].body.direction.clone().multiplyScalar(.06)),window.pellets[a].body.position.copy(window.pellets[a].position),window.pellets[a].body.previousPosition.copy(window.pellets[a].position),window.pellets[a].body.angularVelocity.setZero(),window.pellets[a].body.velocity.setZero(),window.pellets[a].body.force.setZero(),window.pellets[a].position.copy(window.pellets[a].body.position),window.pellets[a].quaternion.copy(window.pellets[a].body.quaternion),window.pellets[a].body.sound.position.copy(window.pellets[a].body.position),window.pellets[a].body.sound.quaternion.copy(window.pellets[a].body.quaternion)),window.pellets[a].body.started=!0);gc%=vc}var o,s=0;for(o of nd.DYNAMIC_OBJECTS){var l=new dd(o.position.x,o.position.y,o.position.z);if("player"==o.name)for(var u=0;u<nd.PORTAL_GUN_BOX.length;u++)nd.PORTAL_GUN_BOX[u].containsPoint(l)&&nd.PORTAL_GUN_BOX[u].item.visible&&(nd.PORTAL_GUN_BOX[u].item.visible=!1,nd.PORTAL_GUN_BOX[u].item.name.includes("portal_gun")?(nd.PORTAL_GUN_INITIATE=nd.PORTAL_GUN_BOX[u].item.userData.state,nd.GUN.children[0].visible=!0,nd.GUN_CLONE.children[0].visible=!0,nd.GUN_CLONE2.children[0].visible=!0,document.getElementById("reticle-img").style.filter="none","left"==nd.PORTAL_GUN_INITIATE?document.getElementById("reticle-img").src="./assets/ui/mobile/portalBlue.png":"right"==nd.PORTAL_GUN_INITIATE?document.getElementById("reticle-img").src="./assets/ui/mobile/portalOrange.png":document.getElementById("reticle-img").src="./assets/textures/crosshairNone.png",nd.GUN.visible=!0,nd.GUN_MODE="portal","left"==nd.PORTAL_GUN_INITIATE?document.getElementById("warning-game").innerHTML="Press Mouse Left to create Blue Portals!":document.getElementById("warning-game").innerHTML="Press Mouse Right to create Orange Portals!",document.getElementById("warning-game").style.opacity="1",setTimeout(()=>{document.getElementById("warning-game").style.opacity="0"},7e3)):nd.PORTAL_GUN_BOX[u].item.name.includes("paint_gun")&&(nd.GUN.visible=!1,nd.GUN_MODE="paint"));100<l.distanceTo(new dd(0,0,0))&&(o.name.includes("pellet")||o.repawning||$0(o));for(var c=0;c<nd.GOO_BOXES.length;c++)!nd.GOO_BOXES[c].containsPoint(l)||o.repawning||$0(o);for(var h=[new dd(o.position.x+o.shapes[0].height/2,o.position.y,o.position.z),new dd(o.position.x-o.shapes[0].height/2,o.position.y,o.position.z),new dd(o.position.x,o.position.y+o.shapes[0].height/2,o.position.z),new dd(o.position.x,o.position.y-o.shapes[0].height/2,o.position.z),new dd(o.position.x,o.position.y,o.position.z+o.shapes[0].height/2),new dd(o.position.x,o.position.y,o.position.z-o.shapes[0].height/2)],u=0;u<nd.CONNECTIONS.length;u++)if(!(nd.CONNECTIONS[u].from.instancedName.includes("pedestal")||nd.CONNECTIONS[u].from.instancedName.includes("laser_receiver")||nd.CONNECTIONS[u].from.instancedName.includes("laser_relay")||nd.CONNECTIONS[u].from.instancedName.includes("pellet_catcher")))for(var d,p,f,m,g=0,v=0;v<h.length;v++){if(nd.CONNECTIONS[u].from.box3.containsPoint(h[v])){nd.CONNECTIONS[u].from.box3.accept.includes(o.name)&&!nd.CONNECTIONS[u].line.active&&(d=0,nd.CONNECTIONS[u].from.item.userData.pedestalInfinity?(rd.POSITIVE.play(),Ov(nd.CONNECTIONS[u],s,!0,new vd(2,1.3,0)),nd.CONNECTIONS[u].to.item.userData.buttons+=1):d=1e3*nd.CONNECTIONS[u].from.item.userData.pedestalValue,m=nd.CONNECTIONS[u].to,p=nd.CONNECTIONS[u],f=s,nd.CONNECTIONS[u].line.active=!0,((n,i,r,a,o)=>{var s=window.timeoutEvent.length;window.timeoutEvent.push(new Lv(function(){if(window.timeoutEvent.splice(s,1),0<i&&(Ov(a,r,!0,new vd(2,1.3,0)),n.item.userData.buttons+=1),a.from.itemName.includes("incinerator")){let e=nd.ITEMS_ADDED.getObjectByName(o.name).scene.clone();e.position.set(o.position.x,o.position.y,o.position.z),e.quaternion.copy(o.quaternion),e.visible=!0,nd.HOLDING_ITEM&&Nv(),nd.UNIFORMS_DISSOLVER.diffuseMap.value=e.material.map,e.material=nd.MATERIAL_DISSOLVER,nd.SCENE_FPS.add(e);var t=e.position.clone(),t=(t.y+=2,nd.UNIFORMS_DISSOLVER.u_EffectOrigin.value=t,e.clone());t.position.y+=.5,xg("audio-dissolve",e,!0,!1,!0,2,"sound"),$g(3e3,nd.UNIFORMS_DISSOLVER.u_EffectOrigin.value,e.position),$g(3e3,e.position,t.position),setTimeout(()=>{nd.SCENE_FPS&&e.sound&&(nd.SCENE.remove(e),nd.SCENE_FPS.remove(e.sound))},3e3),$0(o)}if(n.itemName.includes("door")||n.itemName.includes("exitDoor"))n.item.userData.connections==n.item.userData.buttons&&Y0(0,!0,!1,n.item);else if(n.itemName.includes("cube")||n.itemName.includes("sphere"))n.item.userData.connections==n.item.userData.buttons&&Q0(n.item);else if(n.itemName.includes("tractor"))n.item.userData.connections==n.item.userData.buttons&&J0(n);else if(n.itemName.includes("light_bridge")){if(n.item.userData.connections==n.item.userData.buttons){K0(n);for(var e of nd.DYNAMIC_OBJECTS)e.wakeUp()}}else n.itemName.includes("laser_field")||n.itemName.includes("fizzler")?n.item.userData.connections==n.item.userData.buttons&&Z0(n):n.itemName.includes("portal_0")||n.itemName.includes("portal_1")?(n.item.active=!0,n.itemName.includes("portal_0")?L0(0,n.item,nd.MAIN_CAMERA):n.itemName.includes("portal_1")&&L0(2,n.item,nd.MAIN_CAMERA)):(n.itemName.includes("piston_platforms")||n.itemName.includes("track_platforms")||n.itemName.includes("pellet_launcher"))&&(n.item.userData.isActive=!n.item.userData.isActive,n.item.body.pistonDown=!1,n.itemName.includes("piston_platforms")||n.itemName.includes("track_platforms"))&&(n.item.userData.isActive?n.item.body.sound.audio.play():n.item.body.sound.audio.pause());Eg(n.item.userData)},i))})(m,d,f,p,o));break}nd.CONNECTIONS[u].from.instancedName.includes("trigger")||nd.CONNECTIONS[u].from.instancedName.includes("incinerator")||6<=++g&&nd.CONNECTIONS[u].line.active&&nd.CONNECTIONS[u].line.idConnection==s&&(m=!1,nd.CONNECTIONS[u].to.item.userData.buttons==nd.CONNECTIONS[u].to.item.userData.connections&&(m=!0),--nd.CONNECTIONS[u].to.item.userData.buttons,Ov(nd.CONNECTIONS[u],null,!1,new vd(0,2,5)),m)&&(nd.CONNECTIONS[u].to.itemName.includes("door")||nd.CONNECTIONS[u].to.itemName.includes("exitDoor")?nd.CONNECTIONS[u].to.item.userData.buttons<nd.CONNECTIONS[u].to.item.userData.connections&&Y0(0,!1,!1,nd.CONNECTIONS[u].to.item):nd.CONNECTIONS[u].to.itemName.includes("tractor")?nd.CONNECTIONS[u].to.item.userData.buttons<nd.CONNECTIONS[u].to.item.userData.connections&&J0(nd.CONNECTIONS[u].to):nd.CONNECTIONS[u].to.itemName.includes("light_bridge")?nd.CONNECTIONS[u].to.item.userData.buttons<nd.CONNECTIONS[u].to.item.userData.connections&&K0(nd.CONNECTIONS[u].to):nd.CONNECTIONS[u].to.itemName.includes("laser_field")||nd.CONNECTIONS[u].to.itemName.includes("fizzler")?nd.CONNECTIONS[u].to.item.userData.buttons<nd.CONNECTIONS[u].to.item.userData.connections&&Z0(nd.CONNECTIONS[u].to):nd.CONNECTIONS[u].to.itemName.includes("portal_0")||nd.CONNECTIONS[u].to.itemName.includes("portal_1")?nd.CONNECTIONS[u].to.item.active=!1:(nd.CONNECTIONS[u].to.itemName.includes("piston_platforms")||nd.CONNECTIONS[u].to.itemName.includes("track_platforms")||nd.CONNECTIONS[u].to.itemName.includes("pellet_launcher"))&&(nd.CONNECTIONS[u].to.item.userData.isActive=!nd.CONNECTIONS[u].to.item.userData.isActive,nd.CONNECTIONS[u].to.item.body.pistonDown=!0,nd.CONNECTIONS[u].to.itemName.includes("piston_platforms")||nd.CONNECTIONS[u].to.itemName.includes("track_platforms"))&&(nd.CONNECTIONS[u].to.item.userData.isActive?nd.CONNECTIONS[u].to.item.body.sound.audio.play():nd.CONNECTIONS[u].to.item.body.sound.audio.pause()))}s++}}var Lv=function(e,t){var n,i,r=t;this.pause=function(){window.clearTimeout(n),n=null,r-=Date.now()-i},this.resume=function(){n||(i=Date.now(),n=window.setTimeout(e,r))},this.resume()};function Dv(e,t,n){var i,r=nd.PLANE_USER_DATA[e.userData.planeInstancedId];if(t)for(var a=0;a<nd.CONNECTIONS.length;a++)!(nd.CONNECTIONS[a].from.instancedName.includes("laser_receiver")||nd.CONNECTIONS[a].from.instancedName.includes("laser_relay")||nd.CONNECTIONS[a].from.instancedName.includes("pellet_catcher"))||r!=nd.CONNECTIONS[a].from||nd.CONNECTIONS[a].line.active||(r.item.connection=nd.CONNECTIONS[a],nd.CONNECTIONS[a].from.item.userData.state=!0,nd.CONNECTIONS[a].to.item.userData.buttons+=1,Ov(nd.CONNECTIONS[a],"no",!0,new vd(2,1.3,0)),n||nd.LASER_TRIGGERS.push(e),rd.POSITIVE.play(),nd.CONNECTIONS[a].to.itemName.includes("door")||nd.CONNECTIONS[a].to.itemName.includes("exitDoor")?nd.CONNECTIONS[a].to.item.userData.connections==nd.CONNECTIONS[a].to.item.userData.buttons&&Y0(0,!0,!1,nd.CONNECTIONS[a].to.item):nd.CONNECTIONS[a].to.itemName.includes("cube")||nd.CONNECTIONS[a].to.itemName.includes("sphere")?nd.CONNECTIONS[a].to.item.userData.connections==nd.CONNECTIONS[a].to.item.userData.buttons&&Q0(nd.CONNECTIONS[a].to.item):nd.CONNECTIONS[a].to.itemName.includes("tractor")?nd.CONNECTIONS[a].to.item.userData.connections==nd.CONNECTIONS[a].to.item.userData.buttons&&J0(nd.CONNECTIONS[a].to):nd.CONNECTIONS[a].to.itemName.includes("light_bridge")?nd.CONNECTIONS[a].to.item.userData.connections==nd.CONNECTIONS[a].to.item.userData.buttons&&K0(nd.CONNECTIONS[a].to):nd.CONNECTIONS[a].to.itemName.includes("laser_field")||nd.CONNECTIONS[a].to.itemName.includes("fizzler")?nd.CONNECTIONS[a].to.item.userData.connections==nd.CONNECTIONS[a].to.item.userData.buttons&&Z0(nd.CONNECTIONS[a].to):nd.CONNECTIONS[a].to.itemName.includes("portal_0")||nd.CONNECTIONS[a].to.itemName.includes("portal_1")?(nd.CONNECTIONS[a].to.item.active=!0,nd.CONNECTIONS[a].to.itemName.includes("portal_0")?L0(0,nd.CONNECTIONS[a].to.item,nd.MAIN_CAMERA):nd.CONNECTIONS[a].to.itemName.includes("portal_1")&&L0(2,nd.CONNECTIONS[a].to.item,nd.MAIN_CAMERA)):(nd.CONNECTIONS[a].to.itemName.includes("piston_platforms")||nd.CONNECTIONS[a].to.itemName.includes("track_platforms")||nd.CONNECTIONS[a].to.itemName.includes("pellet_launcher"))&&(nd.CONNECTIONS[a].to.item.userData.isActive=!nd.CONNECTIONS[a].to.item.userData.isActive,nd.CONNECTIONS[a].to.item.body.pistonDown=!1,nd.CONNECTIONS[a].to.itemName.includes("piston_platforms")||nd.CONNECTIONS[a].to.itemName.includes("track_platforms"))&&(nd.CONNECTIONS[a].to.item.userData.isActive?nd.CONNECTIONS[a].to.item.body.sound.audio.play():nd.CONNECTIONS[a].to.item.body.sound.audio.pause()));else n||(-1<(t=nd.LASER_TRIGGERS.indexOf(e))&&nd.LASER_TRIGGERS.splice(t,1),t=!1,(i=r.item.connection).to.item.userData.buttons==i.to.item.userData.connections&&(t=!0),--i.to.item.userData.buttons,i.from.item.userData.state=!1,Ov(i,"no",!1,new vd(0,2,5)),t&&(i.to.itemName.includes("door")||i.to.itemName.includes("exitDoor")?i.to.item.userData.buttons<i.to.item.userData.connections&&Y0(0,!1,!1,i.to.item):i.to.itemName.includes("tractor")?i.to.item.userData.buttons<i.to.item.userData.connections&&J0(i.to):i.to.itemName.includes("light_bridge")?i.to.item.userData.buttons<i.to.item.userData.connections&&K0(i.to):i.to.itemName.includes("laser_field")||i.to.itemName.includes("fizzler")?i.to.item.userData.buttons<i.to.item.userData.connections&&Z0(i.to):i.to.itemName.includes("portal_0")||i.to.itemName.includes("portal_1")?i.to.item.active=!1:(i.to.itemName.includes("piston_platforms")||i.to.itemName.includes("track_platforms")||i.to.itemName.includes("pellet_launcher"))&&(i.to.item.userData.isActive=!1,i.to.item.body.pistonDown=!0,i.to.itemName.includes("piston_platforms")||i.to.itemName.includes("track_platforms"))&&(i.to.item.userData.isActive?i.to.item.body.sound.audio.play():i.to.item.body.sound.audio.pause())))}function Ov(e,t,n,i){"no"!=t&&(e.line.idConnection=t),e.line.active=n,e.line.material.color=i,window.checkers.setColorAt(e.checker,i)}window.timeoutEvent=[];var Pv=1;function Uv(e,t,n,i){var r=new gd,a=(r.position.copy(e.position),r.rotation.copy(e.rotation),new dd),o=new yT,s=(a.copy(r.position),new dd),r=(s.copy(r.up).applyQuaternion(r.quaternion),o.set(a,s),o.item=e,o.intersectObject(nd.PLANE_LEVEL_INSTANCED));if(0!=r.length){if(t){if(n.distance==r[0].distance)return;nd.LASERS.remove(e.continuous),nd.LASER_EMITTER_RAYCASTER[i]=o}else n.push(o);o.distance=r[0].distance,o.item=e;a=new vx(.01,.01,1,8,1,!0),s=new xd(a,new _d({color:new vd(Pv,0,0)})),t=(s.translateY(.5),new Sd),i=(t.position.copy(e.position),t.rotation.copy(e.rotation),t.scale.y=r[0].distance,t.add(s),nd.LASERS.add(t),t.clone());i.visible=!1,t.clone=i,nd.LASERS.add(i),e.continuous=t,(e.raycaster=o).laser=t}}"epic"==localStorage.getItem("quality-select")&&(Pv=10),nd.SCENE_CHILDREN.add(nd.LASERS);var Bv=new yT,Fv=new yT;function zv(e,t){if(nd.LEVEL_ENTERED&&(t.visible=t.active,t.clone.visible=!1,t.active)){var n=new dd,i=(e.getWorldDirection(n),n.negate(),Bv.set(e.position,n),Bv.intersectObject(nd.PLANE_LEVEL_INSTANCED));t.position.copy(e.position),t.rotation.copy(e.rotation),t.rotateX(-Math.PI/2),0<i.length&&(t.scale.y=i[0].distance);for(var r,a,n=[nd.ITEMS_ADDED.getObjectByName("laser_cube"),nd.ITEMS_ADDED.getObjectByName("cube"),nd.ITEMS_ADDED.getObjectByName("sphere"),nd.ITEMS_ADDED.getObjectByName("cube_2"),nd.ITEMS_ADDED.getObjectByName("scale_cube"),nd.ITEMS_ADDED.getObjectByName("laser_receiver"),nd.ITEMS_ADDED.getObjectByName("laser_relay")].filter(function(e){return null!=e}),i=Bv.intersectObjects(n),o=0;o<i.length;o++)if(.5<i[o].distance)if("laser_receiver"==i[o].object.name?(nd.DYMANIC_ITEMS.laser_receiver[i[o].instanceId].emitterState=!0,nd.DYMANIC_ITEMS.laser_receiver[i[o].instanceId].fromLaserCube=!0,Dv(nd.DYMANIC_ITEMS.laser_receiver[i[o].instanceId],!0,!1)):"laser_relay"==i[o].object.name&&(nd.DYMANIC_ITEMS.laser_relay[i[o].instanceId].emitterState=!0,nd.DYMANIC_ITEMS.laser_relay[i[o].instanceId].fromLaserCube=!0,Dv(nd.DYMANIC_ITEMS.laser_relay[i[o].instanceId],!0,!1)),"laser_cube"!=i[o].object.name||(r=nd.DYMANIC_ITEMS.laser_cube[i[o].instanceId]).body.laser.active||(r.body.laser.active=!0,(a=new gd).position.copy(r.body.position),a.quaternion.copy(r.body.quaternion),zv(a,r.body.laser)),"laser_relay"!=i[o].object.name)return void(t.scale.y=i[o].distance);if(null!==nd.PORTALS[0]&&null!==nd.PORTALS[1]){var s=Bv.intersectObjects(nd.PORTAL_SHADER);if(0<s.length){var l,u="portal-0"==s[0].object.name?(l=1,0):(l=0,1);t.clone.position.copy(nd.PORTAL_SHADER[l].position);for(var c,u=nd.PORTALS[u].mesh.quaternion.clone(),h=nd.PORTALS[l].mesh.quaternion.clone(),u=(new hd).copy(u).multiply(h.invert()),h=2*Math.acos(fn.clamp(u.w,-1,1)),u=new dd(u.x,u.y,u.z).normalize(),d=new dd(0,1,0),u=u.dot(d),d=(0==(h*=Math.sign(u))||Math.abs(h)==Math.PI?(t.clone.rotation.copy(nd.PORTALS[l].mesh.rotation),t.clone.translateZ(-1.8*(s[0].uv.y-.5)),t.clone.translateX(-1.1*(s[0].uv.x-.5)),t.clone.rotation.copy(t.rotation),t.clone.rotateZ(h-Math.PI)):Math.abs(h).toFixed(2)==(Math.PI/2).toFixed(2)||Math.abs(h).toFixed(2)==(Math.PI+Math.PI/2).toFixed(2)?(t.clone.rotation.copy(nd.PORTALS[l].mesh.rotation),t.clone.translateZ(-1.8*(s[0].uv.y-.5)),t.clone.translateX(-1.1*(s[0].uv.x-.5)),t.clone.rotation.copy(t.rotation),t.clone.rotateZ(h)):(t.clone.rotation.copy(nd.PORTALS[l].mesh.rotation),t.clone.translateZ(-1.8*(s[0].uv.y-.5)),t.clone.translateX(-.9*(s[0].uv.x-.5))),t.clone.visible=!0,new dd(0,1,0).applyQuaternion(t.clone.quaternion)),u=(Fv.set(t.clone.position,d),Fv.intersectObject(nd.PLANE_LEVEL_INSTANCED)),p=(0<u.length&&(t.clone.scale.y=u[0].distance),Fv.intersectObjects(n)),f=0;f<p.length;f++)if("laser_receiver"==p[f].object.name?(nd.DYMANIC_ITEMS.laser_receiver[p[f].instanceId].emitterState=!0,nd.DYMANIC_ITEMS.laser_receiver[p[f].instanceId].fromLaserCube=!0,Dv(nd.DYMANIC_ITEMS.laser_receiver[p[f].instanceId],!0,!1)):"laser_relay"==p[f].object.name&&(nd.DYMANIC_ITEMS.laser_relay[p[f].instanceId].emitterState=!0,nd.DYMANIC_ITEMS.laser_relay[p[f].instanceId].fromLaserCube=!0,Dv(nd.DYMANIC_ITEMS.laser_relay[p[f].instanceId],!0,!1)),"laser_cube"!=p[f].object.name||(c=nd.DYMANIC_ITEMS.laser_cube[p[f].instanceId]).body.laser.active||(c.body.laser.active=!0,(e=new gd).position.copy(c.body.position),e.quaternion.copy(c.body.quaternion),zv(e,c.body.laser)),t.clone.visible=!0,"laser_relay"!=p[f].object.name){t.clone.scale.y=p[f].distance;break}}}}}function kv(e,t,n,i){e.userData.triggers=t,n.data("trigger",t),n.find(".title").text(t);n=new gd,n.position.copy(new dd(e.initialPosition.x,e.initialPosition.y,e.initialPosition.z)),n.rotation.set(e.initialRotation.x,e.initialRotation.y,e.initialRotation.z),"Top"==t?n.translateZ(-.6):"Bottom"==t?n.translateZ(.6):"Left"==t?(n.rotateY(Math.PI/2),n.translateZ(-.6)):"Right"==t&&(n.rotateY(Math.PI/2),n.translateZ(.6)),e.position.copy(n.position),e.rotation.copy(n.rotation),n.updateMatrix(),t=nd.ITEMS_ADDED.getObjectByName(i);if(t.setMatrixAt(e.userData.idInstanced,n.matrix),t.instanceMatrix.needsUpdate=!0,t.computeBoundingSphere(),"laser_receiver"!=i)for(var r=0;r<nd.LASER_EMITTER_RAYCASTER.length;r++)nd.LASER_EMITTER_RAYCASTER[r].distance=null,Uv(nd.LASER_EMITTER_RAYCASTER[r].item,!0,nd.LASER_EMITTER_RAYCASTER[r],r)}td()("body").on("click",".laser_emitter-triggers",function(){nd.LASER_EMITTER_TRIGGER=td()(this).data("trigger"),kv(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item,td()(this).data("trigger"),td()("#laser_emitter-trigger"),"laser_emitter")}),td()("body").on("click",".laser_receiver-triggers",function(){nd.LASER_RECEIVER_TRIGGER=td()(this).data("trigger"),kv(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item,td()(this).data("trigger"),td()("#laser_receiver-trigger"),"laser_receiver")});var Gv=new Rx(.6,8,4);let _c=new _d({color:new vd("rgb(30,144,255)")}),yc=new _d({color:new vd("rgb(255,140,0)")}),Ec=new _d({color:new vd("rgb(75,0,130)")}),Ac=new _d({color:new vd(.8,.8,.8)}),xc=new _d({color:new vd(11001053),transparent:!0,opacity:.5}),Tc=new Ox({metalness:1,roughness:.25}),Sc=new xd(Gv,_c);var Hv=[];let wc=new(ym().Material);function Vv(e,a,o,t){var n=Sc.clone(),s=(nd.SCENE_FPS.add(n),Hv.push(n),n.material=t,new(ym().Body)({shape:new(ym().Sphere)(.3),mass:20,material:wc}));(n.body=s).sphereClone=n,s.position.copy(e.position),s.position.y-=.5,s.quaternion.copy(e.quaternion),s.collisionFilterGroup=nd.CGROUP_DYNAMIC,s.collisionFilterMask=nd.CGROUP_ALL,s.item=e,s.updateMassProperties(),s.clone=new gd,s.spawnPositions=[],s.typeGel=a,s.colorGel=o,nd.CANNON_WORLD.addBody(s),nd.CANNON_BODIES.push(s),nd.DYNAMIC_OBJECTS.push(s),s.addEventListener("collide",function(e){var t,n,i,r;s.inArea||(e.body.dynamic&&(t=nd.ITEMS_ADDED.getObjectByName(e.body.item.userData.instancedName),"clear"==s.typeGel?t.setColorAt(e.body.item.userData.idInstanced,new vd(1,1,1)):t.setColorAt(e.body.item.userData.idInstanced,s.colorGel)),s.sphereClone.visible=!1,s.mass=0,s.updateMassProperties(),s.position.copy(s.item.position),s.position.y-=.5,s.quaternion.copy(s.item.quaternion),s.velocity.setZero(),s.initVelocity.setZero(),s.angularVelocity.setZero(),s.initAngularVelocity.setZero(),s.force.setZero(),s.torque.setZero(),setTimeout(()=>{s.mass=20,s.updateMassProperties(),s.wakeUp(),s.sphereClone.visible=!0},1e3),"wall"!=e.body.name&&"panel"!=e.body.name)||((t=new gd).position.copy(tv(Wv(e.contact))),"wall"==e.body.name?t.rotation.copy("down"==(n=e.body.side)?new md(-Math.PI/2,0,0):"up"==n?new md(Math.PI/2,0,0):"front"==n?new md(0,0,0):"back"==n?new md(Math.PI,0,0):"left"==n?new md(0,Math.PI/2,0):"right"==n?new md(0,-Math.PI/2,0):void 0):(t.quaternion.copy(e.body.quaternion),t.rotateY(Math.PI),n=new dd,e.body.panel.getWorldPosition(n),t.position.copy(n)),i=tv(Wv(e.contact)),r=i,s.spawnPositions.some(e=>e.equals(r)))||(Jv(t,o,a,e.body.side,!0,1),s.spawnPositions.push(i))})}function Wv(e){var t=e.rj,n=new(ym().Vec3);return e.bj.pointToWorldFrame(t,n),n}wc.friction=.4,vg=new EA(2,2),Qh=new Ox({roughness:.2,normalMap:(new wd).load("./assets/textures/decal/normal.webp"),polygonOffset:!0,polygonOffsetFactor:1});let bc=new jA(vg,Qh,1e3);bc.current=0,bc.frustumCulled=!0;for(var jv=new gd,Yv=0;Yv<1e3;Yv++)jv.position.set(1e5,1e5,1e5),jv.updateMatrix(),bc.setMatrixAt(Yv,jv.matrix);bc.instanceMatrix.needsUpdate=!0,bc.computeBoundingSphere(),id=new EA(2,2),pg=new Ox({roughness:.2,normalMap:(new wd).load("./assets/textures/decal/decal-normal.webp"),map:(new wd).load("./assets/textures/decal/decal-diffuse.webp"),transparent:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:1});let Mc=new jA(id,pg,1e3);for(Mc.current=0,Mc.frustumCulled=!0,jv=new gd,Yv=0;Yv<1e3;Yv++)jv.position.set(1e5,1e5,1e5),jv.updateMatrix(),Mc.setMatrixAt(Yv,jv.matrix);Mc.instanceMatrix.needsUpdate=!0,Mc.computeBoundingSphere(),$h=new EA(2,2),wv=new Ox({roughness:.2,normalMap:(new wd).load("./assets/textures/decal/decal-normal.webp"),map:(new wd).load("./assets/textures/decal/decal-diffuse.webp"),transparent:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:1,metalness:1,roughness:.25});let Rc=new jA($h,wv,1e3);for(Rc.current=0,Rc.frustumCulled=!0,jv=new gd,Yv=0;Yv<1e3;Yv++)jv.position.set(1e5,1e5,1e5),jv.updateMatrix(),Rc.setMatrixAt(Yv,jv.matrix);Rc.instanceMatrix.needsUpdate=!0,Rc.computeBoundingSphere(),nd.INSTANCED_WHITE_GEL=new jA(id,pg,1e3),nd.INSTANCED_WHITE_GEL.current=0,nd.INSTANCED_WHITE_GEL.frustumCulled=!0,nd.INSTANCED_WHITE_GEL.array=[];for(var qv,Xv,jv=new gd,Yv=0;Yv<1e3;Yv++)jv.position.set(1e5,1e5,1e5),jv.updateMatrix(),nd.INSTANCED_WHITE_GEL.setMatrixAt(Yv,jv.matrix);function Zv(){Kv(bc),Kv(Mc),Kv(Rc),Kv(nd.INSTANCED_WHITE_GEL),bc.material.envMap=nd.ENV_MAP,nd.SCENE_FPS.add(bc),Mc.material.envMap=nd.ENV_MAP,nd.SCENE_FPS.add(Mc),Rc.material.envMap=nd.ENV_MAP,nd.SCENE_FPS.add(Rc),nd.INSTANCED_WHITE_GEL.material.envMap=nd.ENV_MAP,nd.SCENE_FPS.add(nd.INSTANCED_WHITE_GEL);for(var e=0;e<nd.GELS.length;e++)Jv(nd.GELS[e],nd.GELS[e].planeColor,nd.GELS[e].gelType,nd.GELS[e].side,!1,1);Tc.envMap=nd.ENV_MAP;for(var t=0;t<nd.DYMANIC_ITEMS.gel_blue.length;t++)0!=nd.DYMANIC_ITEMS.gel_blue[t].length&&Vv(nd.DYMANIC_ITEMS.gel_blue[t],"blue",new vd("rgb(30,144,255)"),_c);for(t=0;t<nd.DYMANIC_ITEMS.gel_orange.length;t++)0!=nd.DYMANIC_ITEMS.gel_orange[t].length&&Vv(nd.DYMANIC_ITEMS.gel_orange[t],"orange",new vd("rgb(255,140,0)"),yc);for(t=0;t<nd.DYMANIC_ITEMS.gel_purple.length;t++)0!=nd.DYMANIC_ITEMS.gel_purple[t].length&&Vv(nd.DYMANIC_ITEMS.gel_purple[t],"purple",new vd("rgb(75,0,130)"),Ec);for(t=0;t<nd.DYMANIC_ITEMS.gel_white.length;t++)0!=nd.DYMANIC_ITEMS.gel_white[t].length&&Vv(nd.DYMANIC_ITEMS.gel_white[t],"white",new vd(.8,.8,.8),Ac);for(t=0;t<nd.DYMANIC_ITEMS.gel_clear.length;t++)0!=nd.DYMANIC_ITEMS.gel_clear[t].length&&Vv(nd.DYMANIC_ITEMS.gel_clear[t],"clear",new vd(11001053),xc);for(t=0;t<nd.DYMANIC_ITEMS.gel_reflection.length;t++)0!=nd.DYMANIC_ITEMS.gel_reflection[t].length&&Vv(nd.DYMANIC_ITEMS.gel_reflection[t],"reflection",new vd("rgb(128,128,128)"),Tc)}function Kv(e){for(var t=new gd,n=0;n<1e3;n++)t.scale.set(0,0,0),t.position.set(1e5,1e5,1e5),t.updateMatrix(),e.setMatrixAt(n,t.matrix)}function Jv(e,t,n,i,r,a){var r="white"==n?nd.INSTANCED_WHITE_GEL:"reflection"==n?Rc:r?Mc:bc,o=new gd,e=(o.position.copy(e.position),o.rotation.copy(e.rotation),o.updateMatrix(),r.setMatrixAt(r.current,o.matrix),r.setColorAt(r.current,new vd(t)),o),o=n,n=i,i=a,a=r;i=new(ym().Box)(new(ym().Vec3)(i,i,.01)),i=new(ym().Body)({shape:i,mass:0,material:nd.PHYSICS_MATERIAL}),e.translateZ(-.005),i.position.copy(e.position),i.quaternion.copy(e.quaternion),i.name="gel",i.type=o,i.collisionFilterGroup=nd.CGROUP_ENVIRONMENT,i.collisionFilterMask=nd.CGROUP_DYNAMIC,i.side=n,i.color=t,i.room=!0,e.gelBody=i,nd.GEL_TRIGGER.push(e),"front"==n?i.normal=new dd(0,0,1):"back"==n?i.normal=new dd(0,0,-.01):"right"==n?i.normal=new dd(-.01,0,0):"left"==n?i.normal=new dd(1,0,0):"up"==n?i.normal=new dd(0,-.01,0):"down"==n&&(i.normal=new dd(0,1.01,0)),nd.CANNON_BODIES.push(i),nd.CANNON_WORLD.addBody(i),nd.WALL_BODIES.push(i),"white"==o&&a.array.push(i),r.instanceMatrix.needsUpdate=!0,r.computeBoundingSphere(),r.current+=1}function Qv(t){if(0!=t.body.collisionResponse)if("blue"!=t.body.type||t.target.gelJumping)"orange"==t.body.type?(t.target.OrangeContact||(rd.PROPULSION.currentTime=0,rd.PROPULSION.play(),rd.WALK.volume=0),t.target.OrangeContact=!0):"purple"==t.body.type&&"down"!=t.body.side&&(clearTimeout(t.target.timeout),t.target.gelPurple=t.body,i=tv(t.contact.ni).round().negate(),n=i,n=(new ed.Vec3).copy(n),"player"==t.target.name?t.target.side!=t.body.side&&(nd.HEAD_BOB_SPEED=3,nd.PLAYER.PURPLE_CONTACT=!1,nd.PLAYER.ROTATING=!0,setTimeout(()=>{nd.PLAYER.ROTATING=!1,nd.PLAYER.PURPLE_CONTACT=!0},400),t.target.side=t.body.side,t.target.customGravity=new(ym().Vec3)(-9.8*n.x,-9.8*n.y,-9.8*n.z),nd.PLAYER.upVector=n,nd.PLAYER.upVectorThree=i,nd.PLAYER.EULER||(nd.MAIN_CAMERA_GROUP.position.copy(nd.MAIN_CAMERA.position),nd.MAIN_CAMERA.position.set(0,0,0),nd.PIVOT=nd.MAIN_CAMERA_GROUP,nd.CUSTOM_GRAVITY.push(t.target)),window.direction=1,"front"==t.body.side?(nd.PLAYER.EULER=new md(Math.PI/2,0,0,"XYZ"),$g(400,nd.MAIN_CAMERA_GROUP.rotation,new dd(Math.PI/2,0,0)),nd.PLAYER.DIR=1):"back"==t.body.side?(nd.PLAYER.EULER=new md(-Math.PI/2,0,0,"XYZ"),$g(400,nd.MAIN_CAMERA_GROUP.rotation,new dd(-Math.PI/2,0,0)),nd.PLAYER.DIR=-1):"up"==t.body.side?(nd.PLAYER.EULER=new md(Math.PI*nd.PLAYER.DIR,0,0,"XYZ"),$g(400,nd.MAIN_CAMERA_GROUP.rotation,new dd(Math.PI*nd.PLAYER.DIR,0,0))):"left"==t.body.side?(nd.PLAYER.EULER=new md(0,0,-Math.PI/2,"XYZ"),$g(400,nd.MAIN_CAMERA_GROUP.rotation,new dd(0,0,-Math.PI/2)),nd.PLAYER.DIR=-1):"right"==t.body.side&&(nd.PLAYER.EULER=new md(0,0,Math.PI/2,"XYZ"),$g(400,nd.MAIN_CAMERA_GROUP.rotation,new dd(0,0,Math.PI/2)),nd.PLAYER.DIR=1),window.nnn=!0,nd.SPEED=.75,rd.WALK_NORMAL.pause(),rd.WALK=rd.WALK_PAINT):t.target.customGravity||(nd.CUSTOM_GRAVITY.push(t.target),t.target.customGravity=new(ym().Vec3)(-9.8*n.x,-9.8*n.y,-9.8*n.z)));else{clearTimeout(t.target.timeout),t.target.firstCollisionHandled=!0,t.target.gelJumping=!0;let e=t.target;setTimeout(()=>{e.gelJumping=!1},100);var n,i=t.body.normal;if(t.target.impactSide!=t.body.side){if(0<Math.abs(i.x)?t.target.axisImpact="x":0<Math.abs(i.y)?t.target.axisImpact="y":0<Math.abs(i.z)&&(t.target.axisImpact="z"),Math.abs(t.target.velocity[t.target.axisImpact])<1&&"player"==t.target.name&&"down"==t.body.side)return t.target.jumpVelocity=-7,void(t.target.impactVelocity=-7);Math.abs(t.target.velocity[t.target.axisImpact])<7?t.target.impactVelocity=-7:t.target.impactVelocity=-Math.abs(t.target.velocity[t.target.axisImpact]),t.target.impactSide=t.body.side}else if(t.target.jumpVelocity)return;t.target.velocity[t.target.axisImpact]=t.target.impactVelocity,t.target.impactVelocity<0&&(n=-2.1*t.target.mass*t.target.impactVelocity,i=new(ym().Vec3)(n*i.x,n*i.y,n*i.z),"down"!=t.body.side&&(t.target.velocity.y=.65,i.y=85),t.target.applyImpulse(i,t.target.position),t.target.soundRepulsion.position.copy(tv(t.target.position)),t.target.soundRepulsion.audio.currentTime=0,t.target.soundRepulsion.audio.play())}}function $v(e,t,n,i){"blue"==t?n="rgb(30,144,255)":"orange"==t?n="rgb(255,140,0)":"purple"==t&&(n="rgb(75,0,130)"),e.hasItem=!0,e.itemName="gel",e.gelType=t,e.planeColor=n,nd.PLANE_LEVEL_INSTANCED.setColorAt(i,new vd(n)),nd.GELS.indexOf(e)<=-1&&nd.GELS.push(e)}function e0(n,e){var t,i,r=1<arguments.length&&void 0!==e&&e,a=null!==n[0].index,o=new Set(Object.keys(n[0].attributes)),s=new Set(Object.keys(n[0].morphAttributes)),l={},u={},c=n[0].morphTargetsRelative,h=new Ad;let d=0;for(let t=0;t<n.length;++t){var p,f,m=n[t];let e=0;if(a!=(null!==m.index))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+t+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(p in m.attributes){if(!o.has(p))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+t+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;void 0===l[p]&&(l[p]=[]),l[p].push(m.attributes[p]),e++}if(e!==o.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+t+". Make sure all geometries have the same number of attributes."),null;if(c!==m.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+t+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(f in m.morphAttributes){if(!s.has(f))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+t+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===u[f]&&(u[f]=[]),u[f].push(m.morphAttributes[f])}if(r){let e;if(a)e=m.index.count;else{if(void 0===m.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+t+". The geometry must have either an index or a position attribute"),null;e=m.attributes.position.count}h.addGroup(d,e,t),d+=e}}if(a){let t=0;var g=[];for(let e=0;e<n.length;++e){var v=n[e].index;for(let e=0;e<v.count;++e)g.push(v.getX(e)+t);t+=n[e].attributes.position.count}h.setIndex(g)}for(t in l){var _=t0(l[t]);if(!_)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+t+" attribute."),null;h.setAttribute(t,_)}for(i in u){var y=u[i][0].length;if(0===y)break;h.morphAttributes=h.morphAttributes||{},h.morphAttributes[i]=[];for(let t=0;t<y;++t){var E=[];for(let e=0;e<u[i].length;++e)E.push(u[i][e][t]);var A=t0(E);if(!A)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+i+" morphAttribute."),null;h.morphAttributes[i].push(A)}}return h}function t0(t){let n,i,r,a=-1,o=0;for(let e=0;e<t.length;++e){var s=t[e];if((n=void 0===n?s.array.constructor:n)!==s.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if((i=void 0===i?s.itemSize:i)!==s.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if((r=void 0===r?s.normalized:r)!==s.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if((a=-1===a?s.gpuType:a)!==s.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;o+=s.count*i}var l=new n(o),u=new yd(l,i,r);let c=0;for(let e=0;e<t.length;++e){var h=t[e];if(h.isInterleavedBufferAttribute){var d=c/i;for(let t=0,e=h.count;t<e;t++)for(let e=0;e<i;e++){var p=h.getComponent(t,e);u.setComponent(t+d,e,p)}}else l.set(h.array,c);c+=h.count*i}return void 0!==a&&(u.gpuType=a),u}function n0(e,n){if(0===n)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(2!==n&&1!==n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",n),e;{let t=e.getIndex();if(null===t){var i=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)i.push(e);e.setIndex(i),t=e.getIndex()}var a=t.count-2,o=[];if(2===n)for(let e=1;e<=a;e++)o.push(t.getX(0)),o.push(t.getX(e)),o.push(t.getX(e+1));else for(let e=0;e<a;e++)e%2==0?(o.push(t.getX(e)),o.push(t.getX(e+1)),o.push(t.getX(e+2))):(o.push(t.getX(e+2)),o.push(t.getX(e+1)),o.push(t.getX(e)));o.length/3!=a&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");n=e.clone();return n.setIndex(o),n.clearGroups(),n}}nd.INSTANCED_WHITE_GEL.instanceMatrix.needsUpdate=!0,nd.INSTANCED_WHITE_GEL.computeBoundingSphere(),td()("body").on("click","#add-gel",function(){for(var e=0;e<nd.SELECTED_ID.length;e++)$v(nd.PLANE_USER_DATA[nd.SELECTED_ID[e]],td()("#gel-type").data("gel"),td()("#gel-type").data("color"),nd.SELECTED_ID[e])}),td()("body").on("click","#remove-gel",function(){for(var e,t=0;t<nd.SELECTED_ID.length;t++)nd.PLANE_USER_DATA[nd.SELECTED_ID[t]].gelType&&(nd.PLANE_USER_DATA[nd.SELECTED_ID[t]].hasItem=!1,nd.PLANE_USER_DATA[nd.SELECTED_ID[t]].itemName=null,nd.PLANE_USER_DATA[nd.SELECTED_ID[t]].gelType=null,e=nd.PLANE_USER_DATA[nd.SELECTED_ID[t]].portal?16777215:8421504,nd.PLANE_USER_DATA[nd.SELECTED_ID[t]].planeColor=e,nd.PLANE_LEVEL_INSTANCED.setColorAt(nd.SELECTED_ID[t],new vd(e)),-1<(e=nd.GELS.indexOf(nd.PLANE_USER_DATA[nd.SELECTED_ID[t]])))&&nd.GELS.splice(e,1)}),td()("body").on("click",".gel-type",function(){td()("#gel-type").find(".title").text("Gel type: "+td()(this).data("gel")),td()("#gel-type").data("gel",td()(this).data("gel")),td()("#gel-type").data("color",td()(this).data("color"))});class kS extends xd{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};super(e),this.isWater=!0;let n=this;var e=void 0!==t.textureWidth?t.textureWidth:512,i=void 0!==t.textureHeight?t.textureHeight:512;void 0!==t.clipBias&&t.clipBias;var r=void 0!==t.alpha?t.alpha:1,a=void 0!==t.time?t.time:0,o=void 0!==t.waterNormals?t.waterNormals:null,s=void 0!==t.sunDirection?t.sunDirection:new dd(.70707,.70707,0),l=new vd(void 0!==t.sunColor?t.sunColor:16777215),u=new vd(void 0!==t.waterColor?t.waterColor:8355711);let c=void 0!==t.eye?t.eye:new dd(0,0,0);var h=void 0!==t.distortionScale?t.distortionScale:20,d=void 0!==t.side?t.side:ke,t=void 0!==t.fog&&t.fog;new _A,new dd,new dd,new dd,new fd,new dd(0,0,-1),new cd,new dd,new dd,new cd;let p=new fd,f=(new fA,new nA(e,i));e={name:"MirrorShader",uniforms:$i.merge([N.fog,N.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:0},textureMatrix:{value:new fd},sunColor:{value:new vd(8355711)},sunDirection:{value:new dd(.70707,.70707,0)},eye:{value:new dd},waterColor:{value:new vd(5592405)}}]),vertexShader:`
				uniform mat4 textureMatrix;
				uniform float time;

				varying vec4 mirrorCoord;
				varying vec4 worldPosition;

				#include <common>
				#include <fog_pars_vertex>
				#include <shadowmap_pars_vertex>
				#include <logdepthbuf_pars_vertex>

				void main() {
					mirrorCoord = modelMatrix * vec4( position, 1.0 );
					worldPosition = mirrorCoord.xyzw;
					mirrorCoord = textureMatrix * mirrorCoord;
					vec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );
					gl_Position = projectionMatrix * mvPosition;

				#include <beginnormal_vertex>
				#include <defaultnormal_vertex>
				#include <logdepthbuf_vertex>
				#include <fog_vertex>
				#include <shadowmap_vertex>
			}`,fragmentShader:`
				uniform sampler2D mirrorSampler;
				uniform float alpha;
				uniform float time;
				uniform float size;
				uniform float distortionScale;
				uniform sampler2D normalSampler;
				uniform vec3 sunColor;
				uniform vec3 sunDirection;
				uniform vec3 eye;
				uniform vec3 waterColor;

				varying vec4 mirrorCoord;
				varying vec4 worldPosition;

				vec4 getNoise( vec2 uv ) {
					vec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);
					vec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );
					vec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );
					vec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );
					vec4 noise = texture2D( normalSampler, uv0 ) +
						texture2D( normalSampler, uv1 ) +
						texture2D( normalSampler, uv2 ) +
						texture2D( normalSampler, uv3 );
					return noise * 0.5 - 1.0;
				}

				void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {
					vec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );
					float direction = max( 0.0, dot( eyeDirection, reflection ) );
					specularColor += pow( direction, shiny ) * sunColor * spec;
					diffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;
				}

				#include <common>
				#include <packing>
				#include <bsdfs>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <lights_pars_begin>
				#include <shadowmap_pars_fragment>
				#include <shadowmask_pars_fragment>

				void main() {

					#include <logdepthbuf_fragment>
					vec4 noise = getNoise( worldPosition.xz * size );
					vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );

					vec3 diffuseLight = vec3(0.0);
					vec3 specularLight = vec3(0.0);

					vec3 worldToEye = eye-worldPosition.xyz;
					vec3 eyeDirection = normalize( worldToEye );
					sunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );

					float distance = length(worldToEye);

					vec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;
					vec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );

					float theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );
					float rf0 = 0.3;
					float reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );
					vec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;
					vec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);
					vec3 outgoingLight = albedo;
					gl_FragColor = vec4( outgoingLight, alpha );

					#include <tonemapping_fragment>
					#include <colorspace_fragment>
					#include <fog_fragment>	
				}`};let m=new Td({name:e.name,uniforms:$i.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,lights:!0,side:d,fog:t});m.uniforms.mirrorSampler.value=f.texture,m.uniforms.textureMatrix.value=p,m.uniforms.alpha.value=r,m.uniforms.time.value=a,m.uniforms.normalSampler.value=o,m.uniforms.sunColor.value=l,m.uniforms.waterColor.value=u,m.uniforms.sunDirection.value=s,m.uniforms.distortionScale.value=h,m.uniforms.eye.value=c,n.material=m;n.onBeforeRender=function(e,t,n){nd.FPS_MODE}}}var i0=[],r0=[],a0=[];let Nc=function(t){r0=[],a0=[],function e(t){var n=Zg(t.position.x+1+"/"+(t.position.y+1)+"/"+t.position.z);0==n.length&&(t.hasGoo=!0,r0.includes(t.position)||(r0.push(t.position),a0.push(t.id_instanced)),0<(i=Zg(t.position.x+2+"/"+t.position.y+"/"+t.position.z)).length)&&(a0.includes(i[0].id_instanced)||e(i[0]));n=Zg(t.position.x-1+"/"+(t.position.y+1)+"/"+t.position.z);0==n.length&&(t.hasGoo=!0,r0.includes(t.position)||(r0.push(t.position),a0.push(t.id_instanced)),0<(i=Zg(t.position.x-2+"/"+t.position.y+"/"+t.position.z)).length)&&(a0.includes(i[0].id_instanced)||e(i[0]));n=Zg(t.position.x+"/"+(t.position.y+1)+"/"+(t.position.z+1));0==n.length&&(t.hasGoo=!0,r0.includes(t.position)||(r0.push(t.position),a0.push(t.id_instanced)),0<(i=Zg(t.position.x+"/"+t.position.y+"/"+(t.position.z+2))).length)&&(a0.includes(i[0].id_instanced)||e(i[0]));n=Zg(t.position.x+"/"+(t.position.y+1)+"/"+(t.position.z-1));{var i;0==n.length&&(t.hasGoo=!0,r0.includes(t.position)||(r0.push(t.position),a0.push(t.id_instanced)),0<(i=Zg(t.position.x+"/"+t.position.y+"/"+(t.position.z-2))).length)&&(a0.includes(i[0].id_instanced)||e(i[0]))}}(t);var e,n,i=new EA(2,2),r=[];for(let e=0;e<r0.length;e++){var a,o=new fd,s=((a=new gd).rotation.set(0,0,0),a.rotation.x=-Math.PI/2,a.position.copy(r0[e]),a.translateZ(1.79),a.updateMatrix(),o.compose(a.position,a.quaternion,a.scale),i.clone()),o=(s.applyMatrix4(o),new xd(i.clone(),new _d));o.rotation.set(0,0,0),o.rotation.x=-Math.PI/2,o.position.copy(r0[e]),o.translateZ(1);(l=new pd).setFromObject(o);var l,o=(l.min.y+l.max.y)/2;l.min.y=o-.75,l.max.y=.75+o,l.idPlane=t.id_instanced,nd.GOO_BOXES.push(l),r.push(s)}(e=0<r.length?e0(r):(e=new fd,(a=new gd).rotation.set(0,0,0),a.rotation.x=-Math.PI/2,a.position.copy(t.position),a.translateZ(1.79),a.updateMatrix(),e.compose(a.position,a.quaternion,a.scale),(n=i.clone()).applyMatrix4(e),n)).computeBoundingBox(),Xv=new xd(e,new Ox({color:new vd(8142592),envMap:nd.ENV_MAP,roughness:.2,transparent:!0,opacity:.8})),0==r.length&&((l=new pd).setFromObject(Xv),n=(l.min.y+l.max.y)/2,l.min.y=n-.75,l.max.y=.75+n,l.idPlane=t.id_instanced,nd.GOO_BOXES.push(l)),qv=new kS(e,{textureWidth:512,textureHeight:512,waterNormals:(new wd).load("assets/textures/waternormals.jpg",function(e){e.wrapS=e.wrapT=H}),sunDirection:new dd,sunColor:16777215,waterColor:7695,distortionScale:.2,alpha:.8}),i0.push(qv),qv.updateMatrixWorld(),qv.material.transparent=!0,nd.SCENE_CHILDREN.add(qv),nd.SCENE_CHILDREN.add(Xv),t.item.lava=Xv,t.item.water=qv,t.item.ids=a0,nd.GOO_PLANES.push(t)};function o0(){if(qv)for(var e=0;e<i0.length;e++)i0[e].material.uniforms.time.value+=5e-4}function s0(){for(var e=0;e<nd.TRACTOR_BEAM_RAYCASTER.length;e++)t_("tractor_beam",nd.TRACTOR_BEAM_RAYCASTER[e],nd.TRACTOR_BEAM_RAYCASTER[e].item,null,!0,e);for(e=0;e<nd.LIGHT_BRIDGE_RAYCASTER.length;e++)t_("light_bridge",nd.LIGHT_BRIDGE_RAYCASTER[e],nd.LIGHT_BRIDGE_RAYCASTER[e].item,null,!0,e),i_(nd.LIGHT_BRIDGE_RAYCASTER[e].item,nd.LIGHT_BRIDGE_RAYCASTER[e].item.userData.triggers,td()("#light-bridge-trigger"),"light_bridge");for(e=0;e<nd.LASER_FIELD_RAYCASTER.length;e++)t_("laser_field",nd.LASER_FIELD_RAYCASTER[e],nd.LASER_FIELD_RAYCASTER[e].item,nd.ITEMS_ADDED.getObjectByName("laser_field"),!0,e),i_(nd.LASER_FIELD_RAYCASTER[e].item,nd.LASER_FIELD_RAYCASTER[e].item.userData.triggers,td()("#laser-field-trigger"),"laser_field");for(e=0;e<nd.FIZZLER_RAYCASTER.length;e++)t_("fizzler",nd.FIZZLER_RAYCASTER[e],nd.FIZZLER_RAYCASTER[e].item,nd.ITEMS_ADDED.getObjectByName("fizzler"),!0,e),i_(nd.FIZZLER_RAYCASTER[e].item,nd.FIZZLER_RAYCASTER[e].item.userData.triggers,td()("#fizzler-trigger"),"fizzler");for(e=0;e<nd.GLASS_RAYCASTER.length;e++)t_("glass",nd.GLASS_RAYCASTER[e],nd.GLASS_RAYCASTER[e].item,null,!0,e),i_(nd.GLASS_RAYCASTER[e].item,nd.GLASS_RAYCASTER[e].item.userData.triggers,td()("#glass-trigger"),"glass");for(e=0;e<nd.LASER_EMITTER_RAYCASTER.length;e++)Uv(nd.LASER_EMITTER_RAYCASTER[e].item,!0,nd.LASER_EMITTER_RAYCASTER[e],e);var t=new pd;t.setFromObject(nd.EXIT_DOOR.getObjectByName("trigger")),nd.EXIT_DOOR.bb=t,nd.EXIT_DOOR.add(nd.EXIT_DOOR.getObjectByName("trigger")),(t=new pd).setFromObject(nd.ENTER_DOOR.getObjectByName("trigger")),nd.ENTER_DOOR.bb=t,nd.ENTER_DOOR.add(nd.ENTER_DOOR.getObjectByName("trigger")),nd.ENTER_DOOR.getObjectByName("trigger").material.color=new vd(65280),nd.EXIT_DOOR.getObjectByName("trigger").material.color=new vd(65280);for(var n=0;n<nd.BOUNDING_BOX.length;n++)nd.BOUNDING_BOX[n].platform.material.color=new vd(65280);window.allowTest=!0;for(e=0;e<nd.PLANE_USER_DATA.length;e++)if(nd.PLANE_USER_DATA[e].exists){nd.ENTER_DOOR.bb.containsPoint(nd.PLANE_USER_DATA[e].position)&&(nd.ENTER_DOOR.getObjectByName("trigger").material.color=new vd(16711680),window.allowTest=!1),nd.EXIT_DOOR.bb.containsPoint(nd.PLANE_USER_DATA[e].position)&&(nd.EXIT_DOOR.getObjectByName("trigger").material.color=new vd(16711680),window.allowTest=!1);for(n=0;n<nd.BOUNDING_BOX.length;n++)nd.BOUNDING_BOX[n].containsPoint(nd.PLANE_USER_DATA[e].position)&&("piston_platforms"==nd.BOUNDING_BOX[n].platform.name?!nd.PLANE_USER_DATA[e].hasItem&&"up"!=nd.PLANE_USER_DATA[e].side||(nd.BOUNDING_BOX[n].platform.material.color=new vd(16711680),window.allowTest=!1):"track_platforms"==nd.BOUNDING_BOX[n].platform.name&&("front"==nd.BOUNDING_BOX[n].platform.side||"back"==nd.BOUNDING_BOX[n].platform.side?!nd.PLANE_USER_DATA[e].hasItem&&"right"!=nd.PLANE_USER_DATA[e].side&&"left"!=nd.PLANE_USER_DATA[e].side||(nd.BOUNDING_BOX[n].platform.material.color=new vd(16711680),window.allowTest=!1):"left"!=nd.BOUNDING_BOX[n].platform.side&&"right"!=nd.BOUNDING_BOX[n].platform.side||!nd.PLANE_USER_DATA[e].hasItem&&"front"!=nd.PLANE_USER_DATA[e].side&&"back"!=nd.PLANE_USER_DATA[e].side||(nd.BOUNDING_BOX[n].platform.material.color=new vd(16711680),window.allowTest=!1)))}for(e=0;e<nd.PLANE_USER_DATA.length;e++)if(nd.PLANE_USER_DATA[e].exists&&nd.PLANE_USER_DATA[e].hasItem&&nd.PLANE_USER_DATA[e].hasGoo){var i=nd.PLANE_USER_DATA[e].item;if(i.ids){nd.SCENE_CHILDREN.remove(i.water),nd.SCENE_CHILDREN.remove(i.lava);for(n=0;n<i.ids.length;n++)nd.PLANE_USER_DATA[i.ids[n]].hasGoo=!1;for(var r,n=nd.GOO_BOXES.length-1;0<=n;n--)nd.GOO_BOXES[n].idPlane==nd.PLANE_USER_DATA[e].id_instanced&&-1<(r=nd.GOO_BOXES.indexOf(nd.GOO_BOXES[n]))&&nd.GOO_BOXES.splice(r,1);var a=nd.PLANE_USER_DATA[e];a.hasItem=!0,a.itemName="goo",a.item=i,Nc(a)}}}function l0(e,t){var n=t.item.platformBox,e=(n.parent.scale.y=e,t.item.userData.scaleY=e,nd.BOUNDING_BOX.indexOf(n.bb)),e=(-1<e&&nd.BOUNDING_BOX.splice(e,1),new pd);e.setFromObject(n.parent),e.name=t.itemName,(n.bb=e).platform=n,nd.BOUNDING_BOX.push(e)}function u0(e,t,n){var n=nd.ITEMS_ADDED.getObjectByName(n),i=new gd;i.position.copy(e.initialPosition),i.quaternion.copy(e.quaternion),i.updateMatrix(),n.setMatrixAt(t,i.matrix),n.instanceMatrix.needsUpdate=!0,n.computeBoundingSphere()}window.allowTest=!0,td()("body").on("change","#piston-max-height",function(){l0(td()(this).val(),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]]),s0()}),td()("body").on("change","#state-piston",function(){nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.isActive=this.checked}),td()("body").on("change","#state-piston-loop",function(){nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.loop=this.checked});let Ic=new Map;function c0(e){var{body:e,target:t}=e;Ic.has(t)||Ic.set(t,new Set),Ic.get(t).add(e.id),t.bodiesInContact.includes(e)||t.bodiesInContact.push(e)}function h0(){nd.PLATFORM_BODIES.forEach(e=>{{var r=e;let i=Ic.get(r);if(i){let n=new Set;nd.CANNON_WORLD.contacts.forEach(e=>{e.bi!==r&&e.bj!==r||!i.has(e.bi.id)&&!i.has(e.bj.id)||(e=(e.bi===r?e.bj:e.bi).id,n.add(e))}),i.forEach(t=>{n.has(t)||(console.log(`Body ${t} is no longer colliding with the platform`),i.delete(t),r.bodiesInContact.forEach(e=>{e.id==t&&-1<(e=r.bodiesInContact.indexOf(e))&&r.bodiesInContact.splice(e,1)}))}),0===i.size&&Ic.delete(r)}}})}let g=new ed.World;g.quatNormalizeSkip=0,g.quatNormalizeFast=!1;var Gv=new ed.GSSolver,d0=(g.defaultContactMaterial.contactEquationStiffness=1e9,g.defaultContactMaterial.contactEquationRelaxation=4,Gv.iterations=10,Gv.tolerance=.1,g.solver=new ed.SplitSolver(Gv),g.gravity.set(0,-9.8,0),g.allowSleep=!1,g.broadphase=new ed.NaiveBroadphase,!1),p0=!0;let Cc,Lc,Dc=(vg=new ed.Sphere(.1),(Cc=new ed.Body({mass:0})).addShape(vg),Cc.collisionFilterGroup=0,Cc.collisionFilterMask=0,g.addBody(Cc),Qh=new EA(100,100),new xd(Qh,new _d).visible=!1,new function(d,e,t){let{color:n=65280,scale:p=1,onInit:c,onUpdate:h}=void 0===t?{}:t,f=[],m=new _d({color:null!=n?n:65280,wireframe:!0}),g=new Rd,v=new Rd,_=new Rd,y=new OT,E=new Rx(1),A=new dA(1,1,1),x=new EA(10,10,10,10);function T(e){let t=new xd;var{SPHERE:n,BOX:i,PLANE:r,CYLINDER:a,CONVEXPOLYHEDRON:o,TRIMESH:s,HEIGHTFIELD:l}=Nd.types;switch(e.type){case n:t=new xd(E,m);break;case i:t=new xd(A,m);break;case r:t=new xd(x,m);break;case a:var u=new vx(e.radiusTop,e.radiusBottom,e.height,e.numSegments);t=new xd(u,m),e.geometryId=u.id;break;case o:u=(t=>{var e=new Ad,n=[];for(let e=0;e<t.vertices.length;e++){var i=t.vertices[e];n.push(i.x,i.y,i.z)}e.setAttribute("position",new Ed(n,3));var r=[];for(let e=0;e<t.faces.length;e++){var a=t.faces[e],o=a[0];for(let e=1;e<a.length-1;e++){var s=a[e],l=a[e+1];r.push(o,s,l)}}return e.setIndex(r),e.computeBoundingSphere(),e.computeVertexNormals(),e})(e);t=new xd(u,m),e.geometryId=u.id;break;case s:u=(t=>{var e=new Ad,n=[],i=g,r=v,a=_;for(let e=0;e<t.indices.length/3;e++)t.getTriangleVertices(e,i,r,a),n.push(i.x,i.y,i.z),n.push(r.x,r.y,r.z),n.push(a.x,a.y,a.z);return e.setAttribute("position",new Ed(n,3)),e.computeBoundingSphere(),e.computeVertexNormals(),e})(e);t=new xd(u,m),e.geometryId=u.id;break;case l:u=(n=>{var e=new Ad;let i=n.elementSize||1;var t=n.data.flatMap((e,n)=>e.flatMap((e,t)=>[n*i,t*i,e])),r=[];for(let t=0;t<n.data.length-1;t++)for(let e=0;e<n.data[t].length-1;e++){var a=n.data[t].length,o=t*a+e;r.push(o+1,o+a,o+a+1),r.push(o+a,o+1,o)}return e.setIndex(r),e.setAttribute("position",new Ed(t,3)),e.computeBoundingSphere(),e.computeVertexNormals(),e})(e);t=new xd(u,m),e.geometryId=u.id}return d.add(t),t}function S(e,t){let n=f[e],i=!1;((e,t)=>e&&((e=e.geometry)instanceof Rx&&t.type===Nd.types.SPHERE||e instanceof dA&&t.type===Nd.types.BOX||e instanceof EA&&t.type===Nd.types.PLANE||e.id===t.geometryId&&t.type===Nd.types.CYLINDER||e.id===t.geometryId&&t.type===Nd.types.CONVEXPOLYHEDRON||e.id===t.geometryId&&t.type===Nd.types.TRIMESH||e.id===t.geometryId&&t.type===Nd.types.HEIGHTFIELD))(n,t)||(n&&d.remove(n),f[e]=n=T(t),i=!0);var r=n,a=t,{SPHERE:e,BOX:t,PLANE:o,CYLINDER:s,CONVEXPOLYHEDRON:l,TRIMESH:u,HEIGHTFIELD:c}=Nd.types;switch(a.type){case e:var h=a.radius;r.scale.set(h*p,h*p,h*p);break;case t:r.scale.copy(a.halfExtents),r.scale.multiplyScalar(2*p);break;case o:break;case s:case l:r.scale.set(+p,+p,+p);break;case u:r.scale.copy(a.scale).multiplyScalar(p);break;case c:r.scale.set(+p,+p,+p)}return i}return x.translate(0,0,1e-4),{update:function(){var t,n=f,i=g,r=y;let a=0;for(t of e.bodies)for(let e=0;e!==t.shapes.length;e++){var o=t.shapes[e],s=S(a,o),l=n[a];l&&(t.quaternion.vmult(t.shapeOffsets[e],i),t.position.vadd(i,i),t.quaternion.mult(t.shapeOrientations[e],r),l.position.copy(i),l.quaternion.copy(r),s&&c instanceof Function&&c(t,l,o),!s)&&h instanceof Function&&h(t,l,o),a++}for(let e=a;e<n.length;e++){var u=n[e];u&&d.remove(u)}n.length=a}}}(nd.DEBUGGER_GROUP,g,{onInit(e,t){t.visible=!1,td()("body").on("input","#debug-input",function(){p0=this.checked,t.visible=this.checked})}}));var f0=new dd,m0=new yT,g0=!0;function v0(e){for(var t=0;t<nd.CUSTOM_GRAVITY.length;t++){var n=nd.CUSTOM_GRAVITY[t].customGravity,i=nd.CUSTOM_GRAVITY[t],n=new(ym().Vec3)(n.x-nd.CANNON_WORLD.gravity.x,n.y-nd.CANNON_WORLD.gravity.y,n.z-nd.CANNON_WORLD.gravity.z),n=new(ym().Vec3)(n.x*i.mass,n.y*i.mass,n.z*i.mass);i.applyForce(n,i.position)}for(var r,a,o,s,l,u,c=0;c<Hv.length;c++)Hv[c].position.copy(Hv[c].body.position),Hv[c].quaternion.copy(Hv[c].body.quaternion);for(u in nd.HOLDING_ITEM&&(r=new dd,nd.MAIN_CAMERA.getObjectByName("cubeHolder").getWorldPosition(r),a=!1,m0.setFromCamera(f0,nd.MAIN_CAMERA),null!=nd.PORTAL_INNER_BOX[0]&&null!=nd.PORTAL_INNER_BOX[1]&&0<(o=m0.intersectObjects(nd.PORTAL_INNER_BOX)).length&&o[0].distance<1.25&&(a=!0),0<(o=m0.intersectObject(nd.PLANE_LEVEL_INSTANCED)).length&&o[0].distance<1.25&&!a&&(l=o[0].point,s=new dd(0,0,-1).applyMatrix4(nd.MAIN_CAMERA.matrixWorld).sub(nd.MAIN_CAMERA.position).normalize(),l.add(s.clone().multiplyScalar(-nd.CURRENT_ITEM.body.offset)),nd.CURRENT_ITEM.body.position.copy(r=l)),0<(o=m0.intersectObjects(window.glass)).length&&o[0].distance<1.25&&!a&&(l=o[0].point,s=new dd(0,0,-1).applyMatrix4(nd.MAIN_CAMERA.matrixWorld).sub(nd.MAIN_CAMERA.position).normalize(),l.add(s.clone().multiplyScalar(-nd.CURRENT_ITEM.body.offset)),r=l,nd.CURRENT_ITEM.body.position.copy(l)),d0||(d0=!0,a=r,(o=nd.CURRENT_ITEM.body).position.copy(a),s=(new ed.Vec3).copy(a).vsub(o.position),l=(l=o.quaternion.inverse()).vmult(s),Cc.position.copy(a),Lc=new ed.PointToPointConstraint(o,l,Cc,new ed.Vec3(0,0,0)),g.addConstraint(Lc)),a=r,Cc.position.copy(a),nd.CURRENT_ITEM.body.quaternion.copy(nd.PLAYER.quaternion),Lc.update()),g0&&(()=>{if(nd.LEVEL_ENTERED){for(var e=0;e<nd.DYMANIC_ITEMS.laser_cube.length;e++)0!=nd.DYMANIC_ITEMS.laser_cube[e].length&&(nd.DYMANIC_ITEMS.laser_cube[e].body.laser.active=!1);for(var t=0;t<nd.LASER_TRIGGERS.length;t++)nd.LASER_TRIGGERS[t].emitterState=!1;for(t=0;t<nd.LASER_EMITTER_RAYCASTER.length;t++){nd.LASER_EMITTER_RAYCASTER[t].laser.clone.visible=!1;var n=nd.LASER_EMITTER_RAYCASTER[t].intersectObject(nd.PLANE_LEVEL_INSTANCED);0<n.length&&(nd.LASER_EMITTER_RAYCASTER[t].laser.scale.y=n[0].distance);for(var n=[nd.ITEMS_ADDED.getObjectByName("laser_cube"),nd.ITEMS_ADDED.getObjectByName("cube"),nd.ITEMS_ADDED.getObjectByName("sphere"),nd.ITEMS_ADDED.getObjectByName("cube_2"),nd.ITEMS_ADDED.getObjectByName("scale_cube"),nd.ITEMS_ADDED.getObjectByName("laser_receiver"),nd.ITEMS_ADDED.getObjectByName("laser_relay")].filter(function(e){return null!=e}),i=nd.LASER_EMITTER_RAYCASTER[t].intersectObjects(n),r=!1,e=0;e<i.length;e++)if("laser_receiver"==i[e].object.name?(nd.DYMANIC_ITEMS.laser_receiver[i[e].instanceId].emitterState=!0,nd.DYMANIC_ITEMS.laser_receiver[i[e].instanceId].fromLaserCube=!1,Dv(nd.DYMANIC_ITEMS.laser_receiver[i[e].instanceId],!0,!1)):"laser_relay"==i[e].object.name&&(nd.DYMANIC_ITEMS.laser_relay[i[e].instanceId].emitterState=!0,nd.DYMANIC_ITEMS.laser_relay[i[e].instanceId].fromLaserCube=!1,Dv(nd.DYMANIC_ITEMS.laser_relay[i[e].instanceId],!0,!1)),"laser_cube"==i[e].object.name&&(nd.DYMANIC_ITEMS.laser_cube[i[e].instanceId].body.laser.active=!0),"laser_relay"!=i[e].object.name){nd.LASER_EMITTER_RAYCASTER[t].laser.scale.y=i[e].distance,r=!0;break}if(!r){if(null===nd.PORTALS[0]||null===nd.PORTALS[1])return;var a=nd.LASER_EMITTER_RAYCASTER[t].intersectObjects(nd.PORTAL_SHADER);if(0<a.length)for(var o,s,l="portal-0"==a[0].object.name?1:0,u=new dd,c=(nd.PORTAL_SHADER[l].getWorldDirection(u),Fv.set(nd.PORTAL_SHADER[l].position,u),Fv.intersectObject(nd.PLANE_LEVEL_INSTANCED)),h=(0<c.length&&(nd.LASER_EMITTER_RAYCASTER[t].laser.clone.scale.y=c[0].distance,nd.LASER_EMITTER_RAYCASTER[t].laser.clone.position.copy(nd.PORTAL_SHADER[l].position),nd.LASER_EMITTER_RAYCASTER[t].laser.clone.rotation.copy(nd.PORTAL_SHADER[l].rotation),nd.LASER_EMITTER_RAYCASTER[t].laser.clone.translateY(1.8*(a[0].uv.y-.5)),nd.LASER_EMITTER_RAYCASTER[t].laser.clone.translateX(-.9*(a[0].uv.x-.5)),nd.LASER_EMITTER_RAYCASTER[t].laser.clone.rotateX(Math.PI/2),nd.LASER_EMITTER_RAYCASTER[t].laser.clone.visible=!0),Fv.set(nd.LASER_EMITTER_RAYCASTER[t].laser.clone.position,u),Fv.intersectObjects(n)),e=0;e<h.length;e++)if("laser_receiver"==h[e].object.name?(nd.DYMANIC_ITEMS.laser_receiver[h[e].instanceId].fromLaserCube=!1,nd.DYMANIC_ITEMS.laser_receiver[h[e].instanceId].emitterState=!0,Dv(nd.DYMANIC_ITEMS.laser_receiver[h[e].instanceId],!0,!1)):"laser_relay"==h[e].object.name&&(nd.DYMANIC_ITEMS.laser_relay[h[e].instanceId].fromLaserCube=!1,nd.DYMANIC_ITEMS.laser_relay[h[e].instanceId].emitterState=!0,Dv(nd.DYMANIC_ITEMS.laser_relay[h[e].instanceId],!0,!1)),"laser_cube"!=h[e].object.name||(o=nd.DYMANIC_ITEMS.laser_cube[h[e].instanceId]).body.laser.active||(o.body.laser.active=!0,(s=new gd).position.copy(o.body.position),s.quaternion.copy(o.body.quaternion),zv(s,o.body.laser)),nd.LASER_EMITTER_RAYCASTER[t].laser.clone.visible=!0,"laser_relay"!=h[e].object.name){nd.LASER_EMITTER_RAYCASTER[t].laser.clone.scale.y=h[e].distance;break}}}for(t=0;t<nd.LASER_TRIGGERS.length;t++)nd.LASER_TRIGGERS[t].emitterState||nd.LASER_TRIGGERS[t].fromLaserCube||Dv(nd.LASER_TRIGGERS[t],!1,!1)}})(),nd.DYMANIC_ITEMS){var h=nd.ITEMS_ADDED.getObjectByName(u);if("gel_gun_blue"!=u&&"gel_gun_orange"!=u&&"gel_gun_white"!=u&&"pedestal_button"!=u&&"button_weight"!=u&&"button_box"!=u&&"button_sphere"!=u&&"dispenser"!=u&&"ramp"!=u&&"ramp_half"!=u&&"ramp_half2"!=u&&"stairs"!=u&&"light_bridge"!=u&&"laser_emitter"!=u&&"angled_panel"!=u&&"door"!=u&&"light"!=u&&"stripe"!=u&&"gel_blue"!=u&&"gel_orange"!=u&&"laser_field"!=u&&"fizzler"!=u&&"portal_0"!=u&&"portal_1"!=u&&"pellet_launcher"!=u&&"gel_recharger"!=u&&"gel_white"!=u&&"gel_clear"!=u&&"gel_reflection"!=u&&"pellet_catcher"!=u&&"faith_plate"!=u&&"gel_purple"!=u&&"bed"!=u&&"toilet"!=u&&"desk"!=u&&"cabinet"!=u&&"sign"!=u&&"incinerator"!=u&&"step"!=u)for(var d,p=0;p<nd.DYMANIC_ITEMS[u].length;p++)0!=nd.DYMANIC_ITEMS[u][p].length&&(nd.DYMANIC_ITEMS[u][p].body&&nd.DYMANIC_ITEMS[u][p].body.sound&&(nd.DYMANIC_ITEMS[u][p].body.sound.position.copy(nd.DYMANIC_ITEMS[u][p].body.position),nd.DYMANIC_ITEMS[u][p].body.sound.quaternion.copy(nd.DYMANIC_ITEMS[u][p].body.quaternion)),"piston_platforms"==u||"track_platforms"==u?((e,t,n,i)=>{var r,a,o,s,l;e.body&&e.userData.isActive&&0!=e.platformBox.parent.scale.y?!e.userData.loop&&e.body.pistonDown||(r=e.body.pistonDown?-.7*i:.7*i,a="y",o=new ed.Vec3(0,1,0),"track_platforms"==e.platformBox.name?(s="front"==e.platformBox.side||"back"==e.platformBox.side?(a="x",o=new ed.Vec3(1,0,0),new dd(e.body.position.x,e.initialPosition.y,e.initialPosition.z)):(a="z",o=new ed.Vec3(0,0,1),new dd(e.initialPosition.x,e.initialPosition.y,e.body.position.z)),e.platformBox.parent.scale.y<0&&(r*=-1)):s=e.body.position,e.body.position[a]+=r,0<e.platformBox.parent.scale.y?e.body.position[a]>e.initialPosition[a]+2*e.platformBox.parent.scale.y?e.body.pistonDown=!0:e.body.position[a]<=e.initialPosition[a]&&(e.body.pistonDown=!1):e.body.position[a]<e.initialPosition[a]+2*e.platformBox.parent.scale.y?e.body.pistonDown=!0:e.body.position[a]>=e.initialPosition[a]&&(e.body.pistonDown=!1),(l=new gd).quaternion.copy(e.body.quaternion),l.position.copy(s),l.updateMatrix(),t.setMatrixAt(n,l.matrix),t.instanceMatrix.needsUpdate=!0,t.computeBoundingSphere(),e.body.bodiesInContact.forEach(e=>{var t=new ed.Vec3(r*o.x,r*o.y,r*o.z);e.position.vadd(t,e.position)})):e.body&&!e.userData.isActive&&0!=e.platformBox.parent.scale.y&&e.body.pistonDown&&!e.userData.loop&&(r=-.7*i,a="y",o=new ed.Vec3(0,1,0),"track_platforms"==e.platformBox.name?(s="front"==e.platformBox.side||"back"==e.platformBox.side?(a="x",o=new ed.Vec3(1,0,0),new dd(e.body.position.x,e.initialPosition.y,e.initialPosition.z)):(a="z",o=new ed.Vec3(0,0,1),new dd(e.initialPosition.x,e.initialPosition.y,e.body.position.z)),e.platformBox.parent.scale.y<0&&(r*=-1)):s=e.body.position,e.body.position[a]+=r,0<e.platformBox.parent.scale.y?e.body.position[a]>e.initialPosition[a]+2*e.platformBox.parent.scale.y?e.body.pistonDown=!0:e.body.position[a]<=e.initialPosition[a]&&(e.body.pistonDown=!1):e.body.position[a]<e.initialPosition[a]+2*e.platformBox.parent.scale.y?e.body.pistonDown=!0:e.body.position[a]>=e.initialPosition[a]&&(e.body.pistonDown=!1),(l=new gd).quaternion.copy(e.body.quaternion),l.position.copy(s),l.updateMatrix(),t.setMatrixAt(n,l.matrix),t.instanceMatrix.needsUpdate=!0,t.computeBoundingSphere(),e.body.bodiesInContact.forEach(e=>{var t=new ed.Vec3(r*o.x,r*o.y,r*o.z);e.position.vadd(t,e.position)}))})(nd.DYMANIC_ITEMS[u][p],h,p,e):"tractor_beam"==u||"laser_receiver"==u||"laser_relay"==u?nd.DYMANIC_ITEMS[u][p].userData.state&&("tractor_beam"==u?_0(h,nd.DYMANIC_ITEMS[u][p],p,.05):"laser_receiver"!=u&&"laser_relay"!=u||_0(h,nd.DYMANIC_ITEMS[u][p],p,-.075)):((d=new gd).position.copy(nd.DYMANIC_ITEMS[u][p].body.position),d.quaternion.copy(nd.DYMANIC_ITEMS[u][p].body.quaternion),d.updateMatrix(),h.setMatrixAt(p,d.matrix),h.instanceMatrix.needsUpdate=!0,h.computeBoundingSphere(),"laser_cube"==u&&g0&&zv(d,nd.DYMANIC_ITEMS[u][p].body.laser)))}for(p=0;p<nd.LASER_TRIGGERS.length;p++)!nd.LASER_TRIGGERS[p].emitterState&&nd.LASER_TRIGGERS[p].fromLaserCube&&Dv(nd.LASER_TRIGGERS[p],!1);for(p=0;p<nd.CAMERAS.length;p++)nd.CAMERAS[p].fixed||(nd.CAMERAS[p].position.copy(nd.CAMERAS[p].body.position),nd.CAMERAS[p].quaternion.copy(nd.CAMERAS[p].body.quaternion),nd.CAMERAS[p].cube.position.copy(nd.CAMERAS[p].body.position),nd.CAMERAS[p].cube.quaternion.copy(nd.CAMERAS[p].body.quaternion));p0&&Dc.update(),nd.HOLDING_ITEM?g0=!0:g0&&(g0=!1,setTimeout(()=>{g0=!0},100))}function _0(e,t,n,i){var r=new dd,r=(r.copy(t.up).applyQuaternion(t.quaternion),t.userData.reversed&&(i=-i),1==Math.round(Math.abs(r.z))?t.rotation.y+=i:1==Math.round(Math.abs(r.x))?t.rotation.x+=i:1==Math.round(Math.abs(r.y))&&(t.rotation.y+=i),new gd);r.position.copy(t.position),r.rotation.copy(t.rotation),r.updateMatrix(),e.setMatrixAt(n,r.matrix),e.instanceMatrix.needsUpdate=!0,e.computeBoundingSphere()}function y0(){g.removeConstraint(Lc),Lc=void 0,d0=!1,Cc.position.set(1e4,1e3,1e3)}nd.CANNON_WORLD=g;var E0=!1;function A0(e,t){var n=(new fd).makeScale(-1,-1,1),n=t.CDBB.inverse_t.clone().premultiply(n).premultiply(t.output.CDBB.t);e.applyMatrix4(n)}function x0(e,t){return Math.sqrt(2*t*e)}function T0(e,t){var n=(new fd).makeScale(-1,-1,1),n=t.CDBB.inverse_t.clone().premultiply(n).premultiply(t.output.CDBB.t);return iv(nv(e).applyMatrix4(n))}function S0(e,t){var n=(new fd).makeScale(-1,-1,1),i=new fd,r=(i.extractRotation(t.CDBB.inverse_t),new fd),t=(r.extractRotation(t.output.CDBB.t),i.clone().premultiply(n).premultiply(r));return iv(nv(e).applyMatrix4(t))}function w0(){var e=tv(nd.PLAYER.position);if(nd.PIVOT.position.copy(e),nd.PLAYER.PURPLE_CONTACT?nd.PIVOT.translateY(.3):nd.PIVOT.position.y+=.3,nd.GUN.position.copy(nd.PIVOT.position),nd.PORTAL_GUN_CAMERA.position.copy(nd.PIVOT.position),nd.PORTAL_GUN_CAMERA.quaternion.copy(nd.PIVOT.quaternion),E0&&(E0=!1,nd.PLAYER_MODEL.visible=!0),null!==nd.PORTALS[0]&&null!==nd.PORTALS[1]){for(var t,n,i,r,a=0,o=0;o<nd.CAMERAS.length;o++)(nd.CAMERAS[o].box3.containsPoint(nd.PORTAL_BOX[0].position)||nd.CAMERAS[o].box3.containsPoint(nd.PORTAL_BOX[1].position))&&nd.CAMERAS[o].fixed&&(nd.CAMERAS[o].fixed=!1,i=n=t=void 0,t=nd.CAMERAS[o],(n=new ed.Material).friction=.4,n.restitution=0,i=new ed.Box(new ed.Vec3(.15,.25,.25)),i=new ed.Body({shape:i,mass:5,material:n}),nd.CANNON_BODIES.push(i),i.position.copy(t.cube.position),i.quaternion.copy(t.quaternion),i.collisionFilterGroup=nd.CGROUP_DYNAMIC,i.collisionFilterMask=nd.CGROUP_ALL,i.offset=.2,t.body=i,t.cube.body=i,t.name="camera",i.name="camera",i.item=t,nd.DYNAMIC_OBJECTS.push(i),nd.CANNON_WORLD.addBody(i),nd.INTERACTIVE.push(t.cube),(n=t.clone()).visible=!1,nd.SCENE_FPS.add(n),i.clone=n);for(r of nd.DYNAMIC_OBJECTS){var s,l=new dd(r.position.x,r.position.y,r.position.z);if(r.centering&&!r.centered&&((s=tv(r.position)).lerp(r.newPosition,.1),s.y=r.position.y,r.position.copy(s),s.x==r.newPosition.x)&&s.z==r.newPosition.z&&(r.centered=!0),r.collisionFilterMask=nd.CGROUP_ALL,r.inArea=!1,null!==nd.PORTALS[0]&&null!==nd.PORTALS[1]){0==a?(nd.PLAYER_MODEL_CLONE.visible=!1,nd.GUN_CLONE.visible=!1,nd.GUN_CLONE2.visible=!1):(r.clone.visible=!1,r.clone.position.copy(r.position),r.clone.quaternion.copy(r.quaternion));let e=!1;for(let n=0;n<nd.PORTALS.length;n++)if(nd.PORTALS[n].CDBB.containsPoint(l)&&("player"!=r.name&&r.wakeUp(),r.collisionFilterMask&=~nd.PORTALS[n].hostObjects.collisionFilterGroup,r.inArea=!0,0==a?(0==n||0<n&&!e)&&(e=!0,A0(nd.PLAYER_MODEL_CLONE,nd.PORTALS[n]),nd.PLAYER_MODEL_CLONE.visible=!0,nd.PLAYER_MODEL_CLONE.traverse(e=>{var t;e.isBone&&"wrist_R"==e.name&&(t=new dd,e.getWorldPosition(t),window.posW=t)})):(0==n||0<n&&!e)&&(e=!0,A0(r.clone,nd.PORTALS[n]),r.clone.visible=!0)),nd.PORTALS[n].STBB.containsPoint(l)){if(!r.holding){{u=void 0;c=void 0;h=void 0;d=void 0;p=void 0;f=void 0;var u=r;var c=nd.PORTALS[n];var h=(new fd).makeScale(-1,-1,1),h=c.CDBB.inverse_t.clone().premultiply(h).premultiply(c.output.CDBB.t);let e=tv(u.position);var d=tv(u.position);let t=tv(u.velocity);1==Math.abs(nd.PORTALS[0].normal.y)&&1==Math.abs(nd.PORTALS[1].normal.y)&&nd.PORTALS[0].normal.y!=nd.PORTALS[1].normal.y&&(f=c.portalShader.position,p=c.output.portalShader.position,f=f.y-p.y,u.heightDifference&&u.looping2&&u.heightDifference!=f&&(u.looping2=!1,u.looping=!1,u.centered=!1,u.centering=!1),u.looping2?t.y=-x0(Math.abs(u.heightDifference),9.8):1==u.looping?(u.looping2=!0,t.y=-x0(Math.abs(f),9.8),u.heightDifference=f):u.looping=!0);var p=tv(u.force),f=(new hd).copy(u.quaternion),h=(new hd).setFromRotationMatrix(h);f.premultiply(h),d=T0(d,c),t=S0(t,c),p=S0(p,c),1==Math.abs(nd.PORTALS[0].normal.y)&&1==Math.abs(nd.PORTALS[1].normal.y)&&(t.x<3&&(t.x=0),t.z<3)&&(t.z=0),u.previousPosition.copy(d),u.velocity.copy(t),u.force.copy(p),u.quaternion.copy(f),1==Math.abs(nd.PORTALS[0].normal.y)&&1==Math.abs(nd.PORTALS[1].normal.y)&&1==u.looping2?u.centering?(e=T0(c.portalShader.position,c),u.position.copy(e)):(u.centering=!0,e=T0(e,c),u.position.copy(e),h=T0(c.portalShader.position,c),u.newPosition=h):(e=T0(e,c),u.position.copy(e))}"pellet"==r.name&&(d=new dd(0,1,0).applyQuaternion(nd.PORTALS[n].output.mesh.quaternion),r.direction=d,r.previousDirection=d,r.pellet.position.copy(r.position),r.pellet.quaternion.copy(r.quaternion),r.pellet.infinity||(clearTimeout(r.pellet.timeout),Sv(r.pellet,!1))),0==a&&(nd.CURRENT_ITEM&&(nd.CURRENT_ITEM.body.collisionResponse=0,setTimeout(()=>{nd.CURRENT_ITEM.body.collisionResponse=1},100)),rd.PORTAL_ENTER.currentTime=0,Ag(rd.PORTAL_ENTER),y0(),A0(nd.PIVOT,nd.PORTALS[n]),nd.PLAYER_MODEL_CLONE.visible=!1,nd.PLAYER_MODEL.visible=!1,E0=!0,p=new dd(0,1,0),f=new dd,nd.MAIN_CAMERA.getWorldDirection(f),f.normalize(),c=(h=f.clone().cross(p).normalize()).clone().cross(f).normalize(),u=(new fd).makeBasis(h,c,f.negate()),(d=new hd).setFromRotationMatrix(u),nd.TELEPORTING_TARGET_QUATERNION=d),r.collisionFilterMask|=nd.PORTALS[n].hostObjects.collisionFilterGroup,r.collisionFilterMask&=~nd.PORTALS[1-n].hostObjects.collisionFilterGroup;break}r.teleportingHolding=!0}else r.portal==n&&r.teleportingHolding&&(r.teleportingHolding=!1);a++}}}}class GS extends Sd{constructor(e,t,n,i,r,a,o){var s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:[],i=(super(),this.pos=e.clone(),this.output=i,this.hostObjects=r,this.plane=new _A(new dd(0,1,0),0),this.debugMeshes=new Sd,this.ty=t.clone().normalize(),this.tz=n.clone().projectOnPlane(this.ty).normalize(),this.tz.length()<.1&&(this.tz=new dd(0,1,0)),this.tx=this.tz.clone().cross(this.ty),void 0!==(this.portalPoints=s)&&0!=s.length||(this.portalPoints=[this.pos.clone().add(this.tz.clone().multiplyScalar(nd.PORTAL_DEPTH/2+2*nd.PORTAL_EPS).add(this.tx.clone().multiplyScalar(nd.PORTAL_WIDTH/2+2*nd.PORTAL_EPS))),this.pos.clone().add(this.tz.clone().multiplyScalar(-nd.PORTAL_DEPTH/2-2*nd.PORTAL_EPS).add(this.tx.clone().multiplyScalar(nd.PORTAL_WIDTH/2+2*nd.PORTAL_EPS))),this.pos.clone().add(this.tz.clone().multiplyScalar(-nd.PORTAL_DEPTH/2-2*nd.PORTAL_EPS).add(this.tx.clone().multiplyScalar(-nd.PORTAL_WIDTH/2-2*nd.PORTAL_EPS))),this.pos.clone().add(this.tz.clone().multiplyScalar(nd.PORTAL_DEPTH/2+2*nd.PORTAL_EPS).add(this.tx.clone().multiplyScalar(-nd.PORTAL_WIDTH/2-2*nd.PORTAL_EPS)))]),(new fd).makeBasis(this.tx,this.ty,this.tz)),r=new xT(this.tx,e,1,16711680),n=new xT(this.ty,e,1,65280),s=new xT(this.tz,e,1,255),{width:r,height:n}=(this.debugMeshes.add(r,n,s),this.transform=i.clone().setPosition(e),this.plane.applyMatrix4(this.transform),this.plane.translate(t.clone().multiplyScalar(1e-4)),nd.RENDERER.domElement),s=new vx(nd.PORTAL_WIDTH,nd.PORTAL_WIDTH,nd.PORTAL_HEIGHT),r={texture1:{type:"t",value:new eA},ww:{type:"f",value:r},wh:{type:"f",value:n}},n=new Td({vertexShader:`
        void main() 
        {
            vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);
            gl_Position = projectionMatrix * modelViewPosition;
        }
        `,fragmentShader:`
        uniform sampler2D texture1;
        uniform float ww;
        uniform float wh;
        
        void main() {
            gl_FragColor = texture2D(texture1, gl_FragCoord.xy / vec2(ww, wh));


            #include <tonemapping_fragment>
            #include <colorspace_fragment>
        }
        `,uniforms:r,stencilWrite:!0,stencilFunc:514,stencilRef:1,stencilFail:7681,depthTest:!0,depthWrite:!0,polygonOffset:!1,polygonOffsetFactor:-2,side:He}),r=(this.mesh=new xd(s,n),this.mesh.applyMatrix4(this.transform),this.mesh.updateMatrix(),this.mesh.matrixAutoUpdate=!0,this.matrixAutoUpdate=!0,this.mesh.frustumCulled=!0,this.add(this.mesh),this.mesh.renderOrder=100,this.mesh.translateY(-.1),0==o?(this.mesh.userData.this=0,this.mesh.userData.other=1,(l=nd.LIGHT_PORTAL_0).intensity=3):(this.mesh.userData.this=1,this.mesh.userData.other=0,(l=nd.LIGHT_PORTAL_1).intensity=3),l.position.copy(this.mesh.position),l.visible=!0,this.light=l,nd.PORTAL_SHADER[o].parent),s=(r&&(r.remove(nd.PORTAL_SHADER[o]),nd.PORTAL_SHADER[o].matrix.identity().decompose(nd.PORTAL_SHADER[o].position,nd.PORTAL_SHADER[o].quaternion,nd.PORTAL_SHADER[o].scale)),nd.PORTAL_SHADER[o].applyMatrix4((new fd).makeRotationX(-Math.PI/2)),nd.PORTAL_SHADER[o].applyMatrix4(this.transform),nd.PORTAL_SHADER[o].updateMatrix(),nd.PORTAL_SHADER[o].matrixAutoUpdate=!0,this.portalShader=nd.PORTAL_SHADER[o],this.portalShader.frustumCulled=!0,this.add(nd.PORTAL_SHADER[o]),new dA(1.4,2,.1)),n=new _d({color:65280}),l=(nd.PORTAL_BOX[o]=new xd(s,n),nd.PORTAL_BOX[o].applyMatrix4((new fd).makeRotationX(-Math.PI/2)),nd.PORTAL_BOX[o].applyMatrix4(this.transform),nd.PORTAL_BOX[o].updateMatrix(),nd.PORTAL_BOX[o].matrixAutoUpdate=!0,nd.PORTAL_BOX[o].visible=!1,this.add(nd.PORTAL_BOX[o]),new dA(.75,1.2,.1)),r=(nd.PORTAL_INNER_BOX[o]=new xd(l,n),nd.PORTAL_INNER_BOX[o].applyMatrix4((new fd).makeRotationX(-Math.PI/2)),nd.PORTAL_INNER_BOX[o].applyMatrix4(this.transform),nd.PORTAL_INNER_BOX[o].updateMatrix(),nd.PORTAL_INNER_BOX[o].matrixAutoUpdate=!0,nd.PORTAL_INNER_BOX[o].visible=!1,this.add(nd.PORTAL_INNER_BOX[o]),this.transform.clone()),s=e.clone().add(t.clone().multiplyScalar(-nd.PORTAL_CDBB_HEIGHT/4)),l=i.clone().setPosition(s);this.CDBB=new CS(nd.PORTAL_WIDTH,nd.PORTAL_CDBB_HEIGHT,nd.PORTAL_DEPTH,r,16711680),this.STBB=new CS(nd.PORTAL_WIDTH,nd.PORTAL_CDBB_HEIGHT/2,nd.PORTAL_DEPTH,l,65280),this.debugMeshes.add(this.CDBB.helper),this.debugMeshes.add(this.STBB.helper),this.debugMeshes.visible=!1,this.add(this.debugMeshes)}}function b0(e,t,n,i,r,a){var o=M0(nd.PAINTING_GUN_MODE[e]),s=new gd;s.position.copy(t),s.rotation.copy("down"==(t=i.side)?new md(-Math.PI/2,0,0):"up"==t?new md(Math.PI/2,0,0):"front"==t?new md(0,0,0):"back"==t?new md(Math.PI,0,0):"left"==t?new md(0,Math.PI/2,0):"right"==t?new md(0,-Math.PI/2,0):void 0),Jv(s,o,nd.PAINTING_GUN_MODE[e],a.side,!0,1)}function M0(e){return"blue"==e?new vd("rgb(30,144,255)"):"orange"==e?new vd("rgb(255,140,0)"):"purple"==e?new vd("rgb(75,0,130)"):"white"==e?new vd(.8,.8,.8):"clear"==e?new vd(11001053):"reflection"==e?new vd("rgb(128,128,128)"):void 0}function R0(e,t){td()("#gel_recharger-type").find(".title").text("Gel type: "+e),td()("#gel-type").data("gel",e),t.userData.gel=e,nd.ITEMS_ADDED.getObjectByName("gel_recharger").setColorAt(t.userData.idInstanced,M0(e))}td()("body").on("click",".gel_recharger-type",function(){R0(td()(this).data("gel"),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item)});var N0=new dd,I0=new yT,C0=!0;function L0(n,i,r,a){var o,s;if((nd.LEVEL_ENTERED||i)&&((i||!("none"==nd.PORTAL_GUN_INITIATE||"left"==nd.PORTAL_GUN_INITIATE&&2==n||"right"==nd.PORTAL_GUN_INITIATE&&0==n)||"portal"!=nd.GUN_MODE)&&C0&&(!nd.HOLDING_ITEM||i)&&nd.FPS_MODE&&(2==n||0==n||1==n)&&nd.ALLOW_PLACE_PORTALS)){I0.setFromCamera(N0,r),a||(e=I0.intersectObjects(nd.BLOCK_PORTAL));var e,t=null;if(!i&&!a)for(var l=0;l<e.length;l++)if(e[l].object.visible){t=e[l];break}var r=I0.intersectObjects(nd.ANGLED_PANELS),a=I0.intersectObject(nd.INSTANCED_WHITE_GEL),u=I0.intersectObject(nd.PLANE_LEVEL_INSTANCED);if(i&&(i.point=i.position,i.instanceId=i.userData.planeInstancedId,u=[i.object=i]),0<u.length){var c=nd.PLANE_USER_DATA[u[0].instanceId],h=u[0].object,d=new dd,d=(u[0].object.getWorldPosition(d),new dd(0,1,0).applyQuaternion(h.quaternion)),h=new dd(0*d.x,0*d.y,0*d.z),d=u[0].point.x+h.x,p=u[0].point.y+h.y,h=u[0].point.z+h.z;if(i||(2==n?nd.FLASH.color=new vd(1,.25,0):0==n&&(nd.FLASH.color=new vd(0,.3,1)),f=new dd,nd.PORTAL_GUN_FLASH.getWorldPosition(f),0!=n&&2!=n||(nd.FLASH.position.copy(f),2<nd.PLAYER.position.distanceTo(u[0].point)&&(nd.FLASH.visible=!0),$g(300,nd.FLASH.position,t?t.point:new dd(d,p,h)),$g(150,nd.GUN.children[0].position,new dd(nd.GUN.children[0].position.x,nd.GUN.children[0].position.y,.003)),setTimeout(()=>{$g(150,nd.GUN.children[0].position,new dd(nd.GUN.children[0].position.x,nd.GUN.children[0].position.y,0))},150)),setTimeout(()=>{nd.FLASH.scale.set(.02,.02,.02),nd.FLASH.visible=!1,C0=!0},300)),!(0<r.length&&0<r[0].normal.y))if(t)rd.PORTAL_INVALID.currentTime=0,Ag(rd.PORTAL_INVALID);else{var f=!1;if((0==n&&nd.PAINTING_GUN_MODE[0]||2==n&&nd.PAINTING_GUN_MODE[1])&&(f=!0),c.itemName||(c.itemName=""),0<r.length||(c.portal||0<a.length||f)&&(!c.hasItem||i||c.itemName.includes("camera")||c.itemName.includes("radio")||c.itemName.includes("trigger"))){d=new dd(d,p,h);let e=new dd(0,1,0),t=new dd;i&&c.item.getWorldDirection(t),"front"==c.side?g=new dd(0,0,1):"back"==c.side?g=new dd(0,0,-1):"right"==c.side?g=new dd(-1,0,0):"left"==c.side?g=new dd(1,0,0):"up"==c.side?(e.applyQuaternion(nd.MAIN_CAMERA.quaternion),g=new dd(0,-1,0),i&&(e=t)):"down"==c.side&&(e.applyQuaternion(nd.MAIN_CAMERA.quaternion),g=new dd(0,1,0),i)&&(e=t);var m,g,p=e.clone().projectOnPlane(g).normalize(),h=p.clone().cross(g),v=nd.PORTAL_WIDTH,_=nd.PORTAL_DEPTH,y=3*-nd.PORTAL_EPS,p=[d.clone().add(p.clone().multiplyScalar(_/2+y).add(h.clone().multiplyScalar(v/2+y))),d.clone().add(p.clone().multiplyScalar(-_/2-y).add(h.clone().multiplyScalar(v/2+y))),d.clone().add(p.clone().multiplyScalar(-_/2-y).add(h.clone().multiplyScalar(-v/2-y))),d.clone().add(p.clone().multiplyScalar(_/2+y).add(h.clone().multiplyScalar(-v/2-y)))];if(0==n?m=1:2==n&&(m=0),!f&&!i&&0==r.length){if(nd.PORTAL_BOX[m])for(var E of p)if(E=E,u[0].object,o=m,s=void 0,(s=new pd).setFromObject(nd.PORTAL_BOX[o]),s.containsPoint(E))return rd.PORTAL_INVALID.pause(),rd.PORTAL_INVALID.currentTime=0,void Ag(rd.PORTAL_INVALID);D0=[];for(var A of p)((e,t)=>{let n=e.clone().add(t.clone().multiplyScalar(1)),i=new yT(n,t.clone().multiplyScalar(-1),0,1e3),r=i.intersectObject(nd.PLANE_LEVEL_INSTANCED);if(0==r.length)return D0.push([]);if(0<r.length){e=nd.PLANE_USER_DATA[r[0].instanceId];if(!e.portal||1.1<r[0].distance||e.hasItem)return D0.push([])}D0.push(r)})(A,g,u[0].object);"up"==c.side||"down"==c.side?0!=D0[1].length&&0!=D0[1].length&&0!=D0[2].length&&0!=D0[3].length||(d.z=c.position.z,d.x=c.position.x):(0!=D0[1].length&&0!=D0[1].length&&0!=D0[2].length&&0!=D0[3].length||(d.y=c.position.y-.1),0!=D0[0].length&&0!=D0[3].length||(d.x=c.position.x,d.z=c.position.z))}if(v=(0<r.length?(_=(new ud).getNormalMatrix(r[0].object.matrixWorld),(g=r[0].face.normal.clone().applyMatrix3(_).normalize()).negate(),e=new dd(0,-1,0),h=new dd,r[0].object.getWorldPosition(h),d=h,r[0].object):(0<a.length&&(d=tv(nd.INSTANCED_WHITE_GEL.array[a[0].instanceId].position)),c)).body,0==n){if("paint"==nd.GUN_MODE)return void(nd.PAINTING_GUN_MODE[0]&&b0(0,d,0,v,e,c));i||(document.getElementById("reticle-img").style.filter="none","left"==nd.PORTAL_GUN_INITIATE?document.getElementById("reticle-img").src="./assets/ui/mobile/portalBlue.png":"right"==nd.PORTAL_GUN_INITIATE?document.getElementById("reticle-img").src="./assets/ui/mobile/portalOrange.png":document.getElementById("reticle-img").src="./assets/textures/crosshairBlue.png"),null!==nd.PORTALS[0]&&O0(0),P0(0,1,d,g,v,e,p,c.side),nd.UNIFORMS_PORTAL_GUN_ENERGY.iColor.value=new dd(0,1.25,2.5),i||0==nd.UNIFORMS_PORTAL_GUN_ENERGY.iAlpha.value&&new Xg.Tween(nd.UNIFORMS_PORTAL_GUN_ENERGY.iAlpha).to({value:.5},300).start(),nd.PORTALS[0].normal=g,rd.PORTAL_GUN_ORANGE.pause(),rd.PORTAL_GUN_ORANGE.currentTime=0,Ag(rd.PORTAL_GUN_ORANGE)}else if(2==n){if("paint"==nd.GUN_MODE)return void(nd.PAINTING_GUN_MODE[1]&&b0(1,d,0,v,e,c));i||(document.getElementById("reticle-img").style.filter="none","left"==nd.PORTAL_GUN_INITIATE?document.getElementById("reticle-img").src="./assets/ui/mobile/portalBlue.png":"right"==nd.PORTAL_GUN_INITIATE?document.getElementById("reticle-img").src="./assets/ui/mobile/portalOrange.png":document.getElementById("reticle-img").src="./assets/textures/crosshairOrange.png"),null!==nd.PORTALS[1]&&O0(1),P0(1,0,d,g,v,e,c.rotation,c.side),nd.UNIFORMS_PORTAL_GUN_ENERGY.iColor.value=new dd(2.5,.7,0),i||0==nd.UNIFORMS_PORTAL_GUN_ENERGY.iAlpha.value&&new Xg.Tween(nd.UNIFORMS_PORTAL_GUN_ENERGY.iAlpha).to({value:.5},300).start(),nd.PORTALS[1].normal=g,rd.PORTAL_GUN_BLUE.pause(),rd.PORTAL_GUN_BLUE.currentTime=0,Ag(rd.PORTAL_GUN_BLUE)}setTimeout(()=>{0==n?(n_(1,nd.LIGHT_BRIDGE_RAYCASTER),n_(1,nd.TRACTOR_BEAM_RAYCASTER)):2==n&&(n_(0,nd.LIGHT_BRIDGE_RAYCASTER),n_(0,nd.TRACTOR_BEAM_RAYCASTER))},300)}else rd.PORTAL_INVALID.pause(),rd.PORTAL_INVALID.currentTime=0,Ag(rd.PORTAL_INVALID)}}}}var D0=[];function O0(e){if(null===nd.PORTALS[0]&&null===nd.PORTALS[1]&&rd.PORTAL_GUN_LOOP.pause(),null!==nd.PORTALS[e]){for(var t,n=0;n<nd.PORTALS[e].gels.length;n++)nd.PORTALS[e].gels[n].collisionResponse=1;if(nd.PORTALS[e].field&&(nd.SCENE_CHILDREN.remove(nd.PORTALS[e].field),nd.PORTALS[e].field=null),nd.PORTALS[e].fieldBody&&(t=nd.PORTALS[e].fieldBody,setTimeout(()=>{nd.CANNON_WORLD.removeBody(t)},10),nd.PORTALS[e].fieldBodyClone=null,nd.PORTALS[e].fieldBody=null),nd.PORTALS[e].fieldTrigger){var i=nd.TRACTOR_BEAM_BOUNDING_BOX.indexOf(nd.PORTALS[e].fieldTrigger);if(-1<i){for(var r of nd.DYNAMIC_OBJECTS)r.inTractor&&r.tractor==i&&rv(r,i);nd.ITEMS_ADDED.remove(nd.TRACTOR_BEAM[i]),nd.TRACTOR_BEAM_BOUNDING_BOX[i]=null,nd.TRACTOR_BEAM.splice(i,1),nd.TRACTOR_BEAM_BOUNDING_BOX.splice(i,1)}nd.PORTALS[e].fieldTrigger=null}if(nd.PORTALS[e].light.visible=!1,nd.PORTAL_AUDIO[e].sound.audio.pause(),null!==nd.PORTALS[e].hostObjects){nd.PORTALS[e].hostObjects.portal=!1;for(n=0;n<nd.WALL_BODIES.length;n++)nd.WALL_BODIES[n].collisionFilterGroup&=~nd.CGROUP_PORTAL_HOST_CDISABLE[e],nd.WALL_BODIES[n].collisionFilterGroup&nd.CGROUP_PORTAL_HOST_CDISABLE[0]||nd.WALL_BODIES[n].collisionFilterGroup&nd.CGROUP_PORTAL_HOST_CDISABLE[1]||(nd.WALL_BODIES[n].collisionFilterGroup|=nd.CGROUP_ENVIRONMENT)}nd.SCENE.remove(nd.PORTALS[e]),nd.PORTALS[e].portalShader.material.uniforms.iOpened.value=0,nd.PORTALS[e]=null}}function P0(e,t,n,i,r,a,o,s){nd.STATS_UI.portals+=1;for(var l of nd.DYNAMIC_OBJECTS)l.looping=!1,l.looping2=!1,l.centered=!1,l.centering=!1;var u=nd.PORTAL_COLORS[e];nd.PORTALS[e]=new GS(n,i,a,nd.PORTALS[t],r,u,e,o),nd.PORTALS[e].mesh.scale.set(0,0,0),nd.PORTALS[e].portalShader.scale.set(0,0,0),nd.PORTALS[e].side=s,nd.PORTALS[e].normal=i,nd.PORTALS[e].hostObjects.portal=!0;for(var c=0;c<nd.WALL_BODIES.length;c++)nd.WALL_BODIES[c].side==s&&(nd.WALL_BODIES[c].collisionFilterGroup|=nd.CGROUP_PORTAL_HOST_CDISABLE[e],nd.WALL_BODIES[c].collisionFilterGroup&=~nd.CGROUP_ENVIRONMENT);null!==nd.PORTALS[t]&&(nd.PORTALS[t].output=nd.PORTALS[e]),nd.SCENE.add(nd.PORTALS[e]),$g(300,nd.PORTALS[e].mesh.scale,new dd(.6,1,1)),$g(300,nd.PORTALS[e].portalShader.scale,new dd(.6,1,1)),null!==nd.PORTALS[t]&&(nd.PORTALS[t].output=nd.PORTALS[e]),null!==nd.PORTALS[0]&&null!==nd.PORTALS[1]&&(nd.PORTALS[0].portalShader.material.uniforms.iOpened.value=1,nd.PORTALS[1].portalShader.material.uniforms.iOpened.value=1),nd.PORTAL_AUDIO[e].sound.position.copy(nd.PORTALS[e].mesh.position),nd.PORTAL_AUDIO[e].sound.quaternion.copy(nd.PORTALS[e].mesh.quaternion),Ag(nd.PORTAL_AUDIO[e].sound.audio),nd.PORTALS[e].gels=[];for(c=0;c<nd.GEL_TRIGGER.length;c++)for(var h=0;h<9;h++){var d=nd.GEL_TRIGGER[c].clone();nd.SCENE.add(d),1==h?d.translateX(1):2==h?d.translateX(-1):3==h?d.translateY(1):4==h?d.translateY(-1):5==h?(d.translateX(1),d.translateY(1)):6==h?(d.translateX(1),d.translateY(-1)):7==h?(d.translateX(-1),d.translateY(1)):8==h&&(d.translateX(-1),d.translateY(-1)),nd.SCENE.remove(d),nd.PORTALS[e].CDBB.containsPoint(d.position)&&(nd.GEL_TRIGGER[c].gelBody.collisionResponse=0,nd.PORTALS[e].gels.push(nd.GEL_TRIGGER[c].gelBody),h=10)}}$h=(new wd).load("./assets/textures/target.png"),wv=new EA(2,2),id=new _d({map:$h,transparent:!0,polygonOffset:!0,polygonOffsetUnits:-10});let Oc=new xd(wv,id);function U0(e,t){var n,i;t.holding||e.launch||(e.sound.audio.currentTime=0,e.sound.audio.play(),e.launch=!0,setTimeout(()=>{e.launch=!1},150),$g(200,n=e.item.ToRotate.rotation,new dd(.7*Math.PI,0,0)),setTimeout(()=>{$g(200,n,new dd(Math.PI/2,0,0))},200),t.velocity.setZero(),t.initVelocity.setZero(),t.angularVelocity.setZero(),t.initAngularVelocity.setZero(),t.force.setZero(),t.torque.setZero(),i=e.item.target.position.clone(),i=((e,t,n,i,r)=>{(o=new ed.Vec3(t.x-e.x,0,t.z-e.z)).normalize();var a=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.z-e.z,2)),t=t.y-e.y,e=(e=Math.sqrt(2*n/9.81))+Math.sqrt(2*(n-t)/9.81),t=a/e*o.x,a=a/e*o.z,o=Math.sqrt(19.62*n),n=new ed.Vec3(i*t,i*o,i*a);return"player"==r&&(rd.AERIAL.timeout=setTimeout(()=>{nd.BLOCK_PLAYER_MOVE=!1,Sg(rd.AERIAL)},1e3*e)),n})(new ed.Vec3(t.position.x,t.position.y,t.position.z),new ed.Vec3(i.x,i.y,i.z),e.item.userData.height,t.mass,t.name),t.applyImpulse(i,t.position))}function B0(e){nd.FAITH_PLATE_TARGET=e,nd.CONNECTING=!0,nd.MATERIAL_PORTAL_EDITOR.opacity=.25,nd.MATERIAL_NON_PORTAL_EDITOR.opacity=.25,nd.MATERIAL_PORTAL_EDITOR.transparent=!0,nd.MATERIAL_NON_PORTAL_EDITOR.transparent=!0}function F0(e){e=new dd(e.position.x,nd.FAITH_PLATE_TARGET.position.y,e.position.z);nd.FAITH_PLATE_TARGET.lookAt(e)}function z0(e,t){var n=Oc.clone(),e=(n.position.copy(e.position),n.rotation.copy(e.rotation),nd.SCENE.add(n),nd.FAITH_PLATE_TARGET.target=n,2);t&&(e=t),nd.FAITH_PLATE_TARGET.userData.targetPos=n.position,nd.FAITH_PLATE_TARGET.userData.targetRot=n.rotation,nd.FAITH_PLATE_TARGET.userData.target=n,k0(nd.FAITH_PLATE_TARGET.position,n.position,e,n,nd.FAITH_PLATE_TARGET),nd.FAITH_PLATE_TARGET=null}function k0(e,t,n,i,r){var a=(new dd).addVectors(e,t).multiplyScalar(.5);e.y>t.y?a.y=n+e.y:a.y=n+t.y,r.userData.height=Math.abs(e.y-a.y),r.userData.heightLine=n;r=new rx([e,a,t]).getPoints(50),n=(new Ad).setFromPoints(r),e=new XA({color:16711680}),a=new ZA(n,e);i.line=a,nd.GROUP_LINE_TRAGECTORY.add(a)}function G0(e,t){var n=new ed.Box(new ed.Vec3(1,1,.01)),i=new ed.Body({shape:n,mass:0,material:new ed.Material}),i=(i.name=t,nd.CANNON_BODIES.push(i),i.position.copy(e.position),i.quaternion.copy(e.quaternion),i.collisionFilterGroup=nd.CGROUP_DYNAMIC,i.collisionFilterMask=nd.CGROUP_ALL,e.body=i,nd.CANNON_BODIES.push(i),nd.CANNON_WORLD.addBody(i),new gd),e=(i.position.copy(e.position),i.quaternion.copy(e.quaternion),i.translateZ(-.5),new ed.Body({shape:n,mass:0,material:new ed.Material}));e.name=t,nd.CANNON_BODIES.push(e),e.position.copy(i.position),e.quaternion.copy(i.quaternion),e.collisionFilterGroup=nd.CGROUP_DYNAMIC,e.collisionFilterMask=nd.CGROUP_ALL,e.collisionResponse=0,nd.CANNON_BODIES.push(e),nd.CANNON_WORLD.addBody(e),H0(e)}function H0(e){e.addEventListener("collide",function(t){if(1!=t.target.collisionResponse)if(t.body===nd.PLAYER){for(var e=0;e<nd.CONNECTIONS.length;e++)nd.CONNECTIONS[e].from.instancedName.includes("trigger")&&(nd.CONNECTIONS[e].line.active=!1);"exit"!=t.target.name||nd.EXIT_DOOR.finished||Y0(0,!(nd.EXIT_DOOR.finished=!0),!1,nd.EXIT_DOOR),O0(0),O0(1),nd.PORTAL_BOX=[];for(e=0;e<nd.LASER_TRIGGERS.length;e++)!nd.LASER_TRIGGERS[e].emitterState&&nd.LASER_TRIGGERS[e].fromLaserCube&&Dv(nd.LASER_TRIGGERS[e],!1)}else if("sphere"==t.body.name||"cube"==t.body.name||"radio"==t.body.name||"cube_2"==t.body.name||"laser_cube"==t.body.name||"scale_cube"==t.body.name||"camera"==t.body.name||"trash"==t.body.name){var n=("camera"==t.body.name?window.cameraClone:nd.ITEMS_ADDED.getObjectByName(t.body.name).scene).clone(),i=(n.position.set(t.body.position.x,t.body.position.y,t.body.position.z),n.quaternion.copy(t.body.quaternion),n.visible=!0,nd.HOLDING_ITEM&&Nv(),nd.UNIFORMS_DISSOLVER.diffuseMap.value=n.material.map,n.material=nd.MATERIAL_DISSOLVER,nd.SCENE_FPS.add(n),n.position.clone()),i=(i.y+=2,nd.UNIFORMS_DISSOLVER.u_EffectOrigin.value=i,n.clone());if(i.position.y+=1,xg("audio-dissolve",n,!0,!1,!0,2,"dissolve"),$g(3e3,nd.UNIFORMS_DISSOLVER.u_EffectOrigin.value,n.position),$g(3e3,n.position,i.position),setTimeout(()=>{nd.SCENE_FPS&&(nd.SCENE_FPS.remove(n),n.dissolve)&&nd.SCENE_FPS.remove(n.dissolve)},3e3),"camera"==t.body.name){nd.ITEMS_ADDED.remove(t.body.item);let e=t.body;setTimeout(()=>{nd.CANNON_WORLD.removeBody(e)},100)}else if("radio"==t.body.name||"trash"==t.body.name){"radio"==t.body.name&&(console.log(t.body.sound),t.body.sound.audio.pause(),nd.SCENE_FPS.remove(t.body.sound)),console.log(t.body);i=nd.ITEMS_ADDED.getObjectByName(t.body.item.userData.instancedName);i.setVisibilityAt(t.body.item.userData.idInstanced,!1),i.instanceMatrix.needsUpdate=!0,i.computeBoundingSphere();let e=t.body;setTimeout(()=>{nd.CANNON_WORLD.removeBody(e)},100)}else $0(t.body)}})}function ad(e,t,n,i){for(var r,a,o,s=0;s<e.length;s++)if(0!=e[s].length){var l,u=new ed.Material,c=(u.friction=e[s].userData.friction,e[s].position.clone()),h=e[s].quaternion,d=new gd;if(d.position.copy(c),d.quaternion.copy(h),nd.SCENE.add(d),"incinerator"==t)var p=Iu(nd.ITEMS_ADDED.getObjectByName(t),{type:Dg.HULL}),f=p.shape;else if("step"==t)var p=Iu(nd.ITEMS_ADDED.getObjectByName(t),{type:Dg.HULL}),f=p.shape;else if("desk"==t||"cabinet"==t||"sign"==t)var p=Iu(nd.ITEMS_ADDED.getObjectByName(t),{type:Dg.HULL}),f=p.shape;else if("bed"==t){var f=new ed.Box(new ed.Vec3(.5,.5,1));d.translateY(.25)}else if("toilet"==t){var f=new ed.Box(new ed.Vec3(.22,.5,.44));d.translateY(.25)}else if("piston_platforms"==t){var f=new ed.Box(new ed.Vec3(1,.1,1));d.translateY(.05)}else if("track_platforms"==t){var f=new ed.Box(new ed.Vec3(1,1,.1));d.translateY(1),d.translateZ(-.275)}else if("trash"==t){var f=new ed.Box(new ed.Vec3(.05,.09,.05));i=.09}else if("door"==t)var f=new ed.Box(new ed.Vec3(1,1,.01)),c=new dd,c=(e[s].children[1].getWorldPosition(c),d.position.copy(c),new hd),h=(e[s].children[1].getWorldQuaternion(c),c);else if("cube"==t||"cube_2"==t||"laser_cube"==t||"scale_cube"==t){(f=new ed.Box(new ed.Vec3(.3,.3,.3))).height=.6,f.width=.6,i=.5;c=new ed.ContactMaterial(nd.PHYSICS_MATERIAL,u,{friction:0,restitution:e[s].userData.restitution});nd.CANNON_WORLD.addContactMaterial(c)}else if("sphere"==t){(f=new ed.Sphere(.3)).height=.6,f.width=.6,i=.5;c=new ed.ContactMaterial(nd.PHYSICS_MATERIAL,u,{friction:0,restitution:e[s].userData.restitution});nd.CANNON_WORLD.addContactMaterial(c)}else if("gel_gun_blue"==t||"gel_gun_orange"==t||"gel_gun_white"==t)var f=new ed.Box(new ed.Vec3(.1,.5,.1));else if("pedestal_button"==t){var f=new ed.Box(new ed.Vec3(.126,.35,.126));d.translateY(.35)}else if("radio"==t){var f=new ed.Box(new ed.Vec3(.15,.07,.1));i=.07}else if("button_weight"==t){f=new ed.Box(new ed.Vec3(.5,.117,.5));d.translateY(.117)}else if("button_box"==t||"button_sphere"==t)"button_box"==t?(l=.45,0):"button_sphere"==t&&(l=.4,0),1==i?(f=new ed.Box(new ed.Vec3(.5,.14,.1)),d.translateY(.14),d.translateZ(l)):2==i?(f=new ed.Box(new ed.Vec3(.5,.14,.1)),d.translateY(.14),d.translateZ(-l)):3==i?(f=new ed.Box(new ed.Vec3(.1,.14,.5)),d.translateY(.14),d.translateX(l)):4==i&&(f=new ed.Box(new ed.Vec3(.1,.14,.5)),d.translateY(.14),d.translateX(-l));else if("dispenser"==t){if(!e[s].userData.hasDispenser)return;d.position.copy(e[s].dispenserPosition),d.rotation.set(0,0,0),1==i?(f=new ed.Box(new ed.Vec3(.7,.77,.01)),d.translateZ(.7)):2==i?(f=new ed.Box(new ed.Vec3(.7,.77,.01)),d.translateZ(-.7)):3==i?(f=new ed.Box(new ed.Vec3(.01,.77,.7)),d.translateX(.7)):4==i&&(f=new ed.Box(new ed.Vec3(.01,.77,.7)),d.translateX(-.7)),d.translateY(-.8)}else if("ramp"==t||"ramp_half"==t||"ramp_half2"==t||"stairs"==t){let e=Iu(nd.ITEMS_ADDED.getObjectByName(t),{type:Dg.HULL});f=e.shape}else"pellet_launcher"==t?(f=new ed.Box(new ed.Vec3(.6,.3,.6)),d.translateY(.3),Tv(e[s])):"pellet_catcher"==t?(f=new ed.Box(new ed.Vec3(.5,.3,.5)),d.translateY(.3),c=e[s],a=o=a=m=r=void 0,r=new dd(0,1,0).applyQuaternion(c.quaternion),(xv=new yT).set(c.position,r),r=xv.intersectObject(nd.PLANE_LEVEL_INSTANCED),(m=new gd).position.copy(c.position),m.rotation.copy(c.rotation),a=new vx(1,.1,r[0].distance,16,1,!0),a=new xd(a,nd.MATERIAL_CONE),m.add(a),a.translateY(r[0].distance/2),a=new gx(1,16),o=new _d({color:16776960,transparent:!0,opacity:.05,side:1,polygonOffset:!0,polygonOffsetFactor:-10}),a=new xd(a,o),m.add(a),a.rotation.x=-Math.PI/2,a.translateZ(r[0].distance-.01),nd.SCENE_FPS.add(m),c.cone=m):"faith_plate"==t&&(f=new ed.Box(new ed.Vec3(.5,.1,1)));var m,g=new ed.Body({shape:f,mass:n,material:u});g.position.copy(d.position),g.quaternion.copy(h),g.collisionFilterGroup=nd.CGROUP_DYNAMIC,g.collisionFilterMask=nd.CGROUP_ALL,(e[s].body=g).state=e[s].state,g.updateMassProperties(),g.item=e[s],g.name=t,g.initialMass=n,nd.SCENE.remove(d),"radio"==t?xg("audio-radio",g,!0,!0,!1,4,"sound"):"door"==t?xg("audio-door",e[s],!1,!1,!0,8,"sound"):"laser_cube"==t&&(o=g,r=a=void 0,a=new vx(.01,.01,1,8,1,!0),(a=new xd(a,new _d({color:new vd(Pv,0,0)}))).translateY(.5),(r=new gd).position.copy(o.position),r.quaternion.copy(o.quaternion),r.add(a),r.visible=!1,(a=r.clone()).visible=!1,r.clone=a,nd.SCENE_FPS.add(a),nd.SCENE_FPS.add(r),o.laser=r),"faith_plate"==t&&(g.collisionResponse=0,xg("faith_plate_hit",g,!1,!1,!0,12,"sound")),"piston_platforms"!=t&&"track_platforms"!=t||((c=g).bodiesInContact=[],nd.PLATFORM_BODIES.push(c),c.addEventListener("collide",c0),xg("AUDIO-PLATFORM",g,e[s].userData.isActive,!0,!1,5,"sound")),0<n&&(xg("audio-repulsion",g,!1,!1,!0,20,"soundRepulsion"),"cube"!=t&&"cube_2"!=t&&"laser_cube"!=t&&"sphere"!=t&&"scale_cube"!=t||(e[s].userData.hasDispenser?(g.mass=0,g.allowSleep=!1):g.allowSleep=!0,g.position.copy(new dd(e[s].dispenserPosition.x,e[s].dispenserPosition.y-1,e[s].dispenserPosition.z)),e[s].position.copy(g.position),nd.BOX_BODY.push(g)),g.spawnPosition=e[s].position.clone(),g.sleepSpeedLimit=.1,g.sleepTimeLimit=1,nd.DYNAMIC_OBJECTS.push(g),g.gelJumping=!1,g.waiting=!1,g.offset=i,g.arrayPos=[],g.arrayRot=[],g.dynamic=!0,g.playingAudioGel=!1,(m=nd.ITEMS_ADDED.getObjectByName(t).clone.clone()).visible=!1,nd.SCENE_FPS.add(m),g.clone=m,"radio"!=t&&"trash"!=t&&xg("audio-impact",g,!1,!1,!0,8,"sound"),g.addEventListener("collide",function(t){t.body.looping=!1,t.body.looping2=!1,t.body.centered=!1,t.body.centering=!1,t.body.heightDifference=null,"blue"!=t.body.type&&t.target.impactVelocity&&(clearTimeout(t.target.timeout),t.target.timeout=setTimeout(()=>{t.target.impactVelocity=null,t.target.impactSide=null},10)),"purple"!=t.body.type&&t.target.customGravity&&(clearTimeout(t.target.timeout),t.target.timeout=setTimeout(()=>{t.target.customGravity=null;var e=nd.CUSTOM_GRAVITY.indexOf(t.target);-1<e&&(nd.CUSTOM_GRAVITY.splice(e,1),t.target.velocity.setZero(),t.target.initVelocity.setZero(),t.target.angularVelocity.setZero(),t.target.initAngularVelocity.setZero(),t.target.force.setZero(),t.target.torque.setZero())},10)),"gel"==t.body.name&&"blue"==t.body.type?(t.target.playingAudioGel||(t.target.playingAudioGel=!0,setTimeout(()=>{t.target.playingAudioGel=!1},2e3)),Qv(t)):("faith_plate"==t.body.name&&U0(t.body,t.target),"radio"!=t.target.name&&"trash"!=t.target.name&&(1.5<Math.abs(t.target.velocity.x)||1.5<Math.abs(t.target.velocity.y)||1.5<Math.abs(t.target.velocity.z))&&(t.target.sound.position.copy(t.target.position),t.target.sound.audio.play()))}),g.addEventListener("sleep",function(e){g.sleeping=!0,g.name}),g.addEventListener("wakeup",e=>{g.sleeping=!1})),nd.CANNON_WORLD.addBody(g),nd.CANNON_BODIES.push(g)}}function V0(e,t,n,i,r,a){for(var o=[],s=0;s<e.length;s++){for(var l=e[s].position[n],u=[],c=0;c<e.length;c++)e[c].checked||e[c].position[n]==l&&(e[c].position.checked=!1,e[c].position.i=e[c].id_instanced,u.push(e[c].position),e[c].checked=!0);0<u.length&&o.push(u.sort((e,t)=>e[i]-t[i]))}for(var h=[],s=0;s<o.length;s++){h.push([]);for(c=0;c<o[s].length;c++){for(var d=o[s][c][r],u=[],p=0;p<o[s].length;p++)o[s][p].checked||o[s][p][r]!=d||0<u.length&&o[s][p][i]-2!=u[u.length-1][i]||(o[s][p].checked=!0,u.push(o[s][p]));0<u.length&&h[s].push(u)}}for(s=0;s<h.length;s++)for(c=0;c<h[s].length;c++){var f,m=0,g=0,v=0,_=("up"==t?g=.09:"down"==t?g=-.09:"front"==t?v=-.09:"back"==t?v=.09:"right"==t?m=.09:"left"==t&&(m=-.09),"up"==t||"down"==t?f=new ed.Vec3(h[s][c].length,.1,1):"front"==t||"back"==t?f=new ed.Vec3(h[s][c].length,1,.1):"right"!=t&&"left"!=t||(f=new ed.Vec3(.1,1,h[s][c].length)),new ed.Box(f)),y=new ed.Body({mass:0,shape:_,material:nd.PHYSICS_MATERIAL}),_=new gd;_.position.copy(new dd(h[s][c][0].x+m,h[s][c][0].y+g,h[s][c][0].z+v)),y.position.copy(_.position),y.position[a]+=h[s][c].length-1,y.collisionFilterGroup=nd.CGROUP_ENVIRONMENT,y.collisionFilterMask=nd.CGROUP_DYNAMIC,y.room=!0,y.side=t,y.name="wall",y.wallRotation=e[0].normal;for(p=0;p<h[s][c].length;p++)nd.PLANE_USER_DATA[h[s][c][p].i].body=y;nd.CANNON_WORLD.addBody(y),nd.CANNON_BODIES.push(y),nd.WALL_BODIES.push(y)}}function W0(e,a){for(var t=0;t<nd.CORRIDOR_COLLIDERS.length;t++)nd.CANNON_WORLD.removeBody(nd.CORRIDOR_COLLIDERS[t]);nd.CORRIDOR_COLLIDERS=[];let o=nd.MATERIAL_FLOOR_NON_PORTAL.clone(),s=(o.side=2,nd.MATERIAL_FLOOR_NON_PORTAL.clone()),l=(s.side=2,s.envMapIntensity=.35,s.roughness=1,s.roughnessMap=null,nd.MATERIAL_WALL_NON_PORTAL.clone());l.side=2,e.traverse(e=>{var t,n,i,r;e.name.includes("collider")?(e.visible=!1,t=e,n=Iu(t,{type:Dg.BOX}),n=new ed.Body({shape:n.shape,mass:0,material:nd.PHYSICS_MATERIAL}),nd.CANNON_BODIES.push(n),r=new dd,t.getWorldPosition(r),i=new hd,t.getWorldQuaternion(i),n.position.copy(r),n.quaternion.copy(i),n.collisionFilterGroup=nd.CGROUP_ENVIRONMENT,n.collisionFilterMask=nd.CGROUP_DYNAMIC,nd.CANNON_WORLD.addBody(n),nd.CANNON_BODIES.push(n),nd.CORRIDOR_COLLIDERS.push(n),t.name.includes("collider_door")&&(nd.BODY_ELEVATOR=n,console.log(n),n.addEventListener("collide",function(e){var t,n;console.log("11111111111111"),nd.LEVEL_ENTERED&&nd.LOADED_LEVEL&&!nd.FINISHED&&(console.log("2222222222222"),nd.FINISHED=!0,window.currentLevel++,console.log(window.currentLevel),localStorage.setItem("level",window.currentLevel),window.isCustom=!1,nd.MOBILE||document.exitPointerLock(),td()("#test-name").text(td()("#chamber-name-to-save").val()),td()("#test-author").text(td()("#author-name-to-save").val()),t=Math.floor(nd.STATS_UI.time/60),n=Math.floor(nd.STATS_UI.time-60*t),td()("#test-portals").text(nd.STATS_UI.portals),td()("#test-time").text(t+":"+n),td()("#test-steps").text(parseInt(nd.STATS_UI.steps)),window.curentTimeOffset=0,document.getElementById("next-map").style.display="flex")}))):e.name.includes("floor")?a||(e.material=o):e.name.includes("ceiling")?a||(e.material=s):e.name.includes("wall")?a||(e.material=l):e.name.includes("emissive")?a?(e.getWorldPosition(window.worlPos.position),window.worlPos.position.y-=4):(e.material=new _d({color:new vd(2,2,2)}),e.children[0]&&e.remove(e.children[0]),(r=new iT(16777215,20)).angle=Math.PI/2,r.penumbra=1,r.decay=1,r.distance=6,r.position.set(0,.1,0),r.name="spot",e.add(r),window.worlPos=new gd,e.getWorldPosition(window.worlPos.position),nd.SCENE_FPS.add(window.worlPos),window.worlPos.position.y-=4,r.target=window.worlPos):e.name.includes("light")?a||(e.material.envMapIntensity=.25):e.name.includes("Cylinder")&&!a&&(e.material=new Ox)})}nd.SCENE.add(nd.GROUP_LINE_TRAGECTORY),td()("#plate-max-height-value").on("change",function(){nd.GROUP_LINE_TRAGECTORY.remove(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.target.line),k0(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.position,nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.target.position,parseInt(this.value),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.target,nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item)}),td()("#faith-plate-line").on("change",function(){nd.GROUP_LINE_TRAGECTORY.visible=this.checked}),td()("#plate-change-target").on("click",function(){nd.SCENE.remove(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.target),nd.GROUP_LINE_TRAGECTORY.remove(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.target.line),B0(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item)});var j0=!0;function Y0(e,t,n,i,r){n||r?(i.getObjectByName("portal_door_right_04").position.z=10,i.getObjectByName("portal_door_left_06").position.z=10):(i.getObjectByName("portal_door_right_04").position.z=-10,i.getObjectByName("portal_door_left_06").position.z=-10),i.timeOutDoor1&&(clearTimeout(i.timeOutDoor1),clearTimeout(i.timeOutDoor2)),i.timeOutDoor1=setTimeout(()=>{var e;j0&&i.sound&&(i.sound.audio.currentTime=0,Ag(i.sound.audio)),j0=!1,setTimeout(()=>{j0=!0},100),e=t?(q0(Math.PI,i,r),400):(X0(-65,i,r),800),i.body&&(i.body.collisionResponse=t?0:1),i.timeOutDoor2=setTimeout(()=>{nd.LEVEL_ENTERED&&i==nd.ENTER_DOOR&&(nd.CORRIDOR_ENTER.visible=!1),t?X0(25,i,r):q0(0,i,r),n&&setTimeout(()=>{nd.EXIT_DOOR.add(nd.CORRIDOR_ENTER),W0(nd.CORRIDOR_ENTER,!0),nd.CORRIDOR_ENTER.getObjectByName("sign").visible=!1},300),nd.LEVEL_ENTERED&&(i==nd.EXIT_DOOR&&nd.FPS_MODE&&!nd.EXIT_DOOR.finished&&(nd.CORRIDOR_ENTER.visible=t),nd.EXIT_DOOR.finished&&(nd.CORRIDOR_ENTER.visible=!0),i==nd.EXIT_DOOR)&&t&&Eg(i.userData)},e)},e)}function q0(e,t,n){n=n?0:400;$g(n,t.getObjectByName("central_spinner_right_05").rotation,new dd(e,t.getObjectByName("central_spinner_right_05").rotation.y,t.getObjectByName("central_spinner_right_05").rotation.z)),$g(n,t.getObjectByName("central_spinner_left_07").rotation,new dd(e,t.getObjectByName("central_spinner_left_07").rotation.y,t.getObjectByName("central_spinner_left_07").rotation.z))}function X0(e,t,n){n=n?0:400;$g(n,t.getObjectByName("portal_door_right_04").position,new dd(e,t.getObjectByName("portal_door_right_04").position.y,t.getObjectByName("portal_door_right_04").position.z)),$g(n,t.getObjectByName("portal_door_left_06").position,new dd(-e,t.getObjectByName("portal_door_left_06").position.y,t.getObjectByName("portal_door_left_06").position.z))}function Z0(e){e.item.userData.state=!e.item.userData.state,e.item.continuous.visible=!e.item.continuous.visible,nd.CANNON_BODIES.push(e.item.bodyLaserField),e.item.userData.state?nd.CANNON_WORLD.addBody(e.item.bodyLaserField):nd.CANNON_WORLD.removeBody(e.item.bodyLaserField)}function K0(e){e.item.userData.state=!e.item.userData.state,e.item.continuous.visible=!e.item.continuous.visible,nd.CANNON_BODIES.push(e.item.bodyBridge),e.item.userData.state?nd.CANNON_WORLD.addBody(e.item.bodyBridge):nd.CANNON_WORLD.removeBody(e.item.bodyBridge),e.item.clone&&e.item.clone.bodyBridge&&(e.item.clone.visible=e.item.continuous.visible,nd.CANNON_BODIES.push(e.item.clone.bodyBridge),e.item.userData.state?nd.CANNON_WORLD.addBody(e.item.clone.bodyBridge):nd.CANNON_WORLD.removeBody(e.item.clone.bodyBridge))}function J0(e){"State"!=e.item.userData.triggers&&"Both"!=e.item.userData.triggers||(e.item.userData.state=!e.item.userData.state,e.item.continuous.visible=!e.item.continuous.visible,e.item.clone&&(e.item.clone.visible=e.item.continuous.visible)),"Direction"!=e.item.userData.triggers&&"Both"!=e.item.userData.triggers||(e.item.userData.reversed=!e.item.userData.reversed,e.item.userData.reversed?e.item.continuous.material=nd.MATERIAL_TRACTOR_BEAM_REVERSE:e.item.continuous.material=nd.MATERIAL_TRACTOR_BEAM,e.item.clone&&(e.item.clone.material=e.item.continuous.material))}function Q0(e){e.body.position.set(e.dispenserPosition.x,e.dispenserPosition.y-1,e.dispenserPosition.z),e.body.mass=e.body.initialMass,e.body.allowSleep=!0,e.body.velocity.setZero(),e.body.initVelocity.setZero(),e.body.angularVelocity.setZero(),e.body.initAngularVelocity.setZero(),e.body.force.setZero(),e.body.torque.setZero(),e.body.wakeUp()}function $0(e){if(!(e.name.includes("gel")||e.name.includes("camera")||e.name.includes("pellet"))){e.velocity.setZero(),e.initVelocity.setZero(),e.angularVelocity.setZero(),e.initAngularVelocity.setZero(),e.force.setZero(),e.torque.setZero(),e.repawning=!0;var t=0,n=0;if("player"==e.name){nd.HOLDING_ITEM&&Nv(),document.getElementById("death-screen").style.backgroundColor="rgb(255, 0, 0)",document.getElementById("death-screen").style.opacity=.75,rd.DEATH.currentTime=0,Ag(rd.DEATH),n=t=500,O0(0),O0(1),nd.PORTAL_BOX=[];for(var i=0;i<nd.CONNECTIONS.length;i++)nd.CONNECTIONS[i].from.instancedName&&nd.CONNECTIONS[i].to.instancedName&&nd.CONNECTIONS[i].from.instancedName.includes("trigger")&&nd.CONNECTIONS[i].to.instancedName.includes("portal")&&(nd.CONNECTIONS[i].line.active=!1)}setTimeout(()=>{e.repawning=!1,e.velocity.setZero(),e.initVelocity.setZero(),e.angularVelocity.setZero(),e.initAngularVelocity.setZero(),e.force.setZero(),e.torque.setZero(),e.position.copy(e.spawnPosition),"player"!=e.name&&(e.mass=0),setTimeout(()=>{"player"!=e.name?(0==e.item.userData.connections?e.mass=5:e.mass=0,e.wakeUp()):document.getElementById("death-screen").style.opacity=0},t)},n)}}function e_(e){nd.LEVEL_ENTERED||(nd.ENTER_DOOR.box3.containsPoint(nd.PLAYER.position)||e||nd.ITEMS_ADDED.getObjectByName("spawn"))&&(nd.LEVEL_ENTERED=!0,nd.RENDERER.compile(nd.SCENE,nd.MAIN_CAMERA),setTimeout(()=>{for(var e=0;e<nd.BOX_BODY.length;e++)nd.BOX_BODY[e].item.userData.opened&&Q0(nd.BOX_BODY[e].item);"none"==nd.PORTAL_GUN_INITIATE&&(document.getElementById("warning-game").innerHTML="Press E to interact with objects!",document.getElementById("warning-game").style.opacity="1",setTimeout(()=>{document.getElementById("warning-game").style.opacity="0"},7e3))},1e3),Y0(1e3,!1,!0,nd.ENTER_DOOR))}function t_(e,t,n,i,r,a){var o=new gd,s=(o.position.copy(n.position),o.rotation.copy(n.rotation),new dd),l=new yT,u=(s.copy(o.position),new dd),c=(u.copy(o.up).applyQuaternion(o.quaternion),l.set(s,u),l.item=n,l.intersectObject(nd.PLANE_LEVEL_INSTANCED));if(r){if(t.distance==c[0].distance)return;nd.ITEMS_ADDED.remove(n.continuous),n.bodyBridge&&nd.CANNON_WORLD.removeBody(n.bodyBridge),n.bodyLaserField&&nd.CANNON_WORLD.removeBody(n.bodyLaserField),t.distance=c[0].distance}var s=nd.MATERIAL_LIGHT_BRIDGERS,h=(nd.SCENE.remove(o),new gd);if(h.position.copy(n.position),h.rotation.copy(n.rotation),h.rotateX(Math.PI),h.translateY(-c[0].distance),h.position.copy(h.position.round()),"light_bridge"==e)var d=new dA(.9,c[0].distance,.1);else if("glass"==e)var d=new dA(2,c[0].distance,.1);else if("laser_field"==e||"fizzler"==e)"laser_field"==e?(d=new EA(2,c[0].distance),s=nd.MATERIAL_LASER_FIELD,n.cloneLaserID=n.userData.idInstanced+10):"fizzler"==e&&(d=new dA(2,c[0].distance,.025),s=nd.MATERIAL_FIZZLER,n.cloneFizzlerID=n.userData.idInstanced+10),h.updateMatrix(),i.setMatrixAt(n.userData.idInstanced+10,h.matrix),i.instanceMatrix.needsUpdate=!0,i.computeBoundingSphere(),n.cloneLaserDistance=c[0].distance,n.cloneLaserField=h;else if("tractor_beam"==e){for(var i=(d=new vx(.8,.8,c[0].distance+0,32,1,!0)).attributes.position.array,p=new Float32Array(i.length/3),f=0;f<p.length;f++)p[f]=c[0].distance/5;d.setAttribute("height",new yd(p,1)),s=n.userData.reversed?nd.MATERIAL_TRACTOR_BEAM_REVERSE:nd.MATERIAL_TRACTOR_BEAM}l.name=e,l.far=c[0].distance+.1,r?t=l:t.push(l);var i=new xd(d,s),t=(nd.ITEMS_ADDED.add(i),window.uuuu=i,"tractor_beam"==e&&(i.updateMatrix(),i.geometry.applyMatrix4(i.matrix)),i.position.copy(o.position),i.rotation.copy(o.rotation),i.translateY(c[0].distance/2),i.distance=c[0].distance/2,i.renderOrder=-1,"laser_field"!=e&&"fizzler"!=e||i.rotateX(Math.PI),Iu(i,{type:Dg.BOX})),d=new ed.Material,s=(d.friction=.4,new ed.Body({shape:t.shape,mass:d.restitution=0,material:d})),o=(s.position.copy(i.position),s.quaternion.copy(i.quaternion),n.continuous=i,n.raycaster=l,Zg(h.position.x+"/"+h.position.y+"/"+h.position.z));l.distance=c[0].distance,"tractor_beam"!=e&&"light_bridge"!=e&&(nd.PLANE_USER_DATA[o[0].id_instanced].portal=!1,nd.PLANE_USER_DATA[o[0].id_instanced].planeColor=8421504,nd.PLANE_LEVEL_INSTANCED.setColorAt(o[0].id_instanced,new vd(8421504))),0<o.length&&"tractor_beam"!=e&&(o[0].continuousEnding=!0,i.otherSide=o[0]),"glass"==e&&(n.userData.grid?_g(i,nd.MATERIAL_GRID,c[0].distance/3):i.material=nd.MATERIAL_GLASS,window.glass.push(i)),n.userData.state||(i.visible=!1),"light_bridge"==e||"glass"==e?(s.collisionFilterGroup=nd.CGROUP_ENVIRONMENT,s.collisionFilterMask=nd.CGROUP_DYNAMIC,s.name=e,n.bodyBridge=s,nd.CANNON_BODIES_CONTINUOUS.push(s),n.userData.state&&nd.CANNON_WORLD.addBody(s)):"laser_field"==e||"fizzler"==e?(s.collisionFilterGroup=nd.CGROUP_ENVIRONMENT,s.collisionFilterMask=nd.CGROUP_DYNAMIC,s.collisionResponse=0,(n.bodyLaserField=s).isItem=!0,nd.CANNON_BODIES_CONTINUOUS.push(s),n.userData.state&&nd.CANNON_WORLD.addBody(s),"laser_field"==e?s.addEventListener("collide",function(e){e.body===nd.PLAYER&&(document.getElementById("death-screen").style.backgroundColor="rgb(255 0 0)",document.getElementById("death-screen").style.opacity=1,$0(e.body))}):"fizzler"==e&&(s.name="fizzler",H0(s))):"tractor_beam"==e&&((t=new pd).setFromObject(i),t.side=1,i.inTractor=!1,i.item=n,i.dir=u,r?(nd.TRACTOR_BEAM[a]=i,nd.TRACTOR_BEAM_BOUNDING_BOX[a]=t):(nd.TRACTOR_BEAM.push(i),nd.TRACTOR_BEAM_BOUNDING_BOX.push(t)))}function n_(e,t){if(null!==nd.PORTALS[0]&&null!==nd.PORTALS[1])for(var n=0;n<t.length;n++){var i=t[n].intersectObjects(nd.PORTAL_SHADER);if(0<i.length){e="portal-0"==i[0].object.name?1:0,"light_bridge"==t[n].name?nd.LIGHT_BRIDGE_CLONE[n]&&(nd.ITEMS_ADDED.remove(nd.LIGHT_BRIDGE_CLONE[n]),nd.CANNON_WORLD.removeBody(nd.LIGHT_BRIDGE_COLLIDER_CLONE[n]),nd.LIGHT_BRIDGE_CLONE[n].item.clone=null):"tractor_beam"==t[n].name&&nd.TRACTOR_BEAM[nd.TRACTOR_BEAM_LENGTH+n]&&(nd.ITEMS_ADDED.remove(nd.TRACTOR_BEAM[nd.TRACTOR_BEAM_LENGTH+n]),nd.TRACTOR_BEAM_BOUNDING_BOX[nd.TRACTOR_BEAM_LENGTH+n]=null);var r=new dd,a=(nd.PORTAL_SHADER[e].getWorldDirection(r),new yT),o=(a.set(nd.PORTAL_SHADER[e].position,r),a.intersectObject(nd.PLANE_LEVEL_INSTANCED));if(0<i.length)if("light_bridge"==t[n].name){if(!(.3<i[0].uv.x&&i[0].uv.x<.7))return;nd.LIGHT_BRIDGE_CLONE[n]&&(nd.ITEMS_ADDED.remove(nd.LIGHT_BRIDGE_CLONE[n]),nd.CANNON_WORLD.removeBody(nd.LIGHT_BRIDGE_COLLIDER_CLONE[n]),nd.LIGHT_BRIDGE_CLONE[n].item.clone=null)}else if("tractor_beam"==t[n].name){if(!(.3<i[0].uv.x&&i[0].uv.x<.7&&.3<i[0].uv.y&&i[0].uv.y<.7))return;nd.TRACTOR_BEAM[nd.TRACTOR_BEAM_LENGTH+n]&&(nd.ITEMS_ADDED.remove(nd.TRACTOR_BEAM[nd.TRACTOR_BEAM_LENGTH+n]),nd.TRACTOR_BEAM_BOUNDING_BOX[nd.TRACTOR_BEAM_LENGTH+n]=null)}a=nd.MATERIAL_LIGHT_BRIDGERS;if("light_bridge"==t[n].name)var s=new dA(.9,.025,o[0].distance);else if("tractor_beam"==t[n].name){for(var l=(s=new vx(.9,.9,o[0].distance+0,32,1,!0)).attributes.position.array,u=new Float32Array(l.length/3),c=0;c<u.length;c++)u[c]=o[0].distance/5;s.setAttribute("height",new yd(u,1)),a=nd.MATERIAL_TRACTOR_BEAM}var l=new xd(s,a),a=(nd.ITEMS_ADDED.add(l),"tractor_beam"==t[n].name&&(l.rotation.x=Math.PI/2,l.updateMatrix(),l.geometry.applyMatrix4(l.matrix)),l.position.copy(nd.PORTAL_SHADER[e].position),l.rotation.copy(nd.PORTAL_SHADER[e].rotation),!1),h=("light_bridge"==t[n].name&&((h=new gd).rotation.copy(l.rotation),h.position.copy(l.position),"Middle Vertical"!=t[n].item.userData.triggers&&"Left"!=t[n].item.userData.triggers&&"Right"!=t[n].item.userData.triggers||(h.rotateZ(Math.PI/2),a=!0),l.rotation.copy(h.rotation)),l.translateZ(o[0].distance/2),a?(l.translateX(1.8*(i[0].uv.y-.5)),l.translateY(.9*(i[0].uv.x-.5))):(l.translateY(1.8*(i[0].uv.y-.5)),l.translateX(-.9*(i[0].uv.x-.5))),Iu(l,{type:Dg.BOX})),a=new ed.Material,i=(a.friction=.4,new ed.Body({shape:h.shape,mass:a.restitution=0,material:a}));i.position.copy(l.position),i.quaternion.copy(l.quaternion),l.visible=t[n].item.continuous.visible,l.material=t[n].item.continuous.material,l.item=t[n].item,t[n].item.clone=l,nd.PORTALS[e].field=l,"light_bridge"==t[n].name?(i.collisionFilterGroup=nd.CGROUP_ENVIRONMENT,i.collisionFilterMask=nd.CGROUP_DYNAMIC,nd.CANNON_BODIES_CONTINUOUS.push(i),nd.CANNON_WORLD.addBody(i),nd.LIGHT_BRIDGE_CLONE[n]=l,nd.LIGHT_BRIDGE_COLLIDER_CLONE[n]=i,t[n].item.clone.bodyBridge=i,nd.PORTALS[e].fieldBody=i,nd.PORTALS[e].fieldBodyClone=t[n].item.clone):"tractor_beam"==t[n].name&&((a=new pd).setFromObject(l),a.side=1,l.inTractor=!1,l.dir=r,nd.TRACTOR_BEAM[nd.TRACTOR_BEAM_LENGTH+n]=l,nd.TRACTOR_BEAM_BOUNDING_BOX[nd.TRACTOR_BEAM_LENGTH+n]=a,nd.PORTALS[e].fieldTrigger=a)}else"light_bridge"==t[n].name?nd.LIGHT_BRIDGE_CLONE[n]&&(nd.ITEMS_ADDED.remove(nd.LIGHT_BRIDGE_CLONE[n]),nd.CANNON_WORLD.removeBody(nd.LIGHT_BRIDGE_COLLIDER_CLONE[n]),nd.LIGHT_BRIDGE_CLONE[n].item.clone=null):"tractor_beam"==t[n].name&&nd.TRACTOR_BEAM[nd.TRACTOR_BEAM_LENGTH+n]&&(nd.ITEMS_ADDED.remove(nd.TRACTOR_BEAM[nd.TRACTOR_BEAM_LENGTH+n]),nd.TRACTOR_BEAM_BOUNDING_BOX[nd.TRACTOR_BEAM_LENGTH+n]=null)}}function i_(e,t,n,i){e.userData.triggers=t,n.data("trigger",t),n.find(".title").text(t);var n=new gd,r=(n.position.copy(new dd(e.position.x,e.position.y,e.position.z)),n.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),.8);"glass"==i&&(r=.99),"Middle Vertical"==t?n.rotateY(Math.PI/2):"Top"==t?n.translateZ(-r):"Bottom"==t?n.translateZ(r):"Left"==t?(n.rotateY(Math.PI/2),n.translateZ(-r)):"Right"==t&&(n.rotateY(Math.PI/2),n.translateZ(r)),e.raycaster.ray.origin=n.position,e.continuous.position.copy(n.position),e.continuous.rotation.copy(n.rotation),e.continuous.translateY(e.continuous.distance),"light_bridge"!=i&&"glass"!=i||(e.bodyBridge.position.copy(e.continuous.position),e.bodyBridge.quaternion.copy(n.quaternion)),"glass"!=i&&(n.updateMatrix(),(t=nd.ITEMS_ADDED.getObjectByName(i)).setMatrixAt(e.userData.idInstanced,n.matrix),"laser_field"!=i&&"fizzler"!=i||(e.bodyLaserField.position.copy(e.continuous.position),e.bodyLaserField.quaternion.copy(n.quaternion),n.rotateX(Math.PI),n.translateY(-e.cloneLaserDistance),n.updateMatrix(),"laser_field"==i?t.setMatrixAt(e.cloneLaserID,n.matrix):"fizzler"==i&&t.setMatrixAt(e.cloneFizzlerID,n.matrix)),t.instanceMatrix.needsUpdate=!0,t.computeBoundingSphere())}window.glass=[],window.tractorClones=[];var r_,a_={},o_=[],s_=new Sd;function l_(e,t,i,r,n){s_=new Sd,o_=[],a_={};var a=[],o=new EA(.5,.5),s=new _d({color:256252,side:He,polygonOffset:!0,polygonOffsetFactor:-7,map:nd.IMG_CLOSE}),o=new xd(o,s),s=!0;"up"==i.side?(o.rotation.x=Math.PI/2,o.position.set(1.3*i.normal.z+t.x,t.y,1.3*i.normal.x+t.z)):"down"==i.side?(o.rotation.x=-Math.PI/2,o.position.set(t.x,t.y,t.z),s=!1):o.position.set(1.3*i.normal.z+t.x,t.y,1.3*i.normal.x+t.z),nd.CONNECTING=!1,nd.MATERIAL_PORTAL_EDITOR.opacity=1,nd.MATERIAL_NON_PORTAL_EDITOR.opacity=1,nd.MATERIAL_PORTAL_EDITOR.transparent=!1,nd.MATERIAL_NON_PORTAL_EDITOR.transparent=!1,nd.SCENE_CHILDREN.remove(r_);for(var l=0;l<nd.PLANE_USER_DATA.length;l++)nd.PLANE_USER_DATA[l].exists&&!nd.PLANE_USER_DATA[l].hasItem&&a.push(nd.PLANE_USER_DATA[l]);a.push(i),a.push(r);for(var u={},l=0;l<a.length;l++){var c=new gd;c.position.copy(a[l].position),c.rotation.copy(a[l].rotation),c.node=a[l],c.name=a[l].name,s_.add(c),o_.push(c)}for(var h=0;h<o_.length;h++){u[o_[h].id]={};for(l=1;l<o_.length;l++){var d=h_(o_[h].position,o_[l].position);o_[h].id!=o_[l].id&&d<=2&&(u[o_[h].id][o_[l].id]=d)}}for(var o=new m_(u),i=s_.getObjectByName(e.x+"/"+e.y+"/"+e.z).id,e=s_.getObjectByName(t.x+"/"+t.y+"/"+t.z).id,t=s,s=r,r=n,p=o.findShortestPath(i,e),f=[],m=[],g=[],v=[],_=[],y=[],E=0;E<p.length-1;E++){var A=p[E],x=(p[E]in a_||(a_[p[E]]=!0),p[E+1]),A=(p[E+1]in a_||(a_[p[E+1]]=!0),s_.getObjectById(parseInt(A),!0)),x=s_.getObjectById(parseInt(x),!0);h_(A.position,x.position),A.node.hasLine=!0,v.push(A.position),g.push(A.rotation),E>=p.length-2&&(v.push(x.position),g.push(x.rotation))}f.push(v[0]),m.push(g[0]);for(var T=1;T<v.length;T++){if(!g[T-1].equals(g[T]))for(var S=((e,t)=>{var n=new EA(2,2),i=new _d,t=((i=new xd(n,i)).position.copy(e),i.rotation.copy(t),i.updateMatrixWorld(!0),nd.SCENE.add(i),(e=n.parameters.width)/2),e=n.parameters.height/2,n=i.matrixWorld,r=new dd(0,e,0),e=new dd(0,-e,0),a=new dd(-t,0,0),t=new dd(t,0,0);return r.applyMatrix4(n),e.applyMatrix4(n),a.applyMatrix4(n),t.applyMatrix4(n),nd.SCENE.remove(i),[r.round(),e.round(),a.round(),t.round()]})(v[T-1],g[T-1]),w=0;w<S.length;w++)if(S[w].distanceTo(v[T])<=1){m.push(g[T-1]),f.push(S[w]);break}v[T]=c_(v[T],g[T]),m.push(g[T]),f.push(v[T]),(new dd).subVectors(f[T-1],v[T]).normalize()}if(o=new dd,f[f.length-2]&&f[f.length-1]){o.subVectors(f[f.length-2],f[f.length-1]).normalize(),t&&(f[f.length-1].x+=o.x,f[f.length-1].y+=o.y,f[f.length-1].z+=o.z);let n=0;for(let e=0;e<f.length-1;e++)n+=f[e].distanceTo(f[e+1]);var b=4*n,M=new Rx(.04,16,8),i=new _d({color:new vd(0,2,5)});for(let e=0;e<b;e++){var R=e/(b-1)*n;let t=0;for(let e=0;e<f.length-1;e++){var N=f[e].distanceTo(f[e+1]);if(t+N>=R){var I=(R-t)/N,I=(new dd).lerpVectors(f[e],f[e+1],I);_.push(I),y.push(m[e]);break}t+=N}}var C=new fd,L=[];for(let e=0;e<_.length;e++){var D=new gd,D=(D.position.copy(_[e]),D.rotation.copy(y[e]),D.updateMatrix(),C.compose(D.position,D.quaternion,D.scale),M.clone());D.applyMatrix4(C),L.push(D)}e=e0(L),t=new xd(e,i);"trigger_area"!=s.instancedName&&nd.SCENE_FPS.add(t),r.line2=t}else r.line.visible=!0,r.line2=r.line}var u_=[];function c_(e,t){var n,i=new gd;return i.position.copy(e),i.rotation.copy(t),i.translateY(.2*(n=e,u_.filter(e=>e.equals(n)).length)),t=i.position.clone(),u_.push(e.clone()),t}function h_(e,t){var n=t.x-e.x,i=t.y-e.y,t=t.z-e.z;return Math.sqrt(n*n+i*i+t*t)}p_=function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push(t);return n},f_=function(e,t){return parseFloat(e)-parseFloat(t)},__.prototype.findShortestPath=function(e,t){return"[object Array]"===Object.prototype.toString.call(e)?v_(this.map,e):v_(this.map,2===arguments.length?[e,t]:((t,n)=>{try{return Array.prototype.slice.call(t,n)}catch(e){for(var i=[],r=n||0,a=t.length;r<a;++r)i.push(t[r]);return i}})(arguments))},__.prototype.map=function(){return this.map},__.prototype.nodes=function(){return this.keys},__.prototype.edges=function(){return this.connectors};var d_,p_,f_,m_=__;function g_(e,t,n,i){this.start=t,this.end=n;var r,a={},o={0:[t]},s={};for(a[t]=0;o&&(r=p_(o)).length;){r.sort(f_);var l,u,c,h,d=r[0],p=o[d],f=p.shift(),m=parseFloat(d),g=e[f]||{};for(l in p.length||delete o[d],g)Object.prototype.hasOwnProperty.call(g,l)&&(u=g[l]+m,(c=a[l])===d_||u<c)&&(h=c=void 0,c=a[l]=u,h=l,o[c=""+c]||(o[c]=[]),o[c].push(h),s[l]=f)}return a[n]===d_?null:s}function v_(e,t){for(var n,i,r=t.shift(),a=[];t.length;){if(n=t.shift(),!(i=new g_(e,r,n)))return null;if(i=((e,t)=>{for(var n=[],i=t;i;)n.push(i),i=e[i];return n.reverse(),n})(i,n),!t.length)return a.concat(i);a.push.apply(a,i.slice(0,-1)),r=n}}function __(t){this.map=t,this.keys=Object.keys(t);for(var n=this.keys.map(function(e){return t[e]}),e=[],i=0;i<this.keys.length;i++)for(var r=Object.keys(n[i]),a=r.map(function(e){return n[i][e].toString()}),o=0;o<r.length;o++)e.push([this.keys[i],r[o],a[o]]);this.connectors=e}function y_(e){let i=new Map,r=new Map;var t=e.clone();return function t(n,i,r){r(n,i);for(let e=0;e<n.children.length;e++)t(n.children[e],i.children[e],r)}(e,t,function(e,t){i.set(t,e),r.set(e,t)}),t.traverse(function(e){var t,n;e.isSkinnedMesh&&(t=e,n=(e=i.get(e)).skeleton.bones,t.skeleton=e.skeleton.clone(),t.bindMatrix.copy(e.bindMatrix),t.skeleton.bones=n.map(function(e){return r.get(e)}),t.bind(t.skeleton,t.bindMatrix))}),t}pg=new Rx(.1,8,4),Gv=new Ox({color:16777215,depthTest:!1,transparent:!0}),window.checkers=new Cd(pg,Gv,{createInstances:!0}),window.checkers.addInstances(1e3,(e,t)=>{e.color="white",e.visible=!1}),window.checkers.instanceMatrix.needsUpdate=!0,nd.SCENE.add(window.checkers),window.checkersIndexes=[];for(var E_=0;E_<1e3;E_++)window.checkersIndexes.push(!1);let Pc=new vd(0,2,5);function A_(e,t){if(nd.CONNECTING=!1,nd.MATERIAL_PORTAL_EDITOR.opacity=1,nd.MATERIAL_NON_PORTAL_EDITOR.opacity=1,nd.MATERIAL_PORTAL_EDITOR.transparent=!1,nd.MATERIAL_NON_PORTAL_EDITOR.transparent=!1,nd.SCENE_CHILDREN.remove(nd.CURRENT_LINE),!nd.PLANE_USER_DATA[e].item||nd.PLANE_USER_DATA[e].item.userData){if(nd.FAITH_PLATE_TARGET)z0(nd.PLANE_USER_DATA[e]);else if(nd.PLANE_USER_DATA[e].allowconnection&&!nd.SELECTED_FOR_CONNECTION.item.userData.connectedTo.includes(nd.PLANE_USER_DATA[e].id_instanced)&nd.PLANE_USER_DATA[e].item.userData.connections<10){var n,i;nd.PLANE_USER_DATA[e].item.userData.connections+=1;for(var r=0;r<10;r++)if(!(i=nd.PLANE_USER_DATA[e].item.checkersSlots[r]).visible){i.visible=!0;for(var a=i.position,o=0;o<window.checkersIndexes.length;o++)if(!window.checkersIndexes[o]){window.checkersIndexes[o]=!0,window.checkers.instances[o].position.copy(a),window.checkers.setVisibilityAt(o,!0),window.checkers.setColorAt(o,Pc),window.checkers.instances[o].updateMatrix(),window.checkers.computeBoundingSphere(),n=o;break}break}var s=x_(t,a);nd.LINES.add(s),nd.CONNECTIONS.push({line:s,from:t,line2:null,to:nd.PLANE_USER_DATA[e],checker:n,clone:i}),t.item.userData.connectedTo.push(e)}nd.ITEM_CUBE.visible=!1,nd.CURRENT_LINE=null}}function x_(e,t){var n=[],t=(n.push(e.position),n.push(t),(new Ad).setFromPoints(n)),n=new XA({transparent:!0,color:Pc}),t=new ZA(t,n);return t.visible=e.item.userData.showLines,t}td()("body").on("click",".removeConnection",function(){nd.LINES.remove(nd.CONNECTIONS[td()(this).data("id")].line),window.checkers.instances[nd.CONNECTIONS[td()(this).data("id")].checker].visible=!1,window.checkersIndexes[nd.CONNECTIONS[td()(this).data("id")].checker]=!1,nd.CONNECTIONS[td()(this).data("id")].clone.visible=!1,--nd.CONNECTIONS[td()(this).data("id")].to.item.userData.connections;var e=nd.CONNECTIONS[td()(this).data("id")].from.item.userData.connectedTo.indexOf(nd.CONNECTIONS[td()(this).data("id")].to.id_instanced);-1<e&&nd.CONNECTIONS[td()(this).data("id")].from.item.userData.connectedTo.splice(e,1),nd.CONNECTIONS.splice(td()(this).data("id"),1),td()("#connections").empty();for(var t,n=0;n<nd.CONNECTIONS.length;n++)nd.CONNECTIONS[n].from.itemName==nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].itemName&&(t='<li data-id="'+n+'" class="menu-item removeConnection"><button type="button" class="menu-btn"><i class="fas fa-times"></i><span class="menu-text">'+nd.CONNECTIONS[n].to.itemName+"</span></button></li>",td()("#connections").append(t))}),td()("body").on("mouseenter",".removeConnection",function(){nd.CONNECTIONS[td()(this).data("id")]&&(nd.ITEM_CUBE.position.copy(nd.CONNECTIONS[td()(this).data("id")].to.position),nd.ITEM_CUBE.rotation.copy(nd.CONNECTIONS[td()(this).data("id")].to.rotation),nd.ITEM_CUBE.translateZ(1),nd.ITEM_CUBE.material.color=new vd(16711680),nd.ITEM_CUBE.visible=!0)}),td()("body").on("mouseleave",".removeConnection",function(){nd.ITEM_CUBE.visible=!1});class HS extends Kx{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new YS(e)}),this.register(function(e){return new qS(e)}),this.register(function(e){return new nw(e)}),this.register(function(e){return new iw(e)}),this.register(function(e){return new rw(e)}),this.register(function(e){return new ZS(e)}),this.register(function(e){return new KS(e)}),this.register(function(e){return new JS(e)}),this.register(function(e){return new QS(e)}),this.register(function(e){return new jS(e)}),this.register(function(e){return new $S(e)}),this.register(function(e){return new XS(e)}),this.register(function(e){return new tw(e)}),this.register(function(e){return new ew(e)}),this.register(function(e){return new VS(e)}),this.register(function(e){return new aw(e)}),this.register(function(e){return new ow(e)})}load(t,n,e,i){let r=this,a;a=""!==this.resourcePath?this.resourcePath:""!==this.path?(s=uT.extractUrlBase(t),uT.resolveURL(s,this.path)):uT.extractUrlBase(t),this.manager.itemStart(t);function o(e){i?i(e):console.error(e),r.manager.itemError(t),r.manager.itemEnd(t)}var s=new Qx(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,function(e){try{r.parse(e,a,function(e){n(e),r.manager.itemEnd(t)},o)}catch(e){o(e)}},e,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let r;var a={},o={},s=new TextDecoder;if("string"==typeof e)r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(s.decode(new Uint8Array(e,0,4))===Uc){try{a[v.KHR_BINARY_GLTF]=new sw(e)}catch(e){return void(i&&i(e))}r=JSON.parse(a[v.KHR_BINARY_GLTF].content)}else r=JSON.parse(s.decode(e));else r=e;if(void 0===r.asset||r.asset.version[0]<2)i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var l=new pw(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){var u=this.pluginCallbacks[e](l);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[(o[u.name]=u).name]=!0}if(r.extensionsUsed)for(let e=0;e<r.extensionsUsed.length;++e){var c=r.extensionsUsed[e],h=r.extensionsRequired||[];switch(c){case v.KHR_MATERIALS_UNLIT:a[c]=new WS;break;case v.KHR_DRACO_MESH_COMPRESSION:a[c]=new lw(r,this.dracoLoader);break;case v.KHR_TEXTURE_TRANSFORM:a[c]=new uw;break;case v.KHR_MESH_QUANTIZATION:a[c]=new cw;break;default:0<=h.indexOf(c)&&void 0===o[c]&&console.warn('THREE.GLTFLoader: Unknown extension "'+c+'".')}}l.setExtensions(a),l.setPlugins(o),l.parse(n,i)}}parseAsync(n,i){let r=this;return new Promise(function(e,t){r.parse(n,i,e,t)})}}function T_(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}let v={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class VS{constructor(e){this.parser=e,this.name=v.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){var n=this.parser,i=this.parser.json.nodes||[];for(let e=0,t=i.length;e<t;e++){var r=i[e];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&n._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(t){var n=this.parser,i="light:"+t,r=n.cache.get(i);if(!r){var a=n.json,o=((a.extensions&&a.extensions[this.name]||{}).lights||[])[t];let e;var s=new vd(16777215),l=(void 0!==o.color&&s.setRGB(o.color[0],o.color[1],o.color[2],Ye),void 0!==o.range?o.range:0);switch(o.type){case"directional":(e=new sT(s)).target.position.set(0,0,-1),e.add(e.target);break;case"point":(e=new aT(s)).distance=l;break;case"spot":(e=new iT(s)).distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,e.angle=o.spot.outerConeAngle,e.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,e.target.position.set(0,0,-1),e.add(e.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}e.position.set(0,0,0),e.decay=2,w_(e,o),void 0!==o.intensity&&(e.intensity=o.intensity),e.name=n.createUniqueName(o.name||"light_"+t),r=Promise.resolve(e),n.cache.add(i,r)}return r}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){let t=this,n=this.parser;e=n.json.nodes[e];let i=(e.extensions&&e.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then(function(e){return n._getNodeRef(t.cache,i,e)})}}class WS{constructor(){this.name=v.KHR_MATERIALS_UNLIT}getMaterialType(){return _d}extendParams(e,t,n){var i,r=[],t=(e.color=new vd(1,1,1),e.opacity=1,t.pbrMetallicRoughness);return t&&(Array.isArray(t.baseColorFactor)&&(i=t.baseColorFactor,e.color.setRGB(i[0],i[1],i[2],Ye),e.opacity=i[3]),void 0!==t.baseColorTexture)&&r.push(n.assignTexture(e,"map",t.baseColorTexture,je)),Promise.all(r)}}class jS{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){var e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]&&void 0!==(e=e.extensions[this.name].emissiveStrength)&&(t.emissiveIntensity=e),Promise.resolve()}}class YS{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?Px:null}extendMaterialParams(e,t){var n,i=this.parser,e=i.json.materials[e];return e.extensions&&e.extensions[this.name]?(n=[],void 0!==(e=e.extensions[this.name]).clearcoatFactor&&(t.clearcoat=e.clearcoatFactor),void 0!==e.clearcoatTexture&&n.push(i.assignTexture(t,"clearcoatMap",e.clearcoatTexture)),void 0!==e.clearcoatRoughnessFactor&&(t.clearcoatRoughness=e.clearcoatRoughnessFactor),void 0!==e.clearcoatRoughnessTexture&&n.push(i.assignTexture(t,"clearcoatRoughnessMap",e.clearcoatRoughnessTexture)),void 0!==e.clearcoatNormalTexture&&(n.push(i.assignTexture(t,"clearcoatNormalMap",e.clearcoatNormalTexture)),void 0!==e.clearcoatNormalTexture.scale)&&(i=e.clearcoatNormalTexture.scale,t.clearcoatNormalScale=new ld(i,i)),Promise.all(n)):Promise.resolve()}}class qS{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_DISPERSION}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?Px:null}extendMaterialParams(e,t){var e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]&&(e=e.extensions[this.name],t.dispersion=void 0!==e.dispersion?e.dispersion:0),Promise.resolve()}}class XS{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?Px:null}extendMaterialParams(e,t){var n,i=this.parser,e=i.json.materials[e];return e.extensions&&e.extensions[this.name]?(n=[],void 0!==(e=e.extensions[this.name]).iridescenceFactor&&(t.iridescence=e.iridescenceFactor),void 0!==e.iridescenceTexture&&n.push(i.assignTexture(t,"iridescenceMap",e.iridescenceTexture)),void 0!==e.iridescenceIor&&(t.iridescenceIOR=e.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==e.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=e.iridescenceThicknessMinimum),void 0!==e.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=e.iridescenceThicknessMaximum),void 0!==e.iridescenceThicknessTexture&&n.push(i.assignTexture(t,"iridescenceThicknessMap",e.iridescenceThicknessTexture)),Promise.all(n)):Promise.resolve()}}class ZS{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_SHEEN}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?Px:null}extendMaterialParams(e,t){var n,i,r=this.parser,e=r.json.materials[e];return e.extensions&&e.extensions[this.name]?(n=[],t.sheenColor=new vd(0,0,0),t.sheenRoughness=0,t.sheen=1,void 0!==(e=e.extensions[this.name]).sheenColorFactor&&(i=e.sheenColorFactor,t.sheenColor.setRGB(i[0],i[1],i[2],Ye)),void 0!==e.sheenRoughnessFactor&&(t.sheenRoughness=e.sheenRoughnessFactor),void 0!==e.sheenColorTexture&&n.push(r.assignTexture(t,"sheenColorMap",e.sheenColorTexture,je)),void 0!==e.sheenRoughnessTexture&&n.push(r.assignTexture(t,"sheenRoughnessMap",e.sheenRoughnessTexture)),Promise.all(n)):Promise.resolve()}}class KS{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?Px:null}extendMaterialParams(e,t){var n,i=this.parser,e=i.json.materials[e];return e.extensions&&e.extensions[this.name]?(n=[],void 0!==(e=e.extensions[this.name]).transmissionFactor&&(t.transmission=e.transmissionFactor),void 0!==e.transmissionTexture&&n.push(i.assignTexture(t,"transmissionMap",e.transmissionTexture)),Promise.all(n)):Promise.resolve()}}class JS{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_VOLUME}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?Px:null}extendMaterialParams(e,t){var n,i=this.parser,e=i.json.materials[e];return e.extensions&&e.extensions[this.name]?(n=[],e=e.extensions[this.name],t.thickness=void 0!==e.thicknessFactor?e.thicknessFactor:0,void 0!==e.thicknessTexture&&n.push(i.assignTexture(t,"thicknessMap",e.thicknessTexture)),t.attenuationDistance=e.attenuationDistance||1/0,i=e.attenuationColor||[1,1,1],t.attenuationColor=(new vd).setRGB(i[0],i[1],i[2],Ye),Promise.all(n)):Promise.resolve()}}class QS{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_IOR}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?Px:null}extendMaterialParams(e,t){var e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]&&(e=e.extensions[this.name],t.ior=void 0!==e.ior?e.ior:1.5),Promise.resolve()}}class $S{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_SPECULAR}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?Px:null}extendMaterialParams(e,t){var n,i,r=this.parser,e=r.json.materials[e];return e.extensions&&e.extensions[this.name]?(n=[],e=e.extensions[this.name],t.specularIntensity=void 0!==e.specularFactor?e.specularFactor:1,void 0!==e.specularTexture&&n.push(r.assignTexture(t,"specularIntensityMap",e.specularTexture)),i=e.specularColorFactor||[1,1,1],t.specularColor=(new vd).setRGB(i[0],i[1],i[2],Ye),void 0!==e.specularColorTexture&&n.push(r.assignTexture(t,"specularColorMap",e.specularColorTexture,je)),Promise.all(n)):Promise.resolve()}}class ew{constructor(e){this.parser=e,this.name=v.EXT_MATERIALS_BUMP}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?Px:null}extendMaterialParams(e,t){var n,i=this.parser,e=i.json.materials[e];return e.extensions&&e.extensions[this.name]?(n=[],e=e.extensions[this.name],t.bumpScale=void 0!==e.bumpFactor?e.bumpFactor:1,void 0!==e.bumpTexture&&n.push(i.assignTexture(t,"bumpMap",e.bumpTexture)),Promise.all(n)):Promise.resolve()}}class tw{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?Px:null}extendMaterialParams(e,t){var n,i=this.parser,e=i.json.materials[e];return e.extensions&&e.extensions[this.name]?(n=[],void 0!==(e=e.extensions[this.name]).anisotropyStrength&&(t.anisotropy=e.anisotropyStrength),void 0!==e.anisotropyRotation&&(t.anisotropyRotation=e.anisotropyRotation),void 0!==e.anisotropyTexture&&n.push(i.assignTexture(t,"anisotropyMap",e.anisotropyTexture)),Promise.all(n)):Promise.resolve()}}class nw{constructor(e){this.parser=e,this.name=v.KHR_TEXTURE_BASISU}loadTexture(e){var t=this.parser,n=t.json,i=n.textures[e];if(i.extensions&&i.extensions[this.name]){var i=i.extensions[this.name],r=t.options.ktx2Loader;if(r)return t.loadTextureImage(e,i.source,r);if(n.extensionsRequired&&0<=n.extensionsRequired.indexOf(this.name))throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}return null}}class iw{constructor(e){this.parser=e,this.name=v.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){let n=this.name,i=this.parser,r=i.json;var e=r.textures[t];if(!e.extensions||!e.extensions[n])return null;let a=e.extensions[n];var e=r.images[a.source];let o=i.textureLoader;return e.uri&&null!==(e=i.options.manager.getHandler(e.uri))&&(o=e),this.detectSupport().then(function(e){if(e)return i.loadTextureImage(t,a.source,o);if(r.extensionsRequired&&0<=r.extensionsRequired.indexOf(n))throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class rw{constructor(e){this.parser=e,this.name=v.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){let n=this.name,i=this.parser,r=i.json;var e=r.textures[t];if(!e.extensions||!e.extensions[n])return null;let a=e.extensions[n];var e=r.images[a.source];let o=i.textureLoader;return e.uri&&null!==(e=i.options.manager.getHandler(e.uri))&&(o=e),this.detectSupport().then(function(e){if(e)return i.loadTextureImage(t,a.source,o);if(r.extensionsRequired&&0<=r.extensionsRequired.indexOf(n))throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class aw{constructor(e){this.name=v.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){var t=this.parser.json,e=t.bufferViews[e];if(e.extensions&&e.extensions[this.name]){let o=e.extensions[this.name];e=this.parser.getDependency("buffer",o.buffer);let s=this.parser.options.meshoptDecoder;if(s&&s.supported)return e.then(function(e){var t=o.byteOffset||0,n=o.byteLength||0;let i=o.count,r=o.byteStride,a=new Uint8Array(e,t,n);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(i,r,a,o.mode,o.filter).then(function(e){return e.buffer}):s.ready.then(function(){var e=new ArrayBuffer(i*r);return s.decodeGltfBuffer(new Uint8Array(e),i,r,a,o.mode,o.filter),e})});if(t.extensionsRequired&&0<=t.extensionsRequired.indexOf(this.name))throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}return null}}class ow{constructor(e){this.name=v.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){var t,n=this.parser.json,i=n.nodes[e];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;for(t of n.meshes[i.mesh].primitives)if(t.mode!==_.TRIANGLES&&t.mode!==_.TRIANGLE_STRIP&&t.mode!==_.TRIANGLE_FAN&&void 0!==t.mode)return null;var r=i.extensions[this.name].attributes,a=[];let p={};for(let t in r)a.push(this.parser.getDependency("accessor",r[t]).then(e=>(p[t]=e,p[t])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(e=>{var t,n=e.pop(),i=n.isGroup?n.children:[n],r=e[0].count,a=[];for(t of i){var o,s,l=new fd,u=new dd,c=new hd,h=new dd(1,1,1),d=new jA(t.geometry,t.material,r);for(let e=0;e<r;e++)p.TRANSLATION&&u.fromBufferAttribute(p.TRANSLATION,e),p.ROTATION&&c.fromBufferAttribute(p.ROTATION,e),p.SCALE&&h.fromBufferAttribute(p.SCALE,e),d.setMatrixAt(e,l.compose(u,c,h));for(o in p)"_COLOR_0"===o?(s=p[o],d.instanceColor=new WA(s.array,s.itemSize,s.normalized)):"TRANSLATION"!==o&&"ROTATION"!==o&&"SCALE"!==o&&t.geometry.setAttribute(o,p[o]);gd.prototype.copy.call(d,t),this.parser.assignFinalMaterial(d),a.push(d)}return n.isGroup?(n.clear(),n.add(...a),n):a[0]}))}}let Uc="glTF",Bc={JSON:1313821514,BIN:5130562};class sw{constructor(e){this.name=v.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Uc)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");var i=this.header.length-12,r=new DataView(e,12);let a=0;for(;a<i;){var o,s=r.getUint32(a,!0),l=(a+=4,r.getUint32(a,!0));a+=4,l===Bc.JSON?(o=new Uint8Array(e,12+a,s),this.content=n.decode(o)):l===Bc.BIN&&(o=12+a,this.body=e.slice(o,o+s)),a+=s}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class lw{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=v.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){var n=this.json;let r=this.dracoLoader;var i,a,o=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes;let l={},u={},c={};for(i in s){var h=Vc[i]||i.toLowerCase();l[h]=s[i]}for(a in e.attributes){var d,p,f=Vc[a]||a.toLowerCase();void 0!==s[a]&&(d=n.accessors[e.attributes[a]],p=zc[d.componentType],c[f]=p.name,u[f]=!0===d.normalized)}return t.getDependency("bufferView",o).then(function(t){return new Promise(function(i,e){r.decodeDracoFile(t,function(e){for(var t in e.attributes){var n=e.attributes[t],t=u[t];void 0!==t&&(n.normalized=t)}i(e)},l,c,Ye,e)})})}}class uw{constructor(){this.name=v.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale)&&(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class cw{constructor(){this.name=v.KHR_MESH_QUANTIZATION}}class hw extends Ux{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let e=0;e!==i;e++)t[e]=n[r+e];return t}interpolate_(e,t,n,i){var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,u=i-t,i=(n-t)/u,n=i*i,t=n*i,c=e*l,h=c-l,d=-2*t+3*n,p=t-n,f=1-d,m=p-n+i;for(let e=0;e!==o;e++){var g=a[h+e+o],v=a[h+e+s]*u,_=a[c+e+o],y=a[c+e]*u;r[e]=f*g+m*v+d*_+p*y}return r}}let Fc=new hd;class dw extends hw{interpolate_(e,t,n,i){e=super.interpolate_(e,t,n,i);return Fc.fromArray(e).normalize().toArray(e),e}}let _={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},zc={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},kc={9728:V,9729:W,9984:e,9985:Fe,9986:Be,9987:Ve},Gc={33071:Pe,33648:Ue,10497:H},Hc={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Vc={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Wc={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},jc={CUBICSPLINE:void 0,LINEAR:2301,STEP:2300},Yc={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function S_(e,t,n){for(var i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function w_(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function b_(n){let i="";var r=Object.keys(n).sort();for(let e=0,t=r.length;e<t;e++)i+=r[e]+":"+n[r[e]]+";";return i}function M_(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}let qc=new fd;class pw{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new T_,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={};let n=!(this.nodeNamesUsed={}),i=-1,r=!1,a=-1;"undefined"!=typeof navigator&&(e=navigator.userAgent,n=!0===/^((?!chrome|android).)*safari/i.test(e),t=e.match(/Version\/(\d+)/),i=n&&t?parseInt(t[1],10):-1,r=-1<e.indexOf("Firefox"),a=r?e.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||n&&i<17||r&&a<98?this.textureLoader=new wd(this.options.manager):this.textureLoader=new cT(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Qx(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(n,e){let i=this,r=this.json,a=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(e){let t={scene:e[0][r.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:r.asset,parser:i,userData:{}};return S_(a,t,r),w_(t,r),Promise.all(i._invokeAll(function(e){return e.afterRoot&&e.afterRoot(t)})).then(function(){for(var e of t.scenes)e.updateMatrixWorld();n(t)})}).catch(e)}_markDefs(){var n=this.json.nodes||[],i=this.json.skins||[],r=this.json.meshes||[];for(let e=0,t=i.length;e<t;e++){var a=i[e].joints;for(let e=0,t=a.length;e<t;e++)n[a[e]].isBone=!0}for(let e=0,t=n.length;e<t;e++){var o=n[e];void 0!==o.mesh&&(this._addNodeRef(this.meshCache,o.mesh),void 0!==o.skin)&&(r[o.mesh].isSkinnedMesh=!0),void 0!==o.camera&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;var i=n.clone();let a=(e,t)=>{var n,i,r=this.associations.get(e);null!=r&&this.associations.set(t,r);for([n,i]of e.children.entries())a(i,t.children[n])};return a(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(t){var n=Object.values(this.plugins);n.push(this);for(let e=0;e<n.length;e++){var i=t(n[e]);if(i)return i}return null}_invokeAll(t){var n=Object.values(this.plugins),i=(n.unshift(this),[]);for(let e=0;e<n.length;e++){var r=t(n[e]);r&&i.push(r)}return i}getDependency(t,n){var e=t+":"+n;let i=this.cache.get(e);if(!i){switch(t){case"scene":i=this.loadScene(n);break;case"node":i=this._invokeOne(function(e){return e.loadNode&&e.loadNode(n)});break;case"mesh":i=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(n)});break;case"accessor":i=this.loadAccessor(n);break;case"bufferView":i=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(n)});break;case"buffer":i=this.loadBuffer(n);break;case"material":i=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(n)});break;case"texture":i=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(n)});break;case"skin":i=this.loadSkin(n);break;case"animation":i=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(n)});break;case"camera":i=this.loadCamera(n);break;default:if(i=this._invokeOne(function(e){return e!=this&&e.getDependency&&e.getDependency(t,n)}))break;throw new Error("Unknown type: "+t)}this.cache.add(e,i)}return i}getDependencies(i){let e=this.cache.get(i);if(!e){let n=this;var t=this.json[i+("mesh"===i?"es":"s")]||[];e=Promise.all(t.map(function(e,t){return n.getDependency(i,t)})),this.cache.add(i,e)}return e}loadBuffer(e){let n=this.json.buffers[e],i=this.fileLoader;if(n.type&&"arraybuffer"!==n.type)throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(void 0===n.uri&&0===e)return Promise.resolve(this.extensions[v.KHR_BINARY_GLTF].body);let r=this.options;return new Promise(function(e,t){i.load(uT.resolveURL(n.uri,r.path),e,void 0,function(){t(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){let i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(e){var t=i.byteLength||0,n=i.byteOffset||0;return e.slice(n,n+t)})}loadAccessor(e){let m=this,g=this.json,v=this.json.accessors[e];var t,n;return void 0===v.bufferView&&void 0===v.sparse?(e=Hc[v.type],n=zc[v.componentType],t=!0===v.normalized,n=new n(v.count*e),Promise.resolve(new yd(n,e,t))):(n=[],void 0!==v.bufferView?n.push(this.getDependency("bufferView",v.bufferView)):n.push(null),void 0!==v.sparse&&(n.push(this.getDependency("bufferView",v.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",v.sparse.values.bufferView))),Promise.all(n).then(function(e){var t=e[0],n=Hc[v.type],i=zc[v.componentType],r=i.BYTES_PER_ELEMENT,a=r*n,o=v.byteOffset||0,s=void 0!==v.bufferView?g.bufferViews[v.bufferView].byteStride:void 0,l=!0===v.normalized;let u,c;if(s&&s!==a){var a=Math.floor(o/s),h="InterleavedBuffer:"+v.bufferView+":"+v.componentType+":"+a+":"+v.count;let e=m.cache.get(h);e||(u=new i(t,a*s,v.count*s/r),e=new FA(u,s/r),m.cache.add(h,e)),c=new zA(e,n,o%s/r,l)}else u=null===t?new i(v.count*n):new i(t,o,v.count*n),c=new yd(u,n,l);if(void 0!==v.sparse){var a=Hc.SCALAR,h=zc[v.sparse.indices.componentType],s=v.sparse.indices.byteOffset||0,r=v.sparse.values.byteOffset||0,d=new h(e[1],s,v.sparse.count*a),p=new i(e[2],r,v.sparse.count*n);null!==t&&(c=new yd(c.array.slice(),c.itemSize,c.normalized));for(let e=0,t=d.length;e<t;e++){var f=d[e];if(c.setX(f,p[e*n]),2<=n&&c.setY(f,p[e*n+1]),3<=n&&c.setZ(f,p[e*n+2]),4<=n&&c.setW(f,p[e*n+3]),5<=n)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return c}))}loadTexture(e){var t=this.json,n=this.options,i=t.textures[e].source,t=t.images[i];let r=this.textureLoader;return t.uri&&null!==(n=n.manager.getHandler(t.uri))&&(r=n),this.loadTextureImage(e,i,r)}loadTextureImage(n,e,t){let i=this,r=this.json,a=r.textures[n],o=r.images[e];var s=(o.uri||o.bufferView)+":"+a.sampler;return this.textureCache[s]||(e=this.loadImageSource(e,t).then(function(e){e.flipY=!1,e.name=a.name||o.name||"",""===e.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(e.name=o.uri);var t=(r.samplers||{})[a.sampler]||{};return e.magFilter=kc[t.magFilter]||W,e.minFilter=kc[t.minFilter]||Ve,e.wrapS=Gc[t.wrapS]||H,e.wrapT=Gc[t.wrapT]||H,i.associations.set(e,{textures:n}),e}).catch(function(){return null}),this.textureCache[s]=e)}loadImageSource(e,r){var t=this.json;let a=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());let n=t.images[e],i=self.URL||self.webkitURL,o=n.uri||"",s=!1;if(void 0!==n.bufferView)o=this.getDependency("bufferView",n.bufferView).then(function(e){s=!0;e=new Blob([e],{type:n.mimeType});return o=i.createObjectURL(e)});else if(void 0===n.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");t=Promise.resolve(o).then(function(i){return new Promise(function(t,e){let n=t;!0===r.isImageBitmapLoader&&(n=function(e){e=new eA(e);e.needsUpdate=!0,t(e)}),r.load(uT.resolveURL(i,a.path),n,void 0,e)})}).then(function(e){var t;return!0===s&&i.revokeObjectURL(o),w_(e,n),e.userData.mimeType=n.mimeType||(0<(t=n.uri).search(/\.jpe?g($|\?)/i)||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":0<t.search(/\.webp($|\?)/i)||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e});return this.sourceCache[e]=t}assignTexture(i,r,a,o){let s=this;return this.getDependency("texture",a.index).then(function(e){var t,n;return e?(void 0!==a.texCoord&&0<a.texCoord&&((e=e.clone()).channel=a.texCoord),s.extensions[v.KHR_TEXTURE_TRANSFORM]&&(t=void 0!==a.extensions?a.extensions[v.KHR_TEXTURE_TRANSFORM]:void 0)&&(n=s.associations.get(e),e=s.extensions[v.KHR_TEXTURE_TRANSFORM].extendTexture(e,t),s.associations.set(e,n)),void 0!==o&&(e.colorSpace=o),i[r]=e):null})}assignFinalMaterial(e){var n=e.geometry;let i=e.material;var r=void 0===n.attributes.tangent,a=void 0!==n.attributes.color,n=void 0===n.attributes.normal;if(e.isPoints){var t="PointsMaterial:"+i.uuid;let e=this.cache.get(t);e||(e=new QA,uA.prototype.copy.call(e,i),e.color.copy(i.color),e.map=i.map,e.sizeAttenuation=!1,this.cache.add(t,e)),i=e}else if(e.isLine){t="LineBasicMaterial:"+i.uuid;let e=this.cache.get(t);e||(e=new XA,uA.prototype.copy.call(e,i),e.color.copy(i.color),e.map=i.map,this.cache.add(t,e)),i=e}if(r||a||n){let e="ClonedMaterial:"+i.uuid+":",t=(r&&(e+="derivative-tangents:"),a&&(e+="vertex-colors:"),n&&(e+="flat-shading:"),this.cache.get(e));t||(t=i.clone(),a&&(t.vertexColors=!0),n&&(t.flatShading=!0),r&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale)&&(t.clearcoatNormalScale.y*=-1),this.cache.add(e,t),this.associations.set(t,this.associations.get(i))),i=t}e.material=i}getMaterialType(){return Ox}loadMaterial(t){let n=this;var e=this.json;let i=this.extensions,r=e.materials[t],a,o={};var s,e=[],l=((r.extensions||{})[v.KHR_MATERIALS_UNLIT]?(s=i[v.KHR_MATERIALS_UNLIT],a=s.getMaterialType(),e.push(s.extendParams(o,r,n))):(s=r.pbrMetallicRoughness||{},o.color=new vd(1,1,1),o.opacity=1,Array.isArray(s.baseColorFactor)&&(l=s.baseColorFactor,o.color.setRGB(l[0],l[1],l[2],Ye),o.opacity=l[3]),void 0!==s.baseColorTexture&&e.push(n.assignTexture(o,"map",s.baseColorTexture,je)),o.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,o.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(e.push(n.assignTexture(o,"metalnessMap",s.metallicRoughnessTexture)),e.push(n.assignTexture(o,"roughnessMap",s.metallicRoughnessTexture))),a=this._invokeOne(function(e){return e.getMaterialType&&e.getMaterialType(t)}),e.push(Promise.all(this._invokeAll(function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,o)})))),!0===r.doubleSided&&(o.side=He),r.alphaMode||Yc.OPAQUE);return l===Yc.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,l===Yc.MASK&&(o.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&a!==_d&&(e.push(n.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new ld(1,1),void 0!==r.normalTexture.scale)&&(s=r.normalTexture.scale,o.normalScale.set(s,s)),void 0!==r.occlusionTexture&&a!==_d&&(e.push(n.assignTexture(o,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength)&&(o.aoMapIntensity=r.occlusionTexture.strength),void 0!==r.emissiveFactor&&a!==_d&&(l=r.emissiveFactor,o.emissive=(new vd).setRGB(l[0],l[1],l[2],Ye)),void 0!==r.emissiveTexture&&a!==_d&&e.push(n.assignTexture(o,"emissiveMap",r.emissiveTexture,je)),Promise.all(e).then(function(){var e=new a(o);return r.name&&(e.name=r.name),w_(e,r),n.associations.set(e,{materials:t}),r.extensions&&S_(i,e,r),e})}createUniqueName(e){e=bd.sanitizeNodeName(e||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(n){let i=this,r=this.extensions;var a=this.primitiveCache;var o=[];for(let e=0,t=n.length;e<t;e++){var s=n[e],l=(n=>{let i;var e=n.extensions&&n.extensions[v.KHR_DRACO_MESH_COMPRESSION];if(i=e?"draco:"+e.bufferView+":"+e.indices+":"+b_(e.attributes):n.indices+":"+b_(n.attributes)+":"+n.mode,void 0!==n.targets)for(let e=0,t=n.targets.length;e<t;e++)i+=":"+b_(n.targets[e]);return i})(s),u=a[l];if(u)o.push(u.promise);else{let e;e=s.extensions&&s.extensions[v.KHR_DRACO_MESH_COMPRESSION]?(t=>r[v.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,i).then(function(e){return R_(e,t,i)}))(s):R_(new Ad,s,i),a[l]={primitive:s,promise:e},o.push(e)}}return Promise.all(o)}loadMesh(d){let p=this;var e=this.json;let f=this.extensions,m=e.meshes[d],g=m.primitives;var n=[];for(let e=0,t=g.length;e<t;e++){var i=void 0===g[e].material?(void 0===(i=this.cache).DefaultMaterial&&(i.DefaultMaterial=new Ox({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ke})),i.DefaultMaterial):this.getDependency("material",g[e].material);n.push(i)}return n.push(p.loadGeometries(g)),Promise.all(n).then(function(e){var n=e.slice(0,e.length-1),i=e[e.length-1],r=[];for(let t=0,e=i.length;t<e;t++){var a=i[t],o=g[t];let e;var s=n[t];if(o.mode===_.TRIANGLES||o.mode===_.TRIANGLE_STRIP||o.mode===_.TRIANGLE_FAN||void 0===o.mode)!0===(e=new(!0===m.isSkinnedMesh?kA:xd)(a,s)).isSkinnedMesh&&e.normalizeSkinWeights(),o.mode===_.TRIANGLE_STRIP?e.geometry=n0(e.geometry,1):o.mode===_.TRIANGLE_FAN&&(e.geometry=n0(e.geometry,2));else if(o.mode===_.LINES)e=new KA(a,s);else if(o.mode===_.LINE_STRIP)e=new ZA(a,s);else if(o.mode===_.LINE_LOOP)e=new JA(a,s);else{if(o.mode!==_.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+o.mode);e=new $A(a,s)}if(0<Object.keys(e.geometry.morphAttributes).length){c=u=l=void 0;var l=e,u=m;if(l.updateMorphTargets(),void 0!==u.weights)for(let e=0,t=u.weights.length;e<t;e++)l.morphTargetInfluences[e]=u.weights[e];if(u.extras&&Array.isArray(u.extras.targetNames)){var c=u.extras.targetNames;if(l.morphTargetInfluences.length===c.length){l.morphTargetDictionary={};for(let e=0,t=c.length;e<t;e++)l.morphTargetDictionary[c[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}e.name=p.createUniqueName(m.name||"mesh_"+d),w_(e,m),o.extensions&&S_(f,e,o),p.assignFinalMaterial(e),r.push(e)}for(let e=0,t=r.length;e<t;e++)p.associations.set(r[e],{meshes:d,primitives:e});if(1===r.length)return m.extensions&&S_(f,r[0],m),r[0];var h=new Sd;m.extensions&&S_(f,h,m),p.associations.set(h,{meshes:d});for(let e=0,t=r.length;e<t;e++)h.add(r[e]);return h})}loadCamera(e){let t;var e=this.json.cameras[e],n=e[e.type];if(n)return"perspective"===e.type?t=new fA(fn.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===e.type&&(t=new AA(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),e.name&&(t.name=this.createUniqueName(e.name)),w_(t,e),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){let s=this.json.skins[e];var n=[];for(let e=0,t=s.joints.length;e<t;e++)n.push(this._loadNodeShallow(s.joints[e]));return void 0!==s.inverseBindMatrices?n.push(this.getDependency("accessor",s.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(e){var n=e.pop(),i=e,r=[],a=[];for(let e=0,t=i.length;e<t;e++){var o=i[e];o?(r.push(o),o=new fd,null!==n&&o.fromArray(n.array,16*e),a.push(o)):console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[e])}return new VA(r,a)})}loadAnimation(e){var t=this.json;let f=this;var n=t.animations[e];let m=n.name||"animation_"+e;var i=[],r=[],a=[],o=[],s=[];for(let e=0,t=n.channels.length;e<t;e++){var l=n.channels[e],u=n.samplers[l.sampler],l=l.target,c=l.node,h=void 0!==n.parameters?n.parameters[u.input]:u.input,d=void 0!==n.parameters?n.parameters[u.output]:u.output;void 0!==l.node&&(i.push(this.getDependency("node",c)),r.push(this.getDependency("accessor",h)),a.push(this.getDependency("accessor",d)),o.push(u),s.push(l))}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(a),Promise.all(o),Promise.all(s)]).then(function(e){var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=[];for(let e=0,t=n.length;e<t;e++){var l=n[e],u=i[e],c=r[e],h=a[e],d=o[e];if(void 0!==l){l.updateMatrix&&l.updateMatrix();var p=f._createAnimationTracks(l,u,c,h,d);if(p)for(let e=0;e<p.length;e++)s.push(p[e])}}return new Xx(m,void 0,s)})}createNodeMesh(e){var t=this.json;let n=this,i=t.nodes[e];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then(function(e){e=n._getNodeRef(n.meshCache,i.mesh,e);return void 0!==i.weights&&e.traverse(function(n){if(n.isMesh)for(let e=0,t=i.weights.length;e<t;e++)n.morphTargetInfluences[e]=i.weights[e]}),e})}loadNode(e){var t=this.json.nodes[e],e=this._loadNodeShallow(e),n=[],i=t.children||[];for(let e=0,t=i.length;e<t;e++)n.push(this.getDependency("node",i[e]));t=void 0===t.skin?Promise.resolve(null):this.getDependency("skin",t.skin);return Promise.all([e,Promise.all(n),t]).then(function(e){var n=e[0],i=e[1];let t=e[2];null!==t&&n.traverse(function(e){e.isSkinnedMesh&&e.bind(t,qc)});for(let e=0,t=i.length;e<t;e++)n.add(i[e]);return n})}_loadNodeShallow(a){var e=this.json;let o=this.extensions,s=this;if(void 0===this.nodeCache[a]){let t=e.nodes[a],r=t.name?s.createUniqueName(t.name):"",n=[];e=s._invokeOne(function(e){return e.createNodeMesh&&e.createNodeMesh(a)});e&&n.push(e),void 0!==t.camera&&n.push(s.getDependency("camera",t.camera).then(function(e){return s._getNodeRef(s.cameraCache,t.camera,e)})),s._invokeAll(function(e){return e.createNodeAttachment&&e.createNodeAttachment(a)}).forEach(function(e){n.push(e)}),this.nodeCache[a]=Promise.all(n).then(function(n){let i;if((i=!0===t.isBone?new GA:1<n.length?new Sd:1===n.length?n[0]:new gd)!==n[0])for(let e=0,t=n.length;e<t;e++)i.add(n[e]);var e;return t.name&&(i.userData.name=t.name,i.name=r),w_(i,t),t.extensions&&S_(o,i,t),void 0!==t.matrix?((e=new fd).fromArray(t.matrix),i.applyMatrix4(e)):(void 0!==t.translation&&i.position.fromArray(t.translation),void 0!==t.rotation&&i.quaternion.fromArray(t.rotation),void 0!==t.scale&&i.scale.fromArray(t.scale)),s.associations.has(i)||s.associations.set(i,{}),s.associations.get(i).nodes=a,i})}return this.nodeCache[a]}loadScene(e){var t=this.extensions,e=this.json.scenes[e];let r=this,i=new Sd;e.name&&(i.name=r.createUniqueName(e.name)),w_(i,e),e.extensions&&S_(t,i,e);var n=e.nodes||[],a=[];for(let e=0,t=n.length;e<t;e++)a.push(r.getDependency("node",n[e]));return Promise.all(a).then(function(n){for(let e=0,t=n.length;e<t;e++)i.add(n[e]);return r.associations=(e=>{let n=new Map;for(var[t,i]of r.associations)(t instanceof uA||t instanceof eA)&&n.set(t,i);return e.traverse(e=>{var t=r.associations.get(e);null!=t&&n.set(e,t)}),n})(i),i})}_createAnimationTracks(e,n,t,i,r){var a=[],o=e.name||e.uuid;let s=[];Wc[r.path]===Wc.weights?e.traverse(function(e){e.morphTargetInfluences&&s.push(e.name||e.uuid)}):s.push(o);let l;switch(Wc[r.path]){case Wc.weights:l=Vx;break;case Wc.rotation:l=jx;break;case Wc.position:case Wc.scale:l=qx;break;default:l=1===t.itemSize?Vx:qx}var u=void 0!==i.interpolation?jc[i.interpolation]:2301,c=this._getArrayFromAccessor(t);for(let e=0,t=s.length;e<t;e++){var h=new l(s[e]+"."+Wc[r.path],n.array,c,u);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(h),a.push(h)}return a}_getArrayFromAccessor(e){let n=e.array;if(e.normalized){var i=M_(n.constructor),r=new Float32Array(n.length);for(let e=0,t=n.length;e<t;e++)r[e]=n[e]*i;n=r}return n}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof jx?dw:hw)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function R_(f,e,m){var t,n=e.attributes,i=[];for(t in n){var r=Vc[t]||t.toLowerCase();r in f.attributes||i.push(((e,t)=>m.getDependency("accessor",e).then(function(e){f.setAttribute(t,e)}))(n[t],r))}void 0===e.indices||f.index||(a=m.getDependency("accessor",e.indices).then(function(e){f.setIndex(e)}),i.push(a)),qe.workingColorSpace!==Ye&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${qe.workingColorSpace}" not supported.`),w_(f,e);var a=f,o=e,s=m,l=o.attributes,u=new pd;if(void 0!==l.POSITION){var l=s.json.accessors[l.POSITION],c=l.min,h=l.max;if(void 0===c||void 0===h)console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");else{u.set(new dd(c[0],c[1],c[2]),new dd(h[0],h[1],h[2])),l.normalized&&(c=M_(zc[l.componentType]),u.min.multiplyScalar(c),u.max.multiplyScalar(c));var d=o.targets;if(void 0!==d){var p=new dd,g=new dd;for(let e=0,t=d.length;e<t;e++){var v,_,y=d[e];void 0!==y.POSITION&&(_=(y=s.json.accessors[y.POSITION]).min,v=y.max,void 0!==_&&void 0!==v?(g.setX(Math.max(Math.abs(_[0]),Math.abs(v[0]))),g.setY(Math.max(Math.abs(_[1]),Math.abs(v[1]))),g.setZ(Math.max(Math.abs(_[2]),Math.abs(v[2]))),y.normalized&&(_=M_(zc[y.componentType]),g.multiplyScalar(_)),p.max(g)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION."))}u.expandByVector(p)}a.boundingBox=u;h=new aA;u.getCenter(h.center),h.radius=u.min.distanceTo(u.max)/2,a.boundingSphere=h}}return Promise.all(i).then(function(){if(void 0===e.targets)return f;{var o=f,n=e.targets,s=m;let i=!1,r=!1,a=!1;for(let e=0,t=n.length;e<t;e++){var l=n[e];if(void 0!==l.POSITION&&(i=!0),void 0!==l.NORMAL&&(r=!0),void 0!==l.COLOR_0&&(a=!0),i&&r&&a)break}if(!i&&!r&&!a)return Promise.resolve(o);var u=[],c=[],h=[];for(let e=0,t=n.length;e<t;e++){var d,p=n[e];i&&(d=void 0!==p.POSITION?s.getDependency("accessor",p.POSITION):o.attributes.position,u.push(d)),r&&(d=void 0!==p.NORMAL?s.getDependency("accessor",p.NORMAL):o.attributes.normal,c.push(d)),a&&(p=void 0!==p.COLOR_0?s.getDependency("accessor",p.COLOR_0):o.attributes.color,h.push(p))}return Promise.all([Promise.all(u),Promise.all(c),Promise.all(h)]).then(function(e){var t=e[0],n=e[1],e=e[2];return i&&(o.morphAttributes.position=t),r&&(o.morphAttributes.normal=n),a&&(o.morphAttributes.color=e),o.morphTargetsRelative=!0,o})}})}let Xc=new WeakMap;class fw extends Kx{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){var r=new Qx(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,e=>{this.parse(e,t,i)},n,i)}parse(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:()=>{};this.decodeDracoFile(e,t,null,null,je,n).catch(n)}decodeDracoFile(e,t,n,i){var r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:Ye,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:()=>{},i={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:r};return this.decodeGeometry(e,i).then(t).catch(a)}decodeGeometry(n,i){var e=JSON.stringify(i);if(Xc.has(n)){var t=Xc.get(n);if(t.key===e)return t.promise;if(0===n.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r,a=this.workerNextTaskID++;t=n.byteLength,t=this._getWorker(a,t).then(e=>(r=e,new Promise((e,t)=>{r._callbacks[a]={resolve:e,reject:t},r.postMessage({type:"decode",id:a,taskConfig:i,buffer:n},[n])}))).then(e=>this._createGeometry(e.geometry));return t.catch(()=>!0).then(()=>{r&&a&&this._releaseTask(r,a)}),Xc.set(n,{key:e,promise:t}),t}_createGeometry(t){var n=new Ad;t.index&&n.setIndex(new yd(t.index.array,1));for(let e=0;e<t.attributes.length;e++){var i=t.attributes[e],r=i.name,a=i.array,o=i.itemSize,o=new yd(a,o);"color"===r&&(this._assignVertexColorSpace(o,i.vertexColorSpace),o.normalized=a instanceof Float32Array==!1),n.setAttribute(r,o)}return n}_assignVertexColorSpace(n,e){if(e===je){var i=new vd;for(let e=0,t=n.count;e<t;e++)i.fromBufferAttribute(n,e).convertSRGBToLinear(),n.setXYZ(e,i.r,i.g,i.b)}}_loadLibrary(n,e){let i=new Qx(this.manager);return i.setPath(this.decoderPath),i.setResponseType(e),i.setWithCredentials(this.withCredentials),new Promise((e,t)=>{i.load(n,e,void 0,t)})}preload(){return this._initDecoder(),this}_initDecoder(){if(!this.decoderPending){let n="object"!=typeof WebAssembly||"js"===this.decoderConfig.type;var e=[];n?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(e=>{var t=e[0],e=(n||(this.decoderConfig.wasmBinary=e[1]),function(){let n,t;function s(n,i,e,r){var a=r.attributeIDs,o=r.attributeTypes;let s,t;var l=i.GetEncodedGeometryType(e);if(l===n.TRIANGULAR_MESH)s=new n.Mesh,t=i.DecodeArrayToMesh(e,e.byteLength,s);else{if(l!==n.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");s=new n.PointCloud,t=i.DecodeArrayToPointCloud(e,e.byteLength,s)}if(!t.ok()||0===s.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+t.error_msg());var u,c,h,d,p,f,m,g,v,_,y,E,A,x,T={index:null,attributes:[]};for(u in a){var S=self[o[u]];let e,t;if(r.useUniqueIDs)t=a[u],e=i.GetAttributeByUniqueId(s,t);else{if(-1===(t=i.GetAttributeId(s,n[a[u]])))continue;e=i.GetAttribute(s,t)}c=n,h=i,w=s,d=u,S=S,p=e,_=v=g=m=f=void 0,f=p.num_components(),m=w.num_points(),g=(m*=f)*S.BYTES_PER_ELEMENT,v=((e,t)=>{switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}})(c,S),_=c._malloc(g),h.GetAttributeDataArrayForAllPoints(w,p,v,g,_),h=new S(c.HEAPF32.buffer,_,m).slice(),c._free(_);var w={name:d,array:h,itemSize:f};"color"===u&&(w.vertexColorSpace=r.vertexColorSpace),T.attributes.push(w)}return l===n.TRIANGULAR_MESH&&(T.index=(e=n,l=i,y=s,E=y.num_faces(),A=4*(E*=3),x=e._malloc(A),l.GetTrianglesUInt32Array(y,A,x),l=new Uint32Array(e.HEAPF32.buffer,x,E).slice(),e._free(x),{array:l,itemSize:1})),n.destroy(s),T}onmessage=function(e){let o=e.data;switch(o.type){case"init":n=o.decoderConfig,t=new Promise(function(t){n.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(n)});break;case"decode":let r=o.buffer,a=o.taskConfig;t.then(e=>{var e=e.draco,t=new e.Decoder;try{var n=s(e,t,new Int8Array(r),a),i=n.attributes.map(e=>e.array.buffer);n.index&&i.push(n.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:n},i)}catch(e){console.error(e),self.postMessage({type:"error",id:o.id,error:e.message})}finally{e.destroy(t)}})}}}.toString()),t=["/* draco decoder */",t,"","/* worker */",e.substring(e.indexOf("{")+1,e.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([t]))})}return this.decoderPending}_getWorker(t,n){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(e){var t=e.data;switch(t.type){case"decode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});let e=this.workerPool[this.workerPool.length-1];return e._taskCosts[t]=n,e._taskLoad+=n,e})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}let Zc=new vd("rgb(255, 165, 0)");var N_,I_=null,C_=null;function L_(e,t,n){td()("#delete").css("display","none"),document.querySelector(".menu").classList.remove("menu-show");var i=e.instanceId;if(nd.CONNECTING)A_(i,nd.SELECTED_FOR_CONNECTION);else if(nd.PLANE_USER_DATA[i].itemName&&(td()("#sample-audio").prop("value",""),nd.PLANE_USER_DATA[i].itemName.includes("trigger_voice"))?(td()("#sample-audio").prop("value",nd.PLANE_USER_DATA[i].item.userData.speech),td()("#audio-trigger").css("display","flex")):td()("#audio-trigger").css("display","none"),2==t.button){if("enterDoor"!=nd.PLANE_USER_DATA[i].itemName&&"window"!=nd.PLANE_USER_DATA[i].itemName){if(nd.PLANE_USER_DATA[i].hasItem&&(nd.PLANE_USER_DATA[i].itemName.includes("door")||nd.PLANE_USER_DATA[i].itemName.includes("portal_0")||nd.PLANE_USER_DATA[i].itemName.includes("portal_1")||nd.PLANE_USER_DATA[i].itemName.includes("angled_panel")||nd.PLANE_USER_DATA[i].itemName.includes("pedestal_button")||nd.PLANE_USER_DATA[i].itemName.includes("light")||nd.PLANE_USER_DATA[i].itemName.includes("bed")||nd.PLANE_USER_DATA[i].itemName.includes("incinerator")||nd.PLANE_USER_DATA[i].itemName.includes("toilet")||nd.PLANE_USER_DATA[i].itemName.includes("desk")||nd.PLANE_USER_DATA[i].itemName.includes("cabinet")||nd.PLANE_USER_DATA[i].itemName.includes("sign")||nd.PLANE_USER_DATA[i].itemName.includes("step")||nd.PLANE_USER_DATA[i].itemName.includes("portal_gun"))?td()("#rotate-item").css("display","block"):td()("#rotate-item").css("display","none"),td()(".hasItem").css("display","none"),1==nd.SELECTED_ID.length&&nd.PLANE_USER_DATA[i].hasItem){if(td()("#delete").css("display","block"),"exitDoor"==nd.PLANE_USER_DATA[i].itemName&&td()("#delete").css("display","none"),"sphere"==nd.PLANE_USER_DATA[i].instancedName||"cube"==nd.PLANE_USER_DATA[i].instancedName||"cube_2"==nd.PLANE_USER_DATA[i].instancedName||"laser_cube"==nd.PLANE_USER_DATA[i].instancedName||"scale_cube"==nd.PLANE_USER_DATA[i].instancedName?(td()(".dispenser").css("display","block"),td()("#state-dispenser").prop("checked",nd.PLANE_USER_DATA[i].item.userData.hasDispenser),td()("#dispenser-opened").prop("checked",nd.PLANE_USER_DATA[i].item.userData.opened)):td()(".dispenser").css("display","none"),nd.PLANE_USER_DATA[i].itemName.includes("button")||nd.PLANE_USER_DATA[i].itemName.includes("laser_receiver")||nd.PLANE_USER_DATA[i].itemName.includes("trigger")||nd.PLANE_USER_DATA[i].itemName.includes("laser_relay")||nd.PLANE_USER_DATA[i].itemName.includes("pellet_catcher")||nd.PLANE_USER_DATA[i].itemName.includes("incinerator")){td()(".buttons").css("display","block"),td()("#connections").empty();for(var r,a=0;a<nd.CONNECTIONS.length;a++)nd.CONNECTIONS[a].from.itemName==nd.PLANE_USER_DATA[i].itemName&&(r='<li data-id="'+a+'" class="menu-item removeConnection"><button type="button" class="menu-btn"><i class="fas fa-times"></i><span class="menu-text">'+nd.CONNECTIONS[a].to.itemName+"</span></button></li>",td()("#connections").append(r),td()("#state-lines").prop("checked",nd.CONNECTIONS[a].line.visible))}else td()(".buttons").css("display","none");(nd.PLANE_USER_DATA[i].itemName.includes("pedestal")||nd.PLANE_USER_DATA[i].itemName.includes("trigger"))&&(td()(".pedestal").css("display","block"),td()("#state-pedetsal-infinity").prop("checked",nd.PLANE_USER_DATA[i].item.userData.pedestalInfinity),td()("#pedestal-timer-value").prop("value",nd.PLANE_USER_DATA[i].item.userData.pedestalValue),nd.PLANE_USER_DATA[i].item.userData.pedestalInfinity?td()("#pedestal-timer").addClass("disabled"):td()("#pedestal-timer").removeClass("disabled"),nd.PLANE_USER_DATA[i].itemName.includes("pedestal")?td()("#pedestal-inifinity").find("span").text("Activation Lasts"):td()("#pedestal-inifinity").find("span").text("Wait to activate")),nd.PLANE_USER_DATA[i].itemName.includes("tractor")&&(td()(".tractor").css("display","block"),td()("#tractor-state-input").prop("checked",nd.PLANE_USER_DATA[i].item.userData.state),td()("#tractor-direction-input").prop("checked",nd.PLANE_USER_DATA[i].item.userData.reversed),td()("#tractor-trigger").find(".title").text("Triggers: "+nd.PLANE_USER_DATA[i].item.userData.triggers)),nd.PLANE_USER_DATA[i].itemName.includes("light_bridge")&&(td()(".light-bridge").css("display","block"),td()("#light-bridge-state-input").prop("checked",nd.PLANE_USER_DATA[i].item.userData.state),td()("#light-bridge-trigger").find(".title").text(nd.PLANE_USER_DATA[i].item.userData.triggers)),nd.PLANE_USER_DATA[i].itemName.includes("laser_field")&&(td()(".laser-field").css("display","block"),td()("#laser-field-state-input").prop("checked",nd.PLANE_USER_DATA[i].item.userData.state),td()("#laser-field-trigger").find(".title").text(nd.PLANE_USER_DATA[i].item.userData.triggers)),nd.PLANE_USER_DATA[i].itemName.includes("fizzler")&&(td()(".fizzler").css("display","block"),td()("#fizzler-state-input").prop("checked",nd.PLANE_USER_DATA[i].item.userData.state),td()("#fizzler-trigger").find(".title").text(nd.PLANE_USER_DATA[i].item.userData.triggers)),(nd.PLANE_USER_DATA[i].itemName.includes("observation_room")||nd.PLANE_USER_DATA[i].itemName.includes("light"))&&(td()(".light-color").css("display","block"),td()("#ligh-color-input").val(nd.PLANE_USER_DATA[i].item.userData.lightColor)),"sphere"!=nd.PLANE_USER_DATA[i].instancedName&&"cube"!=nd.PLANE_USER_DATA[i].instancedName&&"cube_2"!=nd.PLANE_USER_DATA[i].instancedName&&"laser_cube"!=nd.PLANE_USER_DATA[i].instancedName&&"scale_cube"!=nd.PLANE_USER_DATA[i].instancedName||(td()(".physics").css("display","block"),td()("#restitution").val(nd.PLANE_USER_DATA[i].item.userData.restitution),td()("#friction").val(nd.PLANE_USER_DATA[i].item.userData.friction)),nd.PLANE_USER_DATA[i].itemName.includes("glass")&&(td()(".glass").css("display","block"),td()("#glass-trigger").find(".title").text(nd.PLANE_USER_DATA[i].item.userData.triggers),td()("#grid-state-input").prop("checked",nd.PLANE_USER_DATA[i].item.userData.grid)),nd.PLANE_USER_DATA[i].itemName.includes("portal_gun")&&(td()(".portal_gun").css("display","block"),td()("#portal_gun-state").find(".title").text(nd.PLANE_USER_DATA[i].item.userData.state+" Portals")),nd.PLANE_USER_DATA[i].itemName.includes("laser_emitter")&&(td()(".laser_emitter").css("display","block"),td()("#laser_emitter-trigger").find(".title").text(nd.PLANE_USER_DATA[i].item.userData.triggers)),nd.PLANE_USER_DATA[i].itemName.includes("laser_receiver")&&(td()(".laser_receiver").css("display","block"),td()("#laser_receiver-trigger").find(".title").text(nd.PLANE_USER_DATA[i].item.userData.triggers)),nd.PLANE_USER_DATA[i].itemName.includes("pellet_launcher")&&(td()(".pellet").css("display","block"),td()("#state-pellet-infinity").prop("checked",nd.PLANE_USER_DATA[i].item.userData.pedestalInfinity),td()("#pellet-timer-value").prop("value",nd.PLANE_USER_DATA[i].item.userData.pedestalValue),nd.PLANE_USER_DATA[i].item.userData.pedestalInfinity?td()("#pellet-timer").addClass("disabled"):td()("#pellet-timer").removeClass("disabled")),nd.PLANE_USER_DATA[i].itemName.includes("faith_plate")&&(td()(".faith_plate").css("display","block"),td()("#plate-max-height-value").prop("value",nd.PLANE_USER_DATA[i].item.userData.heightLine)),nd.PLANE_USER_DATA[i].itemName.includes("angled_panel")&&td()(".angled_panel").css("display","block"),nd.PLANE_USER_DATA[i].itemName.includes("gel_recharger")&&td()(".gel_recharger").css("display","block"),nd.PLANE_USER_DATA[i].itemName.includes("trigger")&&(td()(".trigger").css("display","block"),td()("#state-trigger-visibility").prop("checked",nd.PLANE_USER_DATA[i].item.userData.triggerVisibility)),nd.PLANE_USER_DATA[i].itemName.includes("trigger_voice")&&(td()(".trigger_voice").css("display","block"),td()("#state-trigger-voice-link").prop("value",nd.PLANE_USER_DATA[i].item.userData.link),td()("#state-trigger-multiple").prop("checked",nd.PLANE_USER_DATA[i].item.userData.multipleTrigger)),nd.PLANE_USER_DATA[i].itemName.includes("exitDoor")&&(td()(".exitDoor").css("display","block"),td()("#state-trigger-voice-link").prop("value",nd.PLANE_USER_DATA[i].item.userData.link)),nd.PLANE_USER_DATA[i].itemName.includes("trigger_audio")&&(td()(".trigger_audio").css("display","block"),td()("#state-trigger-loop").prop("checked",nd.PLANE_USER_DATA[i].item.userData.soundEffectLoop)),nd.PLANE_USER_DATA[i].itemName.includes("trigger")&&!nd.PLANE_USER_DATA[i].itemName.includes("trigger_save")&&td()(".trigger-multiple").css("display","block"),(nd.PLANE_USER_DATA[i].itemName.includes("piston_platforms")||nd.PLANE_USER_DATA[i].itemName.includes("track_platforms"))&&(td()(".piston_platforms").css("display","block"),td()("#piston-max-height").prop("value",nd.PLANE_USER_DATA[i].item.platformBox.parent.scale.y),td()("#state-piston").prop("checked",nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.isActive),td()("#state-piston-loop").prop("checked",nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.loop),nd.PLANE_USER_DATA[i].itemName.includes("track_platforms")?td()("#piston-max-height").prop("min",-100):td()("#piston-max-height").prop("min",0)),nd.PLANE_USER_DATA[i].itemName.includes("pellet_launcher")&&(td()(".pellet_launcher").css("display","block"),td()("#state-piston").prop("checked",nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.isActive)),(nd.PLANE_USER_DATA[i].itemName.includes("pellet_catcher")||nd.PLANE_USER_DATA[i].itemName.includes("door"))&&(td()(".soundPlay").css("display","block"),td()("#state-trigger-voice-link").prop("value",nd.PLANE_USER_DATA[i].item.userData.link))}nd.SELECTED_ID.includes(i)||nd.SELECTED_ID.push(i),td()(".gel").css("display","block");for(a=0;a<nd.SELECTED_ID.length;a++)if(nd.PLANE_USER_DATA[nd.SELECTED_ID[a]].hasItem){td()(".gel").css("display","none");break}e=t.pageX,s=t.pageY,(o=document.querySelector(".menu")).style.left=e+"px",o.style.top=s+"px",o.classList.add("menu-show"),nd.PLANE_LEVEL_INSTANCED.setColorAt(i,Zc)}}else if("move"==n&&!nd.PLANE_USER_DATA[i].hasItem&&nd.PLANE_USER_DATA[nd.SELECTED_ID[0]]&&nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].hasItem&&nd.SELECTED_ID[0]!=i){var o,e=nd.PLANE_USER_DATA[nd.SELECTED_ID[0]],s=nd.PLANE_USER_DATA[i];if(e.isInstanced)nd.DRAGGING=!0,e.item.continuous&&(-1<(o=nd.TRACTOR_BEAM.indexOf(e.item.continuous))&&(nd.TRACTOR_BEAM.splice(o,1),nd.TRACTOR_BEAM_BOUNDING_BOX.splice(o,1),nd.TRACTOR_BEAM_RAYCASTER.splice(o,1)),-1<(u=nd.LIGHT_BRIDGE_RAYCASTER.indexOf(e.item.raycaster))&&nd.LIGHT_BRIDGE_RAYCASTER.splice(u,1),-1<(u=nd.LASER_FIELD_RAYCASTER.indexOf(e.item.raycaster))&&nd.LASER_FIELD_RAYCASTER.splice(u,1),-1<(u=nd.FIZZLER_RAYCASTER.indexOf(e.item.raycaster))&&nd.FIZZLER_RAYCASTER.splice(u,1),-1<(u=nd.LASER_EMITTER_RAYCASTER.indexOf(e.item.raycaster))&&nd.LASER_EMITTER_RAYCASTER.splice(u,1),nd.SCENE_CHILDREN.remove(e.item.continuous)),e.item.bodyBridge&&(nd.LIGHT_BRIDGE_TRIGGER=e.item.userData.triggers,nd.CANNON_WORLD.removeBody(e.item.bodyBridge)),e.item.cloneLaserID&&(nd.LASER_FIELD_TRIGGER=e.item.userData.triggers),e.item.cloneFizzlerID&&(nd.FIZZLER_TRIGGER=e.item.userData.triggers),e.item.bodyLaserField&&nd.CANNON_WORLD.removeBody(e.item.bodyLaserField),window.moving=!0,td()("#delete").trigger("click"),zE(e,!1,null,null,null,null,null,null,null,!1,null,!1,!1);else{if("down"==s.side){if(!e.floor)return void Kg("You can not move this item on the floor!")}else if("up"==s.side){if(!e.ceiling)return void Kg("You can not move this item on the ceiling!")}else if(!e.walls)return void Kg("You can not move this item on the walls!");if(nd.DRAGGING=!0,e.item.continuous)return-1<(u=nd.GLASS_RAYCASTER.indexOf(e.item.raycaster))&&nd.GLASS_RAYCASTER.splice(u,1),nd.GRID_STATE=e.item.userData.grid,nd.SCENE_CHILDREN.remove(e.item.continuous),nd.ITEMS_ADDED.remove(e.item),e.item.bodyBridge&&nd.CANNON_WORLD.removeBody(e.item.bodyBridge),CE(td()("#"+e.item.userData.instancedName)),zE(e,!1,null,null,null,null,null,null,null,!1,null,!1,!1),D_(),void(nd.SELECTED_ID[0]=i);e.item.namePosition=s.position.x+"/"+s.position.y+"/"+s.position.z,e.item.position.copy(s.position),e.item.name.includes("camera")?e.item.translateY(.3):e.item.name.includes("spawn")?e.item.translateY(-1):e.item.name.includes("portal_gun")?e.item.translateY(.65):e.item.name.includes("trigger_area")?e.item.translateZ(1):e.item.name.includes("faith_plate")&&(window.faithPlateMoved=s,e.item.translateY(.025),nd.SCENE.remove(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.target),nd.GROUP_LINE_TRAGECTORY.remove(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.target.line)),e.item.name.includes("camera")||e.item.name.includes("observation")||e.item.name.includes("portal_")?e.item.rotation.set(s.normal.x,s.normal.y,s.normal.z):e.item.name.includes("door-")||e.item.name.includes("faith_plate")||e.item.name.includes("spawn")||e.item.rotation.copy(s.rotation),zE(s,!0,e.item.name,e.item,e.state,e.canRotate,e.floor,e.ceiling,e.walls,!1,e.instancedName,e.allowconnection,e.continuousEnding),zE(e,!1,null,null,null,null,null,null,null,!1,null,!1,!1),window.changingPosition=!0,window.changingPositionPlane=e,LE(s),NE(s,!1),s.item&&s.item.name.includes("Door")&&setTimeout(()=>{s0()},10)}D_(),nd.SELECTED_ID[0]=i}else if("down"==n&&0<nd.SELECTED_ID.length&&0==t.button&&D_(),!nd.DRAGGING&&C_!=i){C_=i;for(a=0;a<nd.SELECTED_ID_ORANGE.length;a++)nd.PLANE_USER_DATA[nd.SELECTED_ID_ORANGE[a].id_instanced].planeColor&&nd.PLANE_LEVEL_INSTANCED.setColorAt(nd.SELECTED_ID_ORANGE[a].id_instanced,new vd(nd.PLANE_USER_DATA[nd.SELECTED_ID_ORANGE[a].id_instanced].planeColor));if(nd.SELECTED_ID_ORANGE=[],0==nd.SELECTED_ID.length)I_=nd.PLANE_USER_DATA[i].position,nd.SELECTED_ID.includes(i)||nd.SELECTED_ID.push(i),nd.PLANE_LEVEL_INSTANCED.setColorAt(nd.PLANE_USER_DATA[i].id_instanced,Zc),N_=i;else{nd.SELECTED_ID=[];var l=I_,u=nd.PLANE_USER_DATA[i].position,c=-1*Math.sign(l.x-u.x),h=-1*Math.sign(l.y-u.y),d=-1*Math.sign(l.z-u.z),e=(new dd).subVectors(u,l),n=(new dd).addVectors(l,u).multiplyScalar(.5),p=Math.abs(e.x),f=Math.abs(e.y),m=Math.abs(e.z),t=new dA(p,f,m),u=new _d({color:new vd("rgb(0, 0, 255)")}),e=new xd(t,u),t=(e.position.copy(n),new dd);e.getWorldDirection(t);new dd(Math.abs(t.x-1),Math.abs(t.y-1),Math.abs(t.z-1));for(var g=0,a=0;g<=p/2;g++,a+=2)for(var v=0,_=0;v<=f/2;v++,_+=2)for(var y=0,E=0;y<=m/2;y++,E+=2){var A=Zg(l.x+a*c+"/"+(l.y+_*h)+"/"+(l.z+E*d));A[0]&&A[0].side==nd.PLANE_USER_DATA[N_].side&&A[0]&&(nd.PLANE_LEVEL_INSTANCED.setColorAt(A[0].id_instanced,Zc),nd.SELECTED_ID_ORANGE.push(A[0]),nd.SELECTED_ID.includes(A[0].id_instanced)||nd.SELECTED_ID.push(A[0].id_instanced))}}}}function D_(){N_=null;for(var e=0;e<nd.SELECTED_ID.length;e++)nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].planeColor&&nd.PLANE_LEVEL_INSTANCED.setColorAt(nd.SELECTED_ID[e],new vd(nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].planeColor)),nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].selected=!1;nd.SELECTED_ID=[],nd.SELECTED_COLOR=[]}var O_,P_=[],U_=["left","right","up","down","front","back"];function B_(e){if(O_=!1,"plus"==e){for(var t=0;t<nd.SELECTED_ID.length;t++)for(var n=0;n<6;n++)if(F_(t,1,U_[n]))return;for(t=0;t<nd.SELECTED_ID.length;t++)z_(nd.SELECTED_ID[t],1,nd.PLANE_USER_DATA[nd.SELECTED_ID[t]].portal,nd.PLANE_USER_DATA[nd.SELECTED_ID[t]])}else if("minus"==e){for(t=0;t<nd.SELECTED_ID.length;t++)for(n=0;n<6;n++)if(F_(t,-1,U_[n]))return;for(t=0;t<nd.SELECTED_ID.length;t++)z_(nd.SELECTED_ID[t],-1,nd.PLANE_USER_DATA[nd.SELECTED_ID[t]].portal,nd.PLANE_USER_DATA[nd.SELECTED_ID[t]])}for(t=0;t<P_.length;t++){var i=new gd;i.scale.set(0,0,0),i.updateMatrix(),nd.PLANE_LEVEL_INSTANCED.setMatrixAt(P_[t],i.matrix),nd.PLANE_LEVEL_INSTANCED.setVisibilityAt(P_[t],!1),nd.PLANE_USER_DATA[P_[t]]={},nd.PLANE_LEVEL_INSTANCED.computeBoundingSphere(),nd.BUDGET+=1}P_=[],s0(),O_&&D_()}function F_(e,t,n){var i,r=new gd,n=(r.position.copy(nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].position),r.rotation.copy(nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].rotation),r.translateZ(t),"left"==n?r.rotation.set(0,Math.PI/2,0):"right"==n?r.rotation.set(0,-Math.PI/2,0):"up"==n?r.rotation.set(Math.PI/2,0,0):"down"==n?r.rotation.set(-Math.PI/2,0,0):"front"==n?r.rotation.set(0,0,0):"back"==n&&r.rotation.set(0,Math.PI,0),"left"==nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].side?i="right":"right"==nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].side?i="left":"up"==nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].side?i="down":"down"==nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].side?i="up":"front"==nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].side?i="back":"back"==nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].side&&(i="front"),r.translateZ(t),r.position.copy(r.position.round()),Zg(r.position.x+"/"+r.position.y+"/"+r.position.z));return!!(0<n.length&&(n[0].hasItem&&nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].side!=n[0].side||n[0].side==i&&nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].hasItem))&&(Kg("Conflict!"),!0)}function z_(e,t,n){var i=new gd,r=(i.position.copy(nd.PLANE_USER_DATA[e].position),i.rotation.copy(nd.PLANE_USER_DATA[e].rotation),i.translateZ(2*t),i.position.copy(i.position.round()),Zg(i.position.x+"/"+i.position.y+"/"+i.position.z)),a=i.clone();if(a.translateZ(2*-t),"front"==nd.PLANE_USER_DATA[e].side||"back"==nd.PLANE_USER_DATA[e].side?(k_(a.clone(),t,0,"left",n),k_(a.clone(),t,0,"right",n),k_(a.clone(),t,0,"up",n),k_(a.clone(),t,0,"down",n)):"up"==nd.PLANE_USER_DATA[e].side||"down"==nd.PLANE_USER_DATA[e].side?(k_(a.clone(),t,0,"left",n),k_(a.clone(),t,0,"right",n),k_(a.clone(),t,0,"front",n),k_(a.clone(),t,0,"back",n)):"left"!=nd.PLANE_USER_DATA[e].side&&"right"!=nd.PLANE_USER_DATA[e].side||(k_(a.clone(),t,0,"front",n),k_(a.clone(),t,0,"back",n),k_(a.clone(),t,0,"up",n),k_(a.clone(),t,0,"down",n)),0<r.length){nd.PLANE_LEVEL_INSTANCED.setColorAt(e,new vd(16777215));a=new gd;a.scale.set(0,0,0),a.updateMatrix(),nd.PLANE_LEVEL_INSTANCED.setMatrixAt(e,a.matrix),nd.PLANE_LEVEL_INSTANCED.setVisibilityAt(e,!1),nd.PLANE_USER_DATA[e]={},nd.PLANE_LEVEL_INSTANCED.setColorAt(r[0].id_instanced,new vd(16777215)),(a=new gd).scale.set(0,0,0),a.updateMatrix(),nd.PLANE_LEVEL_INSTANCED.setMatrixAt(r[0].id_instanced,a.matrix),nd.PLANE_LEVEL_INSTANCED.setVisibilityAt(r[0].id_instanced,!1),nd.PLANE_USER_DATA[r[0].id_instanced]={},nd.PLANE_LEVEL_INSTANCED.instanceMatrix.needsUpdate=!0,nd.PLANE_LEVEL_INSTANCED.computeBoundingSphere(),nd.BUDGET+=2,O_=!0}else if(nd.PLANE_USER_DATA[e].position=i.position.clone(),nd.PLANE_USER_DATA[e].rotation=i.rotation.clone(),nd.PLANE_USER_DATA[e].name=i.position.x+"/"+i.position.y+"/"+i.position.z,i.updateMatrix(),nd.PLANE_LEVEL_INSTANCED.setMatrixAt(e,i.matrix),nd.PLANE_LEVEL_INSTANCED.setVisibilityAt(e,!0),nd.PLANE_LEVEL_INSTANCED.instanceMatrix.needsUpdate=!0,nd.PLANE_LEVEL_INSTANCED.computeBoundingSphere(),nd.PLANE_USER_DATA[e].hasItem){for(var o,s,l=nd.PLANE_USER_DATA[e],u=0;u<nd.CONNECTIONS.length;u++)nd.CONNECTIONS[u].from==l?(nd.CONNECTIONS[u].from=l,nd.SCENE_CHILDREN.remove(nd.CONNECTIONS[u].line),s=x_(nd.CONNECTIONS[u].from,nd.CONNECTIONS[u].to.position),nd.SCENE_CHILDREN.add(s),nd.CONNECTIONS[u].line=s,s=new dA(1,.5,1),o=new _d,(s=new xd(s,o)).position.copy(l.position),s.rotation.copy(l.rotation),(o=new pd).setFromObject(s),"button_box"==l.instancedName?o.accept="cube-cube_2-laser_cube-scale_cube":"button_sphere"==l.instancedName?o.accept="sphere":"button_weight"==l.instancedName&&(o.accept="sphere-cube-player-laser_cube-cube_2-scale_cube"),l.box3=o):nd.CONNECTIONS[u].to==l&&(nd.CONNECTIONS[u].to=l,nd.SCENE_CHILDREN.remove(nd.CONNECTIONS[u].line),s=x_(nd.CONNECTIONS[u].from,nd.CONNECTIONS[u].to.position),nd.SCENE_CHILDREN.add(s),nd.CONNECTIONS[u].line=s);"gel"!=nd.PLANE_USER_DATA[e].itemName&&(nd.PLANE_USER_DATA[e].isInstanced?(l.item.position.copy(l.position),(t=new gd).position.copy(l.position),t.rotation.copy(l.item.rotation),"cube"!=l.instancedName&&"sphere"!=l.instancedName&&"cube_2"!=l.instancedName&&"laser_cube"!=l.instancedName&&"scale_cube"!=l.instancedName||(t.translateY(-1),t.translateY(2),(n=new gd).position.copy(l.position),n.updateMatrix(),nd.ITEMS_ADDED.getObjectByName("dispenser").setMatrixAt(l.item.dispenserID,n.matrix),nd.ITEMS_ADDED.getObjectByName("dispenser").instanceMatrix.needsUpdate=!0,l.item.dispenserPosition=n.position.clone()),l.item.initialPosition=t.position.clone(),l.item.initialRotation=t.rotation.clone(),t.updateMatrix(),nd.ITEMS_ADDED.getObjectByName(l.instancedName).setMatrixAt(l.item.userData.id,t.matrix),nd.ITEMS_ADDED.getObjectByName(l.instancedName).instanceMatrix.needsUpdate=!0):l.item.position.copy(l.position))}}function k_(e,t,n,i,r){e.translateZ(t),"left"==i?e.rotation.set(0,Math.PI/2,0):"right"==i?e.rotation.set(0,-Math.PI/2,0):"up"==i?e.rotation.set(Math.PI/2,0,0):"down"==i?e.rotation.set(-Math.PI/2,0,0):"front"==i?e.rotation.set(0,0,0):"back"==i&&e.rotation.set(0,Math.PI,0),e.translateZ(t),e.position.copy(e.position.round());var a,t=Zg(e.position.x+"/"+e.position.y+"/"+e.position.z);if(0==t.length){e.updateMatrix();for(var o=0;o<nd.PLANE_USER_DATA.length;o++)if(!nd.PLANE_USER_DATA[o].exists){a=o;break}nd.PLANE_LEVEL_INSTANCED.setMatrixAt(a,e.matrix),nd.PLANE_LEVEL_INSTANCED.setVisibilityAt(a,!0);var s,l=8421504,u=(r?(nd.PLANE_LEVEL_INSTANCED.setColorAt(a,(new vd).setHex(16777215)),l=16777215):nd.PLANE_LEVEL_INSTANCED.setColorAt(a,(new vd).setHex(8421504)),nd.PLANE_LEVEL_INSTANCED.instanceMatrix.needsUpdate=!0,nd.PLANE_LEVEL_INSTANCED.computeBoundingSphere(),e.position.copy(e.position.round()),new dd);e.getWorldDirection(u),1==u.round().z?i="front":-1==u.round().z?i="back":1==u.round().x?i="left":-1==u.round().x?i="right":1==u.round().y?i="down":-1==u.round().y&&(i="up"),"down"==i?s=new dd(0,0,0):"up"==i?s=new dd(Math.PI,0,0):"front"==i?s=new dd(Math.PI/2,0,0):"back"==i?s=new dd(-Math.PI/2,0,0):"right"==i?s=new dd(Math.PI/2,0,Math.PI/2):"left"==i&&(s=new dd(Math.PI/2,0,-Math.PI/2)),nd.PLANE_USER_DATA[a]={iniPos:e.position.clone(),base:!0,side:i,name:e.position.x+"/"+e.position.y+"/"+e.position.z,selected:!1,position:e.position.clone(),rotation:e.rotation.clone(),exists:!0,id_instanced:a,portal:r,tile:1,normal:s,planeColor:l},--nd.BUDGET}else P_.push(t[0].id_instanced)}var G_=0;nd.PLANE_USER_DATA=[];for(var H_=0;H_<nd.BUDGET;H_++)nd.PLANE_USER_DATA.push({});function V_(){var e=new EA(2,2);e.computeBoundsTree(),nd.PLANE_LEVEL_INSTANCED=new Cd(e,nd.MATERIAL_PORTAL_EDITOR),nd.PLANE_LEVEL_INSTANCED.sortObjects=!0,nd.PLANE_LEVEL_INSTANCED.customSort=(s=>{let l={get:e=>e.depthSort,aux:new Array(s._capacity),reversed:null};return function(e){var t,n;l.reversed=!(null==(t=s._material)||!t.transparent),s._capacity>l.aux.length&&(l.aux.length=s._capacity);let i=1/0,r=-1/0;for({depth:n}of e)n>r&&(r=n),n<i&&(i=n);var a,o=(2**32-1)/(r-i);for(a of e)a.depthSort=(a.depth-i)*o;zu(e,l)}})(nd.PLANE_LEVEL_INSTANCED),nd.PLANE_LEVEL_INSTANCED.addInstances(nd.BUDGET,(e,t)=>{e.visible=!1}),nd.PLANE_LEVEL_INSTANCED.raycastOnlyFrustum=!0,nd.PLANE_LEVEL_INSTANCED.computeBVH(),nd.PLANE_LEVEL_INSTANCED.frustumCulled=!0,nd.PLANE_LEVEL_INSTANCED.castShadow=!1,nd.PLANE_LEVEL_INSTANCED.receiveShadow=!1,nd.PLANE_LEVEL_INSTANCED.name="cube-parent",nd.CUBES.add(nd.PLANE_LEVEL_INSTANCED),W_(-1,-1,0,"x","z","y",6,8,"down",new dd(-Math.PI/2,0,0),new dd(0,0,0)),W_(-1,-1,8,"x","z","y",6,8,"up",new dd(Math.PI/2,0,0),new dd(Math.PI,0,0)),W_(-1,-1,0,"x","y","z",4,8,"front",new dd(0,0,0),new dd(Math.PI/2,0,0)),W_(-1,-1,12,"x","y","z",4,8,"back",new dd(0,Math.PI,0),new dd(-Math.PI/2,Math.PI,0)),W_(-1,-1,16,"z","y","x",4,6,"right",new dd(0,-Math.PI/2,0),new dd(Math.PI/2,0,Math.PI/2)),W_(-1,-1,0,"z","y","x",4,6,"left",new dd(0,Math.PI/2,0),new dd(Math.PI/2,0,-Math.PI/2)),nd.PLANE_LEVEL_INSTANCED.instanceMatrix.needsUpdate=!0,nd.PLANE_LEVEL_INSTANCED.computeBoundingSphere()}function W_(e,t,n,i,r,a,o,s,l,u,c){for(var h=t,d=new gd,p=0;p<s;p++){e+=2;for(var f=0;f<o;f++){t+=2,d.rotation.set(u.x,u.y,u.z),d.scale.set(1,1,1),d.position[i]=e,d.position[r]=t,d.position[a]=n,d.updateMatrix(),nd.PLANE_LEVEL_INSTANCED.setMatrixAt(G_,d.matrix),nd.PLANE_LEVEL_INSTANCED.setVisibilityAt(G_,!0);var m,g=8421504,v=(d.position.x<=5&&7<=d.position.z&&d.position.y<=5||10<=d.position.x&&d.position.z<=1&&d.position.y<=3||8==d.position.y?(m=!1,nd.PLANE_LEVEL_INSTANCED.setColorAt(G_,(new vd).setHex(8421504))):(m=!0,nd.PLANE_LEVEL_INSTANCED.setColorAt(G_,(new vd).setHex(16777215)),g=16777215),!1),_=null,y=!1,E=null,A=!1;d.position.equals(new dd(3,1,12))?(_="enterDoor",E=nd.ENTER_DOOR,A=y=v=!0):d.position.equals(new dd(13,1,0))?(_="exitDoor",E=nd.EXIT_DOOR,A=y=v=!0):d.position.equals(new dd(16,7,7))&&(_="window",y=v=!0,E=nd.OBSERVATION_ROOM_IMG),d.position.copy(d.position.round()),nd.PLANE_USER_DATA[G_]={iniPos:d.position.clone(),base:!0,side:l,name:d.position.x+"/"+d.position.y+"/"+d.position.z,selected:!1,position:d.position.clone(),rotation:d.rotation.clone(),exists:!0,id_instanced:G_,portal:m,tile:1,hasItem:v,itemName:_,merged:!1,checked:!1,canRotate:!1,floor:!1,walls:y,ceiling:!1,isInstanced:!1,item:E,allowconnection:A,connected:[],idConnection:[],line:[],normal:c,planeColor:g,connectionPoints:[]},--nd.BUDGET,"exitDoor"==_&&LE(nd.PLANE_USER_DATA[G_]),G_++}t=h}nd.RENDERER.renderLists.dispose()}var j_,Y_,q_,X_,Z_,K_,J_,vg=window.innerWidth,Qh=window.innerHeight,$h=`
varying vec2 vUv; 
void main()
{
    vUv = uv;

    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;
}
`,wv=`
// inspired by shader from VoidChicken
// https://www.shadertoy.com/view/XtdXR2
// ... and portal of course ;)

uniform vec2 resolution;
uniform float iTime;
uniform sampler2D iChannel0;
uniform sampler2D iChannel1;
uniform bool start;

uniform int dir;
uniform float dirVal;

// 1 .. 3
const int transitionType = 1;
bool transitionStarted = false; // Variable to track if the transition has started
float transitionProgress = 0.0; // Variable to control the transition progress

varying vec2 vUv;

void main()
{

    gl_FragColor = vec4(0);
    float depth = -1e3;
    for (float i=0. ; i<=1. ; ++i)
    {
        vec2 fragCoord = vUv * resolution;
        vec2 xy = fragCoord - resolution.xy / 2.0;

        //vec2 xy = fragCoord - iResolution / 2.0;
        //vec2 xy = vUv * resolution / 2.0;
        //vec2 xy = vUv;
        //vec2 xy = -0.1 + 1.0 *vUv;

        float grid_width = 100.0;//159
        xy /= grid_width;
        xy.y += i + .5;
        xy.y /= 2.;
        vec2 grid = floor(xy);
        xy -= grid + 0.5;
        xy.y *= 2.;
        grid.y = grid.y * 2. - i;

        float phase = 0.0;
        float offset = (grid.y - grid.x)*dirVal;
        float time = iTime*1.5 - offset;
        if (transitionType == 1)
        {
            // Check if the transition has not started yet
            if (!transitionStarted)
            {
                // Increment the transitionProgress only once
                transitionProgress += 1.0;
                
                // Set time based on transitionProgress
                float time = mod(transitionProgress, 6.0);
                
                // If one full cycle has occurred, set the transitionStarted flag to true
                if (transitionProgress >= 6.0)
                {
                    transitionStarted = true;
                    
                    // Reset transitionProgress to ensure the transition effect doesn't continue
                    transitionProgress = 0.0;
                }
                
                // Apply your transition effect here based on the value of 'time'
                // This effect will run once and then stop
                // For example, you can use 'time' to control the progress of the transition.
                // The effect will complete in one cycle, and then the flag will be set, stopping further transitions.
            }
        }

        //phase += smoothstep(0.0, 1.0, time);
        phase += 1.0 - smoothstep(3.0, 4.0, time);
        phase = abs(mod(phase, 2.0)-1.0);
        
        float side = step(0.5, phase);

        float angle = radians(phase * 180.), z = 2.;
        vec3 p = inverse(mat3(cos(angle),0,-sin(angle), 0,1,0, 0,0,z)) * vec3(xy, z);
        vec2 uv = p.xy / p.z + .5;

        float alpha = 1.;
        if (uv.x>0.0&&uv.y>0.0&&uv.x<1.0&&uv.y<1.0 && p.z>depth)
            depth = p.z;
        else
            alpha = 0.;

        vec2 scale = grid_width / resolution.xy;
        vec2 uv1 = (grid + uv) * scale + .5;
        vec2 uv2 = (grid + vec2(1. - uv.x, uv.y)) * scale + .5;

        vec4 c1;
        vec4 c2;

        if(dir == 0){
            c1 = texture(iChannel0, uv1);
            c2 = texture(iChannel1, uv2);
        }else{
            c1 = texture(iChannel1, uv1);
            c2 = texture(iChannel0, uv2);
        }
        

        gl_FragColor = mix(gl_FragColor, mix(c1, c2, side), alpha);
        //gl_FragColor = mix(gl_FragColor, vec4(p.z-1., 1.-p.z, 0, 1)*10., alpha);
    }
}
`,id=(new wd).load("./assets/loading/3.webp"),pg,Gv;nd.TEXTURE_MENU_GRID=(new wd).load("./assets/ui/grid.webp"),nd.MATERIAL_MAIN_MENU=new Td({uniforms:{iTime:{type:"f",value:1.2},resolution:{type:"v2",value:new ld(vg,Qh)},iChannel0:{type:"t",value:id},iChannel1:{type:"t",value:nd.TEXTURE_MENU_GRID},dir:{value:0},dirVal:{value:-.1}},vertexShader:$h,fragmentShader:wv,side:2,transparent:!0}),nd.MATERIAL_SUB_MENU=new Td({uniforms:{iTime:{type:"f",value:1.2},resolution:{type:"v2",value:new ld(vg,Qh)},iChannel0:{type:"t",value:id},iChannel1:{type:"t",value:nd.TEXTURE_MENU_GRID},dir:{value:1},dirVal:{value:.1}},vertexShader:$h,fragmentShader:wv,side:2,transparent:!0}),(pg=new ed.Material).friction=0,(Gv=new ed.Box(new ed.Vec3(.25,.625,.25))).height=1.25,Gv.width=.5,nd.PLAYER=new ed.Body({mass:50,material:pg}),nd.PLAYER.allowSleep=!1,nd.PLAYER.addShape(Gv),nd.PLAYER.position.set(5,5,5),nd.PLAYER.linearDamping=.999,nd.PLAYER.name="player",nd.PLAYER.angularDamping=1,nd.PLAYER.inJump=!0,nd.PLAYER.DIR=1,nd.PLAYER.updateMassProperties(),nd.CANNON_WORLD.addBody(nd.PLAYER),nd.PLAYER.upVector=new ed.Vec3(0,1,0),nd.PLAYER.upVectorThree=new dd(0,1,0);let Kc=new ed.Vec3(0,0,0);nd.PLAYER.addEventListener("collide",function(e){"gel"==e.body.name&&Qv(e),nd.PLAYER.ROTATING||("orange"==e.body.type?(nd.SPEED=3,nd.HEAD_BOB_SPEED=10):e.target.OrangeContact&&(e.target.OrangeContact=!1,nd.SPEED=1,nd.HEAD_BOB_SPEED=6,rd.WALK.volume=.25,Sg(rd.PROPULSION)),"purple"!=e.body.type&&nd.PLAYER.customGravity&&(clearTimeout(e.target.timeout),e.target.timeout=setTimeout(()=>{Q_()},10)),"blue"!=e.body.type&&e.target.impactVelocity&&(clearTimeout(e.target.timeout),e.target.timeout=setTimeout(()=>{e.target.impactVelocity=null,e.target.jumpVelocity=null,e.target.impactSide=null},10)),nd.PLAYER.looping=!1,"faith_plate"!=e.body.name||nd.PLAYER.block||(nd.PLAYER.block=!0,setTimeout(()=>{nd.PLAYER.block=!1},10),clearTimeout(rd.AERIAL.timeout),rd.AERIAL.volume=1,0<rd.AERIAL.duration&&!rd.AERIAL.paused||(rd.AERIAL.currentTime=0,rd.AERIAL.play()),nd.BLOCK_PLAYER_MOVE=!0,nd.PLAYER.inJump=!0,nd.PLAYER_MOVING=!0,nd.PLAYER.linearDamping=.01,U0(e.body,e.target)),"light_bridge"==e.contact.bj.name?nd.PLAYER.lightBridge=!0:nd.PLAYER.lightBridge=!1,nd.PLAYER.inJump&&Ag(rd.JUMP))}),nd.CANNON_WORLD.addEventListener("postStep",e=>{if(h0(),nd.PLAYER.inJump=!0,!nd.BLOCK_PLAYER_MOVE){if(0<nd.CANNON_WORLD.contacts.length)for(var t of nd.CANNON_WORLD.contacts)if(0!=t.bi.collisionResponse&&0!=t.bj.collisionResponse&&(t.bi.id==nd.PLAYER.id||t.bj.id==nd.PLAYER.id)){Kc=t.bi.id==nd.PLAYER.id?new dd(-1*t.ni.x,-1*t.ni.y,-1*t.ni.z):t.ni,nd.PLAYER.inJump=Kc.dot(nd.PLAYER.upVector)<=.5;break}nd.PLAYER_MOVING=nd.PLAYER.inJump;for(var n of nd.DYNAMIC_OBJECTS)n.firstCollisionHandled=!1}}),nd.DYNAMIC_OBJECTS.push(nd.PLAYER);for(j_ of nd.DYNAMIC_OBJECTS)j_.collisionFilterGroup=nd.CGROUP_DYNAMIC,j_.collisionFilterMask=nd.CGROUP_ALL;function Q_(){nd.HEAD_BOB_SPEED=6,nd.PLAYER.PURPLE_CONTACT=!1,nd.PLAYER.customGravity=null,nd.PLAYER.side=null,nd.PLAYER.EULER=null,nd.PLAYER.DIR=1;var e=nd.CUSTOM_GRAVITY.indexOf(nd.PLAYER);-(nd.SPEED=1)<e&&(rd.WALK_PAINT.pause(),rd.WALK=rd.WALK_NORMAL,nd.PLAYER.EULER=null,nd.CUSTOM_GRAVITY.splice(e,1),nd.PLAYER.upVector=new ed.Vec3(0,1,0),nd.PLAYER.upVectorThree=new dd(0,1,0),window.nnn=!1,nd.POINTER_CONTROLS.maxPolarAngle=Math.PI,nd.POINTER_CONTROLS._euler=new md(0,0,0,"YXZ"),nd.PLAYER.velocity.setZero(),nd.PLAYER.initVelocity.setZero(),nd.PLAYER.angularVelocity.setZero(),nd.PLAYER.initAngularVelocity.setZero(),nd.PLAYER.force.setZero(),nd.PLAYER.torque.setZero(),$g(400,nd.MAIN_CAMERA_GROUP.rotation,new dd(0,0,0)),setTimeout(()=>{nd.MAIN_CAMERA.position.copy(nd.MAIN_CAMERA_GROUP.position),nd.MAIN_CAMERA_GROUP.position.set(0,0,0),nd.PIVOT=nd.MAIN_CAMERA},500))}function $_(){nd.PLAYER.position.set(0,0,0),nd.PLAYER.previousPosition.set(0,0,0),nd.PLAYER.interpolatedPosition.set(0,0,0),nd.PLAYER.initPosition.set(0,0,0),nd.PLAYER.quaternion.set(0,0,0,1),nd.PLAYER.initQuaternion.set(0,0,0,1),nd.PLAYER.interpolatedQuaternion.set(0,0,0,1),nd.PLAYER.velocity.set(0,0,0),nd.PLAYER.initVelocity.set(0,0,0),nd.PLAYER.angularVelocity.set(0,0,0),nd.PLAYER.initAngularVelocity.set(0,0,0),nd.PLAYER.force.set(0,0,0),nd.PLAYER.torque.set(0,0,0),nd.PLAYER.inJump=!1}function ey(){nd.EXIT_DOOR.finished=!1,nd.STATS_UI.time=0,nd.STATS_UI.steps=0,window.curentTimeOffset=0,window.pellets=[],$_(),nd.MAIN_CAMERA.remove(nd.MAIN_CAMERA.getObjectByName("listener")),window.listernAdded=!1;for(var e=0;e<nd.SOUNDS_FPS.length;e++)nd.SCENE_FPS.remove(nd.SOUNDS_FPS[e]),nd.SOUNDS_FPS[e].audio.currentTime=0,nd.SOUNDS_FPS[e].audio.pause();nd.SCENE_FPS.remove(m);for(var t=m.current=0;t<m.instances.length;t++)m.instances[t].position.x=1e5,m.instances[t].position.y=1e5,m.instances[t].position.z=1e5,m.instances[t].scale.x=0,m.instances[t].scale.y=0,m.instances[t].scale.z=0,m.instances[t].visible=!1,m.instances[t].updateMatrix();m.instanceMatrix.needsUpdate=!0,m.computeBoundingSphere(),nd.HOLDING_ITEM&&Nv();for(var n=0;n<nd.BOUNDING_BOX.length;n++)nd.BOUNDING_BOX[n].platform.material.color=new vd(65280),nd.BOUNDING_BOX[n].platform.material.emissive=null,nd.BOUNDING_BOX[n].platform.material.transparent=!0,nd.BOUNDING_BOX[n].platform.scale.x=1,nd.BOUNDING_BOX[n].platform.scale.z=1;for(e=0;e<nd.DYMANIC_ITEMS.piston_platforms.length;e++)0!=nd.DYMANIC_ITEMS.piston_platforms[e].length&&u0(nd.DYMANIC_ITEMS.piston_platforms[e],e,"piston_platforms");for(e=0;e<nd.DYMANIC_ITEMS.track_platforms.length;e++)0!=nd.DYMANIC_ITEMS.track_platforms[e].length&&u0(nd.DYMANIC_ITEMS.track_platforms[e],e,"track_platforms");for(e=0;e<nd.GOO_PLANES.length;e++)nd.GOO_PLANES[e].item.visible=!0;for(var i=0;i<nd.TRIGGER_BOXES.length;i++)nd.TRIGGER_BOXES[e]&&(nd.TRIGGER_BOXES[e].item.visible=!0,nd.TRIGGER_BOXES[i].item.userData.active=!1,nd.TRIGGER_BOXES[i].item.userData.played=!1);nd.ENTER_DOOR.getObjectByName("trigger").visible=!0,nd.EXIT_DOOR.getObjectByName("trigger").visible=!0;for(e=0;e<window.instances.length;e++)nd.SCENE_FPS.remove(window.instances[e]);nd.ITEMS_ADDED.getObjectByName("spawn")&&(nd.CORRIDOR_ENTER.visible=!1,nd.ITEMS_ADDED.getObjectByName("spawn").visible=!0,nd.ENTER_DOOR.visible=!0),nd.DEBUGGER_GROUP.visible=!1,nd.GROUP_LINE_TRAGECTORY.visible=!0,nd.ROOM.visible=!0,nd.CONTROLS.enabled=!0,nd.SCENE.environment=nd.ENV_MAP,nd.LIGHT_GROUP.visible=!1,nd.SCENE.background=null,nd.CORRIDOR_ENTER.visible=!1,nd.SCENE.getObjectByName("window").visible=!0,nd.OBSERVATION_ROOM.visible=!1,nd.SCENE_CHILDREN.remove(nd.SCENE_FPS),nd.SCENE_FPS=null,nd.LEVEL_ENTERED=!1,nd.DOOR_OPEN_STATE=!1,nd.FINISHED=!1,td()("#ui").css("display","block"),td()(".img").removeClass("image"),td()("#mobile-controls").css("display","none"),td()("#container").css("filter","none"),td()("#blocker").css("display","none"),td()("#blocker").css("pointer-events","none"),td()("#reticle").css("display","none"),O0(0),O0(1),nd.PORTAL_BOX=[],nd.MAIN_CAMERA.position.set(-12.2,17.4,26.3),nd.LIGHT_PORTAL_0.visible=!1,nd.LIGHT_PORTAL_1.visible=!1,nd.FLASH.visible=!1;for(e=nd.CANNON_BODIES.length-1;0<=e;e--)nd.CANNON_WORLD.remove(nd.CANNON_BODIES[e]);for(var r=0;r<nd.LIGHT_BRIDGE_CLONE.length;r++)nd.ITEMS_ADDED.remove(nd.LIGHT_BRIDGE_CLONE[r]),nd.CANNON_WORLD.removeBody(nd.LIGHT_BRIDGE_COLLIDER_CLONE[r]),nd.LIGHT_BRIDGE_CLONE[r].item.clone=null;nd.CANNON_BODIES=[],nd.WALL_BODIES=[],nd.RADIO_MUSIC=[],nd.BLOCK_PORTAL=[],nd.DYNAMIC_OBJECTS=[],nd.DYNAMIC_OBJECTS.push(nd.PLAYER),nd.TRACTOR_BEAM_LENGTH=0,nd.LASER_EMITTER_LENGTH=0,nd.CONTROLS.update(),Ag(rd.EDITOR),rd.AMBIENT.pause(),nd.ENTER_DOOR.children[0].rotation.z+=Math.PI,Y0(0,!1,!1,nd.ENTER_DOOR,!0),Y0(0,!1,!1,nd.EXIT_DOOR,!0),nd.CORRIDOR_ENTER.getObjectByName("elevatorOBJ").visible=!0,nd.CORRIDOR_ENTER.getObjectByName("leftDoor").visible=!0,nd.CORRIDOR_ENTER.getObjectByName("rightDoor").visible=!0,nd.CORRIDOR_ENTER.getObjectByName("rightDoor").rotation.y=Math.PI/2,nd.CORRIDOR_ENTER.getObjectByName("leftDoor").rotation.y=Math.PI/2,nd.MATERIAL_TRACTOR_BEAM.depthWrite=!0,nd.MATERIAL_TRACTOR_BEAM_REVERSE.depthWrite=!0,nd.FPS_MODE=!1;for(var a,o=0;o<nd.CONNECTIONS.length;o++)nd.CONNECTIONS[o].line.active&&(a=!1,nd.CONNECTIONS[o].to.item.userData.buttons==nd.CONNECTIONS[o].to.item.userData.connections&&(a=!0),--nd.CONNECTIONS[o].to.item.userData.buttons,Ov(nd.CONNECTIONS[o],null,!1,new vd(0,2,5)),a)&&(nd.CONNECTIONS[o].to.itemName.includes("door")||nd.CONNECTIONS[o].to.itemName.includes("exitDoor")?nd.CONNECTIONS[o].to.item.userData.buttons<nd.CONNECTIONS[o].to.item.userData.connections&&Y0(0,!1,!1,nd.CONNECTIONS[o].to.item):nd.CONNECTIONS[o].to.itemName.includes("tractor")?nd.CONNECTIONS[o].to.item.userData.buttons<nd.CONNECTIONS[o].to.item.userData.connections&&J0(nd.CONNECTIONS[o].to):nd.CONNECTIONS[o].to.itemName.includes("light_bridge")?nd.CONNECTIONS[o].to.item.userData.buttons<nd.CONNECTIONS[o].to.item.userData.connections&&K0(nd.CONNECTIONS[o].to):nd.CONNECTIONS[o].to.itemName.includes("laser_field")||nd.CONNECTIONS[o].to.itemName.includes("fizzler")?nd.CONNECTIONS[o].to.item.userData.buttons<nd.CONNECTIONS[o].to.item.userData.connections&&Z0(nd.CONNECTIONS[o].to):nd.CONNECTIONS[o].to.itemName.includes("portal_0")||nd.CONNECTIONS[o].to.itemName.includes("portal_1")?nd.CONNECTIONS[o].to.item.active=!1:(nd.CONNECTIONS[o].to.itemName.includes("piston_platforms")||nd.CONNECTIONS[o].to.itemName.includes("track_platforms")||nd.CONNECTIONS[o].to.itemName.includes("pellet_launcher"))&&(nd.CONNECTIONS[o].to.item.userData.isActive=!nd.CONNECTIONS[o].to.item.userData.isActive,nd.CONNECTIONS[o].to.item.body.pistonDown=!0,nd.CONNECTIONS[o].to.itemName.includes("piston_platforms")||nd.CONNECTIONS[o].to.itemName.includes("track_platforms"))&&(nd.CONNECTIONS[o].to.item.userData.isActive?nd.CONNECTIONS[o].to.item.body.sound.audio.play():nd.CONNECTIONS[o].to.item.body.sound.audio.pause()));for(var s=["cube","cube_2","radio","sphere","laser_cube","scale_cube"],e=0;e<s.length;e++)for(var l,u,n=0;n<nd.DYMANIC_ITEMS[s[e]].length;n++)nd.DYMANIC_ITEMS[s[e]][n].visible&&(u=l=void 0,l=nd.DYMANIC_ITEMS[s[e]][n],u=s[e],l.position.copy(l.position),l.updateMatrix(),(u=nd.ITEMS_ADDED.getObjectByName(u)).setMatrixAt(l.userData.idInstanced,l.matrix),u.instanceMatrix.needsUpdate=!0,u.computeBoundingSphere());for(e=0;e<nd.CAMERAS.length;e++){nd.CAMERAS[e].fixed=!0,nd.CAMERAS[e].position.copy(nd.CAMERAS[e].initialPosition),nd.CAMERAS[e].rotation.copy(nd.CAMERAS[e].initialRotation);var c=new dd,c=(nd.CAMERAS[e].children[1].getWorldPosition(c),c.y-=.25,nd.CAMERAS[e].cube.position.copy(c),nd.CAMERAS[e].cube.body=null,nd.INTERACTIVE.indexOf(nd.CAMERAS[e].cube));-1<c&&nd.INTERACTIVE.splice(c,1)}nd.SCENE_FPS=[],setTimeout(()=>{nd.ENTER_DOOR.getObjectByName("portal_door_right_04").position.z=10,nd.ENTER_DOOR.getObjectByName("portal_door_left_06").position.z=10,nd.EXIT_DOOR.getObjectByName("portal_door_right_04").position.z=10,nd.EXIT_DOOR.getObjectByName("portal_door_left_06").position.z=10},1500),nd.PORTAL_GUN_INITIATE=nd.PORTAL_GUN_INITIATE_HOLDER;for(e=0;e<nd.PORTAL_GUN_BOX.length;e++)nd.PORTAL_GUN_BOX[e].item.visible=!0,nd.PORTAL_GUN_BOX[e]=nd.PORTAL_GUN_BOX[e].item;for(e=0;e<nd.CONNECTIONS.length;e++)nd.CONNECTIONS[e].from.instancedName.includes("trigger_area")&&(nd.CONNECTIONS[e].from.item.visible=!0),nd.CONNECTIONS[e].line.active=!1,nd.CONNECTIONS[e].to.item.userData.buttons=0;nd.SCENE_FPS=new Sd;for(e=0;e<nd.LASER_EMITTER_RAYCASTER.length;e++)nd.LASER_EMITTER_RAYCASTER[e].laser.clone.visible=!1}async function ty(e,t){clearTimeout(q_),Y_&&(Y_.currentTime=0,Y_.pause()),Y_=new Audio(e.link);try{t&&(await Y_.play(),setTimeout(()=>{Y_.pause()},5e3)),e.voice=Y_}catch(e){}}td()("body").on("click","#back-editor",function(){ey()}),td()("body").on("change","#state-trigger-multiple",function(){nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.multipleTrigger=this.checked}),td()("body").on("change","#state-trigger-visibility",function(){console.log(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]]),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.triggerVisibility=this.checked}),td()("body").on("change","#state-trigger-loop",function(){nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.soundEffectLoop=this.checked}),td()("#ambient-sound-select").on("change",function(){rd.AMBIENT.pause(),rd.AMBIENT.currentTime=0,rd.AMBIENT=document.getElementById("ambient-"+td()(this).val()),rd.AMBIENT.value=td()(this).val(),nd.LOADED_LEVEL||(Ag(rd.AMBIENT),clearTimeout(X_),X_=setTimeout(()=>{rd.AMBIENT.pause(),rd.AMBIENT.currentTime=0},5e3))}),td()(".trigger_audio-state").on("click",function(){nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.soundEffect=td()(this).data("state"),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.soundEffectElem&&(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.soundEffectElem.pause(),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.soundEffectElem.currentTime=0),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.soundEffectElem=new Audio("/audio/effect/"+td()(this).data("state")),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.soundEffectElem.play(),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.soundEffectElem.loop=!1,clearTimeout(X_),X_=setTimeout(()=>{nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.soundEffectElem.pause(),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.soundEffectElem.currentTime=0},5e3)}),td()("body").on("input","#state-trigger-voice-link",function(){var e=(e=td()(this).val().replace("dl=0","dl=1")).replace(/&st=.*&dl=1/,"");e=(e+="&dl=1").replace("www","dl"),td()(this).val(e),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.link=e}),td()("body").on("click","#play-trigger-voice",function(){nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.link&&ty(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData,!0)});var ny,iy=!1,ry=!1;window.stopMenuLoop=!1;let Jc=new dT;function ay(){nd.RENDERER.setSize(window.innerWidth,window.innerHeight),nd.MAIN_CAMERA.aspect=window.innerWidth/window.innerHeight,nd.MAIN_CAMERA.updateProjectionMatrix(),nd.MATERIAL_MAIN_MENU.uniforms.resolution.value=new ld(window.innerWidth,window.innerHeight),nd.MATERIAL_SUB_MENU.uniforms.resolution.value=new ld(window.innerWidth,window.innerHeight),oy(Z_,nd.MAIN_CAMERA)}function oy(e,t,n){var n=2<arguments.length&&void 0!==n?n:null,n=(null!==n?n:t.position.z)-e.position.z,i=t.fov*Math.PI/180,i=2*Math.tan(i/2)*n,n=i*t.aspect;e.scale.set(n,i,1),K_.scale.set(n,i,1)}function sy(){var e="./levels/tutorial_"+window.currentLevel+"_by_rafadante.json";window.isCustom&&(e=ny),fetch(e).then(e=>e.json()).then(e=>{J_=e,py="tutorial_"+window.currentLevel+"_by_rafadante",td()("#portal-gun-select").val(J_[0][0]).change(),td()("#ambient-sound-select").val(J_[0][1]).change(),td()("#option-single").css("display","none"),td()("#option-community").css("display","none"),td()("#option-about").css("display","none"),td()("#back-editor").css("display","none"),fy(J_[1])})}window.unlockedFPS=0,window.isCustom=!1,td()("#blocker").css("display","flex"),td()("#options-main").css("display","block"),td()("#loading-parent").css("opacity","0"),td()("#loading-parent").css("pointer-events","none"),td()("body").on("click","#option-community-build, #option-single-load",function(){alert("The level editor is still very unstable, and things will change a lot in the coming weeks, so maps can break in future updates. Feel free to mess around with it."),setTimeout(()=>{Ag(rd.EDITOR),L1()},2e3)}),td()("body").on("click","#back-main-map-btn, #back-main-menu",function(){console.log("66666666666666"),td()("#blocker .body").css("opacity","1"),td()("#blocker").css("display","flex"),td()("#ui").css("display","none"),td()("#blocker .body").css("opacity","1"),td()(".optionMenu").css("display","none"),td()("#options-main").css("display","block"),td()("#options-settings").css("display","none"),td()("#settings-close").css("display","none"),td()("#next-map").css("display","none"),td()("#options-main .option").css("display","block"),window.stopMenuLoop=!1}),window.stopMenuLoop||setTimeout(()=>{var e=new EA(1,1),e=(Z_=new xd(e,nd.MATERIAL_MAIN_MENU),nd.SCENE_CHILDREN.add(Z_),new EA(1,1));K_=new xd(e,nd.MATERIAL_SUB_MENU),nd.SCENE.background=new vd(0),oy(Z_,nd.MAIN_CAMERA),dy(),window.addEventListener("resize",ay)},1e3),td()("body").on("click","#option-single-load",function(){td()("#next-map-btn").css("display","block"),uy(),setTimeout(()=>{window.currentLevel=1,window.stopMenuLoop=!0,nd.LOADED_LEVEL=!0},2e3)}),td()("#next-map-btn").on("click",function(){td()("#loading-parent").css("opacity",1),td()("#loading-parent").css("pointer-events","all"),td()("#next-map").css("display","none"),ey(),setTimeout(()=>{sy()},2e3)}),td()("body").on("click",".load-custom",function(){window.isCustom=!0,L1(),fetch("./levels/custom/"+td()(this).data("id")+".json").then(e=>e.json()).then(e=>{J_=e,nd.LOADED_LEVEL=!0,uy()})});var ly=!0;function uy(){td()("#blocker .body").css("opacity","0"),td()("#logo").css("opacity","0"),nd.MATERIAL_MAIN_MENU.uniforms.iChannel0.value=nd.MATERIAL_MAIN_MENU.uniforms.iChannel1.value,nd.MATERIAL_MAIN_MENU.uniforms.iChannel1.value=null,nd.MATERIAL_MAIN_MENU.uniforms.iTime.value=1.2,ry=!(iy=!0),nd.SCENE_CHILDREN.add(Z_),nd.SCENE_CHILDREN.remove(K_),setTimeout(()=>{td()("#loading-parent").css("opacity","1"),td()("#loading-parent").css("pointer-events","all"),setTimeout(()=>{td()("#blocker").css("display","none"),td()("#ui").css("display","block"),td()("#container #back-effect").css("display","none"),td()("#blocker .body").css("opacity","1"),td()(".option-main").css("display","none"),td()("#options-settings").css("display","block"),td()("#settings-menu-title").text("OPTIONS"),td()("#back-main").css("display","none"),td()("#settings-close").css("display","block"),td()("#main-container").css("display","block"),nd.SCENE_CHILDREN.remove(Z_),nd.SCENE_CHILDREN.remove(K_),nd.SCENE.background=null,window.stopMenuLoop=!0,console.log(window.stopMenuLoop)},1e3)},1e3)}function cy(e,t,n){nd.MATERIAL_MAIN_MENU.uniforms.iChannel1.value=e,nd.MATERIAL_SUB_MENU.uniforms.iChannel1.value=e,nd.MATERIAL_MAIN_MENU.uniforms.iTime.value=1.2,nd.MATERIAL_SUB_MENU.uniforms.iTime.value=1.2,iy=!0,ry&&(ry=!1,nd.SCENE_CHILDREN.add(Z_),nd.SCENE_CHILDREN.remove(K_)),hy("block","none",t,"flex",n)}function hy(e,t,n,i,r){td()("#blocker .body").css("opacity","0"),td()("#logo").css("opacity","0"),td()("#blocker").css("pointer-events","none"),setTimeout(()=>{td()("#options-main").css("display",t),td()(r).css("display",e),td()("#back-main").css("display",e),td()("#settings-menu-title").css("display",i),td()("#settings-menu-title").text(n),td()("#blocker").css("pointer-events","all"),td()("#blocker .body").css("opacity","1"),td()("#logo").css("opacity","1")},2e3)}function dy(e){window.stopMenuLoop||(iy&&(nd.MATERIAL_MAIN_MENU.uniforms.iTime.value+=Jc.getDelta()),ry&&(nd.MATERIAL_SUB_MENU.uniforms.iTime.value+=Jc.getDelta()),nd.RENDERER.render(nd.SCENE,nd.MAIN_CAMERA),requestAnimationFrame(dy))}td()("body").on("click",".custom-chamber",function(){td()("#next-map-btn").css("display","none"),window.isCustom=!0,"list-custm-chambers"==td()(this).parent().attr("id")?td()("#next-map-btn").css("display","none"):(td()("#next-map-btn").css("display","block"),window.currentLevel=td()(this).data("id")),setTimeout(()=>{ny=td()(this).data("name")+".json",window.stopMenuLoop=!0,nd.LOADED_LEVEL=!0},2e3),ly?(setTimeout(()=>{L1()},2e3),uy()):(td()("#loading-parent").css("opacity",1),td()("#loading-parent").css("pointer-events","all"),td()("#next-map").css("display","none"),td()("#options-settings").css("display","block"),td()("#options-main").css("display","none"),td()("#options-single").css("display","none"),td()("#options-community").css("display","none"),td()("#container").css("display","block"),td()("#back-main").css("display","none"),td()("#settings-close").css("display","block"),ey(),setTimeout(()=>{sy()},2100)),ly=!1}),"true"==localStorage.getItem("load")&&(td()("#loading-parent").css("opacity","1"),td()("#loading-parent").css("pointer-events","all"),localStorage.setItem("load","false"),setTimeout(()=>{window.currentLevel=parseInt(localStorage.getItem("level")),L1(),fetch("./levels/"+window.currentLevel+".json").then(e=>e.json()).then(e=>{J_=e,nd.LOADED_LEVEL=!0,uy()})},1e3)),td()("body").on("click","#option-community-build",function(){uy()}),td()("body").on("click","#option-single-reset",function(){1==window.confirm("Are you sure you want to reset your progress?")&&(localStorage.setItem("level",1),window.location.reload())}),td()("body").on("click","#option-single",function(){cy(nd.TEXTURE_MENU_GRID,"SINGLE PLAYER","#options-single")}),td()("body").on("click","#option-community",function(){cy(nd.TEXTURE_MENU_GRID,"COMMUNITY CHAMBERS","#options-community"),td()(".main-option").css("display","flex"),td()(".sub-option").css("display","none")}),td()("body").on("click","#option-options",function(){td()("#back-editor").css("display","none"),cy(nd.TEXTURE_MENU_GRID,"OPTIONS","#options-settings")}),td()("body").on("click","#option-about",function(){cy(nd.TEXTURE_MENU_GRID,"ABOUT","#options-about")}),td()("body").on("click","#option-patreon",function(){cy(nd.TEXTURE_MENU_GRID,"PATREON","#options-patreon")}),td()("body").on("click","#back-main",function(){nd.MATERIAL_SUB_MENU.uniforms.iTime.value=1.2,iy=!(ry=!0),nd.SCENE_CHILDREN.remove(Z_),nd.SCENE_CHILDREN.add(K_),hy("none","block","","none",".option-main")}),td()("body").on("click","#load-level",function(){td()("#load-level-panel").css("display","flex")}),td()("body").on("click","#close-load-level-panel",function(){td()("#load-level-panel").css("display","none")}),td()("body").on("click","#option-community-play",function(){td()(".main-option").css("display","none"),td()(".sub-option").css("display","grid")});var py="null";function fy(e){for(var t=nd.CANNON_BODIES_CONTINUOUS.length-1;0<=t;t--)nd.CANNON_WORLD.remove(nd.CANNON_BODIES_CONTINUOUS[t]);for(var n,t=nd.LASERS.children.length-1;0<=t;t--)nd.LASERS.remove(nd.LASERS.children[t]);nd.EXIT_DOOR.finished=!1,nd.CORRIDOR_ENTER&&((n=(new wd).load("./levels/signs/"+window.currentLevel+".webp")).colorSpace=je,n.wrapS=n.wrapT=H,n.flipY=!1,nd.CORRIDOR_ENTER.getObjectByName("sign").visible=!0,nd.CORRIDOR_ENTER.getObjectByName("sign").material.map=n,nd.CORRIDOR_ENTER.getObjectByName("sign").material.envMapIntensity=0,nd.CORRIDOR_ENTER.getObjectByName("sign").scale.z=-1),td()("#chamber-name-to-save").val(py.substring(0,py.indexOf("_by_"))),td()("#author-name-to-save").val(py.split("_by_").pop().replace(".json",""));for(var i=[],t=0;t<nd.ITEMS_ADDED.children.length;t++)if(nd.ITEMS_ADDED.children[t].instanceMatrix)for(var r=0;r<nd.ITEMS_ADDED.children[t].count;r++){var a=nd.ITEMS_ADDED.children[t],o=new gd;o.scale.set(0,0,0),o.position.set(1e5,1e5,1e5),o.updateMatrix(),a.setMatrixAt(r,o.matrix),a.instanceMatrix.needsUpdate=!0,a.computeBoundingSphere()}else i.push(nd.ITEMS_ADDED.children[t]);for(var s,t=0;t<nd.PLANE_USER_DATA.length;t++)nd.PLANE_USER_DATA[t].gelType&&(nd.PLANE_USER_DATA[t].hasItem=!1,nd.PLANE_USER_DATA[t].itemName=null,nd.PLANE_USER_DATA[t].gelType=null,s=nd.PLANE_USER_DATA[t].portal?16777215:8421504,nd.PLANE_USER_DATA[t].planeColor=s,nd.PLANE_LEVEL_INSTANCED.setColorAt(t,new vd(s)),-1<(s=nd.GELS.indexOf(nd.PLANE_USER_DATA[t])))&&nd.GELS.splice(s,1);for(var l,t=0;t<i.length;t++)nd.ITEMS_ADDED.remove(i[t]);for(l in nd.STATS_UI={time:0,portals:0,steps:0},nd.BOUNDING_BOX=[],nd.PLATFORM_BODIES=[],nd.FINISHED=!1,window.glass=[],nd.BOX_BODY=[],nd.ITEMS_COUNT=fg(),nd.TRIGGER_BOXES=[],nd.SELECTED_ID=[],nd.SELECTED_ID_ORANGE=[],nd.SELECTED_COLOR=[],nd.LASER_EMITTER=[],nd.LASER_EMITTER_OBJ=[],nd.LASER_EMITTER_LENGTH=0,nd.LASER_EMITTER_BOUNDING_BOX=[],nd.LASER_EMITTER_RAYCASTER=[],nd.LASER_CUBE=null,nd.TRACTOR_BEAM=[],nd.TRACTOR_BEAM_BOUNDING_BOX=[],nd.TRACTOR_BEAM_RAYCASTER=[],nd.TRACTOR_BEAM_LENGTH=0,nd.LIGHT_BRIDGE_RAYCASTER=[],nd.LIGHT_BRIDGE_CLONE=[],nd.LIGHT_BRIDGE_COLLIDER_CLONE=[],nd.LASER_FIELD_RAYCASTER=[],nd.FIZZLER_RAYCASTER=[],nd.GLASS_RAYCASTER=[],nd.CAMERA_OBJ_HORIZONTAL=[],nd.CAMERA_OBJ_VERTICAL=[],nd.GOO_PLANES=[],nd.GOO_BOXES=[],nd.FAITH_PLATE_TO_ROTATE=[],nd.FAITH_PLATE_CONTACT_BOX=[],nd.DOORS=[],nd.RADIO_MUSIC=[],nd.CAMERAS=[],nd.CANNON_BODIES=[],nd.CANNON_BODIES_CONTINUOUS=[],nd.CONNECTIONS=[],nd.GLASS_PANELS=[],nd.BLOCK_PORTAL=[],nd.LOADED_CONNECTIONS=[],nd.PORTAL_GUN_BOX=[],nd.WALL_BODIES=[],nd.ACTIVATED=[],nd.SOUNDS_FPS=[],nd.LASER_EMITTER_PORTAL_CLONES=[],nd.DYNAMIC_BODIES=[],nd.LASER_TRIGGERS=[],nd.CUSTOM_GRAVITY=[],nd.ANGLED_PANELS=[],nd.PAINTING_GUN_MODE=[],nd.DYMANIC_ITEMS)for(t=0;t<nd.DYMANIC_ITEMS[l].length;t++)nd.DYMANIC_ITEMS[l][t]=[];nd.PLANE_USER_DATA=e;for(var u,c=new gd,h=[],t=0;t<e.length;t++)e[t].exists?(c.rotation.copy(e[t].rotation),c.position.copy(e[t].position),c.scale.set(1,1,1),c.updateMatrix(),nd.PLANE_LEVEL_INSTANCED.setMatrixAt(t,c.matrix),nd.PLANE_LEVEL_INSTANCED.setVisibilityAt(t,!0),e[t].portal?nd.PLANE_LEVEL_INSTANCED.setColorAt(t,(new vd).setHex(16777215)):nd.PLANE_LEVEL_INSTANCED.setColorAt(t,(new vd).setHex(8421504)),u=8421504,e[t].portal&&(u=16777215),e[t].planeColor=u):nd.PLANE_LEVEL_INSTANCED.setVisibilityAt(t,!1),"exitDoor"==e[t].itemName?(nd.EXIT_DOOR.position.set(e[t].position.x,e[t].position.y,e[t].position.z),nd.EXIT_DOOR.rotation.copy(e[t].rotation),nd.EXIT_DOOR.userData=e[t].item,nd.EXIT_DOOR.userData.connections=0,nd.EXIT_DOOR.userData.played=!1,e[t].item=nd.EXIT_DOOR,ty(e[t].item.userData,!1),LE(e[t])):"enterDoor"==e[t].itemName?(nd.ENTER_DOOR.position.set(e[t].position.x,e[t].position.y,e[t].position.z),nd.ENTER_DOOR.rotation.copy(e[t].rotation),nd.ENTER_DOOR.userData=e[t].item,e[t].item=nd.ENTER_DOOR,LE(e[t])):"window"==e[t].itemName?(nd.OBSERVATION_ROOM_IMG.position.set(e[t].position.x,e[t].position.y,e[t].position.z),nd.OBSERVATION_ROOM_IMG.rotation.copy(e[t].rotation),nd.OBSERVATION_ROOM_IMG.userData=e[t].item,e[t].item=nd.OBSERVATION_ROOM_IMG):"gel"==e[t].itemName&&$v(e[t],e[t].gelType,e[t].planeColor,e[t].id_instanced),e[t].hasGoo=!1;nd.PLANE_LEVEL_INSTANCED.instanceMatrix.needsUpdate=!0,nd.PLANE_LEVEL_INSTANCED.computeBoundingSphere(),window.totalItemsToLoad=0,window.totalItemsLoaded=0,window.gooToLoad=[];for(t=0;t<e.length;t++)e[t].exists&&e[t].hasItem&&"gel"!=e[t].itemName&&("exitDoor"!=e[t].itemName.split("-")[0]&&"enterDoor"!=e[t].itemName.split("-")[0]&&"window"!=e[t].itemName.split("-")[0]&&"dispenser"!=e[t].itemName.split("-")[0]&&"goo"!=e[t].itemName.split("-")[0]?window.totalItemsToLoad++:"goo"==e[t].itemName.split("-")[0]&&window.gooToLoad.push(e[t]));for(var d,t=0;t<e.length;t++)e[t].exists&&e[t].hasItem&&"gel"!=e[t].itemName&&"exitDoor"!=e[t].itemName.split("-")[0]&&"enterDoor"!=e[t].itemName.split("-")[0]&&"window"!=e[t].itemName.split("-")[0]&&"dispenser"!=e[t].itemName.split("-")[0]&&"goo"!=e[t].itemName.split("-")[0]&&(d=e[t].state,IE(e[t],!0),e[t].state=d,e[t].trigger)&&h.push(e[t]);for(t=0;t<window.checkers.instances.length;t++)window.checkers.instances[t].visible=!1;for(t=nd.LINES.children.length-1;0<=t;t--)nd.LINES.remove(nd.LINES.children[t])}td()("#input-level").on("change",function(e){var t,n,e=e.target.files[0],e=(py=e.name,(window.URL||window.webkitURL).createObjectURL(e));e=e,t=function(e){e=JSON.parse(e);td()("#portal-gun-select").val(e[0][0]).change(),td()("#ambient-sound-select").val(e[0][1]).change(),fy(e[1])},(n=new XMLHttpRequest).overrideMimeType("application/json"),n.open("GET",e,!0),n.onreadystatechange=function(){4===n.readyState&&"200"==n.status&&t(n.responseText)},n.send(null)}),window.totalItemsToLoad=0,window.totalItemsLoaded=0;var my=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(e){"undefined"!=typeof document&&void 0!==document.hidden&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=e)}get delta(){return.001*this._delta}get fixedDelta(){return.001*this._fixedDelta}set fixedDelta(e){this._fixedDelta=1e3*e}get elapsed(){return.001*this._elapsed}update(e){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(void 0!==e?e:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(e){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},gy=new pA,vy=null,_y=class Ew{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Pass",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new BA,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:gy;this.name=e,this.renderer=null,this.scene=t,this.camera=n,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){var t;this.rtt===e&&(null!==(t=this.fullscreenMaterial)&&(t.needsUpdate=!0),this.rtt=!e)}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return null!==this.screen?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;var n,i;null!==t?t.material=e:((t=new xd((null===vy&&(n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),i=new Float32Array([0,0,2,0,0,2]),void 0!==(vy=new Ad).setAttribute?(vy.setAttribute("position",new yd(n,3)),vy.setAttribute("uv",new yd(i,2))):(vy.addAttribute("position",new yd(n,3)),vy.addAttribute("uv",new yd(i,2)))),vy),e)).frustumCulled=!1,null===this.scene&&(this.scene=new BA),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e){}render(e,t,n,i,r){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,n){}dispose(){for(var e of Object.keys(this)){var t=this[e];(t instanceof nA||t instanceof uA||t instanceof eA||t instanceof Ew)&&this[e].dispose()}}},yy=class extends _y{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,n,i,r){e=e.state.buffers.stencil;e.setLocked(!1),e.setTest(!1)}},Ey="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Ay=class extends Td{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Md(null),opacity:new Md(1)},blending:Y,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;\n#include <colorspace_fragment>\n#include <dithering_fragment>\n}",vertexShader:Ey})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},xy=class extends _y{constructor(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];super("CopyPass"),this.fullscreenMaterial=new Ay,this.needsSwap=!1,void 0===(this.renderTarget=e)&&(this.renderTarget=new nA(1,1,{minFilter:W,magFilter:W,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,n,i,r){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,n){void 0!==n&&((this.renderTarget.texture.type=n)!==We?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":null!==e&&e.outputColorSpace===je&&(this.renderTarget.texture.colorSpace=je))}},Ty=new vd,Sy=class extends _y{constructor(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=n,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,n){this.color=e,this.depth=t,this.stencil=n}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,n,i,r){var a=this.overrideClearColor,o=this.overrideClearAlpha,s=e.getClearAlpha(),l=null!==a,u=0<=o;l?(e.getClearColor(Ty),e.setClearColor(a,u?o:s)):u&&e.setClearAlpha(o),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(Ty,s):u&&e.setClearAlpha(s)}},wy=class extends _y{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new Sy(!1,!1,!0),this.inverse=!1}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,n,i,r){var a=e.getContext(),o=e.state.buffers,s=this.scene,l=this.camera,u=this.clearPass,c=this.inverted?0:1,h=1-c;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),o.stencil.setFunc(a.ALWAYS,c,4294967295),o.stencil.setClear(h),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?u.render(e,null):(u.render(e,t),u.render(e,n))),this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),e.render(s,l),e.setRenderTarget(n)),e.render(s,l),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(a.EQUAL,1,4294967295),o.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),o.stencil.setLocked(!0)}},by=class{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,{depthBuffer:t=!0,stencilBuffer:n=!1,multisampling:i=0,frameBufferType:r}=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.renderer=null,this.inputBuffer=this.createBuffer(t,n,r,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new xy,this.depthTexture=null,this.passes=[],this.timer=new my,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){var t=this.inputBuffer,n=this.multisampling;0<n&&0<e?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):n!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(null!==(this.renderer=e)){var t,n=e.getSize(new ld),i=e.getContext().getContextAttributes().alpha,r=this.inputBuffer.texture.type;r===We&&e.outputColorSpace===je&&(this.inputBuffer.texture.colorSpace=je,this.outputBuffer.texture.colorSpace=je,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(n.width,n.height);for(t of this.passes)t.initialize(e,i,r)}}replaceRenderer(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=this.renderer,i=n.domElement.parentNode;return this.setRenderer(e),t&&null!==i&&(i.removeChild(n.domElement),i.appendChild(e.domElement)),n}createDepthTexture(){var e=this.depthTexture=new TA;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=lt,e.type=tt):e.type=Je,e}deleteDepthTexture(){if(null!==this.depthTexture){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(var e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,n,i){var r=this.renderer,a=null===r?new ld:r.getDrawingBufferSize(new ld),t={minFilter:W,magFilter:W,stencilBuffer:t,depthBuffer:e,type:n},e=new nA(a.width,a.height,t);return 0<i&&(e.ignoreDepthForMultisampleCopy=!1,e.samples=i),n===We&&null!==r&&r.outputColorSpace===je&&(e.texture.colorSpace=je),e.texture.name="EffectComposer.Buffer",e.texture.generateMipmaps=!1,e}setMainScene(e){for(var t of this.passes)t.mainScene=e}setMainCamera(e){for(var t of this.passes)t.mainCamera=e}addPass(e,t){var n=this.passes,i=this.renderer,r=i.getDrawingBufferSize(new ld),a=i.getContext().getContextAttributes().alpha,o=this.inputBuffer.texture.type;if(e.setRenderer(i),e.setSize(r.width,r.height),e.initialize(i,a,o),this.autoRenderToScreen&&(0<n.length&&(n[n.length-1].renderToScreen=!1),e.renderToScreen)&&(this.autoRenderToScreen=!1),void 0!==t?n.splice(t,0,e):n.push(e),this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!0),e.needsDepthTexture||null!==this.depthTexture)if(null===this.depthTexture){var s=this.createDepthTexture();for(e of n)e.setDepthTexture(s)}else e.setDepthTexture(this.depthTexture)}removePass(e){var t=this.passes,n=t.indexOf(e);-1!==n&&0<t.splice(n,1).length&&(null!==this.depthTexture&&(t.reduce((e,t)=>e||t.needsDepthTexture,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())),this.autoRenderToScreen)&&n===t.length&&(e.renderToScreen=!1,0<t.length)&&(t[t.length-1].renderToScreen=!0)}removeAllPasses(){var e=this.passes;this.deleteDepthTexture(),0<e.length&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){var t,n,i,r=this.renderer,a=this.copyPass;let o=this.inputBuffer,s=this.outputBuffer,l=!1;void 0===e&&(this.timer.update(),e=this.timer.getDelta());for(i of this.passes)i.enabled&&(i.render(r,o,s,e,l),i.needsSwap&&(l&&(a.renderToScreen=i.renderToScreen,t=r.getContext(),(n=r.state.buffers.stencil).setFunc(t.NOTEQUAL,1,4294967295),a.render(r,o,s,e,l),n.setFunc(t.EQUAL,1,4294967295)),n=o,o=s,s=n),i instanceof wy?l=!0:i instanceof yy&&(l=!1))}setSize(e,t,n){var i,r=this.renderer,a=r.getSize(new ld),o=(void 0!==e&&void 0!==t||(e=a.width,t=a.height),a.width===e&&a.height===t||r.setSize(e,t,n),r.getDrawingBufferSize(new ld));this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(i of this.passes)i.setSize(o.width,o.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(var e of this.passes)e.dispose();this.passes=[],null!==this.inputBuffer&&this.inputBuffer.dispose(),null!==this.outputBuffer&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},My=0,Ry=1,Ny=2,od={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Iy=class{constructor(){this.shaderParts=new Map([[od.FRAGMENT_HEAD,null],[od.FRAGMENT_MAIN_UV,null],[od.FRAGMENT_MAIN_IMAGE,null],[od.VERTEX_HEAD,null],[od.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=My,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Ye}},Cy=!1,Ly=class{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let e;if(t.material.flatShading)switch(t.material.side){case He:e=this.materialsFlatShadedDoubleSide;break;case Ge:e=this.materialsFlatShadedBackSide;break;default:e=this.materialsFlatShaded}else switch(t.material.side){case He:e=this.materialsDoubleSide;break;case Ge:e=this.materialsBackSide;break;default:e=this.materials}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=e[2]:t.isInstancedMesh?t.material=e[1]:t.material=e[0],++this.meshCount}}}cloneMaterial(e){if(!(e instanceof Td))return e.clone();var t,n=e.uniforms,i=new Map;for(t in n){var r=n[t].value;r.isRenderTargetTexture&&(n[t].value=null,i.set(t,r))}var a,o=e.clone();for(a of i)n[a[0]].value=a[1],o.uniforms[a[0]].value=a[1];return o}setMaterial(t){if(this.disposeMaterials(),null!==(this.material=t)){var e,n=this.materials=[this.cloneMaterial(t),this.cloneMaterial(t),this.cloneMaterial(t)];for(e of n)e.uniforms=Object.assign({},t.uniforms),e.side=ke;n[2].skinning=!0,this.materialsBackSide=n.map(e=>{e=this.cloneMaterial(e);return e.uniforms=Object.assign({},t.uniforms),e.side=Ge,e}),this.materialsDoubleSide=n.map(e=>{e=this.cloneMaterial(e);return e.uniforms=Object.assign({},t.uniforms),e.side=He,e}),this.materialsFlatShaded=n.map(e=>{e=this.cloneMaterial(e);return e.uniforms=Object.assign({},t.uniforms),e.flatShading=!0,e}),this.materialsFlatShadedBackSide=n.map(e=>{e=this.cloneMaterial(e);return e.uniforms=Object.assign({},t.uniforms),e.flatShading=!0,e.side=Ge,e}),this.materialsFlatShadedDoubleSide=n.map(e=>{e=this.cloneMaterial(e);return e.uniforms=Object.assign({},t.uniforms),e.flatShading=!0,e.side=He,e})}}render(e,t,n){var i=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,Cy){var r,a=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,n);for(r of a)r[0].material=r[1];this.meshCount!==a.size&&a.clear()}else{a=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,n),t.overrideMaterial=a}e.shadowMap.enabled=i}disposeMaterials(){var e;if(null!==this.material)for(e of this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide))e.dispose()}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Cy}static set workaroundEnabled(e){Cy=e}},Dy=class extends J1{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;super(),this.resizable=e,this.baseSize=new ld(1,1),this.preferredSize=new ld(t,n),this.target=this.preferredSize,this.s=i,this.effectiveSize=new ld,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){var e=this.baseSize,t=this.preferredSize,n=this.effectiveSize,i=this.scale;-1!==t.width?n.width=t.width:-1!==t.height?n.width=Math.round(t.height*(e.width/Math.max(e.height,1))):n.width=Math.round(e.width*i),-1!==t.height?n.height=t.height:-1!==t.width?n.height=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):n.height=Math.round(e.height*i)}get width(){return this.effectiveSize.width}set width(e){this.preferredWidth=e}get height(){return this.effectiveSize.height}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferredSize.setScalar(-1),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.baseSize.width}set baseWidth(e){this.baseSize.width!==e&&(this.baseSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(e){this.baseWidth=e}get baseHeight(){return this.baseSize.height}set baseHeight(e){this.baseSize.height!==e&&(this.baseSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){this.baseSize.width===e&&this.baseSize.height===t||(this.baseSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(e){this.preferredSize.width!==e&&(this.preferredSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferredSize.height}set preferredHeight(e){this.preferredSize.height!==e&&(this.preferredSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){this.preferredSize.width===e&&this.preferredSize.height===t||(this.preferredSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(e){this.s=e.scale,this.baseSize.set(e.baseWidth,e.baseHeight),this.preferredSize.set(e.preferredWidth,e.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return-1}},Oy=class extends Set{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:10;super(),this.l=t,this.exclusive=!1,void 0!==e&&this.set(e)}get layer(){return this.l}set layer(e){var t,n=this.l;for(t of this)t.layers.disable(n),t.layers.enable(e);this.l=e}getLayer(){return this.layer}setLayer(e){this.layer=e}isExclusive(){return this.exclusive}setExclusive(e){this.exclusive=e}clear(){var e,t=this.layer;for(e of this)e.layers.disable(t);return super.clear()}set(e){this.clear();for(var t of e)this.add(t);return this}indexOf(e){return this.has(e)?0:-1}add(e){return this.exclusive?e.layers.set(this.layer):e.layers.enable(this.layer),super.add(e)}delete(e){return this.has(e)&&e.layers.disable(this.layer),super.delete(e)}toggle(e){let t;return t=this.has(e)?(this.delete(e),!1):(this.add(e),!0)}setVisible(e){for(var t of this)e?t.layers.enable(0):t.layers.disable(0);return this}},vg=1,Py=9,Qh=21,Uy=23,id=24,By=28,Fy=30,zy=new Map([[0,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}"],[vg,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}"],[2,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}"],[3,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}"],[4,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}"],[5,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}"],[6,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}"],[7,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}"],[8,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}"],[Py,null],[10,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}"],[11,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}"],[12,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}"],[13,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}"],[14,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}"],[15,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}"],[16,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}"],[17,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}"],[18,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}"],[19,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}"],[20,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}"],[Qh,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}"],[22,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}"],[Uy,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}"],[id,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}"],[25,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}"],[26,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}"],[27,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}"],[By,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}"],[29,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}"],[Fy,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}"],[31,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}"],[32,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}"]]),ky=class extends J1{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;super(),this._blendFunction=e,this.opacity=new Md(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this._blendFunction}set blendFunction(e){this._blendFunction=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return zy.get(this.blendFunction)}},Gy=2,Hy=3,Vy=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],Wy=class extends Td{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new cd;super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Md(null),texelSize:new Md(new cd),scale:new Md(1),kernel:new Md(0)},blending:Y,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <colorspace_fragment>\n}",vertexShader:"uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}"}),this.setTexelSize(e.x,e.y),this.kernelSize=Gy}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get kernelSequence(){return Vy[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t,.5*e,.5*t)}setSize(e,t){e=1/e,t=1/t;this.uniforms.texelSize.value.set(e,t,.5*e,.5*t)}},jy=class extends _y{constructor(){var{kernelSize:e=Gy,resolutionScale:t=.5,width:n=Dy.AUTO_SIZE,height:i=Dy.AUTO_SIZE,resolutionX:n=n,resolutionY:i=i}=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};super("KawaseBlurPass"),this.renderTargetA=new nA(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let r=this.resolution=new Dy(this,n,i,t);r.addEventListener("change",e=>this.setSize(r.baseWidth,r.baseHeight)),this._blurMaterial=new Wy,this._blurMaterial.kernelSize=e,this.copyMaterial=new Ay}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(e){this._blurMaterial=e}get dithering(){return this.copyMaterial.dithering}set dithering(e){this.copyMaterial.dithering=e}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(e){this.blurMaterial.kernelSize=e}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(n,e,t,i,r){var a=this.scene,o=this.camera,s=this.renderTargetA,l=this.renderTargetB,u=this.blurMaterial,c=u.kernelSequence;let h=e;this.fullscreenMaterial=u;for(let e=0,t=c.length;e<t;++e){var d=0==(1&e)?s:l;u.kernel=c[e],u.inputBuffer=h.texture,n.setRenderTarget(d),n.render(a,o),h=d}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=h.texture,n.setRenderTarget(this.renderToScreen?null:t),n.render(a,o)}setSize(e,t){var n=this.resolution,i=(n.setBaseSize(e,t),n.width),n=n.height;this.renderTargetA.setSize(i,n),this.renderTargetB.setSize(i,n),this.blurMaterial.setSize(e,t)}initialize(e,t,n){void 0!==n&&(this.renderTargetA.texture.type=n,(this.renderTargetB.texture.type=n)!==We?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):null!==e&&e.outputColorSpace===je&&(this.renderTargetA.texture.colorSpace=je,this.renderTargetB.texture.colorSpace=je))}static get AUTO_SIZE(){return Dy.AUTO_SIZE}},Yy=class extends Td{constructor(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;super({name:"LuminanceMaterial",defines:{THREE_REVISION:l.replace(/\D+/g,"")},uniforms:{inputBuffer:new Md(null),threshold:new Md(0),smoothing:new Md(1),range:new Md(null)},blending:Y,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef RANGE\nuniform vec2 range;\n#elif defined(THRESHOLD)\nuniform float threshold;uniform float smoothing;\n#endif\nvarying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);\n#ifdef RANGE\nfloat low=step(range.x,l);float high=step(l,range.y);l*=low*high;\n#elif defined(THRESHOLD)\nl=smoothstep(threshold,threshold+smoothing,l)*l;\n#endif\n#ifdef COLOR\ngl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);\n#else\ngl_FragColor=vec4(l);\n#endif\n}",vertexShader:Ey}),this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){0<this.smoothing||0<e?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){0<this.threshold||0<e?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return 0<this.threshold||0<this.smoothing}set useThreshold(e){}get colorOutput(){return void 0!==this.defines.COLOR}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return null!==this.luminanceRange}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){null!==e?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},qy=class extends _y{constructor(){var{renderTarget:e,luminanceRange:t,colorOutput:n,resolutionScale:i=1,width:r=Dy.AUTO_SIZE,height:a=Dy.AUTO_SIZE,resolutionX:r=r,resolutionY:a=a}=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};super("LuminancePass"),this.fullscreenMaterial=new Yy(n,t),this.needsSwap=!1,this.renderTarget=e,void 0===this.renderTarget&&(this.renderTarget=new nA(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");let o=this.resolution=new Dy(this,r,a,i);o.addEventListener("change",e=>this.setSize(o.baseWidth,o.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,n,i,r){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){var n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height)}initialize(e,t,n){void 0!==n&&n!==We&&(this.renderTarget.texture.type=n,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Xy=class extends Td{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new Md(null),texelSize:new Md(new ld)},blending:Y,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#define WEIGHT_INNER 0.125\n#define WEIGHT_OUTER 0.0555555\nvarying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;\n#include <colorspace_fragment>\n}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}"})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Zy=class extends Td{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new Md(null),supportBuffer:new Md(null),texelSize:new Md(new ld),radius:new Md(.85)},blending:Y,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;\n#else\nuniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;\n#endif\nuniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);\n#include <colorspace_fragment>\n}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}"})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}set supportBuffer(e){this.uniforms.supportBuffer.value=e}get radius(){return this.uniforms.radius.value}set radius(e){this.uniforms.radius.value=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Ky=class extends _y{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new nA(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new Xy,this.upsamplingMaterial=new Zy,this.resolution=new ld}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){var i=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let e=0;e<n;++e){var t=i.clone();t.texture.name="Downsampling.Mipmap"+e,this.downsamplingMipmaps.push(t)}this.upsamplingMipmaps.push(i);for(let e=1,t=n-1;e<t;++e){var r=i.clone();r.texture.name="Upsampling.Mipmap"+e,this.upsamplingMipmaps.push(r)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(e){this.upsamplingMaterial.radius=e}render(n,e,t,i,r){var{scene:a,camera:o}=this,{downsamplingMaterial:s,upsamplingMaterial:l}=this,{downsamplingMipmaps:u,upsamplingMipmaps:c}=this;let h=e;this.fullscreenMaterial=s;for(let e=0,t=u.length;e<t;++e){var d=u[e];s.setSize(h.width,h.height),s.inputBuffer=h.texture,n.setRenderTarget(d),n.render(a,o),h=d}this.fullscreenMaterial=l;for(let e=c.length-1;0<=e;--e){var p=c[e];l.setSize(h.width,h.height),l.inputBuffer=h.texture,l.supportBuffer=u[e].texture,n.setRenderTarget(p),n.render(a,o),h=p}}setSize(e,t){var n=this.resolution;n.set(e,t);let i=n.width,r=n.height;for(let e=0,t=this.downsamplingMipmaps.length;e<t;++e)i=Math.round(.5*i),r=Math.round(.5*r),this.downsamplingMipmaps[e].setSize(i,r),e<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[e].setSize(i,r)}initialize(e,t,n){if(void 0!==n){var i,r=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(i of r)i.texture.type=n;if(n!==We)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(null!==e&&e.outputColorSpace===je)for(var a of r)a.texture.colorSpace=je}}dispose(){super.dispose();for(var e of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))e.dispose()}},$h=class extends J1{constructor(e,t){var{attributes:n=My,blendFunction:i=Uy,defines:r=new Map,uniforms:a=new Map,extensions:o=null,vertexShader:s=null}=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};super(),this.name=e,this.renderer=null,this.attributes=n,this.fragmentShader=t,this.vertexShader=s,this.defines=r,this.uniforms=a,this.extensions=o,this.blendMode=new ky(i),this.blendMode.addEventListener("change",e=>this.setChanged()),this._inputColorSpace=Ye,this._outputColorSpace=Kt}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(e){this._inputColorSpace=e,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e,this.setChanged()}set mainScene(e){}set mainCamera(e){}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e){}update(e,t,n){}setSize(e,t){}initialize(e,t,n){}dispose(){for(var e of Object.keys(this)){var t=this[e];(t instanceof nA||t instanceof uA||t instanceof eA||t instanceof _y)&&this[e].dispose()}}},Jy=class extends $h{constructor(){var{blendFunction:e=By,luminanceThreshold:t=.9,luminanceSmoothing:n=.025,mipmapBlur:i=!1,intensity:r=1,radius:a=.85,levels:o=8,kernelSize:s=Hy,resolutionScale:l=.5,width:u=Dy.AUTO_SIZE,height:c=Dy.AUTO_SIZE,resolutionX:u=u,resolutionY:c=c}=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};super("BloomEffect","#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D map;\n#else\nuniform lowp sampler2D map;\n#endif\nuniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}",{blendFunction:e,uniforms:new Map([["map",new Md(null)],["intensity",new Md(r)]])}),this.renderTarget=new nA(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new jy({kernelSize:s}),this.luminancePass=new qy({colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothing=n,this.mipmapBlurPass=new Ky,this.mipmapBlurPass.enabled=i,this.mipmapBlurPass.radius=a,this.mipmapBlurPass.levels=o,this.uniforms.get("map").value=(i?this.mipmapBlurPass:this.renderTarget).texture;let h=this.resolution=new Dy(this,u,c,l);h.addEventListener("change",e=>this.setSize(h.baseWidth,h.baseHeight))}get texture(){return(this.mipmapBlurPass.enabled?this.mipmapBlurPass:this.renderTarget).texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,n){var i=this.renderTarget,r=this.luminancePass;r.enabled?(r.render(e,t),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,r.renderTarget):this.blurPass.render(e,r.renderTarget,i)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,t):this.blurPass.render(e,t,i)}setSize(e,t){var n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height),this.blurPass.resolution.copy(n),this.luminancePass.setSize(e,t),this.mipmapBlurPass.setSize(e,t)}initialize(e,t,n){this.blurPass.initialize(e,t,n),this.luminancePass.initialize(e,t,n),this.mipmapBlurPass.initialize(e,t,n),void 0!==n&&(this.renderTarget.texture.type=n,null!==e)&&e.outputColorSpace===je&&(this.renderTarget.texture.colorSpace=je)}},Qy=(class extends Td{},class extends Td{},class extends Td{},class extends _y{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"inputBuffer";super("ShaderPass"),this.fullscreenMaterial=e,this.input=t}setInput(e){this.input=e}render(e,t,n,i,r){var a=this.fullscreenMaterial.uniforms;null!==t&&void 0!==a&&void 0!==a[this.input]&&(a[this.input].value=t.texture),e.setRenderTarget(this.renderToScreen?null:n),e.render(this.scene,this.camera)}initialize(e,t,n){void 0!==n&&n!==We&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}}),$y=(class extends HA{},1),eE=2,tE=class extends Td{constructor(){super({name:"DepthMaskMaterial",defines:{DEPTH_EPSILON:"0.0001",DEPTH_PACKING_0:"0",DEPTH_PACKING_1:"0",DEPTH_TEST_STRATEGY:$y},uniforms:{inputBuffer:new Md(null),depthBuffer0:new Md(null),depthBuffer1:new Md(null),cameraNearFar:new Md(new ld(1,1))},blending:Y,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <packing>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer0;uniform highp sampler2D depthBuffer1;\n#else\nuniform mediump sampler2D depthBuffer0;uniform mediump sampler2D depthBuffer1;\n#endif\nuniform sampler2D inputBuffer;uniform vec2 cameraNearFar;float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);\n#endif\n}varying vec2 vUv;void main(){vec2 depth;\n#if DEPTH_PACKING_0 == 3201\ndepth.x=unpackRGBAToDepth(texture2D(depthBuffer0,vUv));\n#else\ndepth.x=texture2D(depthBuffer0,vUv).r;\n#ifdef LOG_DEPTH\nfloat d=pow(2.0,depth.x*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.x=a+b/d;\n#endif\n#endif\n#if DEPTH_PACKING_1 == 3201\ndepth.y=unpackRGBAToDepth(texture2D(depthBuffer1,vUv));\n#else\ndepth.y=texture2D(depthBuffer1,vUv).r;\n#ifdef LOG_DEPTH\nfloat d=pow(2.0,depth.y*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.y=a+b/d;\n#endif\n#endif\nbool isMaxDepth=(depth.x==1.0);\n#ifdef PERSPECTIVE_CAMERA\ndepth.x=viewZToOrthographicDepth(getViewZ(depth.x),cameraNearFar.x,cameraNearFar.y);depth.y=viewZToOrthographicDepth(getViewZ(depth.y),cameraNearFar.x,cameraNearFar.y);\n#endif\n#if DEPTH_TEST_STRATEGY == 0\nbool keep=depthTest(depth.x,depth.y);\n#elif DEPTH_TEST_STRATEGY == 1\nbool keep=isMaxDepth||depthTest(depth.x,depth.y);\n#else\nbool keep=!isMaxDepth&&depthTest(depth.x,depth.y);\n#endif\nif(keep){gl_FragColor=texture2D(inputBuffer,vUv);}else{discard;}}",vertexShader:Ey}),this.depthMode=Me}set depthBuffer0(e){this.uniforms.depthBuffer0.value=e}set depthPacking0(e){this.defines.DEPTH_PACKING_0=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer0(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Yt;this.depthBuffer0=e,this.depthPacking0=t}set depthBuffer1(e){this.uniforms.depthBuffer1.value=e}set depthPacking1(e){this.defines.DEPTH_PACKING_1=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer1(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Yt;this.depthBuffer1=e,this.depthPacking1=t}get maxDepthStrategy(){return Number(this.defines.DEPTH_TEST_STRATEGY)}set maxDepthStrategy(e){this.defines.DEPTH_TEST_STRATEGY=e.toFixed(0),this.needsUpdate=!0}get keepFar(){return this.maxDepthStrategy}set keepFar(e){this.maxDepthStrategy=e?$y:eE}getMaxDepthStrategy(){return this.maxDepthStrategy}setMaxDepthStrategy(e){this.maxDepthStrategy=e}get epsilon(){return Number(this.defines.DEPTH_EPSILON)}set epsilon(e){this.defines.DEPTH_EPSILON=e.toFixed(16),this.needsUpdate=!0}getEpsilon(){return this.epsilon}setEpsilon(e){this.epsilon=e}get depthMode(){return Number(this.defines.DEPTH_MODE)}set depthMode(e){let t;switch(e){case we:t="false";break;case be:t="true";break;case Ne:t="abs(d1 - d0) <= DEPTH_EPSILON";break;case Le:t="abs(d1 - d0) > DEPTH_EPSILON";break;case Me:t="d0 > d1";break;case Re:t="d0 >= d1";break;case Ie:t="d0 <= d1";break;default:Ce;t="d0 < d1"}this.defines.DEPTH_MODE=e.toFixed(0),this.defines["depthTest(d0, d1)"]=t,this.needsUpdate=!0}getDepthMode(){return this.depthMode}setDepthMode(e){this.depthMode=e}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNearFar.value.set(e.near,e.far),e instanceof fA?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},nE=(class extends Td{},class extends _y{constructor(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new Sy,this.overrideMaterialManager=null===n?null:new Ly(n),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){var e=this.overrideMaterialManager;return null!==e?e.material:null}set overrideMaterial(e){var t=this.overrideMaterialManager;null!==e?null!==t?t.setMaterial(e):this.overrideMaterialManager=new Ly(e):null!==t&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,n,i,r){var a=this.scene,o=this.camera,s=this.selection,l=o.layers.mask,u=a.background,c=e.shadowMap.autoUpdate,h=this.renderToScreen?null:t;null!==s&&o.layers.set(s.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),!this.ignoreBackground&&null===this.clearPass.overrideClearColor||(a.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(h),null!==this.overrideMaterialManager?this.overrideMaterialManager.render(e,a,o):e.render(a,o),o.layers.mask=l,a.background=u,e.shadowMap.autoUpdate=c}}),iE=(class extends rA{},{LINEAR:0,REINHARD:1,REINHARD2:2,REINHARD2_ADAPTIVE:3,UNCHARTED2:4,OPTIMIZED_CINEON:5,ACES_FILMIC:6,AGX:7,NEUTRAL:8}),rE=(class extends Td{},class extends Td{},class extends _y{constructor(e,t){var{renderTarget:n,resolutionScale:i=1,width:r=Dy.AUTO_SIZE,height:a=Dy.AUTO_SIZE,resolutionX:r=r,resolutionY:a=a}=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},e=(super("DepthPass"),this.needsSwap=!1,this.renderPass=new nE(e,t,new IA({depthPacking:qt})),this.renderPass),t=(e.skipShadowMapUpdate=!0,e.ignoreBackground=!0,e.clearPass);t.overrideClearColor=new vd(16777215),t.overrideClearAlpha=1,this.renderTarget=n,void 0===this.renderTarget&&(this.renderTarget=new nA(1,1,{minFilter:V,magFilter:V}),this.renderTarget.texture.name="DepthPass.Target");let o=this.resolution=new Dy(this,r,a,i);o.addEventListener("change",e=>this.setSize(o.baseWidth,o.baseHeight))}set mainScene(e){this.renderPass.mainScene=e}set mainCamera(e){this.renderPass.mainCamera=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,n,i,r){var a=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,a)}setSize(e,t){var n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height)}}),aE=(Math.PI,class extends Jy{constructor(e,t,n){super(n),this.setAttributes(this.getAttributes()|Ry),this.camera=t,this.depthPass=new rE(e,t),this.clearPass=new Sy(!0,!1,!1),this.clearPass.overrideClearColor=new vd(0),this.depthMaskPass=new Qy(new tE);n=this.depthMaskMaterial;n.copyCameraSettings(t),n.depthBuffer1=this.depthPass.texture,n.depthPacking1=qt,n.depthMode=Ne,this.renderTargetMasked=new nA(1,1,{depthBuffer:!1}),this.renderTargetMasked.texture.name="Bloom.Masked",this.selection=new Oy,this.selection.layer=11,this._inverted=!1,this._ignoreBackground=!1}set mainScene(e){this.depthPass.mainScene=e}set mainCamera(e){this.camera=e,this.depthPass.mainCamera=e,this.depthMaskMaterial.copyCameraSettings(e)}getSelection(){return this.selection}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get inverted(){return this._inverted}set inverted(e){this._inverted=e,this.depthMaskMaterial.depthMode=e?Le:Ne}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get ignoreBackground(){return this._ignoreBackground}set ignoreBackground(e){this._ignoreBackground=e,this.depthMaskMaterial.maxDepthStrategy=e?eE:$y}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}setDepthTexture(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Yt;this.depthMaskMaterial.depthBuffer0=e,this.depthMaskMaterial.depthPacking0=t}update(e,t,n){var i=this.camera,r=this.selection,a=this.inverted;let o=t;(this.ignoreBackground||!a||0<r.size)&&(a=i.layers.mask,i.layers.set(r.layer),this.depthPass.render(e),i.layers.mask=a,o=this.renderTargetMasked,this.clearPass.render(e,o),this.depthMaskPass.render(e,t,o)),super.update(e,o,n)}setSize(e,t){super.setSize(e,t),this.renderTargetMasked.setSize(e,t),this.depthPass.setSize(e,t)}initialize(e,t,n){super.initialize(e,t,n),this.clearPass.initialize(e,t,n),this.depthPass.initialize(e,t,n),this.depthMaskPass.initialize(e,t,n),null!==e&&e.capabilities.logarithmicDepthBuffer&&(this.depthMaskPass.fullscreenMaterial.defines.LOG_DEPTH="1"),void 0!==n&&(this.renderTargetMasked.texture.type=n,null!==e)&&e.outputColorSpace===je&&(this.renderTargetMasked.texture.colorSpace=je)}}),oE=(class extends Td{},class extends Td{},class extends Td{},class extends Td{},class extends Td{constructor(){super({name:"AdaptiveLuminanceMaterial",defines:{MIP_LEVEL_1X1:"0.0"},uniforms:{luminanceBuffer0:new Md(null),luminanceBuffer1:new Md(null),minLuminance:new Md(.01),deltaTime:new Md(0),tau:new Md(1)},extensions:{shaderTextureLOD:!0},blending:Y,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <packing>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\nuniform lowp sampler2D luminanceBuffer0;uniform lowp sampler2D luminanceBuffer1;uniform float minLuminance;uniform float deltaTime;uniform float tau;varying vec2 vUv;void main(){float l0=unpackRGBAToFloat(texture2D(luminanceBuffer0,vUv));\n#if __VERSION__ < 300\nfloat l1=texture2DLodEXT(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;\n#else\nfloat l1=textureLod(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;\n#endif\nl0=max(minLuminance,l0);l1=max(minLuminance,l1);float adaptedLum=l0+(l1-l0)*(1.0-exp(-deltaTime*tau));gl_FragColor=(adaptedLum==1.0)?vec4(1.0):packFloatToRGBA(adaptedLum);}",vertexShader:Ey})}set luminanceBuffer0(e){this.uniforms.luminanceBuffer0.value=e}setLuminanceBuffer0(e){this.uniforms.luminanceBuffer0.value=e}set luminanceBuffer1(e){this.uniforms.luminanceBuffer1.value=e}setLuminanceBuffer1(e){this.uniforms.luminanceBuffer1.value=e}set mipLevel1x1(e){this.defines.MIP_LEVEL_1X1=e.toFixed(1),this.needsUpdate=!0}setMipLevel1x1(e){this.mipLevel1x1=e}set deltaTime(e){this.uniforms.deltaTime.value=e}setDeltaTime(e){this.uniforms.deltaTime.value=e}get minLuminance(){return this.uniforms.minLuminance.value}set minLuminance(e){this.uniforms.minLuminance.value=e}getMinLuminance(){return this.uniforms.minLuminance.value}setMinLuminance(e){this.uniforms.minLuminance.value=e}get adaptationRate(){return this.uniforms.tau.value}set adaptationRate(e){this.uniforms.tau.value=e}getAdaptationRate(){return this.uniforms.tau.value}setAdaptationRate(e){this.uniforms.tau.value=e}}),sE=class extends _y{constructor(e){var{minLuminance:t=.01,adaptationRate:n=1}=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=(super("AdaptiveLuminancePass"),this.fullscreenMaterial=new oE,this.needsSwap=!1,this.renderTargetPrevious=new nA(1,1,{minFilter:V,magFilter:V,depthBuffer:!1}),this.renderTargetPrevious.texture.name="Luminance.Previous",this.fullscreenMaterial);i.luminanceBuffer0=this.renderTargetPrevious.texture,i.luminanceBuffer1=e,i.minLuminance=t,i.adaptationRate=n,this.renderTargetAdapted=this.renderTargetPrevious.clone(),this.renderTargetAdapted.texture.name="Luminance.Adapted",this.copyPass=new xy(this.renderTargetPrevious,!1)}get texture(){return this.renderTargetAdapted.texture}getTexture(){return this.renderTargetAdapted.texture}set mipLevel1x1(e){this.fullscreenMaterial.mipLevel1x1=e}get adaptationRate(){return this.fullscreenMaterial.adaptationRate}set adaptationRate(e){this.fullscreenMaterial.adaptationRate=e}render(e,t,n,i,r){this.fullscreenMaterial.deltaTime=i,e.setRenderTarget(this.renderToScreen?null:this.renderTargetAdapted),e.render(this.scene,this.camera),this.copyPass.render(e,this.renderTargetAdapted)}},lE=class extends $h{constructor(){var{blendFunction:e=Fy,adaptive:t=!1,mode:t=t?iE.REINHARD2_ADAPTIVE:iE.AGX,resolution:n=256,maxLuminance:i=4,whitePoint:r=i,middleGrey:a=.6,minLuminance:o=.01,averageLuminance:s=1,adaptationRate:l=1}=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};super("ToneMappingEffect","#include <tonemapping_pars_fragment>\nuniform float whitePoint;\n#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3\nuniform float middleGrey;\n#if TONE_MAPPING_MODE == 3\nuniform lowp sampler2D luminanceBuffer;\n#else\nuniform float averageLuminance;\n#endif\nvec3 Reinhard2ToneMapping(vec3 color){color*=toneMappingExposure;float l=luminance(color);\n#if TONE_MAPPING_MODE == 3\nfloat lumAvg=unpackRGBAToFloat(texture2D(luminanceBuffer,vec2(0.5)));\n#else\nfloat lumAvg=averageLuminance;\n#endif\nfloat lumScaled=(l*middleGrey)/max(lumAvg,1e-6);float lumCompressed=lumScaled*(1.0+lumScaled/(whitePoint*whitePoint));lumCompressed/=(1.0+lumScaled);return clamp(lumCompressed*color,0.0,1.0);}\n#elif TONE_MAPPING_MODE == 4\n#define A 0.15\n#define B 0.50\n#define C 0.10\n#define D 0.20\n#define E 0.02\n#define F 0.30\nvec3 Uncharted2Helper(const in vec3 x){return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}vec3 Uncharted2ToneMapping(vec3 color){color*=toneMappingExposure;return clamp(Uncharted2Helper(color)/Uncharted2Helper(vec3(whitePoint)),0.0,1.0);}\n#endif\nvoid mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){\n#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3\noutputColor=vec4(Reinhard2ToneMapping(inputColor.rgb),inputColor.a);\n#elif TONE_MAPPING_MODE == 4\noutputColor=vec4(Uncharted2ToneMapping(inputColor.rgb),inputColor.a);\n#else\noutputColor=vec4(toneMapping(inputColor.rgb),inputColor.a);\n#endif\n}",{blendFunction:e,uniforms:new Map([["luminanceBuffer",new Md(null)],["maxLuminance",new Md(i)],["whitePoint",new Md(r)],["middleGrey",new Md(a)],["averageLuminance",new Md(s)]])}),this.renderTargetLuminance=new nA(1,1,{minFilter:Ve,depthBuffer:!1}),this.renderTargetLuminance.texture.generateMipmaps=!0,this.renderTargetLuminance.texture.name="Luminance",this.luminancePass=new qy({renderTarget:this.renderTargetLuminance}),this.adaptiveLuminancePass=new sE(this.luminancePass.texture,{minLuminance:o,adaptationRate:l}),this.uniforms.get("luminanceBuffer").value=this.adaptiveLuminancePass.texture,this.resolution=n,this.mode=t}get mode(){return Number(this.defines.get("TONE_MAPPING_MODE"))}set mode(e){if(this.mode!==e){switch(this.defines.clear(),this.defines.set("TONE_MAPPING_MODE",e.toFixed(0)),e){case iE.LINEAR:this.defines.set("toneMapping(texel)","LinearToneMapping(texel)");break;case iE.REINHARD:this.defines.set("toneMapping(texel)","ReinhardToneMapping(texel)");break;case iE.OPTIMIZED_CINEON:this.defines.set("toneMapping(texel)","OptimizedCineonToneMapping(texel)");break;case iE.ACES_FILMIC:this.defines.set("toneMapping(texel)","ACESFilmicToneMapping(texel)");break;case iE.AGX:this.defines.set("toneMapping(texel)","AgXToneMapping(texel)");break;case iE.NEUTRAL:this.defines.set("toneMapping(texel)","NeutralToneMapping(texel)");break;default:this.defines.set("toneMapping(texel)","texel")}this.adaptiveLuminancePass.enabled=e===iE.REINHARD2_ADAPTIVE,this.setChanged()}}getMode(){return this.mode}setMode(e){this.mode=e}get whitePoint(){return this.uniforms.get("whitePoint").value}set whitePoint(e){this.uniforms.get("whitePoint").value=e}get middleGrey(){return this.uniforms.get("middleGrey").value}set middleGrey(e){this.uniforms.get("middleGrey").value=e}get averageLuminance(){return this.uniforms.get("averageLuminance").value}set averageLuminance(e){this.uniforms.get("averageLuminance").value=e}get adaptiveLuminanceMaterial(){return this.adaptiveLuminancePass.fullscreenMaterial}getAdaptiveLuminanceMaterial(){return this.adaptiveLuminanceMaterial}get resolution(){return this.luminancePass.resolution.width}set resolution(e){var e=Math.max(0,Math.ceil(Math.log2(e))),t=Math.pow(2,e);this.luminancePass.resolution.setPreferredSize(t,t),this.adaptiveLuminanceMaterial.mipLevel1x1=e}getResolution(){return this.resolution}setResolution(e){this.resolution=e}get adaptive(){return this.mode===iE.REINHARD2_ADAPTIVE}set adaptive(e){this.mode=e?iE.REINHARD2_ADAPTIVE:iE.REINHARD2}get adaptationRate(){return this.adaptiveLuminanceMaterial.adaptationRate}set adaptationRate(e){this.adaptiveLuminanceMaterial.adaptationRate=e}get distinction(){return console.warn(this.name,"distinction was removed."),1}set distinction(e){console.warn(this.name,"distinction was removed.")}update(e,t,n){this.adaptiveLuminancePass.enabled&&(this.luminancePass.render(e,t),this.adaptiveLuminancePass.render(e,null,null,n))}initialize(e,t,n){this.adaptiveLuminancePass.initialize(e,t,n)}},uE=(class extends null{},class extends null{},class extends null{},class extends Td{},class extends Td{},class extends Td{constructor(e,t,n,i){var r=4<arguments.length&&void 0!==arguments[4]&&arguments[4];super({name:"EffectMaterial",defines:{THREE_REVISION:l.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Md(null),depthBuffer:new Md(null),resolution:new Md(new ld),texelSize:new Md(new ld),cameraNear:new Md(.3),cameraFar:new Md(1e3),aspect:new Md(1),time:new Md(0)},blending:Y,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:r}),e&&this.setShaderParts(e),t&&this.setDefines(t),n&&this.setUniforms(n),this.copyCameraSettings(i)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Yt;this.depthBuffer=e,this.depthPacking=t}setShaderData(e){this.setShaderParts(e.shaderParts),this.setDefines(e.defines),this.setUniforms(e.uniforms),this.setExtensions(e.extensions)}setShaderParts(e){return this.fragmentShader="#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#if DEPTH_PACKING == 3201\nuniform lowp sampler2D depthBuffer;\n#elif defined(GL_FRAGMENT_PRECISION_HIGH)\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNear,cameraFar);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNear,cameraFar);\n#endif\n}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;\n#ifdef ENCODE_OUTPUT\n#include <colorspace_fragment>\n#endif\n#include <dithering_fragment>\n}".replace(od.FRAGMENT_HEAD,e.get(od.FRAGMENT_HEAD)||"").replace(od.FRAGMENT_MAIN_UV,e.get(od.FRAGMENT_MAIN_UV)||"").replace(od.FRAGMENT_MAIN_IMAGE,e.get(od.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}".replace(od.VERTEX_HEAD,e.get(od.VERTEX_HEAD)||"").replace(od.VERTEX_MAIN_SUPPORT,e.get(od.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(e){for(var t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(var t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(var t of e)this.extensions[t]=!0;return this}get encodeOutput(){return void 0!==this.defines.ENCODE_OUTPUT}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof fA?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){var n=this.uniforms;n.resolution.value.set(e,t),n.texelSize.value.set(1/e,1/t),n.aspect.value=e/t}static get Section(){return od}}),wv=(class extends Td{},Number(l.replace(/\D+/g,"")),255/256);function cE(e,t,n){for(var i of t){var r,a="$1"+e+i.charAt(0).toUpperCase()+i.slice(1),o=new RegExp("([^\\.])(\\b"+i+"\\b)","g");for(r of n.entries())null!==r[1]&&n.set(r[0],r[1].replace(o,a))}}new Float32Array([wv/256**3,wv/65536,wv/256,wv]),new Float32Array([wv,wv/256,wv/65536,1/256**3]);var hE=class extends _y{constructor(e){super("EffectPass"),this.fullscreenMaterial=new uE(null,null,null,e),this.listener=e=>this.handleEvent(e),this.effects=[];for(var t=arguments.length,n=new Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.setEffects(n),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(e){for(var t of this.effects)t.mainScene=e}set mainCamera(e){this.fullscreenMaterial.copyCameraSettings(e);for(var t of this.effects)t.mainCamera=e}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){var t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}setEffects(e){for(var t of this.effects)t.removeEventListener("change",this.listener);this.effects=e.sort((e,t)=>t.attributes-e.attributes);for(var n of this.effects)n.addEventListener("change",this.listener)}updateMaterial(){var e,t=new Iy;let n=0;for(e of this.effects)if(e.blendMode.blendFunction===Py)t.attributes|=e.getAttributes()&Ry;else{if(0!=(t.attributes&e.getAttributes()&Ny))throw new Error(`Convolution effects cannot be merged (${e.name})`);((a,o,s)=>{let l=o.getFragmentShader(),u=o.getVertexShader();var c=void 0!==l&&/mainImage/.test(l),h=void 0!==l&&/mainUv/.test(l);if(s.attributes|=o.getAttributes(),void 0===l)throw new Error(`Missing fragment shader (${o.name})`);if(h&&0!=(s.attributes&Ny))throw new Error(`Effects that transform UVs are incompatible with convolution effects (${o.name})`);if(!c&&!h)throw new Error(`Could not find mainImage or mainUv function (${o.name})`);{var d=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,p=s.shaderParts;let e=p.get(od.FRAGMENT_HEAD)||"",t=p.get(od.FRAGMENT_MAIN_UV)||"",n=p.get(od.FRAGMENT_MAIN_IMAGE)||"",i=p.get(od.VERTEX_HEAD)||"",r=p.get(od.VERTEX_MAIN_SUPPORT)||"";var f,m,g,v=new Set,_=new Set;if(h&&(t+=`	${a}MainUv(UV);
`,s.uvTransformation=!0),null!==u&&/mainSupport/.test(u)){var y,E,h=/mainSupport *\([\w\s]*?uv\s*?\)/.test(u);r=r+`	${a}MainSupport(`+(h?"vUv);\n":");\n");for(y of u.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(var A of y[1].split(/\s*,\s*/))s.varyings.add(A),v.add(A),_.add(A);for(E of u.matchAll(d))_.add(E[1])}for(f of l.matchAll(d))_.add(f[1]);for(m of o.defines.keys())_.add(m.replace(/\([\w\s,]*\)/g,""));for(g of o.uniforms.keys())_.add(g);_.delete("while"),_.delete("for"),_.delete("if"),o.uniforms.forEach((e,t)=>s.uniforms.set(a+t.charAt(0).toUpperCase()+t.slice(1),e)),o.defines.forEach((e,t)=>s.defines.set(a+t.charAt(0).toUpperCase()+t.slice(1),e));h=new Map([["fragment",l],["vertex",u]]),d=(cE(a,_,s.defines),cE(a,_,h),l=h.get("fragment"),u=h.get("vertex"),o.blendMode);if(s.blendModes.set(d.blendFunction,d),c&&(null!==o.inputColorSpace&&o.inputColorSpace!==s.colorSpace&&(n+=o.inputColorSpace===je?"color0 = sRGBTransferOETF(color0);\n\t":"color0 = sRGBToLinear(color0);\n\t"),o.outputColorSpace!==Kt?s.colorSpace=o.outputColorSpace:null!==o.inputColorSpace&&(s.colorSpace=o.inputColorSpace),n+=a+"MainImage(color0, UV, ",0!=(s.attributes&Ry)&&/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/.test(l)&&(n+="depth, ",s.readDepth=!0),n+="color1);\n\t",s.uniforms.set(h=a+"BlendOpacity",d.opacity),n+=`color0 = blend${d.blendFunction}(color0, color1, ${h});

	`,e+=`uniform float ${h};

`),e+=l+"\n",null!==u&&(i+=u+"\n"),p.set(od.FRAGMENT_HEAD,e),p.set(od.FRAGMENT_MAIN_UV,t),p.set(od.FRAGMENT_MAIN_IMAGE,n),p.set(od.VERTEX_HEAD,i),p.set(od.VERTEX_MAIN_SUPPORT,r),null!==o.extensions)for(var x of o.extensions)s.extensions.add(x)}})("e"+n++,e,t)}let i=t.shaderParts.get(od.FRAGMENT_HEAD),r=t.shaderParts.get(od.FRAGMENT_MAIN_IMAGE),a=t.shaderParts.get(od.FRAGMENT_MAIN_UV);var o,s,l,u=/\bblend\b/g;for(o of t.blendModes.values())i+=o.getShaderCode().replace(u,"blend"+o.blendFunction)+"\n";0!=(t.attributes&Ry)?(t.readDepth&&(r="float depth = readDepth(UV);\n\n\t"+r),this.needsDepthTexture=null===this.getDepthTexture()):this.needsDepthTexture=!1,t.colorSpace===je&&(r+="color0 = sRGBToLinear(color0);\n\t"),t.uvTransformation?(a="vec2 transformedUv = vUv;\n"+a,t.defines.set("UV","transformedUv")):t.defines.set("UV","vUv"),t.shaderParts.set(od.FRAGMENT_HEAD,i),t.shaderParts.set(od.FRAGMENT_MAIN_IMAGE,r),t.shaderParts.set(od.FRAGMENT_MAIN_UV,a);for([s,l]of t.shaderParts)null!==l&&t.shaderParts.set(s,l.trim().replace(/^#/,"\n#"));this.skipRendering=0===n,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(t)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Yt;this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=n;for(t of this.effects)t.setDepthTexture(e,n)}render(e,t,n,i,r){for(var a of this.effects)a.update(e,t,i);var o;this.skipRendering&&!this.renderToScreen||((o=this.fullscreenMaterial).inputBuffer=t.texture,o.time+=i*this.timeScale,e.setRenderTarget(this.renderToScreen?null:n),e.render(this.scene,this.camera))}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(var n of this.effects)n.setSize(e,t)}initialize(e,t,n){this.renderer=e;for(var i of this.effects)i.initialize(e,t,n);this.updateMaterial(),void 0!==n&&n!==We&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(var e of this.effects)e.removeEventListener("change",this.listener),e.dispose()}handleEvent(e){"change"===e.type&&this.recompile()}};function dE(e,t,n){return e+(t-e)*n}function pE(e,t,n,i){e=dE(e,t,.75),t=dE(n,i,.75);return dE(e,t,.875)}new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array(2),new Float32Array(2),new Float32Array([0,-.25,.25,-.125,.125,-.375,.375]),new Float32Array([0,0]),new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([.125,-.125]),new Float32Array([-.125,.125]),new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4]),new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3]),pE(0,0,0,0),new Float32Array([0,0,0,0]),pE(0,0,0,1),new Float32Array([0,0,0,1]),pE(0,0,1,0),new Float32Array([0,0,1,0]),pE(0,0,1,1),new Float32Array([0,0,1,1]),pE(0,1,0,0),new Float32Array([0,1,0,0]),pE(0,1,0,1),new Float32Array([0,1,0,1]),pE(0,1,1,0),new Float32Array([0,1,1,0]),pE(0,1,1,1),new Float32Array([0,1,1,1]),pE(1,0,0,0),new Float32Array([1,0,0,0]),pE(1,0,0,1),new Float32Array([1,0,0,1]),pE(1,0,1,0),new Float32Array([1,0,1,0]),pE(1,0,1,1),new Float32Array([1,0,1,1]),pE(1,1,0,0),new Float32Array([1,1,0,0]),pE(1,1,0,1),new Float32Array([1,1,0,1]),pE(1,1,1,0),new Float32Array([1,1,1,0]),pE(1,1,1,1),new Float32Array([1,1,1,1]),nd.SELECTED_FOR_BLOOM=new Oy;var fE=!1;let Qc=function(){var e=new Sd,t=(e.visible=!1,new lT(4210752)),t=(e.add(t),new iT(16777215,20));return t.name="spotLightMain",t.position.set(-1,0,-2),t.angle=Math.PI/3,t.penumbra=1,t.decay=1,t.distance=0,t.castShadow=!0,nd.MOBILE?(t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048):(t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024),t.shadow.camera.near=1,t.shadow.camera.far=500,t.shadow.focus=1,t.shadow.bias=0,nd.SPOTLIGHT=t,nd.MOBILE||"epic"!=localStorage.getItem("quality-select")&&"high"!=localStorage.getItem("quality-select")||e.add(t),e};var mE=0;function gE(e,t){if(0!=e.length){t.polygonOffset=!0,t.polygonOffsetFactor=2;var n=new EA(2,2),i=(n.computeBoundsTree(),new jA(n.clone(),t,e.length)),r=(i.castShadow=!0,i.receiveShadow=!0,i.name="Instanced-"+mE,i.frustumCulled=!0,nd.SCENE_FPS.add(i),mE++,new gd);r.position.copy(nd.OBSERVATION_ROOM_IMG.position),r.rotation.copy(nd.OBSERVATION_ROOM_IMG.rotation),nd.SCENE.add(r),r.translateX(-2);for(var a=0;a<e.length;a++){var o=new gd;("window"==e[a].itemName||e[a].position.x==Math.round(r.position.x)&&e[a].position.y==Math.round(r.position.y)&&e[a].position.z==Math.round(r.position.z))&&(o.scale.set(0,0,0),o.position.set(1e5,1e5,1e5),e[a].portal=!1),e[a].itemName&&e[a].itemName.includes("observation_room")&&(o.scale.set(0,0,0),o.position.set(1e5,1e5,1e5)),o.rotation.set(0,0,0),o.position.copy(e[a].position),o.rotation.copy(e[a].rotation),o.updateMatrix(),i.setMatrixAt(a,o.matrix)}nd.SCENE.remove(r),i.instanceMatrix.needsUpdate=!0,i.computeBoundingSphere()}}window.instances=[],td()("body").on("click","#view-fps",function(){window.allowTest?(td()("#chamberName").css("opacity",1),td()("#chamberName").text(td()("#chamber-name-to-save").val()+"_by_"+td()("#author-name-to-save").val()),td()("#loading-parent").css("opacity",1),td()("#loading-parent").css("pointer-events","all"),(nd.PLAYER_MODEL?_E:bE)()):alert("The corridor enter and exit bounding box must be green!")});var vE=0;function _E(L){$_(),vE=0,function e(){vE+=1,td()(".introduction-text").addClass("loading-disabled"),td()("#p"+vE).removeClass("loading-disabled"),vE<4&&setTimeout(()=>{e()},3e3)}(),rd.EDITOR.pause(),nd.SCENE_CHILDREN.add(nd.SCENE_FPS),nd.ITEM_CUBE.visible=!1;var e=nd.ENTER_DOOR.clone();e.translateZ(1),nd.PLAYER.spawnPosition=e.position.clone(),td()("#container").css("filter","blur(3px)"),td()(".img").addClass("image"),nd.FLASH.visible=!0,xg("audio-portal-ambient",nd.PORTAL_AUDIO[0],!1,!0,!1,3,"sound"),xg("audio-portal-ambient",nd.PORTAL_AUDIO[1],!1,!0,!1,3,"sound"),setTimeout(()=>{"epic"!=localStorage.getItem("quality-select")||fE||(fE=!0,nd.COMPOSER=new by(nd.RENDERER,{multisampling:Math.min(4,nd.RENDERER.capabilities.maxSamples),frameBufferType:Qe}),nd.COMPOSER.addPass(new nE(nd.SCENE,nd.MAIN_CAMERA)),(d=new nE(nd.GUN_GROUP,nd.PORTAL_GUN_CAMERA)).clearColor=new vd(1,1,1),d.clearAlpha=0,d.clearPass.enabled=!0,d.clearPass.color=!1,d.clearPass.camera=nd.PORTAL_GUN_CAMERA,nd.COMPOSER.addPass(d),d=new lE({mode:iE.ACES_FILMIC,resolution:64,whitePoint:4,middleGrey:.6,minLuminance:.01,averageLuminance:.01,adaptationRate:1}),new aE(nd.GUN,nd.PORTAL_GUN_CAMERA,{intensity:20,mipmapBlur:!0,luminanceThreshold:.3,luminanceSmoothing:.2,radius:.618,resolutionScale:1}).selection=nd.SELECTED_FOR_BLOOM,p=new Jy({luminanceThreshold:1.1}),nd.MOBILE?nd.COMPOSER.addPass(new hE(nd.MAIN_CAMERA,d)):nd.COMPOSER.addPass(new hE(nd.MAIN_CAMERA,d,p)));var e=[],t=[],n=[],i=[],r=[],a=[],o=[],s=[],l=[],u=[],c="enterDoor";nd.ITEMS_ADDED.getObjectByName("spawn")&&(c="..");for(var h=0;h<nd.PLANE_USER_DATA.length;h++)nd.PLANE_USER_DATA[h].exists&&(nd.PLANE_USER_DATA[h].item&&nd.PLANE_USER_DATA[h].item.userData&&(nd.PLANE_USER_DATA[h].item.userData.played=!1),nd.PLANE_USER_DATA[h].itemName!=c)&&"exitDoor"!=nd.PLANE_USER_DATA[h].itemName&&"gel"!=nd.PLANE_USER_DATA[h].itemName&&(nd.PLANE_USER_DATA[h].checked=!1,nd.PLANE_USER_DATA[h].position.checked=!1,"front"==nd.PLANE_USER_DATA[h].side?o.push(nd.PLANE_USER_DATA[h]):"back"==nd.PLANE_USER_DATA[h].side?s.push(nd.PLANE_USER_DATA[h]):"right"==nd.PLANE_USER_DATA[h].side?l.push(nd.PLANE_USER_DATA[h]):"left"==nd.PLANE_USER_DATA[h].side?u.push(nd.PLANE_USER_DATA[h]):"down"==nd.PLANE_USER_DATA[h].side?r.push(nd.PLANE_USER_DATA[h]):"up"==nd.PLANE_USER_DATA[h].side&&a.push(nd.PLANE_USER_DATA[h]),(nd.PLANE_USER_DATA[h].portal?"up"==nd.PLANE_USER_DATA[h].side||"down"==nd.PLANE_USER_DATA[h].side?n:e:"up"==nd.PLANE_USER_DATA[h].side||"down"==nd.PLANE_USER_DATA[h].side?i:t).push(nd.PLANE_USER_DATA[h]));V0(r,"down","z","x","y","x"),V0(a,"up","z","x","y","x"),V0(o,"front","y","x","z","x"),V0(s,"back","y","x","z","x"),V0(l,"right","y","z","x","z"),V0(u,"left","y","z","x","z");var d=[5,85,5,5],p=Jg(Qg(e),d),f=(gE(p[0],nd.MATERIAL_WALL_PORTAL),gE(p[1],nd.MATERIAL_WALL_PORTAL2),gE(p[2],nd.MATERIAL_WALL_PORTAL3),gE(p[3],nd.MATERIAL_WALL_PORTAL4),d=[50,50],gE((p=Jg(Qg(t),d))[0],nd.MATERIAL_WALL_NON_PORTAL),gE(p[1],nd.MATERIAL_WALL_NON_PORTAL2),gE(n,nd.MATERIAL_FLOOR_PORTAL),gE(i,nd.MATERIAL_FLOOR_NON_PORTAL),xg("audio-door",nd.EXIT_DOOR,!1,!1,!0,8,"sound"),xg("audio-door",nd.ENTER_DOOR,!1,!1,!0,8,"sound"),nd.UNIFORMS_LASER_FIELD.fade=1,nd.MATERIAL_TRACTOR_BEAM.depthWrite=!1,nd.MATERIAL_TRACTOR_BEAM_REVERSE.depthWrite=!1,nd.ENTER_DOOR.children[0].rotation.z+=Math.PI,nd.RENDERER.setPixelRatio(window.devicePixelRatio*nd.PIXEL_RATIO),localStorage.getItem("option-stats")&&td()("#option-stats").prop("checked","true"==localStorage.getItem("option-stats")),localStorage.getItem("fov-val-range")&&td()("#fov-val-range").val(localStorage.getItem("fov-val-range")).trigger("input"),localStorage.getItem("mouse-val-range")&&td()("#mouse-val-range").val(localStorage.getItem("mouse-val-range")).trigger("input"),localStorage.getItem("quality-select")&&td()("#quality-select").val(localStorage.getItem("quality-select")).change(),nd.ENTER_DOOR.cube.clone()),m=new dd,g=(nd.ENTER_DOOR.cube.getWorldPosition(m),new hd),v=(nd.ENTER_DOOR.cube.getWorldQuaternion(g),f.position.copy(m),f.quaternion.copy(g),new pd),m=(v.setFromObject(f),nd.ENTER_DOOR.box3=v,setTimeout(()=>{L&&xg("audio-repulsion",nd.PLAYER,!1,!1,!0,20,"soundRepulsion"),yE()},500),nd.CONTROLS.enabled=!1,nd.ROOM.visible=!1,nd.SCENE.environment=null,nd.LIGHT_GROUP.visible=!0,nd.OBSERVATION_ROOM.visible=!0,nd.SCENE.getObjectByName("window").visible=!1,nd.ENTER_DOOR.add(nd.CORRIDOR_ENTER),nd.OBSERVATION_ROOM.position.copy(nd.OBSERVATION_ROOM_IMG.position),nd.OBSERVATION_ROOM.rotation.copy(nd.OBSERVATION_ROOM_IMG.rotation),(nd.MOBILE||"epic"!=localStorage.getItem("quality-select")&&"high"!=localStorage.getItem("quality-select"))&&!window.playerState||(nd.SCENE_FPS.add(nd.GUN_CLONE),nd.SCENE_FPS.add(nd.GUN_CLONE2)),nd.GUN.children[0].children[0].add(nd.LIGHTNIN_STRIKE_1,nd.LIGHTNIN_STRIKE_2,nd.LIGHTNIN_STRIKE_3),nd.GUN.visible=!0,nd.GUN_SPHERE.material=nd.MATERIAL_GUN,nd.GUN_CYLINDER.material=nd.MATERIAL_GUN,new dd);nd.CORRIDOR_ENTER.getObjectByName("spawnElevator").getWorldPosition(m),nd.PLAYER.position.copy(m);for(var _=0;_<nd.GOO_PLANES.length;_++)nd.GOO_PLANES[_].item.visible=!1;W0(nd.CORRIDOR_ENTER,!1),ad(nd.DYMANIC_ITEMS.dispenser,"dispenser",0,1),ad(nd.DYMANIC_ITEMS.dispenser,"dispenser",0,2),ad(nd.DYMANIC_ITEMS.dispenser,"dispenser",0,3),ad(nd.DYMANIC_ITEMS.dispenser,"dispenser",0,4),ad(nd.DYMANIC_ITEMS.cube,"cube",5),ad(nd.DYMANIC_ITEMS.cube_2,"cube_2",5),ad(nd.DYMANIC_ITEMS.scale_cube,"scale_cube",5),ad(nd.DYMANIC_ITEMS.sphere,"sphere",5),ad(nd.DYMANIC_ITEMS.gel_gun_blue,"gel_gun_blue",0),ad(nd.DYMANIC_ITEMS.gel_gun_orange,"gel_gun_orange",0),ad(nd.DYMANIC_ITEMS.gel_gun_white,"gel_gun_white",0),ad(nd.DYMANIC_ITEMS.pedestal_button,"pedestal_button",0),ad(nd.DYMANIC_ITEMS.radio,"radio",5),ad(nd.DYMANIC_ITEMS.button_weight,"button_weight",0),ad(nd.DYMANIC_ITEMS.button_box,"button_box",0,1),ad(nd.DYMANIC_ITEMS.button_box,"button_box",0,2),ad(nd.DYMANIC_ITEMS.button_box,"button_box",0,3),ad(nd.DYMANIC_ITEMS.button_box,"button_box",0,4),ad(nd.DYMANIC_ITEMS.button_sphere,"button_sphere",0,1),ad(nd.DYMANIC_ITEMS.button_sphere,"button_sphere",0,2),ad(nd.DYMANIC_ITEMS.button_sphere,"button_sphere",0,3),ad(nd.DYMANIC_ITEMS.button_sphere,"button_sphere",0,4),ad(nd.DYMANIC_ITEMS.ramp,"ramp",0),ad(nd.DYMANIC_ITEMS.ramp_half,"ramp_half",0),ad(nd.DYMANIC_ITEMS.ramp_half2,"ramp_half2",0),ad(nd.DYMANIC_ITEMS.stairs,"stairs",0),ad(nd.DYMANIC_ITEMS.laser_cube,"laser_cube",5),ad(nd.DOORS,"door",0),ad(nd.DYMANIC_ITEMS.pellet_launcher,"pellet_launcher",0),ad(nd.DYMANIC_ITEMS.pellet_catcher,"pellet_catcher",0),ad(nd.DYMANIC_ITEMS.faith_plate,"faith_plate",0),ad(nd.DYMANIC_ITEMS.bed,"bed",0),ad(nd.DYMANIC_ITEMS.toilet,"toilet",0),ad(nd.DYMANIC_ITEMS.trash,"trash",5),ad(nd.DYMANIC_ITEMS.desk,"desk",0),ad(nd.DYMANIC_ITEMS.step,"step",0,1),ad(nd.DYMANIC_ITEMS.cabinet,"cabinet",0),ad(nd.DYMANIC_ITEMS.sign,"sign",0),ad(nd.DYMANIC_ITEMS.track_platforms,"track_platforms",0),ad(nd.DYMANIC_ITEMS.piston_platforms,"piston_platforms",0),G0(nd.ENTER_DOOR,"enter"),G0(nd.EXIT_DOOR,"exit"),ad(nd.DYMANIC_ITEMS.incinerator,"incinerator",0);for(var y,E,A,x,_=0;_<nd.DYMANIC_ITEMS.angled_panel.length;_++)0!=nd.DYMANIC_ITEMS.angled_panel[_].length&&(y=nd.DYMANIC_ITEMS.angled_panel[_].getObjectByName("panel"),nd.ANGLED_PANELS.push(y),E=nd.DYMANIC_ITEMS.angled_panel[_].getObjectByName("Cube"),A=new ed.Box(new ed.Vec3(1,1,.1)),(A=new ed.Body({shape:A,mass:0,material:window.materialB})).name="panel",A.panel=y,x=new dd,E.getWorldPosition(x),A.position.copy(x),x=new hd,E.getWorldQuaternion(x),A.quaternion.copy(x),A.collisionFilterGroup=nd.CGROUP_DYNAMIC,A.collisionFilterMask=nd.CGROUP_ALL,nd.CANNON_BODIES.push(A),nd.CANNON_WORLD.addBody(A),y.body=A);Tg(nd.DYMANIC_ITEMS.fizzler,"audio-fizzler"),Tg(nd.DYMANIC_ITEMS.laser_field,"audio-fizzler"),Tg(nd.DYMANIC_ITEMS.tractor_beam,"audio-tractor-beam");for(var T=0;T<nd.DYMANIC_ITEMS.tractor_beam.length;T++)0!=nd.DYMANIC_ITEMS.tractor_beam[T].length&&nd.TRACTOR_BEAM_LENGTH++;for(T=0;T<nd.DYMANIC_ITEMS.laser_emitter.length;T++)0!=nd.DYMANIC_ITEMS.laser_emitter[T].length&&nd.LASER_EMITTER_LENGTH++;nd.SCENE.traverse(e=>{e.frustumCulled=!0});g=nd.ITEMS_ADDED.getObjectByName("light");g&&(g.material.color=new vd(2,2,2));for(var S,w,b=0;b<nd.DYMANIC_ITEMS.light.length;b++)nd.DYMANIC_ITEMS.light[b].id&&(w=new EA(1,1),S=new Ox({side:He,emissive:new vd(1,1,1),emissiveIntensity:2}),(w=new xd(w,S)).position.copy(nd.DYMANIC_ITEMS.light[b].position),w.rotation.copy(nd.DYMANIC_ITEMS.light[b].rotation),w.rotateX(-Math.PI/2),w.scale.set(.2,2,2),w.translateZ(.025),nd.SCENE_FPS.add(w));for(var M,R,b=0;b<nd.ITEMS_ADDED.children.length;b++)nd.ITEMS_ADDED.children[b].name.includes("observation_room")&&(nd.ITEMS_ADDED.children[b].visible=!1,(M=nd.OBSERVATION_ROOM_HALF.clone()).visible=!0,nd.SCENE_FPS.add(M),M.position.copy(nd.ITEMS_ADDED.children[b].position),M.rotation.copy(nd.ITEMS_ADDED.children[b].rotation),M.getObjectByName("pointLight")&&(M.getObjectByName("pointLight").color=new vd(nd.ITEMS_ADDED.children[b].userData.lightColor)),R=nd.SPOTLIGHT.clone(),M.add(R),M.getObjectByName("pointLight")&&(R.color=M.getObjectByName("pointLight").color),R.intensity=5,R.distance=12,R.position.set(0,-1,-.5),R.target=M.getObjectByName("targetLight"));nd.FLASH.visible=!1;for(var N=0;N<nd.LIGHT_BRIDGE_RAYCASTER.length;N++)nd.BLOCK_PORTAL.push(nd.LIGHT_BRIDGE_RAYCASTER[N].item.continuous);for(N=0;N<nd.LASER_FIELD_RAYCASTER.length;N++)nd.BLOCK_PORTAL.push(nd.LASER_FIELD_RAYCASTER[N].item.continuous);for(N=0;N<nd.FIZZLER_RAYCASTER.length;N++)nd.BLOCK_PORTAL.push(nd.FIZZLER_RAYCASTER[N].item.continuous);for(N=0;N<nd.GLASS_RAYCASTER.length;N++)nd.GLASS_RAYCASTER[N].item.userData.grid||nd.BLOCK_PORTAL.push(nd.GLASS_RAYCASTER[N].item.continuous);for(N=0;N<nd.DOORS.length;N++)nd.BLOCK_PORTAL.push(nd.DOORS[N].children[1].children[0]),nd.BLOCK_PORTAL.push(nd.DOORS[N].children[1].children[1]);nd.RENDERER.renderLists.dispose(),nd.PORTAL_GUN_INITIATE_HOLDER=nd.PORTAL_GUN_INITIATE,"none"==nd.PORTAL_GUN_INITIATE?(nd.GUN.children[0].visible=!1,nd.GUN_CLONE.children[0].visible=!1,nd.GUN_CLONE2.children[0].visible=!1,document.getElementById("reticle-img").src="./assets/textures/crosshairNull.png",document.getElementById("reticle-img").style.filter="invert(1)"):(nd.GUN.children[0].visible=!0,nd.GUN_CLONE.children[0].visible=!0,nd.GUN_CLONE2.children[0].visible=!0,document.getElementById("reticle-img").style.filter="none","left"==nd.PORTAL_GUN_INITIATE?document.getElementById("reticle-img").src="./assets/ui/mobile/portalBlue.png":"right"==nd.PORTAL_GUN_INITIATE?document.getElementById("reticle-img").src="./assets/ui/mobile/portalOrange.png":document.getElementById("reticle-img").src="./assets/textures/crosshairNone.png");for(var I=[],C=0;C<nd.PORTAL_GUN_BOX.length;C++)nd.PORTAL_GUN_BOX[C].parent&&((v=new pd).setFromObject(nd.PORTAL_GUN_BOX[C]),v.item=nd.PORTAL_GUN_BOX[C],I.push(v));nd.PORTAL_GUN_BOX=I,nd.FPS_MODE=!0,nd.GROUP_LINE_TRAGECTORY.visible=!1,(nd.MOBILE||"epic"!=localStorage.getItem("quality-select")&&"high"!=localStorage.getItem("quality-select"))&&(nd.SCENE.environment=nd.ENV_MAP),window.checkers.material.envMap=nd.ENV_MAP,nd.ITEMS_ADDED.getObjectByName("spawn")&&(nd.CORRIDOR_ENTER.visible=!1,nd.ITEMS_ADDED.getObjectByName("spawn").visible=!1,nd.PLAYER.spawnPosition=nd.ITEMS_ADDED.getObjectByName("spawn").position.clone(),nd.ENTER_DOOR.visible=!1,nd.PLAYER.position.copy(nd.PLAYER.spawnPosition),setTimeout(()=>{e_(!0)},5e3))},500)}function yE(){for(var e=0;e<nd.CONNECTIONS.length;e++)nd.CONNECTIONS[e].line.visible||(window.checkers.instances[nd.CONNECTIONS[e].checker].visible=!1);for(var t=0;t<nd.BOUNDING_BOX.length;t++)nd.BOUNDING_BOX[t].platform.material.color=new vd(16777215),nd.BOUNDING_BOX[t].platform.material.emissive=new vd(0,1.5,0),nd.BOUNDING_BOX[t].platform.material.transparent=!1,nd.BOUNDING_BOX[t].platform.scale.x=.1,nd.BOUNDING_BOX[t].platform.scale.z=.1;nd.ENTER_DOOR.getObjectByName("trigger").visible=!1,nd.EXIT_DOOR.getObjectByName("trigger").visible=!1,Zv(),nd.DEBUGGER_GROUP.visible=!0,nd.MAIN_CAMERA.lookAt(nd.ENTER_DOOR.position),nd.PAUSED=!1,nd.CORRIDOR_ENTER.visible=!0,setTimeout(()=>{nd.PAUSED=!0},100),td()("#ui").css("display","none"),td()("#reticle").css("display","flex"),td()("#blocker").css("display","block"),td()("#blocker").css("pointer-events","all"),td()("#loading-parent").css("opacity",0),td()("#loading-parent").css("pointer-events","none"),nd.MOBILE&&td()("#mobile-controls").css("display","block"),window.loaded=!0}nd.SCENE_FPS=new Sd;var EE=0,AE=0,xE=!1;function TE(){var e=new pd;e.setFromObject(nd.CUBES),e.getCenter(nd.CONTROLS.target),nd.CONTROLS.target.set(nd.CONTROLS.target.x+8,nd.CONTROLS.target.y+2,nd.CONTROLS.target.z+6),nd.MAIN_CAMERA.position.set(-12.2,17.4,26.3),nd.CONTROLS.update(),wE("/items/open.glb","door",!1),wE("/items/hd_portal_gun3.glb","gun",!1),wE("/items/cube_dispenser.glb","dispenser",!0,!1,.2,.5,!1,!1,!0,!1,null,null,null,100),y.load("/medium/items/WINDOW_IMG.glb",e=>{e.scene.traverse(e=>{var t;e.userData.wall=!0,e.userData.ground=!1,e.userData.ceiling=!1,e.material&&(t=e.material.map,e.material=new _d,e.material.map=t,e.material.polygonOffset=!0,e.material.polygonOffsetFactor=-1)}),e.scene.rotation.y=-Math.PI/2,e.scene.position.set(16,8,8),e.scene.translateY(-1),e.scene.translateX(-1),e.scene.name="window",nd.SCENE_CHILDREN.add(e.scene),nd.OBSERVATION_ROOM_IMG=e.scene})}var SE=new fw;SE.setDecoderPath("draco/"),SE.preload();let y=(new HS).setPath("./assets/3ds/");async function wE(e,s,l,u,c,h,d,p,f,m,t,n,i,g){var r=new Zx,a=new HS(r).setPath("./assets/3ds/medium");a.setDRACOLoader(SE),r.onStart=function(e,t,n){td()("#loading-parent").css("opacity",1),td()("#loading-parent").css("pointer-events","all")},r.onLoad=function(){EE<3?3==++EE&&(V_(),nd.LOADED_LEVEL?sy():(td()("#loading-parent").css("opacity",0),td()("#loading-parent").css("pointer-events","none"))):xE?2==++AE&&_E(!(xE=!1)):(t&&(nd.ITEM_HOLDED_NAME=s,nd.DRAGGED_ITEM_ELEMENT=i,IE(t,n)),nd.LOADED_LEVEL||(td()("#loading-parent").css("opacity",0),td()("#loading-parent").css("pointer-events","none")))},r.onProgress=function(e,t,n){},a.load(e,async function(e){var t,n,i,r,a,o,e=e.scene;e.instanced=l,e.traverse(e=>{e.frustumCulled=!0}),l?((t=((e,t,n,i,r,a)=>{var o=e.children[0].geometry.clone();o.computeVertexNormals(),o.computeBoundsTree(),(o=new Cd(o,e.children[0].material.clone(),{createInstances:!0})).addInstances(a,(e,t)=>{e.visible=!1}),o.raycastOnlyFrustum=!0,o.computeBVH(),o.name=t,o.receiveShadow=!0,o.castShadow=!0,o.material.envMap=nd.ENV_MAP,o.material.envMapIntensity=r,o.material.roughness=i,o.frustumCulled=!0,o.instanceMatrix.needsUpdate=!0,n&&nd.INTERACTIVE.push(o),"laser_cube"==t&&((nd.LASER_CUBE=o).material.transparent=!0,o.material.opacity=.9,o.material.roughness=0);for(var s=0;s<a;s++)nd.DYMANIC_ITEMS[t].push([]);return nd.ITEMS_ADDED.add(o),o})(e,s,u,c,h,g)).userData.wall=d,t.userData.ground=p,t.userData.ceiling=f,t.userData.trigger=m,u&&(t.scene=e.children[0],t.clone=e,t.clone.children[0].material.envMap=nd.ENV_MAP,t.clone.children[0].material.envMapIntensity=.5,t.clone.children[0].material.roughness=.2)):"door"==s?((t=e).userData.connections=0,t.name="enterDoor",t.rotation.y=Math.PI,t.position.set(3,1,12),t.namePosition=t.position.x+"/"+t.position.y+"/"+t.position.z,nd.ENTER_DOOR=t,nd.SCENE_CHILDREN.add(t),i=new EA(2,2),n=new _d({color:16776960,side:2,visible:!1}),i=new xd(i,n),t.add(i),n=new dA(2,2,.1),i=new _d({color:65280}),(n=new xd(n,i)).visible=!1,t.add(n),(t.cube=n).translateZ(.3),t.traverse(e=>{e.userData.wall=!0,e.userData.ground=!1,e.userData.ceiling=!1,e.material&&(e.material.envMap=nd.ENV_MAP,e.material.envMapIntensity=.5,e.name.includes("dif"))&&(e.material=new _d,e.material.color=new vd(0))}),nd.EXIT_DOOR=y_(nd.ENTER_DOOR),nd.EXIT_DOOR.position.set(13,1,0),nd.EXIT_DOOR.userData.buttons=0,nd.EXIT_DOOR.userData.connections=0,nd.EXIT_DOOR.name="exitDoor",nd.EXIT_DOOR.rotation.y+=Math.PI,nd.SCENE_CHILDREN.add(nd.EXIT_DOOR),nd.EXIT_DOOR.namePosition=nd.EXIT_DOOR.position.x+"/"+nd.EXIT_DOOR.position.y+"/"+nd.EXIT_DOOR.position.z,(i=(new wd).load("./assets/exit.jpg")).colorSpace=je,n=new EA(1,1),t=new _d({map:i}),(i=new xd(n,t)).position.set(-.6,.8,.16),i.scale.set(.8,.4,.8),nd.EXIT_DOOR.add(i),n=new dA(5.99,5.99,11.5),t=new _d({color:65280,transparent:!0,opacity:.5}),(i=new xd(n,t)).geometry.computeBoundingBox(),i.updateMatrixWorld(!0),i.name="trigger",i.position.set(0,0,-5.76),nd.EXIT_DOOR.add(i),(n=i.clone()).material=new _d({color:65280,transparent:!0,opacity:.5}),nd.ENTER_DOOR.add(n),t=new EA(2,2),(i=new xd(t,nd.MATERIAL_FIZZLER)).name="fizzler",i.translateZ(-.5),nd.ENTER_DOOR.fizzler=i,nd.ENTER_DOOR.add(i),n=i.clone(),nd.EXIT_DOOR.fizzler=n,nd.EXIT_DOOR.add(n)):"gun"==s?(i=e,nd.GUN=new Sd,nd.GUN.visible=!1,n=new Sd,nd.GUN.add(n),nd.GUN_CLONE=new Sd,n.add(i),(n=i.clone()).rotation.x=fn.degToRad(10),n.position.set(-.05,.075,-.1),nd.GUN_CLONE.add(n),nd.GUN_CLONE2=nd.GUN_CLONE.clone(),i.traverse(e=>{e.castShadow=!0,e.layers.mask=2,e.renderOrder=100,e.material&&(e.receiveShadow=!0,e.material.envMap=nd.ENV_MAP,e.material.envMapIntensity=.5),"sphere"==e.name?(nd.GUN_SPHERE=e,nd.SELECTED_FOR_BLOOM.add(e)):"cylinder"==e.name?(nd.GUN_CYLINDER=e,nd.SELECTED_FOR_BLOOM.add(e)):"cube_4"==e.name?window.gun_holder=e:"cube_5"==e.name?nd.PORTAL_GUN_FLASH=e:"gel_left"!=e.name&&"gel_right"!=e.name||(e.visible=!1,e.material=new Ox,e.material.roughness=0,e.material.envMap=nd.ENV_MAP,e.material.envMapIntensity=1)}),localStorage.getItem("portal_gun_color")&&(n=Cu(localStorage.getItem("portal_gun_color")),i.getObjectByName("Object_6").material.color=new vd(n.r/255,n.g/255,n.b/255)),localStorage.getItem("portal_gun_roughness")&&(i.getObjectByName("Object_6").material.roughness=localStorage.getItem("portal_gun_roughness")),localStorage.getItem("portal_gun_metalness")&&(i.getObjectByName("Object_6").material.metalnessMap=null,i.getObjectByName("Object_6").material.metalness=localStorage.getItem("portal_gun_metalness")),nd.GUN.name="GUN",nd.GUN_GROUP.add(nd.GUN),i.scale.set(.07,.07,.05),i.position.set(.007,-.01,-.0095),i.rotation.y=-.1,nd.GUN_CLONE.scale.setScalar(.7),nd.GUN_CLONE2.scale.setScalar(.7)):"window"==s?((o=e).traverse(e=>{var t,n;e.name.includes("Cube")&&(e.castShadow=!0,e.material=new _d({color:new vd(0)})),"room_light"==e.name&&(t=new aT(16777215,50,3),n=new dd,e.getWorldPosition(n),t.position.copy(n),t.translateY(-.2),nd.MOBILE||"epic"!=localStorage.getItem("quality-select")&&"high"!=localStorage.getItem("quality-select")||o.add(t)),e.name.includes("image")&&(e.material.side=2,e.material.envMap=nd.ENV_MAP,e.material.envMapIntensity=.5,e.material.roughness=.3)}),o.rotation.y=-Math.PI/2,o.position.set(16,6,6),o.visible=!1,o.name="OBSERVATION_ROOM",nd.SCENE_CHILDREN.add(o),nd.SPOTLIGHT.target=o.getObjectByName("lightTarget"),nd.OBSERVATION_ROOM=o,nd.OBSERVATION_ROOM.add(nd.LIGHT_GROUP)):"corridor"==s?((a=(a=e).clone()).visible=!1,a.traverse(e=>{e.material&&(e.material.envMap=nd.ENV_MAP,"lambert5"==e.material.name&&(e.material=new _d),"back"==e.name&&(nd.WALL_CORRIDOR_BACK=e),"spawn"==e.name)&&(e.name="spawnElevator")}),nd.CORRIDOR_ENTER=a,nd.CORRIDOR_ENTER.name="corridorEnter",nd.ENTER_DOOR.add(nd.CORRIDOR_ENTER)):"faith_plate"==s?((a=e).name="faith_plate",a.userData.wall=!1,a.userData.ground=!0,a.userData.ceiling=!0,a.visible=!1,nd.ITEMS_ADDED.add(a),a.traverse(e=>{e.receiveShadow=!0,e.castShadow=!0,e.material&&(e.material.envMap=nd.ENV_MAP,e.material.envMapIntensity=1,e.material.roughness=.2)})):"camera"==s?(r=e,y.load("/medium/items/camera2.glb",async function(e){window.cameraClone=e.scene.children[0]}),r.name="camera",r.visible=!1,r.userData.wall=!0,r.userData.ground=!1,r.userData.ceiling=!1,nd.ITEMS_ADDED.add(r),r.traverse(e=>{e.receiveShadow=!0,e.castShadow=!0,e.material&&(e.material.envMap=nd.ENV_MAP,e.material.envMapIntensity=.5,e.material.roughness=.2,"Sphere"==e.name)&&(e.material=new _d,e.material.roughness=0,e.material.color=new vd(16187426))})):"portal_gun"==s?((r=e).traverse(e=>{e.material&&(e.material.envMap=nd.ENV_MAP)}),r.name="portal_gun",r.visible=!1,nd.ITEMS_ADDED.add(r)):"angled_panel"==s&&((e=e).name="angled_panel",e.userData.wall=!0,e.userData.ground=!0,e.userData.ceiling=!0,e.visible=!1,nd.ITEMS_ADDED.add(e),e.traverse(e=>{e.name.includes("panel")&&e.material&&(e.material.side=2,e.material.envMap=nd.ENV_MAP,e.material.envMapIntensity=.2,e.material.roughness=1),e.material&&(e.material.polygonOffset=!0,e.material.polygonOffsetFactor=2)}))})}function bE(){xE=!0;var e=y.loadAsync("/avatar/medium/chell.glb"),n=(wE("/items/window.glb","window",!1),wE("/items/corridor.glb","corridor",!1),nd.PLAYER_ANIMATIONS={ANIM_STANDING_IDLE:y.loadAsync("/avatar/StandingIdle.glb"),ANIM_JUMP:y.loadAsync("/avatar/Jump.glb"),ANIM_STATIONARY_RUNNING:y.loadAsync("/avatar/StationaryRunning.glb"),ANIM_BACKWARD_RUNNING:y.loadAsync("/avatar/RunningBackward.glb"),ANIM_RIGHT_STRAFE:y.loadAsync("/avatar/RightStrafe.glb"),ANIM_LEFT_STRAFE:y.loadAsync("/avatar/LeftStrafe.glb"),ANIM_FALLING_IDLE:y.loadAsync("/avatar/FallingIdle.glb"),ANIM_STANDING_IDLE_NO_GUN:y.loadAsync("/avatar/noGun/StandingIdle.glb"),ANIM_JUMP_NO_GUN:y.loadAsync("/avatar/noGun/Jump.glb"),ANIM_STATIONARY_RUNNING_NO_GUN:y.loadAsync("/avatar/noGun/StationaryRunning.glb"),ANIM_BACKWARD_RUNNING_NO_GUN:y.loadAsync("/avatar/noGun/RunningBackward.glb"),ANIM_RIGHT_STRAFE_NO_GUN:y.loadAsync("/avatar/noGun/RightStrafe.glb"),ANIM_LEFT_STRAFE_NO_GUN:y.loadAsync("/avatar/noGun/LeftStrafe.glb")},e.then(e=>{e=e.scene;e.scale.setScalar(.015),nd.MIXERS=new _T(e),e.traverse(e=>{e.castShadow=!0,e.material&&(e.material.envMap=nd.ENV_MAP,e.material.envMapIntensity=.5,e.material.transparent=!0,e.material.opacity=0,e.material.colorWrite=!1,e.material.depthWrite=!1,e.material.side=0),e.isBone&&("wrist_R"==e.name?window.hand=e:"elbow_L"==e.name?window.handLeft=e:"neck1"==e.name&&(window.neck=e))}),nd.PLAYER_MODEL=e,nd.PLAYER_MODEL_CLONE=y_(nd.PLAYER_MODEL),nd.MIXERS_CLONE=new _T(nd.PLAYER_MODEL_CLONE),nd.PLAYER_MODEL.position.y=1e5,nd.PLAYER_MODEL_CLONE.position.y=1e5,(nd.MOBILE||"epic"!=localStorage.getItem("quality-select")&&"high"!=localStorage.getItem("quality-select"))&&!window.playerState||(nd.SCENE_CHILDREN.add(nd.PLAYER_MODEL),nd.SCENE_CHILDREN.add(nd.PLAYER_MODEL_CLONE)),nd.PLAYER_MODEL.animationActions={},nd.PLAYER_MODEL_CLONE.animationActions={},nd.PLAYER_MODEL.modelReady=!0}).then(()=>{var e=[];for(let n in nd.PLAYER_ANIMATIONS){var t=nd.PLAYER_ANIMATIONS[n];t.then(e=>{var t=nd.MIXERS.clipAction(e.animations[0]),t=(nd.PLAYER_MODEL.animationActions[n]=t,nd.MIXERS_CLONE.clipAction(e.animations[0]));nd.PLAYER_MODEL_CLONE.animationActions[n]=t}),e.push(t)}Promise.all(e).then(()=>nd.PLAYER_MODEL.modelReady=!0)}),GA.prototype.update);GA.prototype.update=function(e,t){n.call(this,e,t),this.updateMatrixWorld(!0)}}y.setDRACOLoader(SE),nd.LIGHT_PORTAL_1=new aT(new vd(1,.25,0),0,2),nd.LIGHT_PORTAL_0=new aT(new vd(0,.3,1),0,2),nd.FLASH=new aT(16711680,10),"epic"==localStorage.getItem("quality-select")&&(nd.SCENE_CHILDREN.add(nd.LIGHT_PORTAL_0),nd.SCENE_CHILDREN.add(nd.LIGHT_PORTAL_1));var ME,RE=0;for(ME in nd.ITEMS_COUNT)td()("#"+ME).parent().children("span").text(nd.ITEMS_COUNT[ME].max);function NE(e,t){if(window.changingPosition)for(var n,i,r=0;r<nd.CONNECTIONS.length;r++)if(nd.CONNECTIONS[r].from==window.changingPositionPlane){nd.CONNECTIONS[r].from=e,nd.SCENE_CHILDREN.remove(nd.CONNECTIONS[r].line);var a=x_(nd.CONNECTIONS[r].from,nd.CONNECTIONS[r].to.position);nd.SCENE_CHILDREN.add(a),nd.CONNECTIONS[r].line=a}else if(nd.CONNECTIONS[r].to==window.changingPositionPlane){nd.CONNECTIONS[r].to=e,t&&(nd.CONNECTIONS[r].to.item.userData.connections+=1);for(var o=0;o<10;o++)if(!(i=e.item.checkersSlots[o]).visible){i.visible=!0,n=i.position,window.checkers.instances[nd.CONNECTIONS[r].checker].position.copy(n),window.checkers.instances[nd.CONNECTIONS[r].checker].updateMatrix(),window.checkers.computeBoundingSphere(),nd.CONNECTIONS[r].clone=i;break}nd.SCENE_CHILDREN.remove(nd.CONNECTIONS[r].line);a=x_(nd.CONNECTIONS[r].from,n);nd.SCENE_CHILDREN.add(a),nd.CONNECTIONS[r].line=a}}let $c=(pg=new wd).load("./assets/textures/trigger_border.png"),eh=pg.load("./assets/textures/trigger_connection.png"),th=pg.load("./assets/textures/trigger_save.png"),nh=pg.load("./assets/textures/trigger_voice.png"),ih=pg.load("./assets/textures/trigger_audio.png"),rh=pg.load("./assets/textures/falling.png");async function IE(e,t){if(t&&(nd.ITEM_HOLDED_NAME=e.itemName.split("-")[0],nd.DRAGGED_ITEM_ELEMENT=td()("#"+nd.ITEM_HOLDED_NAME)),nd.ITEMS_ADDED.getObjectByName(nd.ITEM_HOLDED_NAME)||"glass"==nd.ITEM_HOLDED_NAME||"trigger_area"==nd.ITEM_HOLDED_NAME||"trigger_save"==nd.ITEM_HOLDED_NAME||"trigger_voice"==nd.ITEM_HOLDED_NAME||"trigger_audio"==nd.ITEM_HOLDED_NAME||"spawn"==nd.ITEM_HOLDED_NAME||"goo"==nd.ITEM_HOLDED_NAME||"door"==nd.ITEM_HOLDED_NAME){if(nd.ITEM_CUBE.place||t)if("goo"==nd.ITEM_HOLDED_NAME||t&&"goo"==e.itemName)(o=t?e:nd.PLANE_USER_DATA[e[0].instanceId]).hasGoo?alert("Already has goo!"):(o.hasItem=!0,o.hasGoo=!0,o.itemName="goo",u=new dA(1.98,2,1.98),d=((u=new xd(u,new _d({color:new vd("rgb(150,75,0)"),side:2,transparent:!0,opacity:.5,map:$c}))).position.copy(o.position),u.translateY(1),nd.SCENE.add(u),o.item=u,new EA(2,2)),a=new _d({color:new vd("rgb(150,75,0)"),map:rh,side:2,depthTest:!1,transparent:!0}),d=new xd(d,a),u.add(d),Nc(o));else{var n,i,r;if(nd.CONNECTING){var a=nd.PLANE_USER_DATA[e[0].instanceId];nd.SELECTED_FOR_CONNECTION.trigger=a,nd.SELECTED_FOR_CONNECTION.normal=e[0].normal,l_(nd.SELECTED_FOR_CONNECTION.position,a.position,e[0])}else{if(t)r=(o=e).item;else if("cube"==nd.ITEM_HOLDED_NAME||"cube_2"==nd.ITEM_HOLDED_NAME||"sphere"==nd.ITEM_HOLDED_NAME||"laser_cube"==nd.ITEM_HOLDED_NAME||"scale_cube"==nd.ITEM_HOLDED_NAME){for(var o=nd.PLANE_USER_DATA[e[0].instanceId],s=0,l=2;s<100;s++,l+=2)if(0<(f=Zg(o.position.x+"/"+(o.position.y+l)+"/"+o.position.z)).length){o=f[0];break}}else(o=nd.PLANE_USER_DATA[e[0].instanceId]).hasItem=!1;if(!o.hasItem&&!o.continuousEnding||t){if("spawn"==nd.ITEM_HOLDED_NAME?(u=new _x(.75,2,8),d=new _d({color:16711680}),i=new xd(u,d)):nd.ITEM_HOLDED_NAME.includes("trigger")?(a=new dA(1.98,2,1.98),(u=new xd(a,new _d({color:new vd(td()("#"+nd.ITEM_HOLDED_NAME).data("color")),side:2,transparent:!0,opacity:.5,map:$c}))).userData.multipleTrigger=!1,u.userData.triggerVisibility=!0,u.userData.soundEffect=null,u.userData.soundEffectLoop=!1,u.userData.link=null,"trigger_area"==nd.ITEM_HOLDED_NAME?h=eh:"trigger_save"==nd.ITEM_HOLDED_NAME?h=th:"trigger_voice"==nd.ITEM_HOLDED_NAME?h=nh:"trigger_audio"==nd.ITEM_HOLDED_NAME&&(h=ih),d=new EA(1,1),a=new _d({color:new vd(td()("#"+nd.ITEM_HOLDED_NAME).data("color")),map:h,transparent:!0,side:2,opacity:.5,depthWrite:!1}),h=new xd(d,a),u.add(h),i=u):"paint_gun"==nd.ITEM_HOLDED_NAME?((i=nd.PAINT_GUN.clone()).name="paint_gun",i.visible=!0):"glass"==nd.ITEM_HOLDED_NAME?i=new gd:"camera"==nd.ITEM_HOLDED_NAME?((i=nd.ITEMS_ADDED.getObjectByName(nd.ITEM_HOLDED_NAME).clone()).visible=!0,i.traverse(e=>{"horizontal"==e.name?nd.CAMERA_OBJ_HORIZONTAL.push(e):"vertical"==e.name&&nd.CAMERA_OBJ_VERTICAL.push(e)})):"faith_plate"==nd.ITEM_HOLDED_NAME||"portal_gun"==nd.ITEM_HOLDED_NAME?(i=nd.ITEMS_ADDED.getObjectByName(nd.ITEM_HOLDED_NAME).clone()).visible=!0:"observation_room"==nd.ITEM_HOLDED_NAME?i=nd.ITEMS_ADDED.getObjectByName(nd.ITEM_HOLDED_NAME).clone():"door"==nd.ITEM_HOLDED_NAME?(i=new Sd,d=new gx(1,10),a=new _d({color:new vd(0,2,5),transparent:!0,opacity:.5}),(h=new xd(d,a)).rotation.x=-Math.PI/2,h.name="circle_rotation",i.add(h),h.translateZ(.01),(u=y_(nd.ENTER_DOOR)).remove(u.getObjectByName("trigger")),u.remove(u.getObjectByName("fizzler")),u.position.set(0,0,0),u.rotation.set(0,0,0),i.add(u),u.translateZ(-1),u.translateY(1),i.getObjectByName("portal_door_right_04").scale.set(1,1,1),i.getObjectByName("portal_door_left_06").scale.set(1,1,1)):"angled_panel"==nd.ITEM_HOLDED_NAME?(i=nd.ITEMS_ADDED.getObjectByName(nd.ITEM_HOLDED_NAME).clone()).visible=!0:(n=nd.ITEMS_ADDED.getObjectByName(nd.ITEM_HOLDED_NAME),i=new gd),!(nd.ITEMS_COUNT[nd.ITEM_HOLDED_NAME].count<nd.ITEMS_COUNT[nd.ITEM_HOLDED_NAME].max))return void alert("Max Number of this item on the scene reached!");if(nd.ITEMS_COUNT[nd.ITEM_HOLDED_NAME].count+=1,td()("#"+nd.ITEM_HOLDED_NAME).parent().children("span").text(nd.ITEMS_COUNT[nd.ITEM_HOLDED_NAME].max-nd.ITEMS_COUNT[nd.ITEM_HOLDED_NAME].count),"piston_platforms"!=nd.ITEM_HOLDED_NAME&&"track_platforms"!=nd.ITEM_HOLDED_NAME||((d=new Sd).scale.y=0,nd.ITEMS_ADDED.add(d),d.position.copy(o.position),a=new dA(2,2,2),h=new xd(a,new Ox({color:new vd(0,2,0),envMap:nd.ENV_MAP,emissiveIntensity:1,transparent:!0,opacity:.5})),"track_platforms"==nd.ITEM_HOLDED_NAME&&("front"==o.side?(d.rotation.z=-Math.PI/2,d.translateZ(1)):"back"==o.side?(d.rotation.z=-Math.PI/2,d.translateZ(-1)):"left"==o.side?(d.rotation.x=Math.PI/2,d.translateX(1)):"right"==o.side&&(d.rotation.x=Math.PI/2,d.translateX(-1)),d.position.y+=.5),d.add(h),h.position.y=1.01,h.side=o.side,h.name=nd.ITEM_HOLDED_NAME,i.platformBox=h,i.initialPosition=o.position,i.userData.isActive=!0,i.userData.loop=!0),"pellet_launcher"==nd.ITEM_HOLDED_NAME&&(i.userData.isActive=!0),zE(o,!0,nd.ITEM_HOLDED_NAME+"-"+RE,i,"open",nd.DRAGGED_ITEM_ELEMENT.data("rotate"),nd.DRAGGED_ITEM_ELEMENT.data("floor"),nd.DRAGGED_ITEM_ELEMENT.data("ceiling"),nd.DRAGGED_ITEM_ELEMENT.data("walls"),nd.DRAGGED_ITEM_ELEMENT.data("instanced"),nd.ITEM_HOLDED_NAME,nd.DRAGGED_ITEM_ELEMENT.data("allowconnection"),!1),i.position.copy(o.position),("camera"==nd.ITEM_HOLDED_NAME||"track_platforms"==nd.ITEM_HOLDED_NAME)&&"back"==o.side&&0==o.normal.y?i.rotation.set(o.normal.x,Math.PI,o.normal.z):i.rotation.set(o.normal.x,o.normal.y,o.normal.z),i.renderOrder=2,i.name=nd.ITEM_HOLDED_NAME+"-"+RE,"radio"!=nd.ITEM_HOLDED_NAME&&"trash"!=nd.ITEM_HOLDED_NAME||i.translateY(.5),"cube"==nd.ITEM_HOLDED_NAME||"cube_2"==nd.ITEM_HOLDED_NAME||"sphere"==nd.ITEM_HOLDED_NAME||"laser_cube"==nd.ITEM_HOLDED_NAME||"scale_cube"==nd.ITEM_HOLDED_NAME){o.dispenser=!0,i.translateY(1);for(l=0;l<nd.DYMANIC_ITEMS.dispenser.length;l++)if(0==nd.DYMANIC_ITEMS.dispenser[l].length){nd.DYMANIC_ITEMS.dispenser[l]=i,p=l;break}var u=nd.ITEMS_ADDED.getObjectByName("dispenser"),c=new gd;c.position.copy(o.position);for(s=0,l=2;s<100;s++,l+=2)if(0<(f=Zg(o.position.x+"/"+(o.position.y+l)+"/"+o.position.z)).length){f[0].hasItem=!0,f[0].itemName="dispenser",f[0].item=c,f[0].isInstanced=!0,f[0].dispenserPosition=c.position,f[0].dispenserID=p,f[0].instancedName="dispenser",c.translateY(l);break}i.dispenserPosition=c.position,i.dispenserID=p,c.item=i,c.userData.id=p,!t||r.hasDispenser?c.scale.set(1,1,1):c.scale.set(0,0,0),c.updateMatrix(),u.setMatrixAt(p,c.matrix),1==c.scale.x&&u.setVisibilityAt(p,!0),u.instanceMatrix.needsUpdate=!0,u.computeBoundingSphere()}if(nd.ITEM_HOLDED_NAME.includes("button")&&(a=new dA(1,.5,1),d=new _d({color:65280}),(h=new xd(a,d)).position.copy(i.position),h.rotation.copy(i.rotation),(m=new pd).setFromObject(h),"button_box"==o.instancedName?m.accept="cube-cube_2-laser_cube-scale_cube":"button_sphere"==o.instancedName?m.accept="sphere":"button_weight"==o.instancedName&&(m.accept="sphere-cube-player-laser_cube-cube_2-scale_cube"),o.box3=m,i.userData.connectedTo=[],i.userData.showLines=!0,nd.LOADED_CONNECTIONS.push({data:r,item:o})),"laser_emitter"==nd.ITEM_HOLDED_NAME?Uv(i,!1,nd.LASER_EMITTER_RAYCASTER):"laser_receiver"!=nd.ITEM_HOLDED_NAME&&"laser_relay"!=nd.ITEM_HOLDED_NAME&&"pellet_catcher"!=nd.ITEM_HOLDED_NAME||(i.userData.connectedTo=[],nd.LOADED_CONNECTIONS.push({data:r,item:o})),"incinerator"==nd.ITEM_HOLDED_NAME&&(u=new vx(.7,.7,1,12),a=new _d({color:16711680}),(d=new xd(u,a)).position.copy(o.position),d.position.y+=.5,nd.ITEMS_ADDED.add(d),i.trigger=d,(m=new pd).setFromObject(d),m.accept="cube-cube_2-laser_cube-scale_cube",o.box3=m,i.userData.connectedTo=[],nd.LOADED_CONNECTIONS.push({data:r,item:o}),d.position.y-=.4),i.initialPosition=i.position.clone(),i.initialRotation=i.rotation.clone(),"faith_plate"!=nd.ITEM_HOLDED_NAME||t||B0(i),"spawn"==nd.ITEM_HOLDED_NAME)nd.ITEMS_ADDED.add(i),i.translateY(1),i.rotation.x=-Math.PI,i.name="spawn";else if("angled_panel"==nd.ITEM_HOLDED_NAME)nd.DYMANIC_ITEMS.angled_panel.push(i),nd.ITEMS_ADDED.add(i);else if(nd.ITEM_HOLDED_NAME.includes("trigger"))nd.ITEMS_ADDED.add(i),i.translateY(1),(m=new pd).setFromObject(i),m.accept="player",o.box3=m,i.userData.connectedTo=[],nd.LOADED_CONNECTIONS.push({data:r,item:o}),nd.TRIGGER_BOXES.push(o);else if("paint_gun"==nd.ITEM_HOLDED_NAME)i.scale.set(1,1,1),i.position.y+=.65,nd.ITEMS_ADDED.add(i),nd.PORTAL_GUN_BOX.push(i);else if("glass"==nd.ITEM_HOLDED_NAME)nd.ITEMS_ADDED.add(i);else if("camera"==nd.ITEM_HOLDED_NAME){i.translateY(.3);var h=new dA(.6,.6,.6),u=new _d({color:65280}),a=new xd(h,u),d=(a.name="camera",a.visible=!1,new dd);i.children[1].getWorldPosition(d),d.y-=.25,a.position.copy(d),nd.SCENE.add(a),(m=new pd).setFromObject(a),i.box3=m,i.fixed=!0,(i.cube=a).item=i,nd.CAMERAS.push(i),nd.ITEMS_ADDED.add(i),i.initialPosition=i.position.clone()}else if("observation_room"==nd.ITEM_HOLDED_NAME)nd.ITEMS_ADDED.add(i);else if("faith_plate"==nd.ITEM_HOLDED_NAME)i.translateY(.025),i.traverse(e=>{"launch"==e.name&&(i.ToRotate=e)}),nd.DYMANIC_ITEMS.faith_plate.push(i),nd.ITEMS_ADDED.add(i);else if("door"==nd.ITEM_HOLDED_NAME)nd.ITEMS_ADDED.add(i),nd.DOORS.push(i);else if("portal_gun"==nd.ITEM_HOLDED_NAME)nd.ITEMS_ADDED.add(i),nd.PORTAL_GUN_BOX.push(i);else{for(var p,l=0;l<nd.DYMANIC_ITEMS[nd.ITEM_HOLDED_NAME].length;l++)if(0==nd.DYMANIC_ITEMS[nd.ITEM_HOLDED_NAME][l].length){i.laser=!1,nd.DYMANIC_ITEMS[nd.ITEM_HOLDED_NAME][l]=i,p=l;break}if("dispenser"==nd.ITEM_HOLDED_NAME)for(var f,s=0,l=2;s<100;s++,l+=2)if(0<(f=Zg(o.position.x+"/"+(o.position.y+l)+"/"+o.position.z)).length){i.translateY(l);break}"track_platforms"==nd.ITEM_HOLDED_NAME&&i.translateZ(-.5),i.userData.id=p,i.userData.idInstanced=p,i.scale.set(1,1,1),i.updateMatrix(),i.initialPosition=i.position.clone(),n.setVisibilityAt(p,!0),n.setMatrixAt(p,i.matrix),o.isInstanced=!0,"gel_gun_blue"==nd.ITEM_HOLDED_NAME?n.setColorAt(p,new vd(255)):"gel_gun_orange"==nd.ITEM_HOLDED_NAME?n.setColorAt(p,new vd(16753920)):"gel_gun_white"==nd.ITEM_HOLDED_NAME&&n.setColorAt(p,new vd(16777215)),n.computeBoundingSphere(),n.dispose(),n.instanceMatrix.needsUpdate=!0}if(RE++,t){var h=i,u=r,d=n,m=o;if(h.userData.buttons=0,h.userData.showLines=u.showLines,h.userData.connections=0,h.userData.opened=u.opened,h.userData.instancedName=u.instancedName,h.userData.planeInstancedId=u.planeInstancedId,h.userData.lightColor=u.lightColor,h.userData.pedestalInfinity=u.pedestalInfinity,h.userData.pedestalValue=u.pedestalValue,h.userData.friction=u.friction,h.userData.restitution=u.restitution,h.userData.multipleTrigger=u.multipleTrigger,h.userData.triggerVisibility=u.triggerVisibility,h.userData.soundEffectLoop=u.soundEffectLoop,h.userData.link=u.link,h.userData.rotationY=u.rotationY,h.userData.angle=u.angle,h.userData.isActive=u.isActive,h.userData.loop=u.loop,"pellet_launcher"==nd.ITEM_HOLDED_NAME&&console.log(u.isActive),h.userData.link&&ty(h.userData,!1),"track_platforms"==nd.ITEM_HOLDED_NAME||"piston_platforms"==nd.ITEM_HOLDED_NAME)h.platformBox.parent.scale.y=u.scaleY,h.userData.scaleY=u.scaleY,l0(u.scaleY,m);else if("portal_gun"==nd.ITEM_HOLDED_NAME)h.userData.state=u.state,h.rotation.y=h.userData.rotationY;else if("door"==nd.ITEM_HOLDED_NAME)h.rotation.y=h.userData.rotationY;else if("angled_panel"==nd.ITEM_HOLDED_NAME)"right"==m.side||"left"==m.side?h.rotation.x=h.userData.rotationY:h.rotation.y=h.userData.rotationY,h.getObjectByName("pivot2").rotation.x=Math.PI/180*h.userData.angle;else if("pedestal_button"==nd.ITEM_HOLDED_NAME||"light"==nd.ITEM_HOLDED_NAME||"bed"==nd.ITEM_HOLDED_NAME||"toilet"==nd.ITEM_HOLDED_NAME||"desk"==nd.ITEM_HOLDED_NAME||"cabinet"==nd.ITEM_HOLDED_NAME||"sign"==nd.ITEM_HOLDED_NAME||"portal_0"==nd.ITEM_HOLDED_NAME||"portal_1"==nd.ITEM_HOLDED_NAME||"incinerator"==nd.ITEM_HOLDED_NAME||"step"==nd.ITEM_HOLDED_NAME){h.userData.rotationY=u.rotationY;var m=nd.ITEMS_ADDED.getObjectByName(nd.ITEM_HOLDED_NAME),g=new gd;g.position.copy(h.position),g.rotation.copy(h.rotation),g.rotation.y=h.userData.rotationY,g.updateMatrix(),m.setMatrixAt(h.userData.id,g.matrix),m.instanceMatrix.needsUpdate=!0,m.computeBoundingSphere(),h.rotation.copy(g.rotation)}else if("cube"==nd.ITEM_HOLDED_NAME||"cube_2"==nd.ITEM_HOLDED_NAME||"sphere"==nd.ITEM_HOLDED_NAME||"laser_cube"==nd.ITEM_HOLDED_NAME||"scale_cube"==nd.ITEM_HOLDED_NAME)h.userData.hasDispenser=u.hasDispenser,h.userData.state=u.state;else if("laser_field"==nd.ITEM_HOLDED_NAME)h.userData.state=u.state,h.userData.triggers=u.triggers,t_("laser_field",nd.LASER_FIELD_RAYCASTER,h,d,!1),i_(h,h.userData.triggers,td()("#laser-field-trigger"),"laser_field");else if("fizzler"==nd.ITEM_HOLDED_NAME)h.userData.state=u.state,h.userData.triggers=u.triggers,t_("fizzler",nd.FIZZLER_RAYCASTER,h,d,!1),i_(h,h.userData.triggers,td()("#laser-field-trigger"),"fizzler");else if("light_bridge"==nd.ITEM_HOLDED_NAME)h.userData.state=u.state,h.userData.triggers=u.triggers,t_("light_bridge",nd.LIGHT_BRIDGE_RAYCASTER,h,null,!1),i_(h,h.userData.triggers,td()("#light-bridge-trigger"),"light_bridge");else if("glass"==nd.ITEM_HOLDED_NAME)h.userData.state=!0,h.userData.triggers=u.triggers,h.userData.grid=u.grid,t_("glass",nd.GLASS_RAYCASTER,h,null,!1),i_(h,h.userData.triggers,td()("#glass-trigger"),"glass");else if("tractor_beam"==nd.ITEM_HOLDED_NAME)h.userData.state=u.state,h.userData.reversed=u.reversed,h.userData.triggers=u.triggers,t_("tractor_beam",nd.TRACTOR_BEAM_RAYCASTER,h,null,!1);else if("laser_emitter"==nd.ITEM_HOLDED_NAME)h.userData.state=u.state,h.userData.triggers=u.triggers,kv(h,h.userData.triggers,td()("#laser_emitter-trigger"),"laser_emitter");else if("laser_receiver"==nd.ITEM_HOLDED_NAME)h.userData.state=!1,h.userData.triggers=u.triggers,kv(h,h.userData.triggers,td()("#laser_receiver-trigger"),"laser_receiver");else if("faith_plate"==nd.ITEM_HOLDED_NAME){h.userData.state=u.state,h.userData.target=u.target,nd.FAITH_PLATE_TARGET=h;let e=new gd;e.position.copy(u.targetPos),e.rotation.copy(u.targetRot),console.log(u.heightLine),F0(e),z0(e,u.heightLine)}else"gel_recharger"==nd.ITEM_HOLDED_NAME&&(h.userData.gel=u.gel,R0(h.userData.gel,h))}else a=o,r=n,(g=i).userData.buttons=0,g.userData.showLines=!0,g.userData.connections=0,g.userData.opened=!0,g.userData.instancedName=nd.ITEM_HOLDED_NAME,g.userData.planeInstancedId=a.id_instanced,g.userData.lightColor="#ffffff",g.userData.pedestalInfinity=!0,g.userData.pedestalValue=3,g.userData.friction=.4,g.userData.restitution=0,g.userData.rotationY=0,g.userData.angle=45,g.userData.link=null,"portal_gun"==nd.ITEM_HOLDED_NAME?g.userData.state="all":"cube"==nd.ITEM_HOLDED_NAME||"cube_2"==nd.ITEM_HOLDED_NAME||"sphere"==nd.ITEM_HOLDED_NAME||"laser_cube"==nd.ITEM_HOLDED_NAME||"scale_cube"==nd.ITEM_HOLDED_NAME?(g.userData.hasDispenser=!0,g.userData.state="open"):"laser_field"==nd.ITEM_HOLDED_NAME?(g.userData.state=!0,g.userData.triggers=nd.LASER_FIELD_TRIGGER,t_("laser_field",nd.LASER_FIELD_RAYCASTER,g,r,!1),i_(g,g.userData.triggers,td()("#laser-field-trigger"),"laser_field")):"fizzler"==nd.ITEM_HOLDED_NAME?(g.userData.state=!0,g.userData.triggers=nd.FIZZLER_TRIGGER,t_("fizzler",nd.FIZZLER_RAYCASTER,g,r,!1),i_(g,g.userData.triggers,td()("#laser-field-trigger"),"fizzler")):"light_bridge"==nd.ITEM_HOLDED_NAME?(g.userData.state=!0,g.userData.triggers=nd.LIGHT_BRIDGE_TRIGGER,t_("light_bridge",nd.LIGHT_BRIDGE_RAYCASTER,g,null,!1),i_(g,g.userData.triggers,td()("#light-bridge-trigger"),"light_bridge")):"glass"==nd.ITEM_HOLDED_NAME?(g.userData.state=!0,g.userData.triggers=nd.GLASS_TRIGGER,g.userData.grid=nd.GRID_STATE,t_("glass",nd.GLASS_RAYCASTER,g,null,!1),i_(g,g.userData.triggers,td()("#glass-trigger"),"glass")):"tractor_beam"==nd.ITEM_HOLDED_NAME?(g.userData.state=!0,g.userData.reversed=!1,g.userData.triggers="State",t_("tractor_beam",nd.TRACTOR_BEAM_RAYCASTER,g,null,!1)):"laser_emitter"==nd.ITEM_HOLDED_NAME?(g.userData.state=!0,g.userData.triggers=nd.LASER_EMITTER_TRIGGER,kv(g,g.userData.triggers,td()("#laser_emitter-trigger"),"laser_emitter")):"laser_receiver"==nd.ITEM_HOLDED_NAME&&(g.userData.state=!1,g.userData.triggers=nd.LASER_RECEIVER_TRIGGER,kv(g,g.userData.triggers,td()("#laser_receiver-trigger"),"laser_receiver"));if(window.totalItemsLoaded++,LE(o),NE(o,!0),window.totalItemsToLoad==window.totalItemsLoaded){for(var v=0;v<window.gooToLoad.length;v++)IE(window.gooToLoad[v],!0);for(v=0;v<nd.LOADED_CONNECTIONS.length;v++)for(var _=0;_<nd.LOADED_CONNECTIONS[v].data.connectedTo.length;_++)nd.SELECTED_FOR_CONNECTION=nd.PLANE_USER_DATA[nd.LOADED_CONNECTIONS[v].data.planeInstancedId],A_(nd.LOADED_CONNECTIONS[v].data.connectedTo[_],nd.LOADED_CONNECTIONS[v].item);nd.LOADED_LEVEL&&(td()("#chamberName").css("opacity",1),td()("#chamberName").text(td()("#chamber-name-to-save").val()+"_by_"+td()("#author-name-to-save").val()),td()("#loading-parent").css("opacity",1),td()("#loading-parent").css("pointer-events","all"),(nd.PLAYER_MODEL?_E:bE)())}}}nd.ITEM_HOLDED_NAME=null,td()("#follow").css("display","none"),window.changingPosition=!1,s0()}}else td()("#follow").css("display","none"),await wE("/items/"+nd.ITEM_HOLDED_NAME+".glb",nd.ITEM_HOLDED_NAME,nd.ITEMS_COUNT[nd.ITEM_HOLDED_NAME].instanced,nd.ITEMS_COUNT[nd.ITEM_HOLDED_NAME].interactive,nd.ITEMS_COUNT[nd.ITEM_HOLDED_NAME].roughness,nd.ITEMS_COUNT[nd.ITEM_HOLDED_NAME].envIntensity,nd.ITEMS_COUNT[nd.ITEM_HOLDED_NAME].wall,nd.ITEMS_COUNT[nd.ITEM_HOLDED_NAME].ground,nd.ITEMS_COUNT[nd.ITEM_HOLDED_NAME].ceiling,nd.ITEMS_COUNT[nd.ITEM_HOLDED_NAME].trigger,e,t,nd.DRAGGED_ITEM_ELEMENT,nd.ITEMS_COUNT[nd.ITEM_HOLDED_NAME].max)}function CE(e){nd.ITEM_HOLDED_NAME=e.data("name"),td()("#follow").attr("src",e.attr("src")),nd.DRAGGED_ITEM_ELEMENT=e}function LE(e){e.item.checkersSlots=[];var t=new gd,n=(t.visible=!1,e.item.dispenserPosition?t.position.copy(e.item.dispenserPosition):t.position.copy(e.position),t.rotation.copy(e.rotation),t.clone());n.translateX(.9),e.item.checkersSlots.push(n),(n=t.clone()).translateX(.9),n.translateY(.4),e.item.checkersSlots.push(n),(n=t.clone()).translateX(.9),n.translateY(.8),e.item.checkersSlots.push(n),(n=t.clone()).translateX(.9),n.translateY(-.4),e.item.checkersSlots.push(n),(n=t.clone()).translateX(.9),n.translateY(-.8),e.item.checkersSlots.push(n),(n=t.clone()).translateX(-.9),e.item.checkersSlots.push(n),(n=t.clone()).translateX(-.9),n.translateY(.4),e.item.checkersSlots.push(n),(n=t.clone()).translateX(-.9),n.translateY(.8),e.item.checkersSlots.push(n),(n=t.clone()).translateX(-.9),n.translateY(-.4),e.item.checkersSlots.push(n),(n=t.clone()).translateX(-.9),n.translateY(-.8),e.item.checkersSlots.push(n)}let ah,oh=!1;var DE,OE=0,PE=new dd;let sh=new XA({color:16711680,linewidth:2});function UE(e,t,n){DE[3*OE+0]=e,DE[3*OE+1]=t,DE[3*OE+2]=n,OE++,ah.geometry.setDrawRange(0,OE)}td()("body").on("pointerdown",".item",function(e){e.preventDefault(),CE(td()(this))}),document.addEventListener("keydown",e=>{"Escape"==e.code&&oh&&(oh=!1,nd.SCENE_CHILDREN.remove(ah),nd.CONNECTING=!1,nd.MATERIAL_PORTAL_EDITOR.opacity=1,nd.MATERIAL_NON_PORTAL_EDITOR.opacity=1,nd.MATERIAL_PORTAL_EDITOR.transparent=!1,nd.MATERIAL_NON_PORTAL_EDITOR.transparent=!1,OE=0)}),td()("body").on("click","#conection",function(e){nd.CONNECTING=!0,nd.MATERIAL_PORTAL_EDITOR.opacity=.25,nd.MATERIAL_NON_PORTAL_EDITOR.opacity=.25,nd.MATERIAL_PORTAL_EDITOR.transparent=!0,nd.MATERIAL_NON_PORTAL_EDITOR.transparent=!0,td()(".menu").removeClass("menu-show");var t=new Ad;DE=new Float32Array(1500),t.setAttribute("position",new yd(DE,3)),ah=new ZA(t,sh),nd.CURRENT_LINE=ah,nd.SCENE_CHILDREN.add(ah),oh=!0,nd.SELECTED_FOR_CONNECTION=nd.PLANE_USER_DATA[nd.SELECTED_ID[0]],UE(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].position.x,nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].position.y,nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].position.z),UE(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].position.x,nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].position.y,nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].position.z)}),document.body.addEventListener("mousemove",function(e){nd.CONNECTING&&(PE.x=e.clientX/window.innerWidth*2-1,PE.y=-e.clientY/window.innerHeight*2+1,PE.z=0,PE.unproject(nd.MAIN_CAMERA),0!==OE&&nd.CONNECTING&&(DE[3*OE-3]=PE.x,DE[3*OE-2]=PE.y,DE[3*OE-1]=PE.z,ah.geometry.attributes.position.needsUpdate=!0),lh.x=e.clientX/window.innerWidth*2-1,lh.y=-e.clientY/window.innerHeight*2+1,BE.setFromCamera(lh,nd.MAIN_CAMERA),FE(BE.intersectObject(nd.PLANE_LEVEL_INSTANCED),!0))});var BE=new yT;let lh=new ld(1,1);function FE(e,t){0!=e.length&&(e=nd.PLANE_USER_DATA[e[0].instanceId],nd.FAITH_PLATE_TARGET&&F0(nd.ITEM_CUBE),t?nd.FAITH_PLATE_TARGET||e.allowconnection&&!nd.SELECTED_FOR_CONNECTION.item.userData.connectedTo.includes(e.id_instanced)&&e.item.userData.connections<10?(nd.ITEM_CUBE.material.color=new vd(65280),nd.ITEM_CUBE.place=!0):(nd.ITEM_CUBE.material.color=new vd(16711680),nd.ITEM_CUBE.place=!1):e.hasItem||e.continuousEnding||"down"==e.side&&!nd.DRAGGED_ITEM_ELEMENT.data("floor")||"up"==e.side&&!nd.DRAGGED_ITEM_ELEMENT.data("ceiling")||("front"==e.side||"back"==e.side||"left"==e.side||"right"==e.side)&&!nd.DRAGGED_ITEM_ELEMENT.data("walls")?(nd.ITEM_CUBE.material.color=new vd(16711680),nd.ITEM_CUBE.place=!1):(nd.ITEM_CUBE.material.color=new vd(65280),nd.ITEM_CUBE.place=!0),nd.ITEM_CUBE.position.copy(e.position),nd.ITEM_CUBE.visible=!0)}function zE(e,t,n,i,r,a,o,s,l,u,c,h,d){e.item&&e.item.continuous&&e.item.continuous.otherSide&&(e.item.continuous.otherSide.continuousEnding=d),e.hasItem=t,e.itemName=n,e.item=i,e.state=r,e.canRotate=a,e.floor=o,e.ceiling=s,e.walls=l,e.isInstanced=u,e.instancedName=c,e.allowconnection=h}window.addEventListener("contextmenu",e=>e.preventDefault());var kE=!1,GE=new yT;td()("body").on("click","#side-bar-left, #ui-top",function(){document.querySelector(".menu").classList.remove("menu-show")}),td()("body").on("click","#rotate-item",function(){var e,t;nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].itemName.includes("door")||nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].itemName.includes("faith_plate")||nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].itemName.includes("portal_0")||nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].itemName.includes("portal_0")||nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].itemName.includes("angled_panel")||nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].itemName.includes("portal_gun")?(e=nd.ITEMS_ADDED.getObjectByName(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].itemName),!nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].itemName.includes("angled_panel")||"left"!=nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].side&&"right"!=nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].side?(e.rotation.y+=Math.PI/2,e.userData.rotationY=e.rotation.y):(e.rotation.x+=Math.PI/2,e.userData.rotationY=e.rotation.x)):(e=nd.ITEMS_ADDED.getObjectByName(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].instancedName),(t=new gd).position.copy(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.position),t.rotation.copy(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.rotation),t.rotation.y+=Math.PI/2,nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.rotationY=t.rotation.y,t.updateMatrix(),e.setMatrixAt(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.id,t.matrix),e.instanceMatrix.needsUpdate=!0,e.computeBoundingSphere(),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.rotation.copy(t.rotation))}),td()("body").on("click","#delete",function(){for(var e=[],t=0;t<nd.CONNECTIONS.length;t++)(nd.CONNECTIONS[t].from==nd.PLANE_USER_DATA[nd.SELECTED_ID[0]]||nd.CONNECTIONS[t].to==nd.PLANE_USER_DATA[nd.SELECTED_ID[0]])&&e.push(t);for(var n,i,t=e.length-1;0<=t;t--){var r,a=nd.CONNECTIONS[e[t]];a.from.item.userData.connectedTo.includes(a.to.id_instanced)&&(r=a.from.item.userData.connectedTo.indexOf(a.to.id_instanced),a.from.item.userData.connectedTo.splice(r)),nd.LINE.remove(nd.CONNECTIONS[e[t]].line),window.checkers.setVisibilityAt(a.checker,!1),window.checkersIndexes[a.checker]=!1,a.clone.visible=!1,nd.CONNECTIONS.splice(e[t],1)}if(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].isInstanced)"incinerator"==nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].instancedName&&nd.ITEMS_ADDED.remove(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.trigger),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.continuous&&(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.continuous.otherSide&&(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.continuous.otherSide.hasItem=!1),nd.ITEMS_ADDED.remove(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.continuous)),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.bodyBridge&&nd.CANNON_WORLD.removeBody(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.bodyBridge),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.bodyLaserField&&nd.CANNON_WORLD.removeBody(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.bodyLaserField),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.cloneLaserField&&(n=nd.ITEMS_ADDED.getObjectByName(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].instancedName),(i=new gd).scale.set(0,0,0),i.updateMatrix(),"laser_field"==nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].instancedName?n.setMatrixAt(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.cloneLaserID,i.matrix):"fizzler"==nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].instancedName&&n.setMatrixAt(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.cloneFizzlerID,i.matrix),n.instanceMatrix.needsUpdate=!0),"tractor_beam"==nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].instancedName&&-1<(i=nd.TRACTOR_BEAM.indexOf(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.continuous))&&(nd.TRACTOR_BEAM.splice(i,1),nd.TRACTOR_BEAM_BOUNDING_BOX.splice(i,1),nd.TRACTOR_BEAM_RAYCASTER.splice(i,1)),"laser_emitter"==nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].instancedName&&-1<(n=nd.LASER_EMITTER_RAYCASTER.indexOf(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.raycaster))&&nd.LASER_EMITTER_RAYCASTER.splice(n,1),"fizzler"==nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].instancedName&&-1<(i=nd.FIZZLER_RAYCASTER.indexOf(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.raycaster))&&nd.FIZZLER_RAYCASTER.splice(i,1),"laser_field"==nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].instancedName&&-1<(n=nd.LASER_FIELD_RAYCASTER.indexOf(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.raycaster))&&nd.LASER_FIELD_RAYCASTER.splice(n,1),"light_bridge"==nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].instancedName&&-1<(i=nd.LIGHT_BRIDGE_RAYCASTER.indexOf(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.raycaster))&&nd.LIGHT_BRIDGE_RAYCASTER.splice(i,1),n=nd.PLANE_USER_DATA[nd.SELECTED_ID[0]],i=window.moving,--nd.ITEMS_COUNT[n.instancedName].count,u=nd.ITEMS_ADDED.getObjectByName(n.instancedName),(l=new gd).scale.set(0,0,0),l.updateMatrix(),u.setMatrixAt(n.item.userData.idInstanced,l.matrix),u.instanceMatrix.needsUpdate=!0,"cube"==n.instancedName||"sphere"==n.instancedName||"cube_2"==n.instancedName||"laser_cube"==n.instancedName||"scale_cube"==n.instancedName?(u=nd.ITEMS_ADDED.getObjectByName("dispenser"),(l=new gd).scale.set(0,0,0),l.updateMatrix(),u.setMatrixAt(n.item.dispenserID,l.matrix),u.instanceMatrix.needsUpdate=!0,nd.DYMANIC_ITEMS.dispenser[n.item.dispenserID].dispenserPosition.y!=n.position.y&&zE(Zg(nd.DYMANIC_ITEMS.dispenser[n.item.dispenserID].dispenserPosition.x+"/"+nd.DYMANIC_ITEMS.dispenser[n.item.dispenserID].dispenserPosition.y+"/"+nd.DYMANIC_ITEMS.dispenser[n.item.dispenserID].dispenserPosition.z)[0],!1,null,null,null,null,null,null,null,!1,null,!1,!1),nd.DYMANIC_ITEMS.dispenser[n.item.dispenserID]=[]):"piston_platforms"!=n.instancedName&&"track_platforms"!=n.instancedName||(nd.ITEMS_ADDED.remove(n.item.platformBox.parent),-1<(l=nd.BOUNDING_BOX.indexOf(n.item.platformBox.bb))&&nd.BOUNDING_BOX.splice(l,1)),nd.DYMANIC_ITEMS[n.instancedName][n.item.userData.idInstanced]=[],i&&(window.changingPosition=!0,window.changingPositionPlane=n,CE(td()("#"+n.instancedName))),td()("#"+n.instancedName).parent().children("span").text(nd.ITEMS_COUNT[n.instancedName].max-nd.ITEMS_COUNT[n.instancedName].count),window.moving=!1;else if("goo"==nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].itemName){var o=nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item;nd.SCENE_CHILDREN.remove(o.water),nd.SCENE_CHILDREN.remove(o.lava),nd.SCENE.remove(o);for(t=0;t<o.ids.length;t++)nd.PLANE_USER_DATA[o.ids[t]].hasGoo=!1;for(var s,t=nd.GOO_BOXES.length-1;0<=t;t--)nd.GOO_BOXES[t].idPlane==nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].id_instanced&&-1<(s=nd.GOO_BOXES.indexOf(nd.GOO_BOXES[t]))&&nd.GOO_BOXES.splice(s,1)}else{var l,u=nd.TRIGGER_BOXES.indexOf(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]]);-1<u&&nd.TRIGGER_BOXES.splice(u,1),"faith_plate"==nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].instancedName&&(nd.SCENE.remove(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.target),nd.GROUP_LINE_TRAGECTORY.remove(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.target.line)),"glass"==nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].instancedName&&-1<(l=nd.GLASS_RAYCASTER.indexOf(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.raycaster))&&nd.GLASS_RAYCASTER.splice(l,1),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.continuous&&(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.continuous.otherSide.hasItem=!1,nd.ITEMS_ADDED.remove(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.continuous)),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.bodyBridge&&nd.CANNON_WORLD.removeBody(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.bodyBridge),--nd.ITEMS_COUNT[nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].instancedName].count,nd.ITEMS_ADDED.remove(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item),td()("#"+nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].instancedName).parent().children("span").text(nd.ITEMS_COUNT[nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].instancedName].max-nd.ITEMS_COUNT[nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].instancedName].count)}zE(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]],!1,null,null,null,null,null,null,null,!1,null,!1,!1),td()(".menu").removeClass("menu-show"),s0()}),td()("body").on("input","#state-dispenser",function(){this.checked?new dd(1,1,1):new dd(0,0,0);nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.hasDispenser=this.checked;var e=nd.ITEMS_ADDED.getObjectByName("dispenser"),t=new gd;t.position.copy(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.dispenserPosition),t.rotation.set(0,0,0),t.updateMatrix(),e.setMatrixAt(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.dispenserID,t.matrix),e.setVisibilityAt(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.dispenserID,this.checked),e.instanceMatrix.needsUpdate=!0}),td()("body").on("input","#dispenser-opened",function(){nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.opened=this.checked}),td()("body").on("input","#state-lines",function(){for(var e=0;e<nd.CONNECTIONS.length;e++)nd.CONNECTIONS[e].from.itemName==nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].itemName&&(nd.CONNECTIONS[e].line.visible=this.checked,nd.CONNECTIONS[e].from.item.userData.showLines=this.checked)}),td()("body").on("input","#state-pedetsal-infinity",function(){this.checked?td()("#pedestal-timer").addClass("disabled"):td()("#pedestal-timer").removeClass("disabled"),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.pedestalInfinity=this.checked}),td()("body").on("input","#pedestal-timer-value",function(){nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.pedestalValue=parseInt(this.value)}),td()("body").on("click",".tile-nonPortal",function(){for(var e=0;e<nd.SELECTED_ID.length;e++)nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].portal||(nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].tile=td()(this).data("id"));td()(".menu").removeClass("menu-show")}),td()("body").on("click",".tile-portal",function(){for(var e=0;e<nd.SELECTED_ID.length;e++)nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].portal&&(nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].tile=td()(this).data("id"));td()(".menu").removeClass("menu-show")}),td()("body").on("input","#tractor-state-input, #light-bridge-state-input, #laser-field-state-input, #fizzler-state-input",function(){nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.state=this.checked,nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.continuous.visible=this.checked,"light-bridge-state-input"==td()(this).attr("id")?this.checked?nd.CANNON_WORLD.addBody(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.bodyBridge):nd.CANNON_WORLD.removeBody(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.bodyBridge):"laser-field-state-input"!=td()(this).attr("id")&&"fizzler-state-input"!=td()(this).attr("id")||(this.checked?nd.CANNON_WORLD.addBody(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.bodyLaserField):nd.CANNON_WORLD.removeBody(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.bodyLaserField))}),td()("body").on("input","#tractor-direction-input",function(){nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.reversed=this.checked,this.checked?nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.continuous.material=nd.MATERIAL_TRACTOR_BEAM_REVERSE:nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.continuous.material=nd.MATERIAL_TRACTOR_BEAM}),td()("body").on("click",".tractor-triggers",function(){nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.triggers=td()(this).data("trigger"),td()("#tractor-trigger").data("trigger",td()(this).data("trigger")),td()("#tractor-trigger").find(".title").text("Triggers: "+td()(this).data("trigger"))}),td()("body").on("input","#ligh-color-input",function(){nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.lightColor=this.value}),td()("body").on("click",".light-bridge-triggers",function(){nd.LIGHT_BRIDGE_TRIGGER=td()(this).data("trigger"),i_(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item,td()(this).data("trigger"),td()("#light-bridge-trigger"),"light_bridge")}),td()("body").on("click",".laser-field-triggers",function(){nd.LASER_FIELD_TRIGGER=td()(this).data("trigger"),i_(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item,td()(this).data("trigger"),td()("#laser-field-trigger"),"laser_field")}),td()("body").on("click",".fizzler-triggers",function(){nd.FIZZLER_TRIGGER=td()(this).data("trigger"),i_(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item,td()(this).data("trigger"),td()("#fizzler-trigger"),"fizzler")}),td()("body").on("click",".glass-triggers",function(){nd.GLASS_TRIGGER=td()(this).data("trigger"),i_(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item,td()(this).data("trigger"),td()("#glass-trigger"),"glass")}),td()("body").on("input","#grid-state-input",function(){nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.grid=this.checked,this.checked?_g(nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.continuous,nd.MATERIAL_GRID,2*nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.continuous.distance/3):nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.continuous.material=nd.MATERIAL_GLASS}),document.getElementById("container").addEventListener("pointerdown",function(e){nd.FPS_MODE||HE(e,"down")},!1),document.getElementById("container").addEventListener("pointermove",function(e){nd.FPS_MODE||(uh.x=e.clientX/window.innerWidth*2-1,uh.y=-e.clientY/window.innerHeight*2+1,HE(e,"move"))},!1),document.getElementById("container").addEventListener("pointerup",function(e){nd.FPS_MODE||(window.faithPlateMoved&&(window.faithPlateMoved.portal=!1,window.faithPlateMoved.planeColor=8421504,nd.PLANE_LEVEL_INSTANCED.setColorAt(window.faithPlateMoved.id_instanced,new vd(8421504)),B0(window.faithPlateMoved.item)),nd.RESIZING_GLASS_PANEL=!1,nd.SELECTED_SIDE=null,nd.SELECTING=!1,nd.CONTROLS.enabled=!0,nd.CONTROLS.update(),!nd.ITEM_HOLDED_NAME&&!nd.CONNECTING||window.faithPlateMoved||HE(e,"up"),nd.ITEM_HOLDED_NAME=null,nd.DRAGGED_ITEM_ELEMENT=null,td()("#follow").css("display","none"),nd.DRAGGING&&(nd.SELECTED_ID=[],nd.DRAGGING=!1),nd.SELECTED&&nd.SELECTED.userData.hasItem||(nd.ITEM_CUBE.visible=!1),window.faithPlateMoved=null)},!1),td()(document).on("keypress",function(e){nd.FPS_MODE||(45!==e.keyCode||kE?43!==e.keyCode&&61!==e.keyCode||kE||B_("plus"):B_("minus"),kE)||(kE=!0,setTimeout(()=>{kE=!1},100))});let uh=new ld(1,1);function HE(e,t){var n,i,r;!nd.FPS_MODE&&nd.PLANE_LEVEL_INSTANCED&&(GE.setFromCamera(uh,nd.MAIN_CAMERA),0<(n=GE.intersectObject(nd.PLANE_LEVEL_INSTANCED)).length?(i=new vd,r=n[0].instanceId,nd.PLANE_LEVEL_INSTANCED.getColorAt(r,i),"move"==t&&nd.SELECTING?L_(n[0],e,t):"down"==t&&(nd.SELECTING=!0,nd.CONTROLS.enabled=!1,nd.PLANE_USER_DATA[r].selected=!0,nd.SELECTED_SIDE=nd.PLANE_USER_DATA[r].side,L_(n[0],e,t)),"up"==t&&0<n.length&&IE(n,!1),nd.ITEM_HOLDED_NAME&&(td()("#follow").css("display","block"),td()("#follow").css({left:e.pageX-25,top:e.pageY-25}),FE(n,!1))):"down"==t&&document.querySelector(".menu").classList.remove("menu-show"))}td()("#main-container").on("click","#plus-portal",function(){B_("plus"),document.querySelector(".menu").classList.remove("menu-show")}),td()("body").on("click","#minus-portal",function(){B_("minus"),document.querySelector(".menu").classList.remove("menu-show")}),td()("body").on("click","#portalable",function(){if(0<nd.SELECTED_ID.length){nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].portal=!nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].portal;for(var e=0;e<nd.SELECTED_ID.length;e++)nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].portal=nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].portal,nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].portal?(nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].planeColor=16777215,nd.PLANE_LEVEL_INSTANCED.setColorAt(nd.SELECTED_ID[e],new vd(16777215))):(nd.PLANE_USER_DATA[nd.SELECTED_ID[e]].planeColor=8421504,nd.PLANE_LEVEL_INSTANCED.setColorAt(nd.SELECTED_ID[e],new vd(8421504)))}document.querySelector(".menu").classList.remove("menu-show")}),td()("body").on("click","#save-level",function(){for(var e=[],t=[],n=[],i=0;i<nd.PLANE_USER_DATA.length;i++)nd.PLANE_USER_DATA[i].item&&(t.push(nd.PLANE_USER_DATA[i]),n.push(nd.PLANE_USER_DATA[i].item),nd.PLANE_USER_DATA[i].item=nd.PLANE_USER_DATA[i].item.userData),nd.PLANE_USER_DATA[i].body=null;var r=[nd.PORTAL_GUN_INITIATE,rd.AMBIENT.value],r=(e.push(r),e.push(nd.PLANE_USER_DATA),"data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e))),e=document.createElement("a");e.setAttribute("href",r),td()("#chamber-name-to-save").val()?e.setAttribute("download",td()("#chamber-name-to-save").val()+"_by_"+td()("#author-name-to-save").val()+".json"):e.setAttribute("download","chamber.json"),e.click();for(i=0;i<t.length;i++)t[i].item=n[i]}),td()("body").on("input","#friction",function(){nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.friction=this.value}),td()("body").on("input","#restitution",function(){nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.restitution=parseFloat(this.value)}),td()("body").on("click","#header-items",function(){td()(this).css("background-color","black"),td()(this).css("color","white"),td()("#header-settings").css("background-color","white"),td()("#header-settings").css("color","black"),td()("#items").css("display","grid"),td()("#settings").css("display","none")}),td()("body").on("click","#header-settings",function(){td()(this).css("background-color","black"),td()(this).css("color","white"),td()("#header-items").css("background-color","white"),td()("#header-items").css("color","black"),td()("#items").css("display","none"),td()("#settings").css("display","flex")}),td()("#portal-gun-select").on("change",function(){nd.PORTAL_GUN_INITIATE=td()(this).val()}),td()("body").on("click",".portal_gun-state",function(){nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.state=td()(this).data("state"),td()("#portal_gun-state").find(".title").text(td()(this).data("state")+" Portals")}),td()("body").on("input","#portal-gun-color",function(){var e=Cu(this.value);localStorage.setItem("portal_gun_color",this.value),nd.GUN.getObjectByName("Object_6").material.color=new vd(e.r/255,e.g/255,e.b/255)}),td()("body").on("input","#portal-gun-roughness",function(){localStorage.setItem("portal_gun_roughness",this.value),nd.GUN.getObjectByName("Object_6").material.roughness=this.value}),td()("body").on("input","#portal-gun-metalness",function(){localStorage.setItem("portal_gun_metalness",this.value),nd.GUN.getObjectByName("Object_6").material.metalness=this.value}),td()("body").on("change","#option-goo-reflections",function(){nd.GOO_REFLECTIONS=this.checked,localStorage.setItem("goo_reflections",this.checked)}),localStorage.getItem("goo_reflections")&&(nd.GOO_REFLECTIONS="true"==localStorage.getItem("goo_reflections"),td()("#option-goo-reflections").prop("checked",nd.GOO_REFLECTIONS)),td()("body").on("click",".angled_panel_option",function(){td()("#angled_panel_option").find(".title").text("Angle: "+td()(this).data("angle")),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.angle=td()(this).data("real"),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.getObjectByName("pivot2").rotation.x=Math.PI/180*td()(this).data("real")}),td()("body").on("click","#reset-check-point",function(){nd.LEVEL_ENTERED&&$0(nd.PLAYER)}),Gv=window.innerWidth,vg=window.innerHeight;let ch=`
varying vec2 vUv; 
void main()
{
    vUv = uv;

    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;
}
`;var Qh=`

// most of the code is from https://www.shadertoy.com/view/lsf3RH

uniform float iTime;
uniform int iPortal;
uniform int iOpened;
uniform vec4 resolution;

varying vec2 vUv;

float snoise(vec3 uv, float res)
{
	const vec3 s = vec3(1e0, 1e2, 1e3);
	
	uv *= res;
	
	vec3 uv0 = floor(mod(uv, res))*s;
	vec3 uv1 = floor(mod(uv+vec3(1.), res))*s;
	
	vec3 f = fract(uv); f = f*f*(3.0-2.0*f);

	vec4 v = vec4(uv0.x+uv0.y+uv0.z, uv1.x+uv0.y+uv0.z,
		      	  uv0.x+uv1.y+uv0.z, uv1.x+uv1.y+uv0.z);

	vec4 r = fract(sin(v*1e-1)*1e3);
	float r0 = mix(mix(r.x, r.y, f.x), mix(r.z, r.w, f.x), f.y);
	
	r = fract(sin((v + uv1.z - uv0.z)*1e-1)*1e3);
	float r1 = mix(mix(r.x, r.y, f.x), mix(r.z, r.w, f.x), f.y);
	
	return mix(r0, r1, f.z)*2.-1.;
}


void main( ) 
{
    vec2 p = -0.42 + 0.84 *vUv;
	//vec2 p = -.5 + gl_FragCoord.xy / resolution.xy;
	//p.x *= resolution.x/resolution.y;
	
    //p.x *= 1.5;
    
	float color = 3.0 - (3.*length(2.*p));
    
	vec3 coord = vec3(atan(p.x,p.y)/6.2832+.5, length(p)*.4, .5);
	
    coord = 1.0 - coord;

    //for(int i = 1; i <= 2; i++) {
        float power = pow(2.0, float(1));
        color += (0.4 / power) * snoise(coord + vec3(0.,-iTime*.05, iTime*.01), power*16.);
    //}

    color = 1.0 - color;
    color *= 2.7;
    color *= smoothstep(0.43, 0.4, length(p));

    //
    float pct = distance(vUv,vec2(0.5));
    // set solid background
    float y = smoothstep(0.35,0.525,pct);

    if(iOpened == 1){
        if(iPortal == 0){
            gl_FragColor = vec4(pow(max(color,0.),3.)*0.15, pow(max(color,0.),2.)*0.4, color, y);

            gl_FragColor = vec4(mix(vec3(1, 0.2, 0),vec3(color, pow(max(color,0.),2.)*0.4, pow(max(color,0.),3.)*0.15),color),y);
        }else{
            gl_FragColor = vec4(mix(vec3(0, 0.2, 1),vec3(pow(max(color,0.),3.)*0.15, pow(max(color,0.),2.)*0.4, color),color),y);
        }
    }else{
        if(iPortal == 0){
            //gl_FragColor  = vec4(color, pow(max(color,0.),2.)*0.4, pow(max(color,0.),3.)*0.15 , y);
            gl_FragColor = vec4(pow(max(color,0.),3.)*0.15, pow(max(color,0.),2.)*0.4, color, y);
        
            gl_FragColor = vec4(mix(vec3(1, 0.2, 0),vec3(color, pow(max(color,0.),2.)*0.4, pow(max(color,0.),3.)*0.15),color),1.0);
        }else{
            gl_FragColor = vec4(mix(vec3(0, 0.2, 1),vec3(pow(max(color,0.),3.)*0.15, pow(max(color,0.),2.)*0.4, color),color),1.0);
        }
    }

}
`,id=(nd.UNIFORMS_PORTAL_GUN_ENERGY={iTime:{type:"f",value:1},iAlpha:{type:"f",value:0},iColor:{type:"v3",value:new dd(1,.25,0)},resolution:{type:"v2",value:new ld(10,1)},iChannel0:{type:"t",value:(new wd).load("./assets/textures/shaders/energy2.png")}},new Rx(15,32,16)),$h=(new _d({color:16776960}),nd.MATERIAL_GUN=new Td({uniforms:nd.UNIFORMS_PORTAL_GUN_ENERGY,vertexShader:`
varying vec2 vUv; 
void main()
{
    vUv = uv;

    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;
}
`,fragmentShader:`
//
uniform float iTime;
uniform float iAlpha;
uniform sampler2D iChannel0;
uniform sampler2D iChannel1;
uniform vec2 iResolution;
uniform vec3 iColor;

float height(in vec2 uv){
    float speed = 6.0;

    float topright=		sin(iTime*(speed+1.0)	-sin(length(uv-vec2(1.0,1.0)))*53.0);
    float topleft=		sin(iTime*(speed+1.0)	-sin(length(uv-vec2(0.0,1.0)))*37.0);
    float bottomright=	sin(iTime*(speed)    	-sin(length(uv-vec2(1.0,0.0)))*61.0);
    float bottomleft=	sin(iTime*(speed+2.0)	-sin(length(uv-vec2(0.0,0.0)))*47.0);

    float horizontalWaves=sin(iTime*(speed+2.0)-sin(uv.y)*47.0);
    
    
    float temp = horizontalWaves +bottomleft*0.4 +bottomright*0.2 +topleft*0.6 +topright*0.3;
    
    float b=smoothstep(-2.5,5.0,temp);
    return b*3.0;
}

varying vec2 vUv;

void main()
{
	//vec2 uv=gl_FragCoord.xy/iResolution.xy;

    vec2 uv= 0.0 + 1.0 *vUv;
    
    float waveHeight=0.4+height(uv);
    
    //vec3 color=vec3(waveHeight*0.3,waveHeight*0.5,waveHeight);
    vec3 color=vec3(waveHeight * iColor.x,waveHeight*iColor.y,waveHeight * iColor.z);
    
    gl_FragColor = vec4( color, iAlpha );
}
`,side:2,transparent:!0,opacity:0}),new xd(id,nd.MATERIAL_GUN),nd.UNIFORMS_LIGHT_BRIDGE={time:{value:0}},new vd(0,.75,1)),wv=("epic"==localStorage.getItem("quality-select")&&($h=new vd(0,1.5,2)),nd.MATERIAL_LIGHT_BRIDGERS=new _d({color:$h,side:He,transparent:!0,blending:J,onBeforeCompile:e=>{e.uniforms.time=nd.UNIFORMS_LIGHT_BRIDGE.time,e.fragmentShader=`
          uniform float time;
          ${e.fragmentShader}
        `.replace("#include <color_fragment>",`#include <color_fragment>
          float t = time;
          float mainWave = sin((vUv.x - t * 0.2) * 1.5 * PI2) * 0.5 + 0.5;
          mainWave = mainWave * 0.25 + 0.25;
          mainWave *= (sin(t * PI2 * 0.1) * 0.5 + 0.5) * 0.25 + 0.75;
          float sideLines = smoothstep(0.45, 0.5, abs(vUv.x - 0.5));
          float contactLines = smoothstep(0.45, 0.5, abs(vUv.y - 0.5));
          float scanLineSin = abs(vUv.x - (sin(t * 2.7) * 0.5 + 0.5));
          float scanLine = smoothstep(0.01, 0., scanLineSin);
          float fadeOut = pow(vUv.y, 2.7);
          
          
          float a = 0.;
          a = max(a, mainWave);
          a = max(a, sideLines);
          a = max(a, contactLines);
          //a = max(a, scanLine);
          
          diffuseColor.a = a;

            #include <tonemapping_fragment>
            #include <colorspace_fragment>
          
          `)}}),nd.MATERIAL_LIGHT_BRIDGERS.defines={USE_UV:""},new dd(.02,.5,.95)),pg=new dd(.95,.45,.02),id=(localStorage.getItem("quality-select"),nd.UNIFORMS_TRACTOR_BEAM={iTime:{type:"f",value:1},iAlpha:{type:"f",value:1},iColor:{type:"v3",value:wv}},nd.UNIFORMS_TRACTOR_BEAM_ORANGE={iTime:{type:"f",value:1},iAlpha:{type:"f",value:1},iColor:{type:"v3",value:pg}},`
attribute float height;  // Custom attribute for height

varying vec2 vUv; 
varying float vHeight;

void main()
{
    vHeight = height;  // Pass height to fragment shader
    vUv = uv;

    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;
}
`),$h=(nd.MATERIAL_TRACTOR_BEAM=new Td({uniforms:nd.UNIFORMS_TRACTOR_BEAM,vertexShader:id,fragmentShader:`
uniform float iTime;
uniform float iAlpha;
uniform vec2 iResolution;
uniform vec3 iColor;
varying vec2 vUv;
varying float vHeight;  // Received from vertex shader

float height(in vec2 uv) {
    float speed = 6.0;

    // Calculate normalized horizontal position
    float horizontalPos = uv.x + uv.y * vHeight;

    // Adjust frequency to spread waves evenly and control width
    float horizontalWaves = sin(iTime * (speed + 2.0) + horizontalPos * 18.85);

    float b = smoothstep(0.0, 4.0, horizontalWaves);
    return b * 3.0;
}

void main() {
    vec2 uv= -vUv;

    float waveHeight = height(uv);
    
    // Set transparency based on wave height
    float alpha = waveHeight; // Invert waveHeight to make black parts transparent
    
    vec3 color = vec3(waveHeight * iColor.x, waveHeight * iColor.y, waveHeight * iColor.z);

    // Glow effect: render the object with a halo around it
    float glowStrength = 0.2;
    float glowSize = 0.2;

    // Calculate distance from center (for circular glow)
    float dist = length(vUv - 0.5);

    // Apply glow based on distance from center
    float glow = glowStrength * smoothstep(glowSize, 0.0, dist);

    // Add glow to color
    color += vec3(glow);
    
    gl_FragColor = vec4(color, iAlpha * alpha);

    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}
`,side:2,transparent:!0}),nd.MATERIAL_TRACTOR_BEAM_REVERSE=new Td({uniforms:nd.UNIFORMS_TRACTOR_BEAM_ORANGE,vertexShader:id,fragmentShader:`
//
uniform float iTime;
uniform float iAlpha;
uniform vec2 iResolution;
uniform vec3 iColor;
varying vec2 vUv;
varying float vHeight;  // Received from vertex shader

float height(in vec2 uv) {
    float speed = 6.0;

    // Calculate normalized horizontal position
    float horizontalPos = uv.x + uv.y * vHeight;

    // Adjust frequency to spread waves evenly and control width
    float horizontalWaves = sin(iTime * (speed + 2.0) + horizontalPos * 18.85);

    float b = smoothstep(0.0, 4.0, horizontalWaves);
    return b * 3.0;
}

void main() {
    vec2 uv= vUv;

    float waveHeight = height(uv);
    
    // Set transparency based on wave height
    float alpha = waveHeight; // Invert waveHeight to make black parts transparent
    
    vec3 color = vec3(waveHeight * iColor.x, waveHeight * iColor.y, waveHeight * iColor.z);
    
    gl_FragColor = vec4(color, iAlpha * alpha);

    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}
`,side:2,transparent:!0}),1),wv;"epic"==localStorage.getItem("quality-select")&&($h=30),nd.UNIFORMS_LASER_FIELD={iTime:{type:"f",value:1},iAlpha:{type:"f",value:1},iColor:{type:"v3",value:new dd($h,0,0)}},nd.MATERIAL_LASER_FIELD=new Td({uniforms:nd.UNIFORMS_LASER_FIELD,vertexShader:`

varying vec2 vUv; 

void main()
{
    vUv = uv;

    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;
}
`,fragmentShader:`
uniform float iTime;
uniform float iAlpha;
uniform vec2 iResolution;
uniform vec3 iColor;
varying vec2 vUv;

float height(in vec2 uv) {
    float speed = 2.0;

    // Calculate normalized horizontal position
    float horizontalPos = uv.x;

    // Adjust frequency to spread waves evenly and control width
    float horizontalWaves = sin(iTime * (speed + 2.0) + horizontalPos * 75.0);

    float b = smoothstep(0.0, 4.0, horizontalWaves);
    return b * 3.0;
}

void main() {
    vec2 uv= -vUv;

    float waveHeight = height(uv);
    
    // Set transparency based on wave height
    float alpha = waveHeight; // Invert waveHeight to make black parts transparent
    
    vec3 color = vec3(waveHeight * iColor.x, waveHeight * iColor.y, waveHeight * iColor.z);

    // Glow effect: render the object with a halo around it
    float glowStrength = 0.2;
    float glowSize = 0.2;

    // Calculate distance from center (for circular glow)
    float dist = length(vUv - 0.5);

    // Apply glow based on distance from center
    float glow = glowStrength * smoothstep(glowSize, 0.0, dist);

    // Add glow to color
    color += vec3(glow);
    
    gl_FragColor = vec4(color, iAlpha * alpha);

    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}
`,side:2,transparent:!0}),nd.UNIFORMS_FIZZLER={iTime:{value:0},iResolution:{type:"v2",value:new ld(1e3,1e3)}},nd.MATERIAL_FIZZLER=new Td({uniforms:nd.UNIFORMS_FIZZLER,vertexShader:`
varying vec2 vUv; 
void main()
{
    vUv = uv;

    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;
}
`,fragmentShader:`
uniform float iTime;
uniform vec2 iResolution;

// Found this on GLSL sandbox. I really liked it, changed a few things and made it tileable.
// :)
// by David Hoskins.
// Original water turbulence effect by joltz0r


// Redefine below to see the tiling...
//#define SHOW_TILING

#define TAU 6.28318530718
#define MAX_ITER 5

varying vec2 vUv;

void main() 
{
	float time = iTime * .5+23.0;
    // uv should be the 0-1 uv of texture...
	//vec2 uv = gl_FragCoord.xy / iResolution.y;
  vec2 uv = -1.0 + 2.0 *vUv;
    
#ifdef SHOW_TILING
	vec2 p = mod(uv*TAU*2.0, TAU)-250.0;
#else
    vec2 p = mod(uv*TAU, TAU)-250.0;
#endif
	vec2 i = vec2(p);
	float c = 1.0;
	float inten = .005;

	for (int n = 0; n < MAX_ITER; n++) 
	{
		float t = time * (1.0 - (3.5 / float(n+1)));
		i = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));
		c += 1.0/length(vec2(p.x / (sin(i.x+t)/inten),p.y / (cos(i.y+t)/inten)));
	}
	c /= float(MAX_ITER);
	c = 1.17-pow(c, 1.4);
	vec3 colour = vec3(pow(abs(c), 8.0));
    colour = clamp(colour + vec3(0.0, 0.35, 0.5), 0.0, 1.0);
    
	gl_FragColor = vec4(colour, 0.15);
}
`,side:2,transparent:!0,opacity:.2,depthWrite:!1}),console.log(nd.MATERIAL_FIZZLER),(wv=(new wd).load("./assets/textures/noise.webp")).wrapS=wv.wrapT=H;var pg,VE=((pg=(new wd).load("./assets/textures/matcap.webp")).colorSpace=je,nd.UNIFORMS_DISSOLVER={u_EffectOrigin:{value:new dd(3,2,3)},u_Time:{value:0},diffuseMap:{value:pg},t_Noise:{value:wv}},nd.MATERIAL_DISSOLVER=new Td({uniforms:nd.UNIFORMS_DISSOLVER,vertexShader:`
    varying vec3 vViewPosition;
    varying vec3 vWorldPosition;
    varying vec2 vUv; // Pass UV coordinates to fragment shader
    
    #include <normal_pars_vertex>
    #include <uv_pars_vertex> // Include UV handling
    
    void main() {
      #include <beginnormal_vertex>
      #include <defaultnormal_vertex>
      #include <normal_vertex>
    
      #include <begin_vertex>
      #include <project_vertex>
    
      // Position of the mesh in world space
      vWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;

      // Pass UV coordinates to fragment shader
      vUv = uv;
    
      vViewPosition = -mvPosition.xyz;
    }
    `,fragmentShader:`
    varying vec3 vViewPosition;
    varying vec3 vWorldPosition;
    varying vec2 vUv; // Receive UV coordinates from vertex shader
    
    uniform vec3 u_EffectOrigin;
    uniform sampler2D t_Noise;
    uniform float u_Time;
    uniform sampler2D diffuseMap; // Texture map
    
    #include <normal_pars_fragment>
    
    void main() {
      vec4 diffuseColor = texture2D(diffuseMap, vUv); // Sample texture map
      vec4 glowColor = vec4(0.2667, 0.8745, 0.6, 0.0);
    
      #include <normal_fragment_begin>
    
      vec3 viewDir = normalize(vViewPosition);
        vec3 x = normalize( vec3(viewDir.z, 0.0, - viewDir.x));
        vec3 y = cross(viewDir, x);
        vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
    
      vec4 tNoise = texture2D(t_Noise, uv+vec2(u_Time* -0.2, u_Time*0.1));
      float noise = (tNoise.r + tNoise.g + tNoise.b) / 3.0;
    
      float distancefromEffectOrigin = distance(vWorldPosition, u_EffectOrigin);
      
      float falloff = step(1.0, distancefromEffectOrigin - noise);

      // Apply falloff to dissolve effect
        float dissolveFactor = 1.0 - falloff; // Invert falloff for dissolve effect

        // Combine texture color with custom effect using dissolveFactor
        vec4 finalColor = mix(diffuseColor, glowColor, dissolveFactor);

        // Set fragment color
        gl_FragColor = finalColor;
    }
    `,side:2,transparent:!0,depthWrite:!1}),id=new Td({uniforms:{iTime:{type:"f",value:.1},resolution:{value:new ld(Gv,vg)},iPortal:{value:1},iOpened:{value:0}},vertexShader:ch,fragmentShader:Qh,side:2,transparent:!0,polygonOffset:!0,polygonOffsetFactor:-10}),($h=new gx(nd.PORTAL_WIDTH,50)).computeBoundsTree(),(id=new xd($h,id)).name="portal-0",id.renderOrder=-1,nd.PORTAL_SHADER[0]=id,pg=new Td({uniforms:{iTime:{type:"f",value:.1},resolution:{value:new ld(Gv,vg)},iPortal:{value:0},iOpened:{value:0}},vertexShader:ch,fragmentShader:Qh,side:2,transparent:!0,polygonOffset:!0,polygonOffsetFactor:-10}),($h=new gx(nd.PORTAL_WIDTH,50)).computeBoundsTree(),(id=new xd($h,pg)).renderOrder=-1,id.name="portal-1",nd.PORTAL_SHADER[1]=id,new dT),WE=new dT,WE=new dT,jE=0;let hh=1/60,dh=(new dT,e=>{(jE+=WE.getDelta())>hh&&(jE%=hh),ph()}),ph=e=>{var t=VE.getDelta(),n=(nd.UNIFORMS_PORTAL_GUN_ENERGY.iTime.value+=t,nd.PORTALS[0]&&(nd.PORTALS[0].portalShader.material.uniforms.iTime.value+=t),nd.PORTALS[1]&&(nd.PORTALS[1].portalShader.material.uniforms.iTime.value+=t),VE.getElapsedTime());nd.UNIFORMS_LIGHT_BRIDGE.time.value=n,nd.UNIFORMS_TRACTOR_BEAM.iTime.value+=t,nd.UNIFORMS_TRACTOR_BEAM_ORANGE.iTime.value+=t,nd.UNIFORMS_FIZZLER.iTime.value+=t,nd.UNIFORMS_LASER_FIELD.iTime.value+=t,nd.UNIFORMS_DISSOLVER.u_Time.value=n},fh=Kh(601);var wv=Kh.n(fh),sd={fwdValue:0,bkdValue:0,rgtValue:0,lftValue:0,shouldJump:!1,headBobActive:!1,headBobTimer:0,controller:{KeyE:{pressed:!1},KeyW:{pressed:!1},KeyS:{pressed:!1},KeyA:{pressed:!1},KeyD:{pressed:!1},Space:{pressed:!1}},blocked_bottom:!1,blocked_top:!1,crouched:!1},YE=!0;if(nd.MOBILE){window.targetRotationOnMouseDownX=0;window.targetRotationOnMouseDownY=0;var qE,XE,ZE,KE=0,JE=0,QE=window.innerWidth/2,$E=window.innerHeight/2,e1=0;let e;document.getElementById("camera2").addEventListener("touchstart",function(e){0<e.touches.length&&(0!=(e1=e.touches.length-1)&&1!=e1||(KE=e.touches[e1].pageX-QE,window.targetRotationOnMouseDownX=nd.TARGET_ROTATION_X,JE=e.touches[e1].pageY-$E,window.targetRotationOnMouseDownY=nd.TARGET_ROTATION_Y))},!1),document.getElementById("camera2").addEventListener("touchmove",function(e){0<e.touches.length&&(0==e1||1==e1)&&(qE=e.touches[e1].pageX-QE,nd.TARGET_ROTATION_X=window.targetRotationOnMouseDownX+-.01*(qE-KE),qE=e.touches[e1].pageY-$E,XE=e.touches[e1].pageY-ZE,ZE=e.touches[e1].pageY,0<XE?sd.blocked_bottom||(nd.TARGET_ROTATION_Y=window.targetRotationOnMouseDownY+-.01*(qE-JE)):sd.blocked_top||(nd.TARGET_ROTATION_Y=window.targetRotationOnMouseDownY+-.01*(qE-JE)))},!1),document.getElementById("camera2").addEventListener("touchup",function(e){e1=0},!1),Qh={zone:document.getElementById("joystickWrapper1"),size:120,multitouch:!0,maxNumberOfNipples:2,mode:"static",restJoystick:!0,shape:"circle",position:{top:"60px",left:"60px"},dynamicPage:!0},(e=wv().create(Qh))[0].on("move",function(e,t){var n=t.vector.y,t=t.vector.x;0<n?(sd.fwdValue=Math.abs(n),sd.bkdValue=0):n<0&&(sd.fwdValue=0,sd.bkdValue=Math.abs(n)),0<t?(sd.lftValue=0,sd.rgtValue=Math.abs(t)):t<0&&(sd.lftValue=Math.abs(t),sd.rgtValue=0),sd.headBobActive=!0}),e[0].on("end",function(e){sd.bkdValue=0,sd.fwdValue=0,sd.lftValue=0,sd.rgtValue=0,nd.PLAYER_MOVING=!1,sd.headBobTimer=0,$g(500,nd.GUN.children[0].position,new dd(0,0,0)),e1=0})}var t1,n1=!1;document.addEventListener("keydown",e=>{nd.FPS_MODE&&YE&&(sd.controller[e.code]&&(sd.controller[e.code].pressed=!0),sd.headBobActive=!0,"ControlLeft"!=e.code||sd.crouched?"KeyE"!=e.code||n1||(n1=!0,Nv()):(sd.crouched=!0,a1(-.25)))}),td()("body").on("click","#close",function(){td()("#blocker").css("display","block"),td()("#container").css("filter","blur(2px)")}),td()("body").on("click","#item",function(){Nv()}),window.blockCamRotation=!1;let mh=Math.PI/2,gh=2*Math.PI;document.body.addEventListener("mousemove",e=>{document.pointerLockElement!==document.body||nd.PAUSED||(nd.MAIN_CAMERA.rotation.y-=e.movementX/1e3,nd.MAIN_CAMERA.rotation.x-=e.movementY/1e3,nd.MAIN_CAMERA.rotation.x=Math.max(-mh,Math.min(mh,nd.MAIN_CAMERA.rotation.x)),nd.MAIN_CAMERA.rotation.y>Math.PI?nd.MAIN_CAMERA.rotation.y-=gh:nd.MAIN_CAMERA.rotation.y<-Math.PI&&(nd.MAIN_CAMERA.rotation.y+=gh),nd.TELEPORTING_TARGET_QUATERNION||nd.GUN.quaternion.slerp(nd.MAIN_CAMERA.quaternion,.075),window.blockCamRotation=!0,clearTimeout(t1),t1=setTimeout(function(){window.blockCamRotation=!1},10))}),td()("body").on("click","#settings-close",function(){nd.FPS_MODE&&YE&&(rd.AMBIENT.currentTime=0,Ag(rd.AMBIENT),document.getElementById("blocker").style.display="none",nd.PAUSED=!1,window.clockTimer=new dT,setTimeout(()=>{nd.ALLOW_PLACE_PORTALS=!0},1e3),sd.controller={KeyE:{pressed:!1},KeyW:{pressed:!1},KeyS:{pressed:!1},KeyA:{pressed:!1},KeyD:{pressed:!1},Space:{pressed:!1}},nd.PAUSED=!1,td()("#chamberName").css("opacity",0),nd.MOBILE?(td()("#blocker").css("display","none"),td()("#mobile-controls").css("display","block"),document.body.requestFullscreen?document.body.requestFullscreen():document.body.mozRequestFullScreen?document.body.mozRequestFullScreen():document.body.webkitRequestFullscreen?document.body.webkitRequestFullscreen():document.body.msRequestFullscreen&&document.body.msRequestFullscreen()):document.body.requestPointerLock(),td()("#container").css("filter","none"),nd.DOOR_OPEN_STATE||(nd.DOOR_OPEN_STATE=!0,setTimeout(()=>{$g(1e3,nd.CORRIDOR_ENTER.getObjectByName("rightDoor").rotation,new dd(nd.CORRIDOR_ENTER.getObjectByName("rightDoor").rotation.x,Math.PI/8,nd.CORRIDOR_ENTER.getObjectByName("rightDoor").rotation.z)),$g(1e3,nd.CORRIDOR_ENTER.getObjectByName("leftDoor").rotation,new dd(nd.CORRIDOR_ENTER.getObjectByName("leftDoor").rotation.x,.9*Math.PI,nd.CORRIDOR_ENTER.getObjectByName("leftDoor").rotation.z)),setTimeout(()=>{nd.BODY_ELEVATOR.position.y=1e4},500),setTimeout(()=>{Y0(1e3,!0,!1,nd.ENTER_DOOR)},1e3)},500)))});var i1=!1;function r1(){if(td()("#container").css("filter","blur(2px)"),document.getElementById("blocker").style.display="block",nd.ALLOW_PLACE_PORTALS=!1,YE=!1,nd.PAUSED=!0,window.curentTimeOffset=nd.STATS_UI.time,td()("#chamberName").css("opacity",1),!nd.FINISHED){!window.previousAudio||window.previousAudio.paused||(i1=!0,window.previousAudio.pause());for(var e=0;e<window.timeoutEvent.length;e++)window.timeoutEvent[e].pause()}setTimeout(()=>{YE=!0},1500)}function a1(e){nd.PLAYER.shapes[0].halfExtents.y+=e,nd.PLAYER.shapes[0].updateConvexPolyhedronRepresentation(),nd.PLAYER.computeAABB(),nd.PLAYER.updateMassProperties()}document.addEventListener("pointerlockchange",()=>{if(document.pointerLockElement===document.body){if(!nd.FINISHED){i1&&(i1=!1,window.previousAudio.play());for(var e=0;e<window.timeoutEvent.length;e++)window.timeoutEvent[e].resume()}}else r1()}),document.addEventListener("keyup",e=>{nd.FPS_MODE&&(n1=!1,nd.FPS_MODE&&YE&&(sd.controller[e.code]&&(sd.controller[e.code].pressed=!1),nd.PLAYER_MOVING=!1,sd.headBobTimer=0,$g(300,nd.GUN.children[0].position,new dd(0,0,0)),sd.crouched)&&(sd.crouched=!1,a1(.25)),rd.WALK.pause())}),td()("body").on("pointerdown","#crouch",function(){sd.crouched=!0,a1(-.25)}),td()("body").on("pointerup","#crouch",function(){a1(.25)}),document.addEventListener("mousedown",e=>{nd.MOBILE||null===document.pointerLockElement||L0(e.button,null,nd.MAIN_CAMERA)}),document.getElementById("portal_l").addEventListener("pointerdown",function(){nd.ALLOW_PLACE_PORTALS=!0,L0(0,null,nd.MAIN_CAMERA)},!1),document.getElementById("portal_r").addEventListener("pointerdown",function(){nd.ALLOW_PLACE_PORTALS=!0,L0(2,null,nd.MAIN_CAMERA)},!1),document.getElementById("jump").addEventListener("pointerdown",function(){nd.PLAYER.inJump||(sd.shouldJump=!0)},!1);var o1,s1=!1,l1=!1,u1=!1,c1=!1,h1=.01;let vh=null;window.PLAYER_JUMPING_FROM_BLUE_GEL=!1;var d1,p1=.1;let _h=new dT,yh=0,Eh=0,Ah=0,xh=0;var f1=.1,m1=!1,g1=!1,v1=!1,_1=!1;let Th=function(e){_1=v1=g1=m1=!1;var t=1100,n=(nd.MOBILE&&null==vh&&!nd.TELEPORTING_TARGET_QUATERNION&&(t=900,nd.MAIN_CAMERA.rotation.y+=(nd.TARGET_ROTATION_X-nd.MAIN_CAMERA.rotation.y)*p1,o1=nd.TARGET_ROTATION_Y-nd.MAIN_CAMERA.rotation.x,nd.MAIN_CAMERA.rotation.x<=1.5&&-1.5<=nd.MAIN_CAMERA.rotation.x&&(nd.MAIN_CAMERA.rotation.x+=o1*p1),1.5<nd.MAIN_CAMERA.rotation.x?(sd.blocked_top=!0,nd.MAIN_CAMERA.rotation.x=1.5):sd.blocked_top=!1,nd.MAIN_CAMERA.rotation.x<-1.5?(sd.blocked_bottom=!0,nd.MAIN_CAMERA.rotation.x=-1.5):sd.blocked_bottom=!1),new dd),n=(nd.MAIN_CAMERA.getWorldDirection(n),n.projectOnPlane(nd.PLAYER.upVectorThree).normalize()),i=n.clone().negate(),r=nd.PLAYER.upVectorThree.clone().cross(n).normalize(),a=r.clone().negate();let o=1;nd.PLAYER.inJump&&(o=.05),nd.PLAYER.inJump?nd.PLAYER.linearDamping=.01:nd.PLAYER.linearDamping=.999;var s=sd.fwdValue+sd.bkdValue+sd.lftValue+sd.rgtValue;let l=1;2==s&&(l=1/Math.sqrt(s));var u,c,s=t*nd.PLAYER.mass*o*e*nd.SPEED;nd.GEL_ORANGE&&nd.PLAYER.applyForce(n.clone().multiplyScalar(3*s),nd.PLAYER.position),nd.STOP_TIME||nd.GEL_ORANGE||window.PLAYER_JUMPING_FROM_BLUE_GEL||(null!==vh&&(M1(u=navigator.getGamepads()[vh],5,0,1),M1(u,6,0,0),M1(u,7,0,2),1!=u.buttons[3].value||l1?0==u.buttons[3].value&&(sd.crouched&&a1(.25),l1=!1,sd.crouched=!1,0):(sd.crouched=!0,a1(-.25),l1=!0),1!=u.buttons[1].value||s1?0==u.buttons[1].value&&(s1=!1):(Nv(),s1=!0),R1(u,12,u1),R1(u,15,c1),nd.TELEPORTING_TARGET_QUATERNION||(t=u.axes[2],c=u.axes[3],yh-=2.5*t*e,Eh-=2.5*c*e,Eh=fn.clamp(Eh,-Math.PI/2,Math.PI/2),Ah+=(yh-Ah)*f1,xh+=(Eh-xh)*f1,nd.MAIN_CAMERA.rotation.x=xh,nd.MAIN_CAMERA.rotation.y=Ah,nd.MAIN_CAMERA.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,nd.MAIN_CAMERA.rotation.x))),u.axes[1]<-.5&&(m1=!0,S1(n,s,l)),.5<u.axes[1]&&(g1=!0,S1(i,s,l)),u.axes[0]<-.5&&(v1=!0,S1(r,s,l)),.5<u.axes[0])&&(_1=!0,S1(a,s,l)),nd.MOBILE&&null==vh?(0<sd.fwdValue&&(m1=!0,w1(n,s,sd.fwdValue)),0<sd.bkdValue&&(g1=!0,w1(i,s,sd.bkdValue)),0<sd.lftValue&&(v1=!0,w1(r,s,sd.lftValue)),0<sd.rgtValue&&(_1=!0,w1(a,s,sd.rgtValue)),sd.shouldJump&&(nd.PLAYER.inJump=!0,nd.PLAYER.applyImpulse(nd.PLAYER.upVectorThree.clone().multiplyScalar(200),nd.PLAYER.position)),sd.shouldJump=!1):(t=new dd(nd.PLAYER.position.x,nd.PLAYER.position.y,nd.PLAYER.position.z),sd.controller.KeyW.pressed&&(m1=!0,T1(n,t,s,l,e)),sd.controller.KeyS.pressed&&(g1=!0,T1(i,t,s,l,e)),sd.controller.KeyA.pressed&&(v1=!0,T1(r,t,s,l,e)),sd.controller.KeyD.pressed&&(_1=!0,T1(a,t,s,l,e)),sd.shouldJump=!1,sd.controller.Space.pressed||(A1=!1),null!==vh?0<u.buttons[0].value&&!nd.PLAYER.inJump&&(sd.shouldJump=!0):sd.controller.Space.pressed&&!nd.PLAYER.inJump&&(sd.shouldJump=!0),!sd.shouldJump||nd.PLAYER.inJump||A1||x1||(rd.WALK.pause(),A1=!0,nd.PLAYER.inJump=!0,nd.PLAYER.jumpVelocity?(nd.PLAYER.linearDamping=.01,c=-1*nd.PLAYER.mass*nd.PLAYER.jumpVelocity,n=new ed.Vec3(c*nd.PLAYER.upVectorThree.x,c*nd.PLAYER.upVectorThree.y,c*nd.PLAYER.upVectorThree.z),nd.PLAYER.applyImpulse(n,nd.PLAYER.position),nd.PLAYER.jumpVelocity=null):nd.PLAYER.applyImpulse(nd.PLAYER.upVectorThree.clone().multiplyScalar(200),nd.PLAYER.position),x1=!0,setTimeout(()=>{x1=!1},100),nd.PLAYER.customGravity&&Q_()))),wh(e),nd.PLAYER_MOVING&&(nd.GUN.children[0].position.x+=Math.sin(sd.headBobTimer*nd.HEAD_BOB_SPEED)*h1*e)};var y1,E1,A1=!1,x1=!1;window.gg=!1;let Sh=function(n){var e,t;nd.TELEPORTING_TARGET_QUATERNION?(f1=1,nd.MAIN_CAMERA.quaternion.slerp(nd.TELEPORTING_TARGET_QUATERNION,.15),function(e,t,n){return n=2<arguments.length&&void 0!==n?n:.001,e=Math.abs(e.dot(t)),Math.abs(e-1)<n}(nd.MAIN_CAMERA.quaternion,nd.TELEPORTING_TARGET_QUATERNION)&&(nd.TELEPORTING_TARGET_QUATERNION=null,nd.MAIN_CAMERA.rotation.z=0,setTimeout(()=>{f1=.1},50)),nd.GUN.position.copy(nd.MAIN_CAMERA.position),nd.GUN.quaternion.copy(nd.MAIN_CAMERA.quaternion),nd.PORTAL_GUN_CAMERA.position.copy(nd.MAIN_CAMERA.position),nd.PORTAL_GUN_CAMERA.quaternion.copy(nd.MAIN_CAMERA.quaternion),nd.TARGET_ROTATION_X=nd.MAIN_CAMERA.rotation.y,nd.TARGET_ROTATION_Y=nd.MAIN_CAMERA.rotation.x,window.targetRotationOnMouseDownX=nd.TARGET_ROTATION_X,window.targetRotationOnMouseDownY=nd.TARGET_ROTATION_Y,Eh=nd.MAIN_CAMERA.rotation.x,yh=nd.MAIN_CAMERA.rotation.y):window.blockCamRotation||(nd.GUN.quaternion.slerp(nd.MAIN_CAMERA.quaternion,.075),e=nd.GUN,t=n,e.position.y+=.0025*Math.sin(.001*t),e.rotation.x+=.00125*Math.sin(.001*t)),window.nnn&&nd.PLAYER.EULER?((e=nd.PLAYER.EULER).y=nd.MAIN_CAMERA.rotation.y,(t=new hd).setFromEuler(e),nd.PLAYER.quaternion.copy(t)):nd.PLAYER.quaternion.setFromAxisAngle(new ed.Vec3(0,1,0),nd.MAIN_CAMERA.rotation.y),100<nd.MAIN_CAMERA.position.distanceTo(new dd(0,0,0))&&((i=nd.ENTER_DOOR.clone()).translateZ(1),nd.PLAYER.position.copy(i.position)),nd.PLAYER_MODEL&&(nd.PLAYER_MODEL.position.copy(nd.PLAYER.position).add(nd.PLAYER.upVectorThree.clone().multiplyScalar(-1)),nd.PLAYER_MODEL.quaternion.copy(nd.PLAYER.quaternion),nd.PLAYER_MODEL.quaternion.multiply(new hd(0,50,0)).normalize(),nd.PLAYER_MODEL.translateY(.4),nd.PLAYER_MODEL_CLONE.position.copy(nd.PLAYER.position).add(nd.PLAYER.upVectorThree.clone().multiplyScalar(-1)),nd.PLAYER_MODEL_CLONE.quaternion.copy(nd.PLAYER.quaternion),nd.PLAYER_MODEL_CLONE.quaternion.multiply(new hd(0,50,0)).normalize(),nd.PLAYER_MODEL_CLONE.translateY(.4),nd.PLAYER_MODEL_CLONE.visible=!1,nd.PLAYER_MODEL_CLONE.traverse(e=>{var t;e.material&&(t=e.material.clone(),e.material=t,e.material.transparent=!1,e.material.opacity=1,e.material.colorWrite=!0,e.material.depthWrite=!0)}));if(nd.PLAYER_MODEL){var i="ANIM_STANDING_IDLE",n="ANIM_STATIONARY_RUNNING",r="ANIM_BACKWARD_RUNNING",a="ANIM_JUMP",o="ANIM_LEFT_STRAFE",s="ANIM_RIGHT_STRAFE";"none"==nd.PORTAL_GUN_INITIATE&&(i="ANIM_STANDING_IDLE_NO_GUN",n="ANIM_STATIONARY_RUNNING_NO_GUN",r="ANIM_BACKWARD_RUNNING_NO_GUN",a="ANIM_JUMP_NO_GUN",o="ANIM_LEFT_STRAFE_NO_GUN",s="ANIM_RIGHT_STRAFE_NO_GUN");let e=nd.PLAYER_MODEL.animationActions[i],t=nd.PLAYER_MODEL_CLONE.animationActions[i];if(nd.PLAYER_MODEL.modelReady){nd.PLAYER.inJump&&!nd.PLAYER.inTractor?(e=nd.PLAYER_MODEL.animationActions[a],t=nd.PLAYER_MODEL_CLONE.animationActions[a]):m1&&v1&&_1&&g1?(e=nd.PLAYER_MODEL.animationActions[i],t=nd.PLAYER_MODEL_CLONE.animationActions[i]):m1&&g1?(e=nd.PLAYER_MODEL.animationActions[i],t=nd.PLAYER_MODEL_CLONE.animationActions[i],_1?(e=nd.PLAYER_MODEL.animationActions[s],t=nd.PLAYER_MODEL_CLONE.animationActions[s]):v1&&(e=nd.PLAYER_MODEL.animationActions[o],t=nd.PLAYER_MODEL_CLONE.animationActions[o])):v1&&_1?(e=nd.PLAYER_MODEL.animationActions[i],t=nd.PLAYER_MODEL_CLONE.animationActions[i],m1?(e=nd.PLAYER_MODEL.animationActions[n],t=nd.PLAYER_MODEL_CLONE.animationActions[n]):g1&&(e=nd.PLAYER_MODEL.animationActions[r],t=nd.PLAYER_MODEL_CLONE.animationActions[r])):0<sd.fwdValue&&0<sd.rgtValue&&sd.lftValue&&0<sd.bkdValue?(e=nd.PLAYER_MODEL.animationActions[i],t=nd.PLAYER_MODEL_CLONE.animationActions[i]):0<sd.fwdValue&&0<sd.bkdValue?(e=nd.PLAYER_MODEL.animationActions[i],t=nd.PLAYER_MODEL_CLONE.animationActions[i],0<sd.rgtValue?(e=nd.PLAYER_MODEL.animationActions[s],t=nd.PLAYER_MODEL_CLONE.animationActions[s]):sd.lftValue&&(e=nd.PLAYER_MODEL.animationActions[o],t=nd.PLAYER_MODEL_CLONE.animationActions[o])):sd.lftValue&&0<sd.rgtValue?(e=nd.PLAYER_MODEL.animationActions[i],t=nd.PLAYER_MODEL_CLONE.animationActions[i],0<sd.fwdValue?(e=nd.PLAYER_MODEL.animationActions[n],t=nd.PLAYER_MODEL_CLONE.animationActions[n]):0<sd.bkdValue&&(e=nd.PLAYER_MODEL.animationActions[r],t=nd.PLAYER_MODEL_CLONE.animationActions[r])):((m1||0<sd.fwdValue)&&(e=nd.PLAYER_MODEL.animationActions[n],t=nd.PLAYER_MODEL_CLONE.animationActions[n]),(g1||0<sd.bkdValue)&&(e=nd.PLAYER_MODEL.animationActions[r],t=nd.PLAYER_MODEL_CLONE.animationActions[r]),(_1||0<sd.rgtValue)&&(e=nd.PLAYER_MODEL.animationActions[s],t=nd.PLAYER_MODEL_CLONE.animationActions[s]),(v1||sd.lftValue)&&(e=nd.PLAYER_MODEL.animationActions[o],t=nd.PLAYER_MODEL_CLONE.animationActions[o]));a=e;if(a!=d1){E1=d1,d1=a;let e=.01;E1&&(e=.8,E1.fadeOut(e)),d1.reset(),d1.fadeIn(e),d1.play()}i=t;if(i!=y1){E1=y1,y1=i;let e=.01;E1&&(e=.8,E1.fadeOut(e)),y1.reset(),y1.fadeIn(e),y1.play()}n=_h.getDelta();nd.MIXERS.update(n),nd.MIXERS_CLONE.update(n)}}};function T1(e,t,n,i,r){nd.PLAYER.centering=!1,nd.BLOCK_PLAYER_MOVE||(!rd.WALK.paused||nd.PLAYER.inJump||nd.PLAYER.lightBridge?nd.PLAYER.inJump||!nd.PLAYER.lightBridge||rd.WALK.paused||rd.WALK.pause():(rd.WALK.currentTime=0,Ag(rd.WALK)),nd.PLAYER_MOVING=!0,0==nd.PLAYER.mass?(t.add(e.clone().multiplyScalar(+r)),nd.PLAYER.position.copy(t)):(nd.STATS_UI.steps+=.01,nd.PLAYER.applyForce(e.clone().multiplyScalar(n*i),nd.PLAYER.position)))}function S1(e,t,n){nd.BLOCK_PLAYER_MOVE||(nd.PLAYER.applyForce(e.clone().multiplyScalar(t*n),nd.PLAYER.position),nd.PLAYER_MOVING=!0,sd.headBobActive=!0)}function w1(e,t,n){nd.BLOCK_PLAYER_MOVE||(nd.PLAYER.applyForce(e.clone().multiplyScalar(t*n),nd.PLAYER.position),nd.PLAYER_MOVING=!0)}var b1=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];function M1(e,t,n,i){1!=e.buttons[t].value||b1[t]?0==e.buttons[t].value&&(b1[t]=!1):(L0(i,null,nd.MAIN_CAMERA),b1[t]=!0)}function R1(e,t,n){1==e.buttons[t].value&&!n||e.buttons[t].value}let wh=function(e){var t;sd.headBobActive&&nd.PLAYER_MOVING&&(t=Math.PI,t=(1+Math.floor((sd.headBobTimer+1e-7)*nd.HEAD_BOB_SPEED/t))*t/nd.HEAD_BOB_SPEED,sd.headBobTimer=Math.min(sd.headBobTimer+e,t))};window.addEventListener("gamepadconnected",e=>{e=e.gamepad;vh=e.index}),window.addEventListener("gamepaddisconnected",e=>{vh=null});class mw{constructor(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Math;this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let e=0;e<256;e++)this.p[e]=Math.floor(256*t.random());this.perm=[];for(let e=0;e<512;e++)this.perm[e]=this.p[255&e];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(e,t,n){return e[0]*t+e[1]*n}dot3(e,t,n,i){return e[0]*t+e[1]*n+e[2]*i}dot4(e,t,n,i,r){return e[0]*t+e[1]*n+e[2]*i+e[3]*r}noise(e,t){let n,i,r;var a=(e+t)*(.5*(Math.sqrt(3)-1)),o=Math.floor(e+a),a=Math.floor(t+a),s=(3-Math.sqrt(3))/6,l=(o+a)*s,e=e-(o-l),t=t-(a-l);let u,c;c=t<e?(u=1,0):(u=0,1);var l=e-u+s,h=t-c+s,d=e-1+2*s,s=t-1+2*s,o=255&o,a=255&a,p=this.perm[o+this.perm[a]]%12,f=this.perm[o+u+this.perm[a+c]]%12,o=this.perm[1+o+this.perm[1+a]]%12,a=.5-e*e-t*t,a=(n=a<0?0:(a*=a)*a*this.dot(this.grad3[p],e,t),.5-l*l-h*h),p=(i=a<0?0:(a*=a)*a*this.dot(this.grad3[f],l,h),.5-d*d-s*s);return r=p<0?0:(p*=p)*p*this.dot(this.grad3[o],d,s),70*(n+i+r)}noise3d(e,t,n){let i,r,a,o;var s=(e+t+n)*(1/3),l=Math.floor(e+s),u=Math.floor(t+s),s=Math.floor(n+s),c=(l+u+s)*(1/6),e=e-(l-c),t=t-(u-c),n=n-(s-c);let h,d,p,f,m,g;g=t<=e?n<=t?(h=1,d=0,p=0,f=1,m=1,0):(m=(f=(p=n<=e?(h=1,d=0):(h=0,d=0,1),1),0),1):t<n?(h=0,d=0,p=1,f=0,m=1):e<n?(h=0,d=1,p=0,f=0,m=1):(h=0,d=1,p=0,f=1,m=1,0);var c=e-h+1/6,v=t-d+1/6,_=n-p+1/6,y=e-f+1/6*2,E=t-m+1/6*2,A=n-g+1/6*2,x=e-1+.5,T=t-1+.5,S=n-1+.5,l=255&l,u=255&u,s=255&s,w=this.perm[l+this.perm[u+this.perm[s]]]%12,b=this.perm[l+h+this.perm[u+d+this.perm[s+p]]]%12,M=this.perm[l+f+this.perm[u+m+this.perm[s+g]]]%12,l=this.perm[1+l+this.perm[1+u+this.perm[1+s]]]%12,u=.6-e*e-t*t-n*n,s=(i=u<0?0:(u*=u)*u*this.dot3(this.grad3[w],e,t,n),.6-c*c-v*v-_*_),u=(r=s<0?0:(s*=s)*s*this.dot3(this.grad3[b],c,v,_),.6-y*y-E*E-A*A),w=(a=u<0?0:(u*=u)*u*this.dot3(this.grad3[M],y,E,A),.6-x*x-T*T-S*S);return o=w<0?0:(w*=w)*w*this.dot3(this.grad3[l],x,T,S),32*(i+r+a+o)}noise4d(e,t,n,i){var r=this.grad4,a=this.simplex,o=this.perm,s=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;let U,B,F,z,k;var s=(e+t+n+i)*s,u=Math.floor(e+s),c=Math.floor(t+s),h=Math.floor(n+s),s=Math.floor(i+s),d=(u+c+h+s)*l,e=e-(u-d),t=t-(c-d),n=n-(h-d),i=i-(s-d),d=(t<e?32:0)+(n<e?16:0)+(n<t?8:0)+(i<e?4:0)+(i<t?2:0)+(i<n?1:0),p=3<=a[d][0]?1:0,f=3<=a[d][1]?1:0,m=3<=a[d][2]?1:0,g=3<=a[d][3]?1:0,v=2<=a[d][0]?1:0,_=2<=a[d][1]?1:0,y=2<=a[d][2]?1:0,E=2<=a[d][3]?1:0,A=1<=a[d][0]?1:0,G=1<=a[d][1]?1:0,H=1<=a[d][2]?1:0,a=1<=a[d][3]?1:0,d=e-p+l,x=t-f+l,T=n-m+l,S=i-g+l,w=e-v+2*l,b=t-_+2*l,M=n-y+2*l,R=i-E+2*l,N=e-A+3*l,I=t-G+3*l,C=n-H+3*l,L=i-a+3*l,D=e-1+4*l,O=t-1+4*l,P=n-1+4*l,l=i-1+4*l,u=255&u,c=255&c,h=255&h,s=255&s,V=o[u+o[c+o[h+o[s]]]]%32,p=o[u+p+o[c+f+o[h+m+o[s+g]]]]%32,f=o[u+v+o[c+_+o[h+y+o[s+E]]]]%32,m=o[u+A+o[c+G+o[h+H+o[s+a]]]]%32,g=o[1+u+o[1+c+o[1+h+o[1+s]]]]%32,v=.6-e*e-t*t-n*n-i*i,_=(U=v<0?0:(v*=v)*v*this.dot4(r[V],e,t,n,i),.6-d*d-x*x-T*T-S*S),y=(B=_<0?0:(_*=_)*_*this.dot4(r[p],d,x,T,S),.6-w*w-b*b-M*M-R*R),E=(F=y<0?0:(y*=y)*y*this.dot4(r[f],w,b,M,R),.6-N*N-I*I-C*C-L*L),A=(z=E<0?0:(E*=E)*E*this.dot4(r[m],N,I,C,L),.6-D*D-O*O-P*P-l*l);return k=A<0?0:(A*=A)*A*this.dot4(r[g],D,O,P,l),27*(U+B+F+z+k)}}class gw extends Ad{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};super(),this.type="LightningStrike",this.init(gw.copyParameters(e,e)),this.createMesh()}static createRandomGenerator(){let t=[];for(let e=0;e<2053;e++)t.push(Math.random());let n={currentSeed:0,random:function(){var e=t[n.currentSeed];return n.currentSeed=(n.currentSeed+1)%2053,e},getSeed:function(){return n.currentSeed/2053},setSeed:function(e){n.currentSeed=Math.floor(2053*e)%2053}};return n}static copyParameters(){let t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};function e(e){return n===t?e:e.clone()}return t.sourceOffset=void 0!==n.sourceOffset?e(n.sourceOffset):new dd(0,100,0),t.destOffset=void 0!==n.destOffset?e(n.destOffset):new dd(0,0,0),t.timeScale=void 0!==n.timeScale?n.timeScale:1,t.roughness=void 0!==n.roughness?n.roughness:.9,t.straightness=void 0!==n.straightness?n.straightness:.7,t.up0=void 0!==n.up0?e(n.up0):new dd(0,0,1),t.up1=void 0!==n.up1?e(n.up1):new dd(0,0,1),t.radius0=void 0!==n.radius0?n.radius0:1,t.radius1=void 0!==n.radius1?n.radius1:1,t.radius0Factor=void 0!==n.radius0Factor?n.radius0Factor:.5,t.radius1Factor=void 0!==n.radius1Factor?n.radius1Factor:.2,t.minRadius=void 0!==n.minRadius?n.minRadius:.2,t.isEternal=void 0!==n.isEternal?n.isEternal:void 0===n.birthTime||void 0===n.deathTime,t.birthTime=n.birthTime,t.deathTime=n.deathTime,t.propagationTimeFactor=void 0!==n.propagationTimeFactor?n.propagationTimeFactor:.1,t.vanishingTimeFactor=void 0!==n.vanishingTimeFactor?n.vanishingTimeFactor:.9,t.subrayPeriod=void 0!==n.subrayPeriod?n.subrayPeriod:4,t.subrayDutyCycle=void 0!==n.subrayDutyCycle?n.subrayDutyCycle:.6,t.maxIterations=void 0!==n.maxIterations?n.maxIterations:9,t.isStatic=void 0!==n.isStatic&&n.isStatic,t.ramification=void 0!==n.ramification?n.ramification:5,t.maxSubrayRecursion=void 0!==n.maxSubrayRecursion?n.maxSubrayRecursion:3,t.recursionProbability=void 0!==n.recursionProbability?n.recursionProbability:.6,t.generateUVs=void 0!==n.generateUVs&&n.generateUVs,t.randomGenerator=n.randomGenerator,t.noiseSeed=n.noiseSeed,t.onDecideSubrayCreation=n.onDecideSubrayCreation,t.onSubrayCreation=n.onSubrayCreation,t}update(e){this.isStatic||(this.rayParameters.isEternal||this.rayParameters.birthTime<=e&&e<=this.rayParameters.deathTime?(this.updateMesh(e),e<this.subrays[0].endPropagationTime?this.state=gw.RAY_PROPAGATING:e>this.subrays[0].beginVanishingTime?this.state=gw.RAY_VANISHING:this.state=gw.RAY_STEADY,this.visible=!0):(this.visible=!1,e<this.rayParameters.birthTime?this.state=gw.RAY_UNBORN:this.state=gw.RAY_EXTINGUISHED))}init(e){this.rayParameters=e,this.maxIterations=void 0!==e.maxIterations?Math.floor(e.maxIterations):9,e.maxIterations=this.maxIterations,this.isStatic=void 0!==e.isStatic&&e.isStatic,e.isStatic=this.isStatic,this.ramification=void 0!==e.ramification?Math.floor(e.ramification):5,e.ramification=this.ramification,this.maxSubrayRecursion=void 0!==e.maxSubrayRecursion?Math.floor(e.maxSubrayRecursion):3,e.maxSubrayRecursion=this.maxSubrayRecursion,this.recursionProbability=void 0!==e.recursionProbability?e.recursionProbability:.6,e.recursionProbability=this.recursionProbability,this.generateUVs=void 0!==e.generateUVs&&e.generateUVs,e.generateUVs=this.generateUVs,void 0!==e.randomGenerator?(this.randomGenerator=e.randomGenerator,this.seedGenerator=e.randomGenerator,void 0!==e.noiseSeed&&this.seedGenerator.setSeed(e.noiseSeed)):(this.randomGenerator=gw.createRandomGenerator(),this.seedGenerator=Math),void 0!==e.onDecideSubrayCreation?this.onDecideSubrayCreation=e.onDecideSubrayCreation:(this.createDefaultSubrayCreationCallbacks(),void 0!==e.onSubrayCreation&&(this.onSubrayCreation=e.onSubrayCreation)),this.state=gw.RAY_INITIALIZED,this.maxSubrays=Math.ceil(1+Math.pow(this.ramification,Math.max(0,this.maxSubrayRecursion-1))),e.maxSubrays=this.maxSubrays,this.maxRaySegments=2*(1<<this.maxIterations),this.subrays=[];for(let e=0;e<this.maxSubrays;e++)this.subrays.push(this.createSubray());this.raySegments=[];for(let e=0;e<this.maxRaySegments;e++)this.raySegments.push(this.createSegment());this.time=0,this.timeFraction=0,this.currentSegmentCallback=null,this.currentCreateTriangleVertices=this.generateUVs?this.createTriangleVerticesWithUVs:this.createTriangleVerticesWithoutUVs,this.numSubrays=0,this.currentSubray=null,this.currentSegmentIndex=0,this.isInitialSegment=!1,this.subrayProbability=0,this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.vertices=null,this.uvs=null,this.indices=null,this.positionAttribute=null,this.uvsAttribute=null,this.simplexX=new mw(this.seedGenerator),this.simplexY=new mw(this.seedGenerator),this.simplexZ=new mw(this.seedGenerator),this.forwards=new dd,this.forwardsFill=new dd,this.side=new dd,this.down=new dd,this.middlePos=new dd,this.middleLinPos=new dd,this.newPos=new dd,this.vPos=new dd,this.cross1=new dd}createMesh(){var e=1<<this.maxIterations,t=3*(1+e)*this.maxSubrays,e=18*e*this.maxSubrays;this.vertices=new Float32Array(3*t),this.indices=new Uint32Array(e),this.generateUVs&&(this.uvs=new Float32Array(2*t)),this.fillMesh(0),this.setIndex(new hA(this.indices,1)),this.positionAttribute=new Ed(this.vertices,3),this.setAttribute("position",this.positionAttribute),this.generateUVs&&(this.uvsAttribute=new Ed(new Float32Array(this.uvs),2),this.setAttribute("uv",this.uvsAttribute)),this.isStatic||(this.index.usage=35048,this.positionAttribute.usage=35048,this.generateUVs&&(this.uvsAttribute.usage=35048)),this.vertices=this.positionAttribute.array,this.indices=this.index.array,this.generateUVs&&(this.uvs=this.uvsAttribute.array)}updateMesh(e){this.fillMesh(e),this.drawRange.count=this.currentIndex,this.index.needsUpdate=!0,this.positionAttribute.needsUpdate=!0,this.generateUVs&&(this.uvsAttribute.needsUpdate=!0)}fillMesh(n){let i=this;this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.fractalRay(n,function(e){var t=i.currentSubray;n<t.birthTime||(this.rayParameters.isEternal&&0==i.currentSubray.recursion?(i.createPrism(e),i.onDecideSubrayCreation(e,i)):n<t.endPropagationTime?i.timeFraction>=e.fraction0*t.propagationTimeFactor&&(i.createPrism(e),i.onDecideSubrayCreation(e,i)):((n<t.beginVanishingTime||i.timeFraction<=t.vanishingTimeFactor+e.fraction1*(1-t.vanishingTimeFactor))&&i.createPrism(e),i.onDecideSubrayCreation(e,i)))})}addNewSubray(){return this.subrays[this.numSubrays++]}initSubray(e,t){e.pos0.copy(t.sourceOffset),e.pos1.copy(t.destOffset),e.up0.copy(t.up0),e.up1.copy(t.up1),e.radius0=t.radius0,e.radius1=t.radius1,e.birthTime=t.birthTime,e.deathTime=t.deathTime,e.timeScale=t.timeScale,e.roughness=t.roughness,e.straightness=t.straightness,e.propagationTimeFactor=t.propagationTimeFactor,e.vanishingTimeFactor=t.vanishingTimeFactor,e.maxIterations=this.maxIterations,e.seed=void 0!==t.noiseSeed?t.noiseSeed:0,e.recursion=0}fractalRay(t,e){this.time=t,this.currentSegmentCallback=e,this.numSubrays=0,this.initSubray(this.addNewSubray(),this.rayParameters);for(let e=0;e<this.numSubrays;e++){var n=this.subrays[e],i=(this.currentSubray=n,this.randomGenerator.setSeed(n.seed),n.endPropagationTime=fn.lerp(n.birthTime,n.deathTime,n.propagationTimeFactor),n.beginVanishingTime=fn.lerp(n.deathTime,n.birthTime,1-n.vanishingTimeFactor),this.randomGenerator.random),i=(n.linPos0.set(i(),i(),i()).multiplyScalar(1e3),n.linPos1.set(i(),i(),i()).multiplyScalar(1e3),this.timeFraction=(t-n.birthTime)/(n.deathTime-n.birthTime),this.currentSegmentIndex=0,this.isInitialSegment=!0,this.getNewSegment());i.iteration=0,i.pos0.copy(n.pos0),i.pos1.copy(n.pos1),i.linPos0.copy(n.linPos0),i.linPos1.copy(n.linPos1),i.up0.copy(n.up0),i.up1.copy(n.up1),i.radius0=n.radius0,i.radius1=n.radius1,i.fraction0=0,i.fraction1=1,i.positionVariationFactor=1-n.straightness,this.subrayProbability=this.ramification*Math.pow(this.recursionProbability,n.recursion)/(1<<n.maxIterations),this.fractalRayRecursive(i)}this.currentSegmentCallback=null,this.currentSubray=null}fractalRayRecursive(t){if(t.iteration>=this.currentSubray.maxIterations)this.currentSegmentCallback(t);else{this.forwards.subVectors(t.pos1,t.pos0);let e=this.forwards.length();e<1e-6&&(this.forwards.set(0,0,.01),e=this.forwards.length());var n=.5*(t.radius0+t.radius1),i=.5*(t.fraction0+t.fraction1),r=this.time*this.currentSubray.timeScale*Math.pow(2,t.iteration),a=(this.middlePos.lerpVectors(t.pos0,t.pos1,.5),this.middleLinPos.lerpVectors(t.linPos0,t.linPos1,.5),this.middleLinPos),a=(this.newPos.set(this.simplexX.noise4d(a.x,a.y,a.z,r),this.simplexY.noise4d(a.x,a.y,a.z,r),this.simplexZ.noise4d(a.x,a.y,a.z,r)),this.newPos.multiplyScalar(t.positionVariationFactor*e),this.newPos.add(this.middlePos),this.getNewSegment()),r=(a.pos0.copy(t.pos0),a.pos1.copy(this.newPos),a.linPos0.copy(t.linPos0),a.linPos1.copy(this.middleLinPos),a.up0.copy(t.up0),a.up1.copy(t.up1),a.radius0=t.radius0,a.radius1=n,a.fraction0=t.fraction0,a.fraction1=i,a.positionVariationFactor=t.positionVariationFactor*this.currentSubray.roughness,a.iteration=t.iteration+1,this.getNewSegment());r.pos0.copy(this.newPos),r.pos1.copy(t.pos1),r.linPos0.copy(this.middleLinPos),r.linPos1.copy(t.linPos1),this.cross1.crossVectors(t.up0,this.forwards.normalize()),r.up0.crossVectors(this.forwards,this.cross1).normalize(),r.up1.copy(t.up1),r.radius0=n,r.radius1=t.radius1,r.fraction0=i,r.fraction1=t.fraction1,r.positionVariationFactor=t.positionVariationFactor*this.currentSubray.roughness,r.iteration=t.iteration+1,this.fractalRayRecursive(a),this.fractalRayRecursive(r)}}createPrism(e){this.forwardsFill.subVectors(e.pos1,e.pos0).normalize(),this.isInitialSegment&&(this.currentCreateTriangleVertices(e.pos0,e.up0,this.forwardsFill,e.radius0,0),this.isInitialSegment=!1),this.currentCreateTriangleVertices(e.pos1,e.up0,this.forwardsFill,e.radius1,e.fraction1),this.createPrismFaces()}createTriangleVerticesWithoutUVs(e,t,n,i){this.side.crossVectors(t,n).multiplyScalar(i*gw.COS30DEG),this.down.copy(t).multiplyScalar(-i*gw.SIN30DEG);var n=this.vPos,r=this.vertices;n.copy(e).sub(this.side).add(this.down),r[this.currentCoordinate++]=n.x,r[this.currentCoordinate++]=n.y,r[this.currentCoordinate++]=n.z,n.copy(e).add(this.side).add(this.down),r[this.currentCoordinate++]=n.x,r[this.currentCoordinate++]=n.y,r[this.currentCoordinate++]=n.z,n.copy(t).multiplyScalar(i).add(e),r[this.currentCoordinate++]=n.x,r[this.currentCoordinate++]=n.y,r[this.currentCoordinate++]=n.z,this.currentVertex+=3}createTriangleVerticesWithUVs(e,t,n,i,r){this.side.crossVectors(t,n).multiplyScalar(i*gw.COS30DEG),this.down.copy(t).multiplyScalar(-i*gw.SIN30DEG);var n=this.vPos,a=this.vertices,o=this.uvs;n.copy(e).sub(this.side).add(this.down),a[this.currentCoordinate++]=n.x,a[this.currentCoordinate++]=n.y,a[this.currentCoordinate++]=n.z,o[this.currentUVCoordinate++]=r,o[this.currentUVCoordinate++]=0,n.copy(e).add(this.side).add(this.down),a[this.currentCoordinate++]=n.x,a[this.currentCoordinate++]=n.y,a[this.currentCoordinate++]=n.z,o[this.currentUVCoordinate++]=r,o[this.currentUVCoordinate++]=.5,n.copy(t).multiplyScalar(i).add(e),a[this.currentCoordinate++]=n.x,a[this.currentCoordinate++]=n.y,a[this.currentCoordinate++]=n.z,o[this.currentUVCoordinate++]=r,o[this.currentUVCoordinate++]=1,this.currentVertex+=3}createPrismFaces(e){var t=this.indices;e=this.currentVertex-6,t[this.currentIndex++]=1+e,t[this.currentIndex++]=2+e,t[this.currentIndex++]=5+e,t[this.currentIndex++]=1+e,t[this.currentIndex++]=5+e,t[this.currentIndex++]=4+e,t[this.currentIndex++]=e,t[this.currentIndex++]=1+e,t[this.currentIndex++]=4+e,t[this.currentIndex++]=e,t[this.currentIndex++]=4+e,t[this.currentIndex++]=3+e,t[this.currentIndex++]=2+e,t[this.currentIndex++]=e,t[this.currentIndex++]=3+e,t[this.currentIndex++]=2+e,t[this.currentIndex++]=3+e,t[this.currentIndex++]=5+e}createDefaultSubrayCreationCallbacks(){let h=this.randomGenerator.random,o=(this.onDecideSubrayCreation=function(e,t){var n,i=t.currentSubray,r=t.rayParameters.subrayPeriod,a=t.rayParameters.subrayDutyCycle,o=t.rayParameters.isEternal&&0==i.recursion?-h()*r:fn.lerp(i.birthTime,i.endPropagationTime,e.fraction0)-h()*r,s=t.time-o,l=Math.floor(s/r),u=h()*(l+1);let c=0;s%r<=a*r&&(c=t.subrayProbability),i.recursion<t.maxSubrayRecursion&&t.numSubrays<t.maxSubrays&&h()<c&&(s=t.addNewSubray(),n=t.randomGenerator.getSeed(),s.seed=u,t.randomGenerator.setSeed(u),s.recursion=i.recursion+1,s.maxIterations=Math.max(1,i.maxIterations-1),s.linPos0.set(h(),h(),h()).multiplyScalar(1e3),s.linPos1.set(h(),h(),h()).multiplyScalar(1e3),s.up0.copy(i.up0),s.up1.copy(i.up1),s.radius0=e.radius0*t.rayParameters.radius0Factor,s.radius1=Math.min(t.rayParameters.minRadius,e.radius1*t.rayParameters.radius1Factor),s.birthTime=o+l*r,s.deathTime=s.birthTime+r*a,t.rayParameters.isEternal||0!=i.recursion||(s.birthTime=Math.max(s.birthTime,i.birthTime),s.deathTime=Math.min(s.deathTime,i.deathTime)),s.timeScale=2*i.timeScale,s.roughness=i.roughness,s.straightness=i.straightness,s.propagationTimeFactor=i.propagationTimeFactor,s.vanishingTimeFactor=i.vanishingTimeFactor,t.onSubrayCreation(e,i,s,t),t.randomGenerator.setSeed(n))},new dd),s=new dd,l=new dd,u=new dd;this.onSubrayCreation=function(e,t,n,i){i.subrayCylinderPosition(e,t,n,.5,.6,.2)},this.subrayConePosition=function(e,t,n,i,r,a){n.pos0.copy(e.pos0),o.subVectors(t.pos1,t.pos0),s.copy(o).normalize(),o.multiplyScalar(e.fraction0+(1-e.fraction0)*(h()*i));e=o.length(),l.crossVectors(t.up0,s),i=2*Math.PI*h();l.multiplyScalar(Math.cos(i)),u.copy(t.up0).multiplyScalar(Math.sin(i)),n.pos1.copy(l).add(u).multiplyScalar(e*r*(a+h()*(1-a))).add(o).add(t.pos0)},this.subrayCylinderPosition=function(e,t,n,i,r,a){n.pos0.copy(e.pos0),o.subVectors(t.pos1,t.pos0),s.copy(o).normalize(),o.multiplyScalar(e.fraction0+(1-e.fraction0)*((2*h()-1)*i));e=o.length(),l.crossVectors(t.up0,s),i=2*Math.PI*h();l.multiplyScalar(Math.cos(i)),u.copy(t.up0).multiplyScalar(Math.sin(i)),n.pos1.copy(l).add(u).multiplyScalar(e*r*(a+h()*(1-a))).add(o).add(t.pos0)}}createSubray(){return{seed:0,maxIterations:0,recursion:0,pos0:new dd,pos1:new dd,linPos0:new dd,linPos1:new dd,up0:new dd,up1:new dd,radius0:0,radius1:0,birthTime:0,deathTime:0,timeScale:0,roughness:0,straightness:0,propagationTimeFactor:0,vanishingTimeFactor:0,endPropagationTime:0,beginVanishingTime:0}}createSegment(){return{iteration:0,pos0:new dd,pos1:new dd,linPos0:new dd,linPos1:new dd,up0:new dd,up1:new dd,radius0:0,radius1:0,fraction0:0,fraction1:0,positionVariationFactor:0}}getNewSegment(){return this.raySegments[this.currentSegmentIndex++]}copy(e){return super.copy(e),this.init(gw.copyParameters({},e.rayParameters)),this}clone(){return new this.constructor(gw.copyParameters({},this.rayParameters))}}gw.prototype.isLightningStrike=!0,gw.RAY_INITIALIZED=0,gw.RAY_UNBORN=1,gw.RAY_PROPAGATING=2,gw.RAY_STEADY=3,gw.RAY_VANISHING=4,gw.RAY_EXTINGUISHED=5,gw.COS30DEG=Math.cos(30*Math.PI/180),gw.SIN30DEG=Math.sin(30*Math.PI/180);let bh={sourceOffset:new dd,destOffset:new dd,radius0:.001,radius1:.001,minRadius:25,maxIterations:7,isEternal:!0,timeScale:.7,propagationTimeFactor:.05,vanishingTimeFactor:.95,subrayPeriod:2.5,subrayDutyCycle:.3,maxSubrayRecursion:3,ramification:7,recursionProbability:.6,roughness:.85,straightness:.68},Mh={sourceOffset:new dd,destOffset:new dd,radius0:.001,radius1:.001,minRadius:25,maxIterations:7,isEternal:!0,timeScale:.7,propagationTimeFactor:.05,vanishingTimeFactor:.95,subrayPeriod:2.5,subrayDutyCycle:.3,maxSubrayRecursion:3,ramification:7,recursionProbability:.6,roughness:.85,straightness:.68},Rh={sourceOffset:new dd,destOffset:new dd,radius0:.001,radius1:.001,minRadius:25,maxIterations:7,isEternal:!0,timeScale:.7,propagationTimeFactor:.05,vanishingTimeFactor:.95,subrayPeriod:2.5,subrayDutyCycle:.3,maxSubrayRecursion:3,ramification:7,recursionProbability:.6,roughness:.85,straightness:.68},Nh,Ih,Ch,Lh,Dh,Oh,Ph=0;class vw{constructor(e,t,n){this.id=0,this.name=e,this.fg=t,this.bg=n,this.gradient=null,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=90*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=84*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.width="90px",this.canvas.style.height="48px",this.canvas.style.position="absolute",this.canvas.style.cssText="width:90px;height:48px;background-color: transparent !important;",this.context=this.canvas.getContext("2d"),this.initializeCanvas()}createGradient(){if(!this.context)throw new Error("No context");var e=this.context.createLinearGradient(0,this.GRAPH_Y,0,this.GRAPH_Y+this.GRAPH_HEIGHT);let t;var n=this.fg;switch(this.fg.toLowerCase()){case"#0ff":t="#006666";break;case"#0f0":t="#006600";break;case"#ff0":t="#666600";break;case"#e1e1e1":t="#666666";break;default:t=this.bg}return e.addColorStop(0,t),e.addColorStop(1,n),e}initializeCanvas(){this.context&&(this.context.imageSmoothingEnabled=!1,this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.gradient=this.createGradient(),this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=this.fg,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT))}update(e,t){var n,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;this.context&&this.gradient&&(n=Math.min(1/0,e),t=Math.max(t,e),this.context.globalAlpha=1,this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(`${e.toFixed(i)} ${this.name} (${n.toFixed(i)}-${parseFloat(t.toFixed(i))})`,this.TEXT_X,this.TEXT_Y))}updateGraph(e,t){var n,i,r,a,o;this.context&&this.gradient&&(0===e&&0===t&&(t=1),t=Math.max(t,e,.1),e=Math.max(e,0),n=Math.round(this.GRAPH_X),i=Math.round(this.GRAPH_Y),r=Math.round(this.GRAPH_WIDTH),a=Math.round(this.GRAPH_HEIGHT),o=Math.round(this.PR),this.context.drawImage(this.canvas,n+o,i,r-o,a,n,i,r-o,a),this.context.fillStyle=this.bg,this.context.fillRect(n+r-o,i,o,a),0<(e=Math.min(a,Math.round(e/t*a)))&&(this.context.globalAlpha=.9,this.context.fillStyle=this.gradient,this.context.fillRect(n+r-o,i+(a-e),o,e)),this.context.globalAlpha=1)}}class _w extends vw{constructor(e,t,n){super(e,t,n),this.vsyncValue=0,this.SMALL_HEIGHT=9*this.PR,this.HEIGHT=this.SMALL_HEIGHT,this.WIDTH=35*this.PR,this.TEXT_Y=0*this.PR,this.canvas.height=this.HEIGHT,this.canvas.width=this.WIDTH,this.canvas.style.height="9px",this.canvas.style.width="35px",this.canvas.style.cssText=`
            width: 35px;
            height: 9px;
            position: absolute;
            top: 0;
            left: 0;
            background-color: transparent !important;
            pointer-events: none;
        `,this.initializeCanvas()}initializeCanvas(){this.context&&(this.context.imageSmoothingEnabled=!1,this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.globalAlpha=1)}update(e,t){this.context&&(this.vsyncValue=e,this.context.clearRect(0,0,this.WIDTH,this.HEIGHT),this.context.globalAlpha=1,this.context.fillStyle=this.bg,this.context.fillText(e.toFixed(0)+"Hz",this.TEXT_X,this.TEXT_Y))}updateGraph(e,t){}setOffset(e,t){this.canvas.style.transform=`translate(${e}px, ${t}px)`}}($h=class Aw{constructor(){var{trackGPU:e=!1,trackCPT:t=!1,trackHz:n=!1,logsPerSecond:i=4,graphsPerSecond:r=30,samplesLog:a=40,samplesGraph:o=10,precision:s=2,minimal:l=!1,horizontal:u=!0,mode:c=0}=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},c=(this.gl=null,this.ext=null,this.activeQuery=null,this.gpuQueries=[],this.threeRendererPatched=!1,this.frameTimes=[],this.renderCount=0,this.totalCpuDuration=0,this.totalGpuDuration=0,this.totalGpuDurationCompute=0,this.gpuPanel=null,this.gpuPanelCompute=null,this.vsyncPanel=null,this.averageFps={logs:[],graph:[]},this.averageCpu={logs:[],graph:[]},this.averageGpu={logs:[],graph:[]},this.averageGpuCompute={logs:[],graph:[]},this.updateCounter=0,this.lastMin={},this.lastMax={},this.lastValue={},this.VSYNC_RATES=[{refreshRate:60,frameTime:16.67},{refreshRate:75,frameTime:13.33},{refreshRate:90,frameTime:11.11},{refreshRate:120,frameTime:8.33},{refreshRate:144,frameTime:6.94},{refreshRate:165,frameTime:6.06},{refreshRate:240,frameTime:4.17}],this.detectedVSync=null,this.frameTimeHistory=[],this.HISTORY_SIZE=120,this.VSYNC_THRESHOLD=.05,this.lastFrameTime=0,this.handleClick=e=>{e.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)},this.handleResize=()=>{this.resizePanel(this.fpsPanel),this.resizePanel(this.msPanel),this.gpuPanel&&this.resizePanel(this.gpuPanel),this.gpuPanelCompute&&this.resizePanel(this.gpuPanelCompute)},this.mode=c,this.horizontal=u,this.minimal=l,this.trackGPU=e,this.trackCPT=t,this.trackHz=n,this.samplesLog=a,this.samplesGraph=o,this.precision=s,this.logsPerSecond=i,this.graphsPerSecond=r,performance.now());this.prevGraphTime=c,this.dom=document.createElement("div"),this.initializeDOM(),this.beginTime=performance.now(),this.prevTextTime=this.beginTime,this.prevCpuTime=this.beginTime,this._panelId=0,this.fpsPanel=this.addPanel(new Aw.Panel("FPS","#0ff","#002")),this.msPanel=this.addPanel(new Aw.Panel("CPU","#0f0","#020")),!0===this.trackHz&&(this.vsyncPanel=new _w("","#f0f","#202"),this.dom.appendChild(this.vsyncPanel.canvas),this.vsyncPanel.setOffset(56,35)),this.setupEventListeners()}initializeDOM(){this.dom.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      opacity: 0.9;
      z-index: 10000;
      ${this.minimal?"cursor: pointer;":""}
    `}setupEventListeners(){this.minimal?(this.dom.addEventListener("click",this.handleClick),this.showPanel(this.mode)):window.addEventListener("resize",this.handleResize)}async init(e){e?this.handleThreeRenderer(e)||await this.handleWebGPURenderer(e)||(this.initializeWebGL(e)?this.trackGPU&&this.initializeGPUTracking():console.error("Stats-gl: Failed to initialize WebGL context")):console.error('Stats: The "canvas" parameter is undefined.')}handleThreeRenderer(e){return!(!e.isWebGLRenderer||this.threeRendererPatched||(this.patchThreeRenderer(e),this.gl=e.getContext(),this.trackGPU&&this.initializeGPUTracking(),0))}async handleWebGPURenderer(e){return!!e.isWebGPURenderer&&((this.trackGPU||this.trackCPT)&&(e.backend.trackTimestamp=!0,await e.hasFeatureAsync("timestamp-query"))&&this.initializeWebGPUPanels(),this.info=e.info,this.patchThreeWebGPU(e),!0)}initializeWebGPUPanels(){this.trackGPU&&(this.gpuPanel=this.addPanel(new Aw.Panel("GPU","#ff0","#220"))),this.trackCPT&&(this.gpuPanelCompute=this.addPanel(new Aw.Panel("CPT","#e1e1e1","#212121")))}initializeWebGL(e){if(e instanceof WebGL2RenderingContext)this.gl=e;else{if(!(e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas))return console.error("Stats: Invalid input type. Expected WebGL2RenderingContext, HTMLCanvasElement, or OffscreenCanvas."),!1;if(this.gl=e.getContext("webgl2"),!this.gl)return console.error("Stats: Unable to obtain WebGL2 context."),!1}return!0}initializeGPUTracking(){this.gl&&(this.ext=this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.ext)&&(this.gpuPanel=this.addPanel(new Aw.Panel("GPU","#ff0","#220")))}begin(){this.beginProfiling("cpu-started"),this.gl&&this.ext&&(this.activeQuery&&this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.activeQuery=this.gl.createQuery(),this.activeQuery)&&this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.activeQuery)}end(){this.renderCount++,this.gl&&this.ext&&this.activeQuery&&(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.gpuQueries.push({query:this.activeQuery}),this.activeQuery=null),this.endProfiling("cpu-started","cpu-finished","cpu-duration")}update(){this.endProfiling("cpu-started","cpu-finished","cpu-duration"),this.info?this.processWebGPUTimestamps():this.processGpuQueries(),this.updateAverages(),this.resetCounters()}processWebGPUTimestamps(){this.totalGpuDuration=this.info.render.timestamp,this.totalGpuDurationCompute=this.info.compute.timestamp}resetCounters(){this.renderCount=0,this.totalCpuDuration=0,this.beginTime=this.endInternal()}resizePanel(e){e.canvas.style.position="absolute",this.minimal?e.canvas.style.display="none":(e.canvas.style.display="block",this.horizontal?(e.canvas.style.top="0px",e.canvas.style.left=e.id*e.WIDTH/e.PR+"px"):(e.canvas.style.left="0px",e.canvas.style.top=e.id*e.HEIGHT/e.PR+"px"))}addPanel(e){return e.canvas&&(this.dom.appendChild(e.canvas),e.id=this._panelId,this.resizePanel(e),this._panelId++),e}showPanel(t){for(let e=0;e<this.dom.children.length;e++)this.dom.children[e].style.display=e===t?"block":"none";this.mode=t}processGpuQueries(){this.gl&&this.ext&&(this.totalGpuDuration=0,this.gpuQueries.forEach((e,t)=>{var n,i;this.gl&&(i=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT_AVAILABLE),n=this.gl.getParameter(this.ext.GPU_DISJOINT_EXT),i)&&!n&&(i=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT),this.totalGpuDuration+=1e-6*i,this.gl.deleteQuery(e.query),this.gpuQueries.splice(t,1))}))}detectVSync(e){if(0===this.lastFrameTime)this.lastFrameTime=e;else{var t=e-this.lastFrameTime;if(this.lastFrameTime=e,this.frameTimeHistory.push(t),this.frameTimeHistory.length>this.HISTORY_SIZE&&this.frameTimeHistory.shift(),!(this.frameTimeHistory.length<60)){let n=this.frameTimeHistory.reduce((e,t)=>e+t)/this.frameTimeHistory.length;e=this.frameTimeHistory.reduce((e,t)=>e+Math.pow(t-n,2),0)/this.frameTimeHistory.length;if(2<Math.sqrt(e))this.detectedVSync=null;else{let e=null,t=1/0;for(var i of this.VSYNC_RATES){var r=Math.abs(n-i.frameTime);r<t&&(t=r,e=i)}e&&t/e.frameTime<=this.VSYNC_THRESHOLD?this.detectedVSync=e:this.detectedVSync=null}}}}endInternal(){var e=performance.now();for(this.frameTimes.push(e);0<this.frameTimes.length&&this.frameTimes[0]<=e-1e3;)this.frameTimes.shift();var t=Math.round(this.frameTimes.length),t=(this.addToAverage(t,this.averageFps),e>=this.prevTextTime+1e3/this.logsPerSecond),n=e>=this.prevGraphTime+1e3/this.graphsPerSecond;return this.updatePanelComponents(this.fpsPanel,this.averageFps,0,t,n),this.updatePanelComponents(this.msPanel,this.averageCpu,this.precision,t,n),this.gpuPanel&&this.updatePanelComponents(this.gpuPanel,this.averageGpu,this.precision,t,n),this.trackCPT&&this.gpuPanelCompute&&this.updatePanelComponents(this.gpuPanelCompute,this.averageGpuCompute,this.precision,t,n),t&&(this.prevTextTime=e),n&&(this.prevGraphTime=e),null!==this.vsyncPanel&&(this.detectVSync(e),n=(null==(n=this.detectedVSync)?void 0:n.refreshRate)||0,t)&&0<n&&this.vsyncPanel.update(n,n),e}updatePanelComponents(e,t,n,i,r){var a;e&&0!==t.logs.length&&(e.name in this.lastMin||(this.lastMin[e.name]=1/0,this.lastMax[e.name]=0,this.lastValue[e.name]=0),a=t.logs[t.logs.length-1],this.lastMax[e.name]=Math.max(...t.logs),this.lastMin[e.name]=Math.min(this.lastMin[e.name],a),this.lastValue[e.name]=.7*this.lastValue[e.name]+.3*a,t=Math.max(Math.max(...t.logs),...t.graph.slice(-this.samplesGraph)),this.updateCounter++,i&&e.update(this.lastValue[e.name],this.lastMax[e.name],n),r)&&e.updateGraph(a,t)}beginProfiling(e){if(window.performance)try{window.performance.clearMarks(e),window.performance.mark(e)}catch(e){console.debug("Stats: Performance marking failed:",e)}}endProfiling(e,t,n){if(window.performance&&t&&e)try{0===window.performance.getEntriesByName(e,"mark").length&&this.beginProfiling(e),window.performance.clearMarks(t),window.performance.mark(t),window.performance.clearMeasures(n);var i=performance.measure(n,e,t);this.totalCpuDuration+=i.duration,window.performance.clearMarks(e),window.performance.clearMarks(t),window.performance.clearMeasures(n)}catch(e){console.debug("Stats: Performance measurement failed:",e)}}updatePanel(e,t){var n,i,r,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2;e&&0!==t.logs.length&&(n=performance.now(),e.name in this.lastMin||(this.lastMin[e.name]=1/0,this.lastMax[e.name]=0,this.lastValue[e.name]=0),i=t.logs[t.logs.length-1],r=Math.max(...t.logs.slice(-30)),this.lastMin[e.name]=Math.min(this.lastMin[e.name],i),this.lastMax[e.name]=Math.max(this.lastMax[e.name],i),this.lastValue[e.name]=.7*this.lastValue[e.name]+.3*i,t=Math.max(r,...t.graph.slice(-this.samplesGraph)),this.updateCounter++,this.updateCounter%(2*this.logsPerSecond)==0&&(this.lastMax[e.name]=r,this.lastMin[e.name]=i),e.update)&&(n>=this.prevCpuTime+1e3/this.logsPerSecond&&e.update(this.lastValue[e.name],i,this.lastMax[e.name],t,a),n>=this.prevGraphTime+1e3/this.graphsPerSecond)&&(e.updateGraph(i,t),this.prevGraphTime=n)}updateAverages(){this.addToAverage(this.totalCpuDuration,this.averageCpu),this.addToAverage(this.totalGpuDuration,this.averageGpu),this.info&&void 0!==this.totalGpuDurationCompute&&this.addToAverage(this.totalGpuDurationCompute,this.averageGpuCompute)}addToAverage(e,t){t.logs.push(e),t.logs.length>this.samplesLog&&(t.logs=t.logs.slice(-this.samplesLog)),t.graph.push(e),t.graph.length>this.samplesGraph&&(t.graph=t.graph.slice(-this.samplesGraph))}get domElement(){return this.dom}patchThreeWebGPU(e){let t=e.info.reset,n=this;e.info.reset=function(){n.beginProfiling("cpu-started"),t.call(this)}}patchThreeRenderer(e){let n=e.render,i=this;e.render=function(e,t){i.begin(),n.call(this,e,t),i.end()},this.threeRendererPatched=!0}}).Panel=vw,Qh=$h;class yw extends BA{constructor(){super();var e=new dA,t=(e.deleteAttribute("uv"),new Ox({side:Ge})),n=new Ox,i=new aT(16777215,900,28,2),i=(i.position.set(.418,16.199,.3),this.add(i),new xd(e,t)),t=(i.position.set(-.757,13.219,.717),i.scale.set(31.713,28.305,28.591),this.add(i),new xd(e,n)),i=(t.position.set(-10.906,2.009,1.846),t.rotation.set(0,-.195,0),t.scale.set(2.328,7.905,4.651),this.add(t),new xd(e,n)),t=(i.position.set(-5.607,-.754,-.758),i.rotation.set(0,.994,0),i.scale.set(1.97,1.534,3.955),this.add(i),new xd(e,n)),i=(t.position.set(6.167,.857,7.803),t.rotation.set(0,.561,0),t.scale.set(3.927,6.285,3.687),this.add(t),new xd(e,n)),t=(i.position.set(-2.017,.018,6.124),i.rotation.set(0,.333,0),i.scale.set(2.002,4.566,2.064),this.add(i),new xd(e,n)),i=(t.position.set(2.291,-.756,-2.621),t.rotation.set(0,-.286,0),t.scale.set(1.546,1.552,1.496),this.add(t),new xd(e,n)),t=(i.position.set(-2.193,-.369,-5.547),i.rotation.set(0,.516,0),i.scale.set(3.875,3.487,2.986),this.add(i),new xd(e,N1(50))),n=(t.position.set(-16.116,14.37,8.208),t.scale.set(.1,2.428,2.739),this.add(t),new xd(e,N1(50))),i=(n.position.set(-16.109,18.021,-8.207),n.scale.set(.1,2.425,2.751),this.add(n),new xd(e,N1(17))),t=(i.position.set(14.904,12.198,-1.832),i.scale.set(.15,4.265,6.331),this.add(i),new xd(e,N1(43))),n=(t.position.set(-.462,8.89,14.52),t.scale.set(4.38,5.441,.088),this.add(t),new xd(e,N1(20))),i=(n.position.set(3.235,11.486,-12.541),n.scale.set(2.5,2,.1),this.add(n),new xd(e,N1(100)));i.position.set(0,20,0),i.scale.set(1,.1,1),this.add(i)}dispose(){let t=new Set;this.traverse(e=>{e.isMesh&&(t.add(e.geometry),t.add(e.material))});for(var e of t)e.dispose()}}function N1(e){var t=new _d;return t.color.setScalar(e),t}var I1=0;let Uh,Bh,Fh=new dT,zh=new dT,kh=new dT,Gh=0,Hh=0,Vh=performance.now();var C1=0;let Wh,jh=new yA;function L1(){nd.ROOM.name="ROOM",nd.ITEMS_ADDED.name="ITEMS",nd.CUBES.name="CUBES",nd.SCENE_CHILDREN.add(nd.LINES),nd.SCENE_CHILDREN.add(nd.ROOM),nd.SCENE_CHILDREN.add(nd.ITEMS_ADDED),nd.ROOM.add(nd.CUBES),nd.SCENE_CHILDREN.add(nd.ITEM_CUBE),nd.SCENE.add(nd.GUN_GROUP),nd.SCENE.add(nd.DEBUGGER_GROUP),nd.SCENE.add(nd.MAIN_CAMERA_GROUP),nd.MAIN_CAMERA_GROUP.add(nd.MAIN_CAMERA),nd.PIVOT=nd.MAIN_CAMERA,nd.LIGHT_GROUP=new Qc,nd.LIGHT_GROUP.name="LIGHT_GROUP",Uh=new xA(nd.RENDERER);var e=new yw(nd.RENDERER),e=Uh.fromScene(e).texture;nd.SCENE.environment=e,(nd.ENV_MAP=e).dispose(),Uh.dispose(),TE(),nd.MATERIAL_FLOOR_NON_PORTAL=new Ox,mg(nd.MATERIAL_FLOOR_NON_PORTAL,"metal/floor.jpg","metal/floor_normal.jpg",null,null,null,null,.7,0,.2,0,null,null),nd.MATERIAL_FLOOR_PORTAL=nd.MATERIAL_FLOOR_NON_PORTAL.clone(),mg(nd.MATERIAL_FLOOR_PORTAL,"portal/floor.jpg","portal/floor_normal.jpg",null,null,null,null,1,0,.2,0,null,null),nd.MATERIAL_WALL_PORTAL=new Ox,mg(nd.MATERIAL_WALL_PORTAL,"portal/wall1.jpg","portal/wall1_normal.jpg",null,null,null,null,1,0,.2,0,null,null),nd.MATERIAL_WALL_PORTAL2=new Ox,mg(nd.MATERIAL_WALL_PORTAL2,"portal/wall2.jpg","portal/wall2_normal.jpg",null,null,null,null,1,0,.2,0,null,null),nd.MATERIAL_WALL_PORTAL3=new Ox,mg(nd.MATERIAL_WALL_PORTAL3,"portal/wall3.jpg","portal/wall3_normal.jpg",null,null,null,null,1,0,.2,0,null,null),nd.MATERIAL_WALL_PORTAL4=new Ox,mg(nd.MATERIAL_WALL_PORTAL4,"portal/wall4.jpg","portal/wall4_normal.jpg",null,null,null,null,1,0,.2,0,null,null),nd.MATERIAL_WALL_NON_PORTAL=nd.MATERIAL_WALL_PORTAL.clone(),mg(nd.MATERIAL_WALL_NON_PORTAL,"metal/wall1.jpg","metal/wall1_normal.jpg",null,null,null,null,1,0,.2,0,null,null),nd.MATERIAL_WALL_NON_PORTAL2=nd.MATERIAL_WALL_PORTAL.clone(),mg(nd.MATERIAL_WALL_NON_PORTAL2,"metal/wall2.jpg","metal/wall2_normal.jpg",null,null,null,null,1,0,.2,0,null,null),nd.MATERIAL_GRID=new Ox({side:2}),mg(nd.MATERIAL_GRID,"wall/grid/1K_chain_1_basecolor.png","wall/grid/1K_chain_1_normal.png","wall/grid/1K_chain_1_ambientocclusion.png",null,null,"wall/grid/1K_chain_1_opacity.png",.25,1,.5,.5,100,100),nd.MATERIAL_GLASS=new Ox({transparent:!0,opacity:.5,side:2,depthWrite:!1}),mg(nd.MATERIAL_GLASS,"wall/glass/Image_8.png","wall/glass/normal.png",null,null,null,null,.1,0,.8,0,null,null),window.addEventListener("resize",D1),Nh=new gw(bh),Lh=new xd(Nh,new _d({color:new vd(2,2,2)})),Ih=new gw(Mh),Dh=new xd(Ih,new _d({color:new vd(2,2,2)})),Ch=new gw(Rh),Oh=new xd(Ch,new _d({color:new vd(2,2,2)})),(nd.LIGHTNIN_STRIKE_1=Lh).visible=!1,(nd.LIGHTNIN_STRIKE_2=Dh).visible=!1,(nd.LIGHTNIN_STRIKE_3=Oh).visible=!1,nd.LIGHTNIN_STRIKE_1.scale.set(1,1,1),nd.LIGHTNIN_STRIKE_2.scale.set(1,1,1),nd.LIGHTNIN_STRIKE_3.scale.set(1,1,1),Lh.layers.mask=2,Dh.layers.mask=2,Oh.layers.mask=2,nd.RENDERER.setAnimationLoop(O1)}function D1(){window.canvasWidth=Math.min(window.innerWidth,1920),window.canvasHeight=Math.min(window.innerHeight,1080),nd.RENDERER.setSize(window.canvasWidth,window.canvasHeight),nd.MAIN_CAMERA.aspect=window.canvasWidth/window.canvasHeight,nd.MAIN_CAMERA.updateProjectionMatrix(),Zh.aspect=window.canvasWidth/window.canvasHeight,Zh.updateProjectionMatrix(),nd.PORTAL_GUN_CAMERA.aspect=window.canvasWidth/window.canvasHeight,nd.PORTAL_GUN_CAMERA.updateProjectionMatrix(),nd.COMPOSER&&nd.COMPOSER.setSize(window.canvasWidth,window.canvasHeight),nd.PAUSED&&nd.FPS_MODE&&(nd.RENDERER.setRenderTarget(Bh),nd.RENDERER.localClippingEnabled=!1,nd.RENDERER.clippingPlanes=[],"epic"==localStorage.getItem("quality-select")&&nd.COMPOSER?nd.COMPOSER.render():(nd.RENDERER.autoClear=!1,nd.RENDERER.clear(),nd.RENDERER.render(nd.SCENE,nd.MAIN_CAMERA),document.getElementById("drawcalls").innerHTML="Drawcalls: "+nd.RENDERER.info.render.calls,nd.RENDERER.clearDepth(),nd.RENDERER.render(nd.GUN_GROUP,nd.PORTAL_GUN_CAMERA)))}function O1(e){if(window.stopMenuLoop){if(nd.FPS_MODE){if(!nd.PAUSED){nd.STATS.update(),nd.STATS_UI.time=window.clockTimer.getElapsedTime()+window.curentTimeOffset,nd.LEVEL_ENTERED&&0,Hh++;var t,n=performance.now();n>=Vh+100&&(C1=10*Math.round(100*Hh/(n-Vh)),Hh=0,Vh=n),n=Fh.getDelta(),15<C1&&(Th(n),Ph+=.01,Nh&&Ih&&Ch&&nd.FPS_MODE&&(r=nd.GUN.getObjectByName("cube_1").position,a=nd.GUN.getObjectByName("cube_2").position,t=nd.GUN.getObjectByName("cube_3").position,Nh.rayParameters.sourceOffset.copy(r),Nh.rayParameters.destOffset.copy(nd.PORTAL_GUN_FLASH.position),Ih.rayParameters.sourceOffset.copy(a),Ih.rayParameters.destOffset.copy(nd.PORTAL_GUN_FLASH.position),Ch.rayParameters.sourceOffset.copy(t),Ch.rayParameters.destOffset.copy(nd.PORTAL_GUN_FLASH.position),Nh.update(Ph),Ih.update(Ph),Ch.update(Ph))),nd.CANNON_WORLD.step(1/60,n,3),dh(),o0(),v0(r=zh.getDelta()),Sh(e),w0(),Cv();for(var i=0;i<nd.TRIGGER_BOXES.length;i++)nd.TRIGGER_BOXES[i].item.visible&&(nd.TRIGGER_BOXES[i].item.visible=nd.TRIGGER_BOXES[i].item.userData.triggerVisibility),nd.TRIGGER_BOXES[i].box3.containsPoint(nd.PLAYER.position)?nd.TRIGGER_BOXES[i].item.userData.active||nd.TRIGGER_BOXES[i].item.userData.played&&!nd.TRIGGER_BOXES[i].item.userData.multipleTrigger||(nd.TRIGGER_BOXES[i].item.userData.active=!0,"trigger_save"!=nd.TRIGGER_BOXES[i].instancedName||nd.PLAYER.spawnPosition.equals(nd.TRIGGER_BOXES[i].item.position)?"trigger_voice"==nd.TRIGGER_BOXES[i].instancedName&&Eg(nd.TRIGGER_BOXES[i].item.userData):(rd.POSITIVE.play(),nd.PLAYER.spawnPosition=nd.TRIGGER_BOXES[i].item.position),"trigger_audio"==nd.TRIGGER_BOXES[i].instancedName&&(Eg(nd.TRIGGER_BOXES[i].item.userData),nd.PLANE_USER_DATA[nd.SELECTED_ID[0]].item.userData.soundEffectLoop)&&rd.AMBIENT.pause()):nd.TRIGGER_BOXES[i].item.userData.active=!1;Xg.update();var r=e,e=(Wh=!1,nd.PLAYER&&nd.PLAYER_MODEL&&(ev(nd.PLAYER_MODEL,!1,1),Wh=nd.PLAYER_MODEL_CLONE.visible),nd.RENDERER.shadowMap.autoUpdate),a=(nd.RENDERER.shadowMap.autoUpdate=!1,Bh=nd.RENDERER.getRenderTarget(),nd.RENDERER.xr.enabled=!1,nd.GUN_CLONE.visible=nd.PLAYER_MODEL.visible,new dd);window.hand.getWorldPosition(a),nd.GUN_CLONE.position.copy(a),nd.GUN_CLONE.rotation.y=nd.MAIN_CAMERA.rotation.y,-20<(a=180*nd.MAIN_CAMERA.rotation.x/Math.PI)&&a<30?(window.neck.rotation.y=-nd.MAIN_CAMERA.rotation.x,I1=nd.MAIN_CAMERA.rotation.x):window.neck.rotation.y=-I1,Gh+=kh.getDelta(),nd.RENDERER.autoClearStencil=!1,0<nd.PORTAL_RECURSION_LEVELS?(a=r-Xh)>=qh&&(Xh=r-a%qh,P1(0,1),P1(1,0)):nd.PORTALS[0]&&nd.PORTALS[1]&&1==nd.PORTALS[0].portalShader.material.uniforms.iOpened.value&&(nd.PORTALS[0].mesh.material.uniforms.texture1.value=null,nd.PORTALS[1].mesh.material.uniforms.texture1.value=null,nd.PORTALS[0].portalShader.material.uniforms.iOpened.value=0,nd.PORTALS[1].portalShader.material.uniforms.iOpened.value=0),nd.SCENE_CHILDREN.visible=!0,nd.GUN_CLONE.visible=!1,(nd.GUN_CLONE2.visible=Wh)&&nd.GUN_CLONE2&&window.posW&&(nd.GUN_CLONE2.position.copy(window.posW),nd.GUN_CLONE2.quaternion.copy(nd.PLAYER_MODEL_CLONE.quaternion),nd.GUN_CLONE2.rotation.y+=Math.PI),nd.PLAYER&&nd.PLAYER_MODEL&&(ev(nd.PLAYER_MODEL,!0,0),nd.PLAYER_MODEL_CLONE.visible=Wh),null===nd.PORTALS[0]&&null!==nd.PORTALS[1]&&(nd.PORTALS[1].mesh.visible=!1),null!==nd.PORTALS[0]&&null===nd.PORTALS[1]&&(nd.PORTALS[0].mesh.visible=!1),null!==nd.PORTALS[0]&&null!==nd.PORTALS[1]&&(nd.PORTALS[0].mesh.visible=!0,nd.PORTALS[1].mesh.visible=!0),nd.RENDERER.shadowMap.autoUpdate=e;for(var o=0;o<nd.CAMERA_OBJ_HORIZONTAL.length;o++)nd.CAMERAS[o].fixed&&(nd.CAMERA_OBJ_HORIZONTAL[o].lookAt(nd.PIVOT.position),nd.CAMERA_OBJ_HORIZONTAL[o].rotation.x=0,nd.CAMERA_OBJ_HORIZONTAL[o].rotation.y=0);for(o=0;o<nd.CAMERA_OBJ_VERTICAL.length;o++)nd.CAMERAS[o].fixed&&(nd.CAMERA_OBJ_VERTICAL[o].lookAt(nd.PIVOT.position),nd.CAMERA_OBJ_VERTICAL[o].rotation.z=0,nd.CAMERA_OBJ_VERTICAL[o].rotation.y=0);nd.RENDERER.setRenderTarget(Bh),nd.RENDERER.localClippingEnabled=!1,nd.RENDERER.clippingPlanes=[],"epic"==localStorage.getItem("quality-select")&&nd.COMPOSER?nd.COMPOSER.render():(nd.RENDERER.autoClear=!1,nd.RENDERER.clear(),nd.RENDERER.render(nd.SCENE,nd.MAIN_CAMERA),document.getElementById("drawcalls").innerHTML="Drawcalls: "+nd.RENDERER.info.render.calls,nd.RENDERER.clearDepth(),nd.RENDERER.render(nd.GUN_GROUP,nd.PORTAL_GUN_CAMERA))}}else nd.RENDERER.render(nd.SCENE,nd.MAIN_CAMERA),Xg.update(),document.getElementById("drawcalls").innerHTML="Drawcalls: "+nd.RENDERER.info.render.calls;var s;nd.FPS_MODE&&null!==vh&&(1!=(s=navigator.getGamepads()[vh]).buttons[9].value||s.buttons[9].pressed2?1!=s.buttons[0].value||s.buttons[0].pressed2||"block"==td()("#blocker").css("display")&&(console.log("A"),s.buttons[0].pressed2=!0,setTimeout(()=>{s.buttons[0].pressed2=!1},100),(nd.FINISHED?td()("#next-map-btn"):td()("#settings-close")).trigger("click")):(console.log("start"),s.buttons[9].pressed2=!0,setTimeout(()=>{s.buttons[9].pressed2=!1},100),document.exitPointerLock(),r1()))}}($h=document.createElement("div")).id="main-container",document.body.appendChild($h),nd.STATS=new Qh({trackGPU:!0,trackHz:!0,trackCPT:!0,logsPerSecond:4,graphsPerSecond:30,samplesLog:40,samplesGraph:10,precision:2,horizontal:!0,minimal:!1,mode:0}),$h.appendChild(nd.STATS.dom),nd.STATS.init(nd.RENDERER),Qh=new dA(2,2,2),$h=new _d({color:65280}),nd.ITEM_CUBE=new xd(Qh,$h),nd.ITEM_CUBE.visible=!1,nd.ITEM_CUBE.name="ITEM_CUBE",document.getElementById("container").appendChild(nd.RENDERER.domElement),nd.RENDERER.info.autoReset=!0;let Yh=60,qh=("very_low"==localStorage.getItem("quality-select")?Yh=20:"low"==localStorage.getItem("quality-select")?Yh=30:"medium"==localStorage.getItem("quality-select")&&(Yh=40),window.curentTimeOffset=0,window.clockTimer=new dT,1e3/Yh),Xh=0,Zh=nd.MAIN_CAMERA.clone();function P1(t,n){if(null!==nd.PORTALS[t]&&null!==nd.PORTALS[n]){var i,e=new hd,{width:e,height:r}=(nd.MAIN_CAMERA.getWorldQuaternion(e),Zh.position.copy(nd.PIVOT.position),Zh.quaternion.copy(e),nd.RENDERER.domElement),a=(nd.PORTALS[t].mesh.material.uniforms.ww.value=e,nd.PORTALS[t].mesh.material.uniforms.wh.value=r,nd.PORTAL_TARGETS[t].setSize(e,r),nd.PORTAL_TMP_TARGETS[t].setSize(e,r),nd.PORTALS[t].mesh.material.stencilWrite=!0,nd.RENDERER.clearStencil(),nd.RENDERER.setRenderTarget(null),new Array(nd.PORTAL_RECURSION_LEVELS+1));a[0]=B1(Zh,nd.PORTALS[t],null);for(let e=0;e<nd.PORTAL_RECURSION_LEVELS;e++)a[e+1]=B1(Zh,nd.PORTALS[t],nd.PORTALS[n].plane)&&a[e],U1(nd.PORTALS[t],Zh);nd.MOBILE?(nd.PORTALS[t].mesh.visible=!1,nd.PORTALS[n].mesh.visible=!1):(nd.PORTALS[t].visible=!1,nd.PORTALS[n].visible=!1),nd.RENDERER.localClippingEnabled=!0;for(let e=nd.PORTAL_RECURSION_LEVELS-1;0<=e;e--)0==e?(nd.PLAYER_MODEL_CLONE.visible=!1,nd.GUN_CLONE2.visible=!1):(nd.PLAYER_MODEL_CLONE.visible=Wh,nd.GUN_CLONE2.visible=Wh),e>nd.PORTAL_RENDER_LEVEL?nd.SCENE_CHILDREN.visible=!1:nd.SCENE_CHILDREN.visible=!0,a[e]?(nd.RENDERER.clippingPlanes=[nd.PORTALS[n].plane.clone()],nd.RENDERER.setRenderTarget(nd.PORTAL_TMP_TARGETS[t]),nd.RENDERER.clear(),nd.RENDERER.render(nd.SCENE,Zh),i=nd.PORTAL_TARGETS[t],nd.PORTAL_TARGETS[t]=nd.PORTAL_TMP_TARGETS[t],nd.PORTAL_TMP_TARGETS[t]=i,nd.PORTALS[t].mesh.material.uniforms.texture1.value=nd.PORTAL_TARGETS[t].texture,U1(nd.PORTALS[n],Zh),nd.PORTALS[t].visible=!0):U1(nd.PORTALS[n],Zh);nd.MOBILE?(nd.PORTALS[t].mesh.visible=!0,nd.PORTALS[n].mesh.visible=!0):(nd.PORTALS[t].visible=!0,nd.PORTALS[n].visible=!0),nd.PORTALS[t].mesh.material.stencilWrite=!1}}function U1(e,t){var n=(new fd).makeScale(-1,-1,1),n=e.CDBB.inverse_t.clone().premultiply(n).premultiply(e.output.CDBB.t);t.applyMatrix4(n)}function B1(e,t,n){return e.updateMatrix(),e.updateMatrixWorld(),jh.setFromProjectionMatrix((new fd).multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse)),jh.intersectsObject(t.mesh)&&(null===n||0<n.distanceToPoint(t.mesh.position))&&0<t.plane.distanceToPoint(e.position)}var F1="@vercel/analytics",z1="1.4.1",k1=()=>{window.va||(window.va=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];(window.vaq=window.vaq||[]).push(t)})};function G1(){return"undefined"!=typeof window}function H1(){try{}catch(e){}return"production"}function V1(){return(G1()?window.vam:H1())||"production"}function W1(){return"development"===V1()}var j1="https://va.vercel-scripts.com/v1/script.debug.js",Y1="/_vercel/insights/script.js";function q1(e){var n,e=0<arguments.length&&void 0!==e?e:{debug:!0};if(G1()){!function(e){e=0<arguments.length&&void 0!==e?e:"auto",window.vam="auto"===e?H1():e}(e.mode),k1(),e.beforeSend&&null!=(n=window.va)&&n.call(window,"beforeSend",e.beforeSend);let t=e.scriptSrc||(W1()?j1:Y1);document.head.querySelector(`script[src*="${t}"]`)||((n=document.createElement("script")).src=t,n.defer=!0,n.dataset.sdkn=F1+(e.framework?"/"+e.framework:""),n.dataset.sdkv=z1,e.disableAutoTrack&&(n.dataset.disableAutoTrack="1"),e.endpoint&&(n.dataset.endpoint=e.endpoint),e.dsn&&(n.dataset.dsn=e.dsn),n.onerror=()=>{var e=W1()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${t}. `+e)},W1()&&!1===e.debug&&(n.dataset.debug="false"),document.head.appendChild(n))}}function X1(i){return(0,Ld.useEffect)(()=>{var e;i.beforeSend&&null!=(e=window.va)&&e.call(window,"beforeSend",i.beforeSend)},[i.beforeSend]),(0,Ld.useEffect)(()=>{q1({framework:i.framework||"react",...void 0!==i.route&&{disableAutoTrack:!0},...i})},[]),(0,Ld.useEffect)(()=>{var e,t,n;i.route&&i.path&&({route:t,path:n}=t={route:i.route,path:i.path},null!=(e=window.va))&&e.call(window,"pageview",{route:t,path:n})},[i.route,i.path]),null}var Z1=Kh(579);function K1(){return(0,Z1.jsx)("div",{className:"App",children:(0,Z1.jsx)(X1,{})})}Qh=a=>{a&&a instanceof Function&&Kh.e(453).then(Kh.bind(Kh,453)).then(e=>{var{getCLS:e,getFID:t,getFCP:n,getLCP:i,getTTFB:r}=e;e(a),t(a),n(a),i(a),r(a)})},Dd.createRoot(document.getElementById("root")).render((0,Z1.jsx)(Ld.StrictMode,{children:(0,Z1.jsx)(K1,{})})),Qh()}})();